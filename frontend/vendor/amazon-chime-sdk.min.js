"use strict";var ChimeSDK=(()=>{var fz=Object.create;var fu=Object.defineProperty;var hz=Object.getOwnPropertyDescriptor;var pz=Object.getOwnPropertyNames;var mz=Object.getPrototypeOf,gz=Object.prototype.hasOwnProperty;var h=(i,t)=>()=>(i&&(t=i(i=0)),t);var y=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),hu=(i,t)=>{for(var e in t)fu(i,e,{get:t[e],enumerable:!0})},SI=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of pz(t))!gz.call(i,n)&&n!==e&&fu(i,n,{get:()=>t[n],enumerable:!(r=hz(t,n))||r.enumerable});return i};var yI=(i,t,e)=>(e=i!=null?fz(mz(i)):{},SI(t||!i||!i.__esModule?fu(e,"default",{value:i,enumerable:!0}):e,i)),pu=i=>SI(fu({},"__esModule",{value:!0}),i);var Fr=y(Lp=>{"use strict";Object.defineProperty(Lp,"__esModule",{value:!0});var Np=class i{constructor(t){this.ids=new Set(t)}add(t){this.ids.add(t)}array(){return Array.from(this.ids.values()).sort((e,r)=>e-r)}contain(t){return this.ids.has(t)}forEach(t){this.ids.forEach(t)}empty(){return this.ids.size===0}size(){return this.ids.size}equal(t){if(!t)return this.ids.size===0;let e=this.array(),r=t.array();if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0}clone(){return new i(this.array())}remove(t){this.ids.delete(t)}toJSON(){return this.array()}truncate(t){let e=this.array();return new i(e.splice(0,t))}};Lp.default=Np});var gu=y(pa=>{"use strict";var Sz=pa&&pa.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(pa,"__esModule",{value:!0});var Fp=Sz(Fr()),mu=class i{constructor(t){this.selfAttendeeId=t,this.reset()}reset(){this.optimalReceiveSet=new Fp.default,this.subscribedReceiveSet=new Fp.default,this.videoSources=void 0}updateIndex(t){this.videoIndex=t,this.optimalReceiveSet=this.calculateOptimalReceiveSet(t)}updateMetrics(t){}wantsResubscribe(){return!this.subscribedReceiveSet.equal(this.optimalReceiveSet)}chooseSubscriptions(){return this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveSet.clone()}chooseRemoteVideoSources(t){this.videoSources=t,this.optimalReceiveSet=this.calculateOptimalReceiveSet(this.videoIndex).clone()}calculateOptimalReceiveSet(t){let e=new Fp.default;if(!this.videoIndex||this.videoIndex.allStreams().empty())return e;let r=t.highestQualityStreamFromEachGroupExcludingSelf(this.selfAttendeeId),n=this.videoSources?this.videoSources:this.videoIndex.allVideoSendingSourcesExcludingSelf(this.selfAttendeeId),o=this.videoIndex.remoteStreamDescriptions(),s=new Map;for(let l of o)r.contain(l.streamId)&&s.set(l.attendeeId,l);let a=0;for(let l of n){let c=l.attendee.attendeeId;if(s.has(c)){let d=s.get(c);if(a+d.maxBitrateKbps<=i.maxReceiveBitrateKbps)e.add(d.streamId),a+=d.maxBitrateKbps;else{console.warn("total bitrate "+(a+d.maxBitrateKbps)+" exceeds maximum limit (15000). Use chooseRemoteVideoSources to select a subset of participants to avoid this.");break}}}return e}};pa.default=mu;mu.maxReceiveBitrateKbps=15e3});var vI=y(Vp=>{"use strict";Object.defineProperty(Vp,"__esModule",{value:!0});var Bp=class i{constructor(t,e){this.appName=t,this.appVersion=e}static create(t,e){let r=/^[a-zA-Z0-9]+[a-zA-Z0-9_-]*[a-zA-Z0-9]+$/g;if(!t||t.length>32)throw new Error("appName should be a valid string and 1 to 32 characters in length");if(!r.test(t))throw new Error(`appName must satisfy ${r} regular expression`);let n=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/gm;if(!e||e.length>32)throw new Error("appVersion should be a valid string and 1 to 32 characters in length");if(!n.test(e))throw new Error("appVersion must satisfy Semantic Versioning format");return new i(t,e)}};Vp.default=Bp});var Ro=y(qp=>{"use strict";Object.defineProperty(qp,"__esModule",{value:!0});var Up=class{constructor(t){this.timeoutMs=t,this.timer=null}start(t){this.stop(),this.timer=setTimeout(()=>{clearTimeout(this.timer),t()},this.timeoutMs)}stop(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}};qp.default=Up});var wt=y(ma=>{"use strict";var yz=ma&&ma.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ma,"__esModule",{value:!0});var vz=yz(Ro()),Hp=class extends vz.default{constructor(){super(0)}static nextTick(t){setTimeout(t,0)}};ma.default=Hp});var Su=y(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.VideoLogEvent=void 0;var bI;(function(i){i[i.InputAttached=0]="InputAttached",i[i.SendingFailed=1]="SendingFailed",i[i.SendingSuccess=2]="SendingSuccess"})(bI=Do.VideoLogEvent||(Do.VideoLogEvent={}));Do.default=bI});var Bt=y(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.LogLevel=void 0;var wI;(function(i){i[i.DEBUG=0]="DEBUG",i[i.INFO=1]="INFO",i[i.WARN=2]="WARN",i[i.ERROR=3]="ERROR",i[i.OFF=4]="OFF"})(wI=No.LogLevel||(No.LogLevel={}));No.default=wI});var $p=y(ga=>{"use strict";var _I=ga&&ga.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ga,"__esModule",{value:!0});var bz=_I(Bt()),CI=_I(wt()),zp=class{constructor(t,e,r){this.logger=t,this.task=e,this.dependencies=r,this.canceled=!1}name(){return`${this.task.name()} (once)`}cancel(){if(!this.canceled){if(this.dependencies)for(let t of this.dependencies)t.cancel();this.logger.info(`Canceling ${this.name()}`),CI.default.nextTick(()=>this.task.cancel()),this.canceled=!0,this.cancelPromise&&CI.default.nextTick(()=>this.cancelPromise(new Error(`canceling ${this.name()}`)))}}logDependencies(){if(this.logger.getLogLevel()>bz.default.INFO||!this.dependencies)return;let t=this.dependencies.filter(e=>e).map(e=>e.name()).join(", ");this.logger.info(`${this.task.name()} waiting for dependencies: ${t}`)}run(){if(this.promise)return this.promise;let t=this.dependencies?Promise.all(this.dependencies.map(e=>e?.run())):Promise.resolve();return this.logDependencies(),this.ongoing=t.then(()=>this.task.run()),this.promise=new Promise((e,r)=>{this.cancelPromise=r,this.ongoing.then(e).catch(r)})}setParent(t){this.task.setParent(t)}};ga.default=zp});var yu=y(Wp=>{"use strict";Object.defineProperty(Wp,"__esModule",{value:!0});var jp;(function(i){i.IDLE="IDLE",i.RUNNING="RUNNING",i.CANCELED="CANCELED",i.FINISHED="FINISHED"})(jp||(jp={}));Wp.default=jp});var _e=y(Br=>{"use strict";var wz=Br&&Br.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},TI=Br&&Br.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Br,"__esModule",{value:!0});var Cz=TI($p()),di=TI(yu()),Gp=class{constructor(t){this.logger=t,this.taskName="BaseTask",this.parentTask=null,this.status=di.default.IDLE,this.run=this.baseRun.bind(this,this.run),this.cancel=this.baseCancel.bind(this,this.cancel)}once(...t){return new Cz.default(this.logger,this,t)}cancel(){}name(){return this.parentTask?`${this.parentTask.name()}/${this.taskName}`:this.taskName}setParent(t){this.parentTask=t}getStatus(){return this.status}logAndThrow(t){throw this.logger.info(t),new Error(t)}baseRun(t){return wz(this,void 0,void 0,function*(){try{let e=Date.now();switch(this.logger.info(`running task ${this.name()}`),this.status){case di.default.RUNNING:this.logAndThrow(`${this.name()} is already running`);case di.default.CANCELED:this.logAndThrow(`${this.name()} was canceled before running`);case di.default.FINISHED:this.logAndThrow(`${this.name()} was already finished`)}this.status=di.default.RUNNING,yield t.call(this),this.logger.info(`${this.name()} took ${Math.round(Date.now()-e)} ms`)}catch(e){throw e}finally{this.status!==di.default.CANCELED&&(this.status=di.default.FINISHED)}})}baseCancel(t){if(this.status===di.default.CANCELED||this.status===di.default.FINISHED){this.logger.info(`Not canceling ${this.name()}: state is ${this.status}`);return}this.logger.info(`canceling task ${this.name()}`),this.status=di.default.CANCELED,t.call(this)}};Br.default=Gp});var Jp=y(Vr=>{"use strict";var _z=Vr&&Vr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},EI=Vr&&Vr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Vr,"__esModule",{value:!0});var Tz=EI(Su()),Ez=EI(_e()),Kp=class extends Ez.default{constructor(t){super(t.logger),this.context=t,this.taskName="AttachMediaInputTask"}run(){return _z(this,void 0,void 0,function*(){let t=this.context.transceiverController;t.setPeer(this.context.peer),t.setupLocalTransceivers();let e=this.context.activeAudioInput;if(e){let n=e.getAudioTracks();this.context.logger.info("attaching audio track to peer connection"),yield t.setAudioInput(n.length?n[0]:null)}else yield t.setAudioInput(null),this.context.logger.info("no audio track");this.setAudioCodecPreferences();let r=this.context.activeVideoInput;if(r){let n=r.getVideoTracks(),o=n.length?n[0]:null;if(this.context.logger.info("attaching video track to peer connection"),yield t.setVideoInput(o),this.context.enableSimulcast&&this.context.videoUplinkBandwidthPolicy){let s=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();t.setEncodingParameters(s)}o&&this.context.statsCollector.logVideoEvent(Tz.default.InputAttached,this.context.videoDeviceInformation)}else yield t.setVideoInput(null),this.context.logger.info("no video track");this.context.videoSubscriptions=t.updateVideoTransceivers(this.context.videoStreamIndex,this.context.videosToReceive),this.context.videoStreamIndex.subscribeFrameSent()})}setAudioCodecPreferences(){let t=window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype,e=this.context.audioProfile.hasRedundancyEnabled();if(!t){this.context.logger.warn("Setting codec preferences not supported");return}let r=this.context.transceiverController.localAudioTransceiver(),{codecs:n}=RTCRtpSender.getCapabilities("audio");this.context.logger.debug(`Available audio codecs ${JSON.stringify(n,null,4)}`);let o=n.findIndex(s=>s.mimeType==="audio/red");if(!r){this.context.logger.error("audio transceiver is null");return}if(o>=0){let s=n[o];n.splice(o,1),e?(n.unshift(s),this.context.logger.info("audio/red set as preferred codec")):this.context.logger.info("audio/red removed from preferred codec"),r.setCodecPreferences(n);return}this.context.logger.info("audio/red codec not supported")}};Vr.default=Kp});var Yp=y(Xp=>{"use strict";Object.defineProperty(Xp,"__esModule",{value:!0});var Qp=class{};Xp.default=Qp});var vu=y(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.AudioLogEvent=void 0;var II;(function(i){i[i.DeviceChanged=0]="DeviceChanged",i[i.MutedLocal=1]="MutedLocal",i[i.UnmutedLocal=2]="UnmutedLocal",i[i.Connected=3]="Connected",i[i.ConnectFailed=4]="ConnectFailed",i[i.RedmicStartLoss=5]="RedmicStartLoss",i[i.RedmicEndLoss=6]="RedmicEndLoss"})(II=Lo.AudioLogEvent||(Lo.AudioLogEvent={}));Lo.default=II});var BI={};hu(BI,{BotInfo:()=>RI,BrowserInfo:()=>xI,NodeInfo:()=>OI,ReactNativeInfo:()=>DI,SearchBotDeviceInfo:()=>PI,browserName:()=>xz,detect:()=>Mz,detectOS:()=>LI,getNodeVersion:()=>FI,parseUserAgent:()=>Zp});function Mz(i){return i?Zp(i):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new DI:typeof navigator<"u"?Zp(navigator.userAgent):FI()}function NI(i){return i!==""&&kz.reduce(function(t,e){var r=e[0],n=e[1];if(t)return t;var o=n.exec(i);return!!o&&[r,o]},!1)}function xz(i){var t=NI(i);return t?t[0]:null}function Zp(i){var t=NI(i);if(!t)return null;var e=t[0],r=t[1];if(e==="searchbot")return new RI;var n=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);n?n.length<kI&&(n=AI(AI([],n,!0),Oz(kI-n.length),!0)):n=[];var o=n.join("."),s=LI(i),a=Az.exec(i);return a&&a[1]?new PI(e,o,s,a[1]):new xI(e,o,s)}function LI(i){for(var t=0,e=MI.length;t<e;t++){var r=MI[t],n=r[0],o=r[1],s=o.exec(i);if(s)return n}return null}function FI(){var i=typeof process<"u"&&process.version;return i?new OI(process.version.slice(1)):null}function Oz(i){for(var t=[],e=0;e<i;e++)t.push("0");return t}var AI,xI,OI,PI,RI,DI,Iz,Az,kI,kz,MI,VI=h(()=>{AI=function(i,t,e){if(e||arguments.length===2)for(var r=0,n=t.length,o;r<n;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return i.concat(o||Array.prototype.slice.call(t))},xI=(function(){function i(t,e,r){this.name=t,this.version=e,this.os=r,this.type="browser"}return i})(),OI=(function(){function i(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return i})(),PI=(function(){function i(t,e,r,n){this.name=t,this.version=e,this.os=r,this.bot=n,this.type="bot-device"}return i})(),RI=(function(){function i(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return i})(),DI=(function(){function i(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return i})(),Iz=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Az=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,kI=3,kz=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Iz]],MI=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]]});var wu=y((Sa,bu)=>{(function(i,t){"use strict";var e="1.0.41",r="",n="?",o="function",s="undefined",a="object",l="string",c="major",d="model",u="name",f="type",m="vendor",S="version",T="architecture",_="console",C="mobile",I="tablet",A="smarttv",E="wearable",V="embedded",W=500,D="Amazon",N="Apple",F="ASUS",G="BlackBerry",oe="Browser",ze="Chrome",oi="Edge",Ai="Firefox",ki="Google",oI="Honor",sI="Huawei",dz="Lenovo",cu="LG",Ap="Microsoft",kp="Motorola",Mp="Nvidia",aI="OnePlus",da="Opera",xp="OPPO",ca="Samsung",dI="Sharp",la="Sony",Op="Xiaomi",Pp="Zebra",cI="Facebook",lI="Chromium OS",uI="Mac OS",fI=" Browser",cz=function(ge,ve){var ae={};for(var Ie in ge)ve[Ie]&&ve[Ie].length%2===0?ae[Ie]=ve[Ie].concat(ge[Ie]):ae[Ie]=ge[Ie];return ae},lu=function(ge){for(var ve={},ae=0;ae<ge.length;ae++)ve[ge[ae].toUpperCase()]=ge[ae];return ve},hI=function(ge,ve){return typeof ge===l?ua(ve).indexOf(ua(ge))!==-1:!1},ua=function(ge){return ge.toLowerCase()},lz=function(ge){return typeof ge===l?ge.replace(/[^\d\.]/g,r).split(".")[0]:t},Rp=function(ge,ve){if(typeof ge===l)return ge=ge.replace(/^\s\s*/,r),typeof ve===s?ge:ge.substring(0,W)},fa=function(ge,ve){for(var ae=0,Ie,Mi,si,we,se,ai;ae<ve.length&&!se;){var Dp=ve[ae],gI=ve[ae+1];for(Ie=Mi=0;Ie<Dp.length&&!se&&Dp[Ie];)if(se=Dp[Ie++].exec(ge),se)for(si=0;si<gI.length;si++)ai=se[++Mi],we=gI[si],typeof we===a&&we.length>0?we.length===2?typeof we[1]==o?this[we[0]]=we[1].call(this,ai):this[we[0]]=we[1]:we.length===3?typeof we[1]===o&&!(we[1].exec&&we[1].test)?this[we[0]]=ai?we[1].call(this,ai,we[2]):t:this[we[0]]=ai?ai.replace(we[1],we[2]):t:we.length===4&&(this[we[0]]=ai?we[3].call(this,ai.replace(we[1],we[2])):t):this[we]=ai||t;ae+=2}},ha=function(ge,ve){for(var ae in ve)if(typeof ve[ae]===a&&ve[ae].length>0){for(var Ie=0;Ie<ve[ae].length;Ie++)if(hI(ve[ae][Ie],ge))return ae===n?t:ae}else if(hI(ve[ae],ge))return ae===n?t:ae;return ve.hasOwnProperty("*")?ve["*"]:ge},uz={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},pI={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},mI={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,S],[/opios[\/ ]+([\w\.]+)/i],[S,[u,da+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[u,da+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[u,da]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[u,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[S,[u,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[u,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[u,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[u,"UC"+oe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[u,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[u,"Smart Lenovo "+oe]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+oe],S],[/\bfocus\/([\w\.]+)/i],[S,[u,Ai+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[u,da+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[u,da+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[u,"MIUI"+fI]],[/fxios\/([\w\.-]+)/i],[S,[u,Ai]],[/\bqihoobrowser\/?([\w\.]*)/i],[S,[u,"360"]],[/\b(qq)\/([\w\.]+)/i],[[u,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1"+fI],S],[/samsungbrowser\/([\w\.]+)/i],[S,[u,ca+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[S,[u,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[u,"Sogou Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[u,S],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[u],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[S,u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,cI],S],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[u,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[u,ze+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,ze+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[u,"Android "+oe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[S,ha,uz]],[/(webkit|khtml)\/([\w\.]+)/i],[u,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],S],[/(wolvic|librewolf)\/([\w\.]+)/i],[u,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[u,Ai+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[u,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[u,[S,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[T,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[T,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[T,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[T,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[T,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[T,/ower/,r,ua]],[/ sun4\w[;\)]/i],[[T,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[T,ua]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[m,ca],[f,I]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[m,ca],[f,C]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[m,N],[f,C]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[m,N],[f,I]],[/(macintosh);/i],[d,[m,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[m,dI],[f,C]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[d,[m,oI],[f,I]],[/honor([-\w ]+)[;\)]/i],[d,[m,oI],[f,C]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[d,[m,sI],[f,I]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[m,sI],[f,C]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[d,/_/g," "],[m,Op],[f,I]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[d,/_/g," "],[m,Op],[f,C]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[m,xp],[f,C]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[d,[m,ha,{OnePlus:["304","403","203"],"*":xp}],[f,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[m,"Vivo"],[f,C]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[m,"Realme"],[f,C]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[m,kp],[f,C]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[m,kp],[f,I]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[m,cu],[f,I]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[m,cu],[f,C]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[d,[m,dz],[f,I]],[/(nokia) (t[12][01])/i],[m,d,[f,I]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[d,/_/g," "],[f,C],[m,"Nokia"]],[/(pixel (c|tablet))\b/i],[d,[m,ki],[f,I]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[m,ki],[f,C]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[m,la],[f,C]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[m,la],[f,I]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[m,aI],[f,C]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[m,D],[f,I]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[m,D],[f,C]],[/(playbook);[-\w\),; ]+(rim)/i],[d,m,[f,I]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[m,G],[f,C]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[m,F],[f,I]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[m,F],[f,C]],[/(nexus 9)/i],[d,[m,"HTC"],[f,I]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[d,/_/g," "],[f,C]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[m,"TCL"],[f,I]],[/(itel) ((\w+))/i],[[m,ua],d,[f,ha,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[m,"Acer"],[f,I]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[m,"Meizu"],[f,C]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[m,"Ulefone"],[f,C]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[d,[m,"Energizer"],[f,C]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[d,[m,"Cat"],[f,C]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[d,[m,"Smartfren"],[f,C]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[m,"Nothing"],[f,C]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[d,[m,"Archos"],[f,I]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[d,[m,"Archos"],[f,C]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[m,d,[f,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[m,d,[f,C]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,d,[f,I]],[/(surface duo)/i],[d,[m,Ap],[f,I]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[m,"Fairphone"],[f,C]],[/(u304aa)/i],[d,[m,"AT&T"],[f,C]],[/\bsie-(\w*)/i],[d,[m,"Siemens"],[f,C]],[/\b(rct\w+) b/i],[d,[m,"RCA"],[f,I]],[/\b(venue[\d ]{2,7}) b/i],[d,[m,"Dell"],[f,I]],[/\b(q(?:mv|ta)\w+) b/i],[d,[m,"Verizon"],[f,I]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[m,"Barnes & Noble"],[f,I]],[/\b(tm\d{3}\w+) b/i],[d,[m,"NuVision"],[f,I]],[/\b(k88) b/i],[d,[m,"ZTE"],[f,I]],[/\b(nx\d{3}j) b/i],[d,[m,"ZTE"],[f,C]],[/\b(gen\d{3}) b.+49h/i],[d,[m,"Swiss"],[f,C]],[/\b(zur\d{3}) b/i],[d,[m,"Swiss"],[f,I]],[/\b((zeki)?tb.*\b) b/i],[d,[m,"Zeki"],[f,I]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],d,[f,I]],[/\b(ns-?\w{0,9}) b/i],[d,[m,"Insignia"],[f,I]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[m,"NextBook"],[f,I]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],d,[f,C]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],d,[f,C]],[/\b(ph-1) /i],[d,[m,"Essential"],[f,C]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[m,"Envizen"],[f,I]],[/\b(trio[-\w\. ]+) b/i],[d,[m,"MachSpeed"],[f,I]],[/\btu_(1491) b/i],[d,[m,"Rotor"],[f,I]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[d,[m,Mp],[f,I]],[/(sprint) (\w+)/i],[m,d,[f,C]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[m,Ap],[f,C]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[m,Pp],[f,I]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[m,Pp],[f,C]],[/smart-tv.+(samsung)/i],[m,[f,A]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[m,ca],[f,A]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,cu],[f,A]],[/(apple) ?tv/i],[m,[d,N+" TV"],[f,A]],[/crkey/i],[[d,ze+"cast"],[m,ki],[f,A]],[/droid.+aft(\w+)( bui|\))/i],[d,[m,D],[f,A]],[/(shield \w+ tv)/i],[d,[m,Mp],[f,A]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[m,dI],[f,A]],[/(bravia[\w ]+)( bui|\))/i],[d,[m,la],[f,A]],[/(mi(tv|box)-?\w+) bui/i],[d,[m,Op],[f,A]],[/Hbbtv.*(technisat) (.*);/i],[m,d,[f,A]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,Rp],[d,Rp],[f,A]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[d,[f,A]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,A]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,d,[f,_]],[/droid.+; (shield)( bui|\))/i],[d,[m,Mp],[f,_]],[/(playstation \w+)/i],[d,[m,la],[f,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[m,Ap],[f,_]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[d,[m,ca],[f,E]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[m,d,[f,E]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[d,[m,xp],[f,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[m,N],[f,E]],[/(opwwe\d{3})/i],[d,[m,aI],[f,E]],[/(moto 360)/i],[d,[m,kp],[f,E]],[/(smartwatch 3)/i],[d,[m,la],[f,E]],[/(g watch r)/i],[d,[m,cu],[f,E]],[/droid.+; (wt63?0{2,3})\)/i],[d,[m,Pp],[f,E]],[/droid.+; (glass) \d/i],[d,[m,ki],[f,E]],[/(pico) (4|neo3(?: link|pro)?)/i],[m,d,[f,E]],[/; (quest( \d| pro)?)/i],[d,[m,cI],[f,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[f,V]],[/(aeobc)\b/i],[d,[m,D],[f,V]],[/(homepod).+mac os/i],[d,[m,N],[f,V]],[/windows iot/i],[[f,V]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[f,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[f,I]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,I]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,C]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[d,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[u,oi+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[u,S],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,S],[/ladybird\//i],[[u,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,S],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[u,[S,ha,pI]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,ha,pI],[u,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,uI],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,u],[/(ubuntu) ([\w\.]+) like android/i],[[u,/(.+)/,"$1 Touch"],S],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[u,S],[/\(bb(10);/i],[S,[u,G]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[S,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[u,Ai+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[u,ze+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,lI],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,S],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,S]]},ht=function(ge,ve){if(typeof ge===a&&(ve=ge,ge=t),!(this instanceof ht))return new ht(ge,ve).getResult();var ae=typeof i!==s&&i.navigator?i.navigator:t,Ie=ge||(ae&&ae.userAgent?ae.userAgent:r),Mi=ae&&ae.userAgentData?ae.userAgentData:t,si=ve?cz(mI,ve):mI,we=ae&&ae.userAgent==Ie;return this.getBrowser=function(){var se={};return se[u]=t,se[S]=t,fa.call(se,Ie,si.browser),se[c]=lz(se[S]),we&&ae&&ae.brave&&typeof ae.brave.isBrave==o&&(se[u]="Brave"),se},this.getCPU=function(){var se={};return se[T]=t,fa.call(se,Ie,si.cpu),se},this.getDevice=function(){var se={};return se[m]=t,se[d]=t,se[f]=t,fa.call(se,Ie,si.device),we&&!se[f]&&Mi&&Mi.mobile&&(se[f]=C),we&&se[d]=="Macintosh"&&ae&&typeof ae.standalone!==s&&ae.maxTouchPoints&&ae.maxTouchPoints>2&&(se[d]="iPad",se[f]=I),se},this.getEngine=function(){var se={};return se[u]=t,se[S]=t,fa.call(se,Ie,si.engine),se},this.getOS=function(){var se={};return se[u]=t,se[S]=t,fa.call(se,Ie,si.os),we&&!se[u]&&Mi&&Mi.platform&&Mi.platform!="Unknown"&&(se[u]=Mi.platform.replace(/chrome os/i,lI).replace(/macos/i,uI)),se},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ie},this.setUA=function(se){return Ie=typeof se===l&&se.length>W?Rp(se,W):se,this},this.setUA(Ie),this};ht.VERSION=e,ht.BROWSER=lu([u,S,c]),ht.CPU=lu([T]),ht.DEVICE=lu([d,m,f,_,C,A,I,E,V]),ht.ENGINE=ht.OS=lu([u,S]),typeof Sa!==s?(typeof bu!==s&&bu.exports&&(Sa=bu.exports=ht),Sa.UAParser=ht):typeof define===o&&define.amd?define(function(){return ht}):typeof i!==s&&(i.UAParser=ht);var Po=typeof i!==s&&(i.jQuery||i.Zepto);if(Po&&!Po.ua){var uu=new ht;Po.ua=uu.getResult(),Po.ua.get=function(){return uu.getUA()},Po.ua.set=function(ge){uu.setUA(ge);var ve=uu.getResult();for(var ae in ve)Po.ua[ae]=ve[ae]}}})(typeof window=="object"?window:Sa)});var We=y(va=>{"use strict";var Pz=va&&va.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(va,"__esModule",{value:!0});var Rz=(VI(),pu(BI)),Dz=wu(),ya=class i{constructor(){this.FALLBACK_BROWSER={type:"browser",name:"unknown",version:"unknown",os:"unknown"},this.browser=Rz.detect()||this.FALLBACK_BROWSER,this.uaParserResult=navigator&&navigator.userAgent?new Dz.UAParser(navigator.userAgent).getResult():null,this.browserSupport={chrome:78,"edge-chromium":79,electron:7,firefox:75,ios:13,safari:13,opera:66,samsung:12,crios:86,fxios:23,"ios-webview":605,"chromium-webview":92},this.browserName={chrome:"Google Chrome","edge-chromium":"Microsoft Edge",electron:"Electron",firefox:"Mozilla Firefox",ios:"Safari iOS",safari:"Safari",opera:"Opera",samsung:"Samsung Internet",crios:"Chrome iOS",fxios:"Firefox iOS","ios-webview":"WKWebView iOS","chromium-webview":"Chrome WebView"},this.chromeLike=["chrome","edge-chromium","chromium-webview","opera","samsung"],this.webkitBrowsers=["crios","fxios","safari","ios","ios-webview","edge-ios"]}version(){return this.browser.version}majorVersion(){return this.version()!==null?parseInt(this.version().split(".")[0]):-1}osMajorVersion(){return parseInt(this.uaParserResult.os.version.split(".")[0])}engine(){return this.uaParserResult.engine.name}engineMajorVersion(){return parseInt(this.uaParserResult.engine.version.split(".")[0])}name(){return this.browser.name}hasChromiumWebRTC(){for(let t of this.chromeLike)if(t===this.browser.name)return!0;return!1}hasWebKitWebRTC(){for(let t of this.webkitBrowsers)if(t===this.browser.name)return!0;return!1}hasFirefoxWebRTC(){return this.isFirefox()}requiresPlaybackLatencyHintForAudioContext(){return navigator.userAgent.indexOf("Windows")!==-1}supportsCanvasCapturedStreamPlayback(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()&&!this.isIOSEdge()||this.isIOSSafari()&&this.majorVersion()>=i.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK||this.majorVersion()>=i.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK}supportsBackgroundFilter(){return!(this.name()==="safari"&&this.majorVersion()===15||!this.supportsCanvasCapturedStreamPlayback())}supportsVideoLayersAllocationRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsDependencyDescriptorRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsScalableVideoCoding(){return this.hasChromiumWebRTC()&&this.engine()==="Blink"&&this.engineMajorVersion()>=111}supportsAudioRedundancy(){return this.hasChromiumWebRTC()?this.engineMajorVersion()>=107:!this.hasFirefoxWebRTC()}requiresResolutionAlignment(t,e){return this.isAndroid()&&this.isPixel3()?[Math.ceil(t/64)*64,Math.ceil(e/64)*64]:[t,e]}requiresCheckForSdpConnectionAttributes(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}requiresIceCandidateGatheringTimeoutWorkaround(){return this.hasChromiumWebRTC()}requiresBundlePolicy(){return"max-bundle"}requiresNoExactMediaStreamConstraints(){return this.isSamsungInternet()}requiresGroupIdMediaStreamConstraints(){return this.isSamsungInternet()}getDisplayMediaAudioCaptureSupport(){return this.isChrome()||this.isEdge()}doesNotSupportMediaDeviceLabels(){return this.browser.name==="chromium-webview"}isSupported(){return!(!this.browserSupport[this.browser.name]||this.majorVersion()<this.browserSupport[this.browser.name]||this.browser.name==="firefox"&&this.isAndroid())}isSimulcastSupported(){return this.hasChromiumWebRTC()}supportDownlinkBandwidthEstimation(){return!this.isFirefox()}supportString(){if(this.isAndroid())return`${this.browserName.chrome} ${this.browserSupport.chrome}+, ${this.browserName.samsung} ${this.browserSupport.samsung}+`;let t=[];for(let e in this.browserSupport)t.push(`${this.browserName[e]} ${this.browserSupport[e]}+`);return t.join(", ")}supportedVideoCodecs(){return Pz(this,void 0,void 0,function*(){let t=new RTCPeerConnection;return t.addTransceiver("video",{direction:"inactive",streams:[]}),(yield t.createOffer({offerToReceiveVideo:!0})).sdp.split(`\r
`).filter(e=>e.includes("a=rtpmap:")).map(e=>e.replace(/.* /,"").replace(/\/.*/,"")).filter((e,r,n)=>n.indexOf(e)===r).filter(e=>e!=="rtx"&&e!=="red"&&e!=="ulpfec")})}supportsSetSinkId(){return"setSinkId"in HTMLAudioElement.prototype}disableResolutionScaleDown(){return this.isAndroid()}disable480pResolutionScaleDown(){return/( Chrome\/98\.)/i.test(navigator.userAgent)&&this.browser.os.startsWith("Windows")}requiresDisablingH264Encoding(){return this.isIOS()&&(this.version()==="15.1.0"||/( OS 15_1)/i.test(navigator.userAgent))}requiresVideoPlayWorkaround(){return this.isSafari()}requiresAudioContextResetOnDeviceFailureForWebAudio(){return this.isIOS()}isVideoFxSupportedBrowser(){return this.supportsBackgroundFilter()}isIOSSafari(){return this.browser.name==="ios"||this.browser.name==="ios-webview"||this.browser.name==="safari"&&/( Mac )/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1}isSafari(){return this.browser.name==="safari"||this.isIOSSafari()}isFirefox(){return this.browser.name==="firefox"}isIOSFirefox(){return this.browser.name==="fxios"}isIOSChrome(){return this.browser.name==="crios"}isChrome(){return this.browser.name==="chrome"}isEdge(){return this.browser.name==="edge-chromium"}isIOSEdge(){return this.browser.name==="edge-ios"}isSamsungInternet(){return this.browser.name==="samsung"}isAndroid(){return/(android)/i.test(navigator.userAgent)}isPixel3(){return/( pixel 3)/i.test(navigator.userAgent)}isIOS(){return this.isIOSSafari()||this.isIOSChrome()||this.isIOSFirefox()}};va.default=ya;ya.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK=16;ya.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK=106});var Cu=y(ba=>{"use strict";var Nz=ba&&ba.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ba,"__esModule",{value:!0});var Lz=Nz(We()),em=class i{constructor(t=null,e=!0){this.audioBitrateBps=t,this.enableAudioRedundancy=new Lz.default().supportsAudioRedundancy()&&e}static fullbandSpeechMono(t=!0){return new i(4e4,t)}static fullbandMusicMono(t=!0){return new i(64e3,t)}static fullbandMusicStereo(t=!0){return new i(128e3,t)}isStereo(){return this.audioBitrateBps===128e3}hasRedundancyEnabled(){return this.enableAudioRedundancy}};ba.default=em});var im=y(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=void 0;Ur.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=25;var tm=class{constructor(){this.logger=null,this.browserBehavior=null,this.meetingSessionConfiguration=null,this.signalingClient=null,this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.audioVideoController=null,this.realtimeController=null,this.videoTileController=null,this.mediaStreamBroker=null,this.activeAudioInput=void 0,this.activeVideoInput=void 0,this.audioMixController=null,this.transceiverController=null,this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.iceGatheringStateEventHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.reconnectController=null,this.removableObservers=[],this.audioProfile=null,this.videoStreamIndex=null,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.lastKnownVideoAvailability=null,this.videoCaptureAndEncodeParameter=null,this.videosToReceive=null,this.lastVideosToReceive=null,this.videoSubscriptions=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptionLimit=Ur.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.videoSendCodecPreferences=[],this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.prioritizedSendVideoCodecCapabilities=[],this.degradedVideoSendCodecs=[],this.videosPaused=null,this.videoDuplexMode=null,this.volumeIndicatorAdapter=null,this.statsCollector=null,this.connectionMonitor=null,this.videoInputAttachedTimestampMs=0,this.audioDeviceInformation={},this.videoDeviceInformation={},this.enableSimulcast=!1,this.enableSVC=!1,this.eventController=null,this.signalingOpenDurationMs=null,this.iceGatheringDurationMs=null,this.startAudioVideoTimestamp=null,this.attendeePresenceDurationMs=null,this.meetingStartDurationMs=null,this.poorConnectionCount=0,this.maxVideoTileCount=0,this.startTimeMs=null,this.isSessionConnected=!1}resetConnectionSpecificState(){this.peer&&this.peer.close(),this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.transceiverController!==void 0&&this.transceiverController.reset(),this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.videoDownlinkBandwidthPolicy.reset(),this.videoUplinkBandwidthPolicy.reset&&this.videoUplinkBandwidthPolicy.reset(),this.lastVideosToReceive=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptions=null,this.videoSubscriptionLimit=Ur.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.videoDuplexMode=null,this.isSessionConnected=!1}};Ur.default=tm});var Ca=y(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.BlurStrengthMapper=void 0;var Fz={LOW:7,MEDIUM:15,HIGH:30},_u=class{static getBlurAmount(t,e){if(t<=0)throw new Error(`invalid value for blur strength: ${t}`);return Math.round(t*e.height/this.BLUR_STRENGTH_DIVISOR)}};wa.BlurStrengthMapper=_u;_u.BLUR_STRENGTH_DIVISOR=540;wa.default=Fz});var Tu=y(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});Ze.isValidRevisionID=Ze.isValidAssetGroup=Ze.resolveURL=Ze.addQueryParams=Ze.withQueryString=Ze.withRequestHeaders=Ze.fetchWithBehavior=void 0;function UI(i,t,e){if(!e)return fetch(i,t);let r=HI(i,e),n=qI(t,e);return fetch(r,n)}Ze.fetchWithBehavior=UI;function qI(i,t){return t?.headers?i?Object.assign(Object.assign({},i),{headers:Object.assign(Object.assign({},i.headers||{}),t.headers)}):{headers:t.headers}:i}Ze.withRequestHeaders=qI;function HI(i,t){if(!t?.escapedQueryString)return i;let e=i.lastIndexOf("?")!==-1;return`${i}${e?"&":"?"}${t.escapedQueryString}`}Ze.withQueryString=HI;function Bz(i,t){let e=Object.keys(t);if(!e.length)return i;let r=new URLSearchParams(i?.escapedQueryString);for(let n of e)r.append(n,t[n]);return Object.assign(Object.assign({},i),{escapedQueryString:r.toString()})}Ze.addQueryParams=Bz;var Vz={method:"HEAD",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"origin"};function Uz(i,t){return UI(i,Vz,t).then(e=>e.redirected?e.url:i)}Ze.resolveURL=Uz;function qz(i){return!!i&&/^[-.a-zA-Z0-9]+$/.test(i)}Ze.isValidAssetGroup=qz;function Hz(i){return!!i&&/^[123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ]{22}$/.test(i)}Ze.isValidRevisionID=Hz});var qr=y(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.loadWorker=void 0;var zI=Tu(),zz={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"},$z=(i,t,e,r)=>{r?.debug(`Loading ${t} worker from ${i}.`);let n=!1;try{n=self.origin===new URL(i).origin}catch(o){r?.error("Could not compare origins.",o)}if(n){let o=(0,zI.withQueryString)(i,e);return Promise.resolve(new Worker(o,{name:t}))}return(0,zI.fetchWithBehavior)(i,zz,e).then(o=>{if(o.ok)return o.blob().then(s=>new Worker(window.URL.createObjectURL(s)));throw new Error("Fetch failed.")})};Eu.loadWorker=$z});var Zi=y(Me=>{"use strict";var jz=Me&&Me.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(Me,"__esModule",{value:!0});Me.isOldChrome=Me.supportsWASMStreaming=Me.supportsSharedArrayBuffer=Me.supportsWASM=Me.supportsAudioWorklet=Me.supportsWorker=Me.supportsVoiceFocusWorker=Me.supportsWASMPostMessage=Me.isSafari=void 0;var Wz=qr(),Gz=(i=globalThis)=>!!i.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/),Kz=(i=globalThis)=>{let t=i.navigator.userAgent,e=t.match(/Safari\//),r=t.match(/Chrom(?:e|ium)\//);return!!(e&&!r)};Me.isSafari=Kz;var Jz=(i=globalThis)=>(0,Me.isSafari)(i)?!1:Gz(i)?($I(i)||0)<95:!0;Me.supportsWASMPostMessage=Jz;var Qz=(i=globalThis,t,e)=>jz(void 0,void 0,void 0,function*(){if(!(0,Me.supportsWorker)(i,e))return!1;let r=`${t.paths.workers}worker-v1.js`;try{let n=yield(0,Wz.loadWorker)(r,"VoiceFocusTestWorker",t,e);try{n.terminate()}catch(o){e?.debug("Failed to terminate worker.",o)}return!0}catch(n){return e?.info("Failed to fetch and instantiate test worker",n),!1}});Me.supportsVoiceFocusWorker=Qz;var Xz=(i=globalThis,t)=>{try{return!!i.Worker}catch(e){return t?.info("Does not support Worker",e),!1}};Me.supportsWorker=Xz;var Yz=(i=globalThis,t)=>{try{return!!i.AudioWorklet&&!!i.AudioWorkletNode}catch(e){return t?.info("Does not support Audio Worklet",e),!1}};Me.supportsAudioWorklet=Yz;var Zz=(i=globalThis,t)=>{try{return!!i.WebAssembly&&(!!i.WebAssembly.compile||!!i.WebAssembly.compileStreaming)}catch(e){return t?.info("Does not support WASM",e),!1}};Me.supportsWASM=Zz;var e$=(i=globalThis,t=globalThis,e)=>{try{return!!i.SharedArrayBuffer&&(!!t.chrome||!!i.crossOriginIsolated)}catch{return e?.info("Does not support SharedArrayBuffer."),!1}};Me.supportsSharedArrayBuffer=e$;var t$=(i=globalThis,t)=>{var e;try{return!!(!((e=i.WebAssembly)===null||e===void 0)&&e.compileStreaming)}catch(r){return t?.info("Does not support WASM streaming compilation",r),!1}};Me.supportsWASMStreaming=t$;var i$=90,$I=(i=globalThis)=>{try{if(!i.chrome)return}catch{}let t=i.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/);if(t)return parseInt(t[1],10)},r$=(i=globalThis,t)=>{let e=$I(i);return e&&e<i$?(t?.debug(`Chrome ${e} has incomplete SIMD support.`),!0):!1};Me.isOldChrome=r$});var om=y(nm=>{"use strict";Object.defineProperty(nm,"__esModule",{value:!0});var rm=class i{constructor(){this.path=null,this.input=null,this.output=null}static builder(){return new i}withDefaultModel(){return this.withSelfieSegmentationDefaults()}withSelfieSegmentationDefaults(){let t={height:144,width:256,range:[0,1],channels:3},e={height:144,width:256,range:[0,1],channels:1},r="https://static.sdkassets.chime.aws/bgblur/models/selfie_segmentation_landscape.tflite";return this.path=r,this.input=t,this.output=e,this}withPath(t){return this.path=t,this}withInput(t){return this.input=t,this}withOutput(t){return this.output=t,this}validate(){if(!this.path)throw new Error("model spec path is not set");if(!this.input)throw new Error("model spec input is not set");if(!this.output)throw new Error("model spec output is not set")}build(){return this.validate(),{path:this.path,input:this.input,output:this.output}}};nm.default=rm});var jI=y(sm=>{"use strict";Object.defineProperty(sm,"__esModule",{value:!0});sm.default={hash:"0b5a81b",raw:"v3.28.0",semverString:"3.28.0"}});var Vt=y(Ta=>{"use strict";var WI=Ta&&Ta.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ta,"__esModule",{value:!0});var n$=WI(We()),am=WI(jI()),_a=class i{static get sdkName(){return"amazon-chime-sdk-js"}static get sdkVersion(){return am.default.semverString}static get sdkVersionSemVer(){var t,e,r,n;let o=am.default.semverString.match(/^(?<major>[0-9]+)\.(?<minor>[0-9]+)((?:\.(?<patch>[0-9]+))(?:-(?<preRelease>[a-zA-Z]+(\.[0-9])*))?)?/);return{major:(t=o?.groups)===null||t===void 0?void 0:t.major,minor:(e=o?.groups)===null||e===void 0?void 0:e.minor,patch:(r=o?.groups)===null||r===void 0?void 0:r.patch,preRelease:(n=o?.groups)===null||n===void 0?void 0:n.preRelease}}static get buildSHA(){return am.default.hash.substring(1)}static get sdkUserAgentLowResolution(){let t=new n$.default;return`${t.name()}-${t.majorVersion()}`}static urlWithVersion(t){let e=new URL(t);return e.searchParams.append(i.X_AMZN_VERSION,i.sdkVersion),e.searchParams.append(i.X_AMZN_USER_AGENT,i.sdkUserAgentLowResolution),e.toString()}};Ta.default=_a;_a.X_AMZN_VERSION="X-Amzn-Version";_a.X_AMZN_USER_AGENT="X-Amzn-User-Agent"});var Iu=y(Hr=>{"use strict";var o$=Hr&&Hr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},um=Hr&&Hr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Hr,"__esModule",{value:!0});var s$=qr(),GI=Zi(),a$=um(om()),d$=um(We()),dm=um(Vt()),c$=()=>a$.default.builder().withSelfieSegmentationDefaults().build(),cm="https://static.sdkassets.chime.aws",l$={worker:`${cm}/bgblur/workers/worker.js`,wasm:`${cm}/bgblur/wasm/_cwt-wasm.wasm`,simd:`${cm}/bgblur/wasm/_cwt-wasm-simd.wasm`},lm=class{static defaultAssetSpec(){let t=dm.default.sdkVersionSemVer;return{assetGroup:`sdk-${t.major}.${t.minor}`}}static createUrlWithParams(t,e){let r=new URL(t),n=Object.keys(e);for(let o of n)e[o]!==void 0&&r.searchParams.set(o,e[o]);return r.toString()}static resolveSpec(t){let{paths:e=l$,model:r=c$(),assetGroup:n=this.defaultAssetSpec().assetGroup,revisionID:o=this.defaultAssetSpec().revisionID}=t||{},s={assetGroup:n,revisionID:o,sdk:encodeURIComponent(dm.default.sdkVersion),ua:encodeURIComponent(dm.default.sdkUserAgentLowResolution)};return e.worker=this.createUrlWithParams(e.worker,s),e.wasm=this.createUrlWithParams(e.wasm,s),e.simd=this.createUrlWithParams(e.simd,s),r.path=this.createUrlWithParams(r.path,s),{paths:e,model:r,assetGroup:n,revisionID:o}}static resolveOptions(t){t.reportingPeriodMillis||(t.reportingPeriodMillis=1e3);let e=30;return t.filterCPUUtilization?(t.filterCPUUtilization<0||t.filterCPUUtilization>100)&&(t.logger.warn(`filterCPUUtilization must be set to a range between 0 and 100 percent. Falling back to default of ${e} percent`),t.filterCPUUtilization=e):t.filterCPUUtilization=e,t}static isSupported(t,e){let{logger:r}=e;return typeof globalThis>"u"?(r.info("Browser does not have globalThis."),Promise.resolve(!1)):new d$.default().supportsBackgroundFilter()?GI.supportsWASM(globalThis,r)?this.supportsBackgroundFilter(globalThis,t,r):(r.info("Browser does not support WASM."),Promise.resolve(!1)):(r.info("Browser is not supported."),Promise.resolve(!1))}static supportsBackgroundFilter(t=globalThis,e,r){return o$(this,void 0,void 0,function*(){if(!GI.supportsWorker(t,r))return r.info("Browser does not support web workers."),!1;let n=e.paths.worker;try{let o=yield s$.loadWorker(n,"BackgroundFilterWorker",{},null);try{o.terminate()}catch(s){r.info(`Failed to terminate worker. ${s.message}`)}return!0}catch(o){return r.info(`Failed to fetch and instantiate test worker ${o.message}`),!1}})}};Hr.default=lm});var Au=y(Ea=>{"use strict";var u$=Ea&&Ea.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ea,"__esModule",{value:!0});var pt=u$(Bt()),fm=class{constructor(t,e=pt.default.WARN){this.name=t,this.level=e}info(t){this.log(pt.default.INFO,t)}warn(t){this.log(pt.default.WARN,t)}error(t){this.log(pt.default.ERROR,t)}debug(t){pt.default.DEBUG<this.level||(typeof t=="string"?this.log(pt.default.DEBUG,t):t?this.log(pt.default.DEBUG,t()):this.log(pt.default.DEBUG,""+t))}setLogLevel(t){this.level=t}getLogLevel(){return this.level}log(t,e){if(t<this.level)return;let n=`${new Date().toISOString()} [${pt.default[t]}] ${this.name} - ${e}`;switch(t){case pt.default.ERROR:console.error(n);break;case pt.default.WARN:console.warn(n);break;case pt.default.DEBUG:console.debug(n.replace(/\\r\\n/g,`
`));break;case pt.default.INFO:console.info(n);break}}};Ea.default=fm});var ku=y(Ia=>{"use strict";var KI=Ia&&Ia.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(Ia,"__esModule",{value:!0});var hm=class{process(t){return KI(this,void 0,void 0,function*(){return t})}destroy(){return KI(this,void 0,void 0,function*(){})}};Ia.default=hm});var ka=y(Aa=>{"use strict";var f$=Aa&&Aa.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(Aa,"__esModule",{value:!0});var pm=class{constructor(t){this.canvas=t,this.destroyed=!1}destroy(){this.canvas=null,this.destroyed=!0}asCanvasImageSource(){return f$(this,void 0,void 0,function*(){return this.destroyed?Promise.reject("canvas buffer is destroyed"):Promise.resolve(this.canvas)})}asCanvasElement(){return this.canvas}};Aa.default=pm});var JI=y(gm=>{"use strict";Object.defineProperty(gm,"__esModule",{value:!0});var h$=.8,mm=class{constructor(t,e,r,n){this.delegate=t,this.reportingPeriodMillis=e,this.filterCPUUtilization=r,this.logger=n,this._processingFilter=!0,this.lastReportedEventTimestamp=0,this.lastFilterCompleteTimestamp=0,this.filterTotalMillis=0,this.filterCount=0,this.framerate=0,this.filterDurationNotifyMillis=0,this.setSegmentationDuration()}reportEvent(t){let e=t-this.lastReportedEventTimestamp;if(e>=this.reportingPeriodMillis){let r=this.filterCount,n=this.filterTotalMillis;if(this.filterCount=0,this.filterTotalMillis=0,this.lastReportedEventTimestamp=t,this.framerate===0||r===0)return;let o=Math.round(n/r),s=Math.round(this.framerate*(e/1e3))-r,a=Math.round(100*n/e);o>=this.filterDurationNotifyMillis&&this.delegate.filterFrameDurationHigh({framesDropped:s,avgFilterDurationMillis:o,framerate:this.framerate,periodMillis:e}),a>=this.filterCPUUtilization&&this.delegate.filterCPUUtilizationHigh({cpuUtilization:a,filterMillis:n,periodMillis:e})}}setSegmentationDuration(){this.filterDurationNotifyMillis=Math.round(1e3/this.framerate*h$)}frameReceived(t){t!==this.framerate&&(this.framerate=t,this.logger.info(`frame counter setting frame rate to ${this.framerate}`),this.setSegmentationDuration());let e=Date.now();this.reportEvent(e)}filterSubmitted(){this._processingFilter=!0,this.lastFilterCompleteTimestamp=Date.now()}filterComplete(){this.filterTotalMillis+=Date.now()-this.lastFilterCompleteTimestamp,this._processingFilter=!1,this.filterCount++}get processingSegment(){return this._processingFilter}};gm.default=mm});var bm=y(xi=>{"use strict";var Sm=xi&&xi.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},QI=xi&&xi.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(xi,"__esModule",{value:!0});xi.BackgroundFilterMonitor=void 0;var p$=qr(),m$=QI(ka()),g$=QI(JI()),ym=class{constructor(){this.value=void 0,this.resolve=null}whenNext(){return this.promise||(this.promise=new Promise(t=>this.resolve=t)),this.promise}next(t){this.value=t,this.resolve(t),delete this.promise}},vm=class i{constructor(t,e,r,n,o){this.targetCanvas=document.createElement("canvas"),this.canvasCtx=this.targetCanvas.getContext("2d"),this.canvasVideoFrameBuffer=new m$.default(this.targetCanvas),this.mask$=new ym,this.sourceWidth=0,this.sourceHeight=0,this.frameNumber=0,this.videoFramesPerFilterUpdate=1,this.initWorkerPromise=i.createWorkerPromise(),this.loadModelPromise=i.createWorkerPromise(),this.modelInitialized=!1,this.destroyed=!1,this.filterType=t,this.validateSpec(e),this.validateOptions(r),this.spec=e,this.logger=r.logger,this.delegate=n,this.initCPUMonitor(r),this.eventController=o}static createWorkerPromise(){let t={resolve:null,reject:null,promise:null};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t}validateSpec(t){if(!t)throw new Error("processor has null spec");if(!t.model)throw new Error("processor spec has null model");if(!t.paths)throw new Error("processor spec has null paths")}validateOptions(t){if(!t)throw new Error("processor has null options");if(!t.logger)throw new Error("processor has null options - logger");if(!t.reportingPeriodMillis)throw new Error("processor has null options - reportingPeriodMillis");if(!t.filterCPUUtilization)throw new Error("processor has null options - filterCPUUtilization")}initCPUMonitor(t){this.videoFramesPerFilterUpdate=1,this.frameCounter=new g$.default(this.delegate,t.reportingPeriodMillis,t.filterCPUUtilization,this.logger),this.cpuMonitor=new Mu(5e3,{reduceCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.min(this.videoFramesPerFilterUpdate+1,10))},increaseCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.max(this.videoFramesPerFilterUpdate-1,1))}}),this.delegate.addObserver(this.cpuMonitor)}stringify(t){return JSON.stringify(t,null,2)}handleInitialize(t){if(this.logger.info(`received initialize message: ${this.stringify(t)}`),!t.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}let e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:0}}),this.initWorkerPromise.resolve({})}handleLoadModel(t){if(this.logger.info(`received load model message: ${this.stringify(t)}`),t.payload!==2){this.logger.error("failed to load model! status: "+t.payload),this.loadModelPromise.reject(new Error("failed to load model! status: "+t.payload));return}this.modelInitialized=!0,this.loadModelPromise.resolve({})}handlePredict(t){this.mask$.next(t.payload.output)}handleWorkerEvent(t){let e=t.data;switch(e.msg){case"initialize":this.handleInitialize(e);break;case"loadModel":this.handleLoadModel(e);break;case"predict":this.handlePredict(e);break;default:this.logger.info(`unexpected event msg: ${this.stringify(e)}`);break}}loadAssets(){return Sm(this,void 0,void 0,function*(){this.logger.info("start initializing the processor");try{this.worker=yield p$.loadWorker(this.spec.paths.worker,"BackgroundFilterWorker",{},null),this.worker.addEventListener("message",t=>this.handleWorkerEvent(t)),this.worker.postMessage({msg:"initialize",payload:{wasmPath:this.spec.paths.wasm,simdPath:this.spec.paths.simd}}),yield this.initWorkerPromise.promise,this.logger.info(`successfully initialized the ${this.filterType} worker`),yield this.loadModelPromise.promise,this.logger.info(`successfully loaded ${this.filterType} worker segmentation model`)}catch(t){throw new Error(`could not initialize the ${this.filterType} video frame processor due to '${t.message}'`)}this.logger.info(`successfully initialized the ${this.filterType} processor`)})}process(t){return Sm(this,void 0,void 0,function*(){if(this.destroyed)return t;this.frameCounter.frameReceived(t[0].framerate),this.cpuMonitor.frameReceived();let e=t[0].asCanvasElement();if(!e)return t;if(!this.modelInitialized)return t[0]=this.canvasVideoFrameBuffer,t;let r=e.width,n=e.height;if(r===0||n===0)return t;this.sourceWidth===0&&(this.sourceWidth=r,this.sourceHeight=n,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight,this.logger.info(`${this.filterType} source width: ${this.sourceWidth}`),this.logger.info(`${this.filterType} source height: ${this.sourceHeight}`),this.initOnFirstExecution()),(this.sourceWidth!==r||this.sourceHeight!==n)&&(this.sourceWidth=r,this.sourceHeight=n,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight);try{this.frameCounter.filterSubmitted();let o=this.mask$.value,s=this.spec.model.input.width/e.width,a=this.spec.model.input.height/e.height;this.scaledCanvas===void 0&&(this.scaledCanvas=document.createElement("canvas"),this.scaledCanvas.width=this.spec.model.input.width,this.scaledCanvas.height=this.spec.model.input.height);let l=this.scaledCanvas.getContext("2d");l.save(),l.scale(s,a),l.drawImage(e,0,0),l.restore();let c=l.getImageData(0,0,this.scaledCanvas.width,this.scaledCanvas.height);if(this.frameNumber%this.videoFramesPerFilterUpdate===0){let d=this.mask$.whenNext();this.worker.postMessage({msg:"predict",payload:c},[c.data.buffer]),o=yield d}this.destroyed||this.drawImageWithMask(e,o)}catch(o){return this.logger.error(`could not process ${this.filterType} frame buffer due to ${o}`),t}finally{this.frameCounter.filterComplete(),this.frameNumber++}return t[0]=this.canvasVideoFrameBuffer,t})}updateVideoFramesPerFilterUpdate(t){t!==this.videoFramesPerFilterUpdate&&(this.videoFramesPerFilterUpdate=t,this.logger.info(`Adjusting filter rate to compensate for CPU utilization. Filter rate is ${this.videoFramesPerFilterUpdate} video frames per filter.`))}destroy(){var t,e,r,n;return Sm(this,void 0,void 0,function*(){this.destroyed=!0,this.delegate.removeObserver(this.cpuMonitor),this.canvasVideoFrameBuffer.destroy(),(t=this.worker)===null||t===void 0||t.postMessage({msg:"destroy"}),(e=this.worker)===null||e===void 0||e.postMessage({msg:"stop"}),(r=this.targetCanvas)===null||r===void 0||r.remove(),this.targetCanvas=void 0,(n=this.scaledCanvas)===null||n===void 0||n.remove(),this.scaledCanvas=void 0,this.logger.info(`${this.filterType} frame process destroyed`)})}};xi.default=vm;var Mu=class{constructor(t,e){this.monitoringPeriodMillis=t,this.observer=e,this.lastCPUChangeTimestamp=0}filterCPUUtilizationHigh(){let t=Date.now();t-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=t,this.observer.reduceCPUUtilization())}frameReceived(){let t=Date.now();t-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis*2&&(this.lastCPUChangeTimestamp=t,this.observer.increaseCPUUtilization())}};xi.BackgroundFilterMonitor=Mu});var _m=y(Cm=>{"use strict";Object.defineProperty(Cm,"__esModule",{value:!0});var wm=class{constructor(){this.observers=new Set}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}filterFrameDurationHigh(t){var e;for(let r of this.observers)(e=r.filterFrameDurationHigh)===null||e===void 0||e.call(r,t)}filterCPUUtilizationHigh(t){var e;for(let r of this.observers)(e=r.filterCPUUtilizationHigh)===null||e===void 0||e.call(r,t)}};Cm.default=wm});var XI=y(Ma=>{"use strict";var S$=Ma&&Ma.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ma,"__esModule",{value:!0});var y$=S$(_m()),Tm=class extends y$.default{};Ma.default=Tm});var Im=y(zr=>{"use strict";var v$=zr&&zr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},YI=zr&&zr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(zr,"__esModule",{value:!0});var b$=YI(bm()),w$=Ca(),C$=YI(XI()),Em=class extends b$.default{constructor(t,e){super("background blur",t,e,new C$.default),this.blurAmount=0,this.setBlurStrength(e.blurStrength),this.logger.info("BackgroundBlur processor successfully created"),this.logger.info(`BackgroundBlur spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundBlur options: { blurStrength: ${e.blurStrength}, filterCPUUtilization: ${e.filterCPUUtilization}, reportingPeriodMillis: ${e.reportingPeriodMillis}}`)}validateOptions(t){if(super.validateOptions(t),!t.blurStrength)throw new Error("processor has null options - blurStrength")}initOnFirstExecution(){this.setBlurPixels()}drawImageWithMask(t,e){e||(e=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(e,0,0);let{canvasCtx:n,targetCanvas:o}=this,{width:s,height:a}=o;n.save(),n.clearRect(0,0,s,a),n.drawImage(this.scaledCanvas,0,0,s,a),n.globalCompositeOperation="source-in",n.drawImage(t,0,0,s,a),n.globalCompositeOperation="destination-over",n.filter=`blur(${this.blurAmount}px)`,n.drawImage(t,0,0,o.width,o.height),n.restore()}setBlurStrength(t){this._blurStrength=t,this.logger.info(`blur strength set to ${this._blurStrength}`),this.setBlurPixels()}setBlurPixels(){this.blurAmount=w$.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:this.sourceHeight}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}static isSupported(){return v$(this,void 0,void 0,function*(){let t=document.createElement("canvas"),e=t.getContext("2d").filter!==void 0;return t.remove(),e})}setEventController(t){this.eventController?this.eventController=t:(this.eventController=t,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){let t={backgroundBlurEnabled:"true",backgroundBlurStrength:this._blurStrength,backgroundReplacementEnabled:"false",backgroundFilterVersion:1};this.eventController.publishEvent("backgroundFilterConfigSelected",t)}};zr.default=Em});var ZI=y($r=>{"use strict";var _$=$r&&$r.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},T$=$r&&$r.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty($r,"__esModule",{value:!0});var E$=T$(Im()),I$=Ca(),Am=class extends E$.default{constructor(t,e){super(t,e),this.blurCanvas=document.createElement("canvas"),this.blurCanvasCtx=this.blurCanvas.getContext("2d"),this.blurCanvas.width=this.spec.model.input.width,this.blurCanvas.height=this.spec.model.input.height,this.logger.info("BackgroundBlur processor using builtin blur")}drawImageWithMask(t,e){let r=this.blurredImage,{canvasCtx:n,targetCanvas:o}=this,{width:s,height:a}=o;if(!e||!r){n.clearRect(0,0,s,a);return}this.scaledCanvas.getContext("2d").putImageData(e,0,0),this.blurCanvasCtx.putImageData(this.blurredImage,0,0),n.save(),n.clearRect(0,0,s,a),n.drawImage(this.scaledCanvas,0,0,s,a),n.globalCompositeOperation="source-in",n.drawImage(t,0,0,s,a),n.globalCompositeOperation="destination-over",n.drawImage(this.blurCanvas,0,0,s,a),n.restore()}setBlurStrength(t){if(super.setBlurStrength(t),this.worker){this.modelInitialized=!1,this.worker.postMessage({msg:"destroy"});let e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}})}}setBlurPixels(){this.blurAmount=I$.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:540}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}handleInitialize(t){if(this.logger.info(`received initialize message: ${this.stringify(t)}`),!t.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}let e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}}),this.initWorkerPromise.resolve({})}handlePredict(t){this.blurredImage=t.payload.blurOutput,super.handlePredict(t)}destroy(){let t=Object.create(null,{destroy:{get:()=>super.destroy}});var e;return _$(this,void 0,void 0,function*(){t.destroy.call(this),(e=this.blurCanvas)===null||e===void 0||e.remove(),this.blurCanvas=void 0})}};$r.default=Am});var iA=y(jr=>{"use strict";var tA=jr&&jr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Wr=jr&&jr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(jr,"__esModule",{value:!0});var A$=Wr(Iu()),k$=Wr(Au()),M$=Wr(Bt()),x$=Wr(ku()),O$=Wr(ZI()),eA=Wr(Im()),P$=Wr(Ca()),km=class extends x$.default{setBlurStrength(){}loadAssets(){return tA(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}},Mm=class i extends A$.default{static create(t,e){return tA(this,void 0,void 0,function*(){t=i.resolveSpec(t),e=i.resolveOptions(e);let{logger:r}=e,n=yield i.isSupported(t,e);if(r.info(`processor is ${n?"":"not"} supported`),!n)return r.warn("Using no-op processor because background blur is not supported"),new km;let o;return(yield eA.default.isSupported())?(r.info("Using browser-provided background blur"),o=new eA.default(t,e)):(r.info("Using built-in background blur"),o=new O$.default(t,e)),yield o.loadAssets(),o})}static resolveOptions(t={}){let e=Object.assign({},t);return e.blurStrength||(e.blurStrength=P$.default.MEDIUM),e.logger||(e.logger=new k$.default("BackgroundBlurProcessor",M$.default.INFO)),e=super.resolveOptions(e),e}static isSupported(t,e){return t=i.resolveSpec(t),e=i.resolveOptions(e),super.isSupported(t,e)}};jr.default=Mm});var rA=y(xa=>{"use strict";var R$=xa&&xa.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(xa,"__esModule",{value:!0});var D$=R$(_m()),xm=class extends D$.default{};xa.default=xm});var oA=y(Gr=>{"use strict";var xu=Gr&&Gr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},nA=Gr&&Gr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Gr,"__esModule",{value:!0});var N$=nA(bm()),L$=nA(rA()),Om=class i extends N$.default{constructor(t,e){super("background replacement",t,e,new L$.default),this.replacementBlob=e.imageBlob,this.logger.info("BackgroundReplacement processor successfully created"),this.logger.info(`BackgroundReplacement spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundReplacement options: { filterCPUUtilization: ${e.filterCPUUtilization}, reportingPeriodMillis: ${e.reportingPeriodMillis}}`)}setImageBlob(t){return xu(this,void 0,void 0,function*(){this.replacementBlob=t,this.replacementImage=yield i.loadImage(this.createReplacementObjectUrl())})}initOnFirstExecution(){}drawImageWithMask(t,e){e||(e=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(e,0,0);let{canvasCtx:n,targetCanvas:o}=this,{width:s,height:a}=o;n.save(),n.clearRect(0,0,s,a),n.drawImage(this.scaledCanvas,0,0,s,a),n.globalCompositeOperation="source-in",n.drawImage(t,0,0,s,a),n.globalCompositeOperation="destination-over",n.drawImage(this.replacementImage,0,0,o.width,o.height),n.restore()}static loadImageExecutor(t,e,r){let n=new Image;n.crossOrigin="Anonymous",n.addEventListener("load",()=>{t(n)},!1),n.addEventListener("error",o=>{e(new Error(`Could not load replacement image ${n.src}: ${o.message}`))},!1),n.src=r}static loadImage(t){return xu(this,void 0,void 0,function*(){return new Promise((e,r)=>this.loadImageExecutor(e,r,t))})}revokeReplacementObjectUrl(){this.replacementObjectUrl&&URL.revokeObjectURL(this.replacementObjectUrl)}createReplacementObjectUrl(){return this.revokeReplacementObjectUrl(),this.replacementObjectUrl=URL.createObjectURL(this.replacementBlob),this.replacementObjectUrl}loadAssets(){let t=Object.create(null,{loadAssets:{get:()=>super.loadAssets}});return xu(this,void 0,void 0,function*(){this.replacementImage=yield i.loadImage(this.createReplacementObjectUrl()),t.loadAssets.call(this)})}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}destroy(){let t=Object.create(null,{destroy:{get:()=>super.destroy}});return xu(this,void 0,void 0,function*(){t.destroy.call(this),this.revokeReplacementObjectUrl()})}setEventController(t){this.eventController?this.eventController=t:(this.eventController=t,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){let t={backgroundBlurEnabled:"false",backgroundBlurStrength:"low",backgroundReplacementEnabled:"true",backgroundFilterVersion:1};this.eventController.publishEvent("backgroundFilterConfigSelected",t)}};Gr.default=Om});var aA=y(Kr=>{"use strict";var Oa=Kr&&Kr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Pa=Kr&&Kr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Kr,"__esModule",{value:!0});var F$=Pa(Iu()),B$=Pa(Au()),V$=Pa(Bt()),U$=Pa(ku()),sA=Pa(oA()),Pm=class extends U$.default{loadAssets(){return Oa(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}setImageBlob(){return Oa(this,void 0,void 0,function*(){})}},Rm=class i extends F$.default{static create(t,e){return Oa(this,void 0,void 0,function*(){t=this.resolveSpec(t),e=this.resolveOptions(e),yield this.resolveOptionsAsync(e);let{logger:r}=e;if(!(yield i.isSupported(t,e)))return r.warn("Using no-op processor because background replacement is not supported"),new Pm;r.info("Using background replacement filter");let o=new sA.default(t,e);return yield o.loadAssets(),o})}static resolveOptions(t={}){let e=Object.assign({},t);return e.logger||(e.logger=new B$.default("BackgroundReplacementProcessor",V$.default.INFO)),super.resolveOptions(e)}static resolveOptionsAsync(t){return Oa(this,void 0,void 0,function*(){if(!t.imageBlob){let e=document.createElement("canvas");e.width=100,e.height=100;let r=e.getContext("2d");r.fillStyle="blue",r.fillRect(0,0,100,100);let n=yield new Promise(o=>{e.toBlob(o)});t.imageBlob=n}})}static isSupported(t,e){let r=Object.create(null,{isSupported:{get:()=>super.isSupported}});return Oa(this,void 0,void 0,function*(){t=this.resolveSpec(t),e=this.resolveOptions(e),yield this.resolveOptionsAsync(e);let n=e.imageBlob,o=URL.createObjectURL(n);try{yield sA.default.loadImage(o)}catch(s){return e.logger.info(`Failed to fetch load replacement image ${s.message}`),!1}finally{URL.revokeObjectURL(o)}return r.isSupported.call(this,t,e)})}};Kr.default=Rm});var er=y(Nm=>{"use strict";Object.defineProperty(Nm,"__esModule",{value:!0});var Dm=class{constructor(t,e,r){this.minHealth=t.minHealth,this.maxHealth=t.maxHealth,this.currentHealth=t.initialHealth,this.currentData=e.clone(),this.name=r}minimumHealth(){return this.minHealth}maximumHealth(){return this.maxHealth}health(){return this.maximumHealth()}update(t){this.currentData=t}getConnectionHealthData(){return this.currentData.clone()}healthy(){return this.health()>this.minimumHealth()}healthIfChanged(){let t=this.health();return t!==this.currentHealth?(this.currentHealth=t,t):null}};Nm.default=Dm});var Bm=y(Fm=>{"use strict";Object.defineProperty(Fm,"__esModule",{value:!0});var Lm=class{};Fm.default=Lm});var Ou=y(Vm=>{"use strict";Object.defineProperty(Vm,"__esModule",{value:!0});var Oi=class i{static register(){!("document"in window)||!document.addEventListener||i.shouldRegisterCSPMonitor&&(i.added||(document.addEventListener("securitypolicyviolation",i.listener),i.added=!0))}static unregister(){!("document"in window)||!document.removeEventListener||(document.removeEventListener("securitypolicyviolation",i.listener),i.loggers=new Set,i.added=!1)}static disable(){i.shouldRegisterCSPMonitor=!1,i.unregister()}static addLogger(t){t&&i.loggers.add(t)}static removeLogger(t){t&&i.loggers.delete(t)}};Vm.default=Oi;Oi.loggers=new Set;Oi.shouldRegisterCSPMonitor=!0;Oi.added=!1;Oi.listener=i=>{let t=`Security Policy Violation
Blocked URI: ${i.blockedURI}
Violated Directive: ${i.violatedDirective}
Original Policy: ${i.originalPolicy}
Document URI: ${i.documentURI}
Source File: ${i.sourceFile}
Line No.: ${i.lineNumber}
`;for(let e of Oi.loggers)e.error(t);Oi.loggers.size===0&&console.error(t)}});var Um=y(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.CheckAudioConnectivityFeedback=void 0;var dA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.AudioInputRequestFailed=1]="AudioInputRequestFailed",i[i.AudioInputPermissionDenied=2]="AudioInputPermissionDenied",i[i.ConnectionFailed=3]="ConnectionFailed",i[i.AudioNotReceived=4]="AudioNotReceived"})(dA=Fo.CheckAudioConnectivityFeedback||(Fo.CheckAudioConnectivityFeedback={}));Fo.default=dA});var qm=y(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.CheckAudioInputFeedback=void 0;var cA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.Failed=1]="Failed",i[i.PermissionDenied=2]="PermissionDenied"})(cA=Bo.CheckAudioInputFeedback||(Bo.CheckAudioInputFeedback={}));Bo.default=cA});var Hm=y(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.CheckAudioOutputFeedback=void 0;var lA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.Failed=1]="Failed"})(lA=Vo.CheckAudioOutputFeedback||(Vo.CheckAudioOutputFeedback={}));Vo.default=lA});var zm=y(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.CheckCameraResolutionFeedback=void 0;var uA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.Failed=1]="Failed",i[i.ResolutionNotSupported=2]="ResolutionNotSupported",i[i.PermissionDenied=3]="PermissionDenied"})(uA=Uo.CheckCameraResolutionFeedback||(Uo.CheckCameraResolutionFeedback={}));Uo.default=uA});var $m=y(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.CheckContentShareConnectivityFeedback=void 0;var fA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.Failed=1]="Failed",i[i.PermissionDenied=2]="PermissionDenied",i[i.TimedOut=3]="TimedOut",i[i.ConnectionFailed=4]="ConnectionFailed"})(fA=qo.CheckContentShareConnectivityFeedback||(qo.CheckContentShareConnectivityFeedback={}));qo.default=fA});var jm=y(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.CheckNetworkTCPConnectivityFeedback=void 0;var hA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",i[i.ConnectionFailed=2]="ConnectionFailed",i[i.ICENegotiationFailed=3]="ICENegotiationFailed"})(hA=Ho.CheckNetworkTCPConnectivityFeedback||(Ho.CheckNetworkTCPConnectivityFeedback={}));Ho.default=hA});var Wm=y(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.CheckNetworkUDPConnectivityFeedback=void 0;var pA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",i[i.ConnectionFailed=2]="ConnectionFailed",i[i.ICENegotiationFailed=3]="ICENegotiationFailed"})(pA=zo.CheckNetworkUDPConnectivityFeedback||(zo.CheckNetworkUDPConnectivityFeedback={}));zo.default=pA});var Gm=y($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.CheckVideoConnectivityFeedback=void 0;var mA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.VideoInputRequestFailed=1]="VideoInputRequestFailed",i[i.VideoInputPermissionDenied=2]="VideoInputPermissionDenied",i[i.ConnectionFailed=3]="ConnectionFailed",i[i.VideoNotSent=4]="VideoNotSent"})(mA=$o.CheckVideoConnectivityFeedback||($o.CheckVideoConnectivityFeedback={}));$o.default=mA});var Km=y(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.CheckVideoInputFeedback=void 0;var gA;(function(i){i[i.Succeeded=0]="Succeeded",i[i.Failed=1]="Failed",i[i.PermissionDenied=2]="PermissionDenied"})(gA=jo.CheckVideoInputFeedback||(jo.CheckVideoInputFeedback={}));jo.default=gA});var Qm=y(Jr=>{"use strict";var q$=Jr&&Jr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},H$=Jr&&Jr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Jr,"__esModule",{value:!0});var z$=H$(_e()),Jm=class extends z$.default{constructor(t){super(t.logger),this.context=t,this.taskName="CleanRestartedSessionTask"}run(){return q$(this,void 0,void 0,function*(){this.context.resetConnectionSpecificState()})}};Jr.default=Jm});var Ge=y(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.SignalingClientEventType=void 0;var SA;(function(i){i[i.WebSocketConnecting=0]="WebSocketConnecting",i[i.WebSocketOpen=1]="WebSocketOpen",i[i.WebSocketError=2]="WebSocketError",i[i.WebSocketClosing=3]="WebSocketClosing",i[i.WebSocketClosed=4]="WebSocketClosed",i[i.WebSocketFailed=5]="WebSocketFailed",i[i.WebSocketMessage=6]="WebSocketMessage",i[i.WebSocketSendMessageFailure=7]="WebSocketSendMessageFailure",i[i.WebSocketSentMessage=8]="WebSocketSentMessage",i[i.ProtocolDecodeFailure=9]="ProtocolDecodeFailure",i[i.ReceivedSignalFrame=10]="ReceivedSignalFrame",i[i.WebSocketSkippedMessage=11]="WebSocketSkippedMessage"})(SA=Wo.SignalingClientEventType||(Wo.SignalingClientEventType={}));Wo.default=SA});var Ym=y(Qr=>{"use strict";var $$=Qr&&Qr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},yA=Qr&&Qr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Qr,"__esModule",{value:!0});var j$=yA(Ge()),W$=yA(_e()),Xm=class extends W$.default{constructor(t){super(t.logger),this.context=t,this.taskName="CleanStoppedSessionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return $$(this,void 0,void 0,function*(){try{this.context.signalingClient.ready()&&(this.context.signalingClient.closeConnection(),yield this.receiveWebSocketClosedEvent())}catch(t){throw t}finally{for(let e of this.context.removableObservers)e.removeObserver();this.context.resetConnectionSpecificState(),this.context.statsCollector.stop(),this.context.statsCollector=null,this.context.connectionMonitor.stop(),this.context.connectionMonitor=null,this.context.videoUplinkBandwidthPolicy.setTransceiverController&&this.context.videoUplinkBandwidthPolicy.setTransceiverController(void 0),this.context.videoDownlinkBandwidthPolicy.bindToTileController&&this.context.videoDownlinkBandwidthPolicy.bindToTileController(void 0);let t=this.context.videoTileController.getLocalVideoTile();t&&t.bindVideoStream("",!0,null,null,null,null),this.context.videoTileController.removeAllVideoTiles()}})}receiveWebSocketClosedEvent(){return new Promise((t,e)=>{class r{constructor(s){this.signalingClient=s}cancel(){this.signalingClient.removeObserver(this),e(new Error("CleanStoppedSessionTask got canceled while waiting for the WebSocket closed event"))}handleSignalingClientEvent(s){s.type===j$.default.WebSocketClosed&&(this.signalingClient.removeObserver(this),t())}}let n=new r(this.context.signalingClient);this.taskCanceler=n,this.context.signalingClient.registerObserver(n)})}};Qr.default=Xm});var bA=y((wie,vA)=>{"use strict";vA.exports=G$;function G$(i,t){for(var e=new Array(arguments.length-1),r=0,n=2,o=!0;n<arguments.length;)e[r++]=arguments[n++];return new Promise(function(a,l){e[r]=function(d){if(o)if(o=!1,d)l(d);else{for(var u=new Array(arguments.length-1),f=0;f<u.length;)u[f++]=arguments[f];a.apply(null,u)}};try{i.apply(t||null,e)}catch(c){o&&(o=!1,l(c))}})}});var TA=y(_A=>{"use strict";var Pu=_A;Pu.length=function(t){var e=t.length;if(!e)return 0;for(var r=0;--e%4>1&&t.charAt(e)==="=";)++r;return Math.ceil(t.length*3)/4-r};var Go=new Array(64),CA=new Array(123);for(Ut=0;Ut<64;)CA[Go[Ut]=Ut<26?Ut+65:Ut<52?Ut+71:Ut<62?Ut-4:Ut-59|43]=Ut++;var Ut;Pu.encode=function(t,e,r){for(var n=null,o=[],s=0,a=0,l;e<r;){var c=t[e++];switch(a){case 0:o[s++]=Go[c>>2],l=(c&3)<<4,a=1;break;case 1:o[s++]=Go[l|c>>4],l=(c&15)<<2,a=2;break;case 2:o[s++]=Go[l|c>>6],o[s++]=Go[c&63],a=0;break}s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),s=0)}return a&&(o[s++]=Go[l],o[s++]=61,a===1&&(o[s++]=61)),n?(s&&n.push(String.fromCharCode.apply(String,o.slice(0,s))),n.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var wA="invalid encoding";Pu.decode=function(t,e,r){for(var n=r,o=0,s,a=0;a<t.length;){var l=t.charCodeAt(a++);if(l===61&&o>1)break;if((l=CA[l])===void 0)throw Error(wA);switch(o){case 0:s=l,o=1;break;case 1:e[r++]=s<<2|(l&48)>>4,s=l,o=2;break;case 2:e[r++]=(s&15)<<4|(l&60)>>2,s=l,o=3;break;case 3:e[r++]=(s&3)<<6|l,o=0;break}}if(o===1)throw Error(wA);return r-n};Pu.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}});var IA=y((_ie,EA)=>{"use strict";EA.exports=Ru;function Ru(){this._listeners={}}Ru.prototype.on=function(t,e,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:r||this}),this};Ru.prototype.off=function(t,e){if(t===void 0)this._listeners={};else if(e===void 0)this._listeners[t]=[];else for(var r=this._listeners[t],n=0;n<r.length;)r[n].fn===e?r.splice(n,1):++n;return this};Ru.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<e.length;)e[n].fn.apply(e[n++].ctx,r)}return this}});var RA=y((Tie,PA)=>{"use strict";PA.exports=AA(AA);function AA(i){return typeof Float32Array<"u"?(function(){var t=new Float32Array([-0]),e=new Uint8Array(t.buffer),r=e[3]===128;function n(l,c,d){t[0]=l,c[d]=e[0],c[d+1]=e[1],c[d+2]=e[2],c[d+3]=e[3]}function o(l,c,d){t[0]=l,c[d]=e[3],c[d+1]=e[2],c[d+2]=e[1],c[d+3]=e[0]}i.writeFloatLE=r?n:o,i.writeFloatBE=r?o:n;function s(l,c){return e[0]=l[c],e[1]=l[c+1],e[2]=l[c+2],e[3]=l[c+3],t[0]}function a(l,c){return e[3]=l[c],e[2]=l[c+1],e[1]=l[c+2],e[0]=l[c+3],t[0]}i.readFloatLE=r?s:a,i.readFloatBE=r?a:s})():(function(){function t(r,n,o,s){var a=n<0?1:0;if(a&&(n=-n),n===0)r(1/n>0?0:2147483648,o,s);else if(isNaN(n))r(2143289344,o,s);else if(n>34028234663852886e22)r((a<<31|2139095040)>>>0,o,s);else if(n<11754943508222875e-54)r((a<<31|Math.round(n/1401298464324817e-60))>>>0,o,s);else{var l=Math.floor(Math.log(n)/Math.LN2),c=Math.round(n*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,o,s)}}i.writeFloatLE=t.bind(null,kA),i.writeFloatBE=t.bind(null,MA);function e(r,n,o){var s=r(n,o),a=(s>>31)*2+1,l=s>>>23&255,c=s&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}i.readFloatLE=e.bind(null,xA),i.readFloatBE=e.bind(null,OA)})(),typeof Float64Array<"u"?(function(){var t=new Float64Array([-0]),e=new Uint8Array(t.buffer),r=e[7]===128;function n(l,c,d){t[0]=l,c[d]=e[0],c[d+1]=e[1],c[d+2]=e[2],c[d+3]=e[3],c[d+4]=e[4],c[d+5]=e[5],c[d+6]=e[6],c[d+7]=e[7]}function o(l,c,d){t[0]=l,c[d]=e[7],c[d+1]=e[6],c[d+2]=e[5],c[d+3]=e[4],c[d+4]=e[3],c[d+5]=e[2],c[d+6]=e[1],c[d+7]=e[0]}i.writeDoubleLE=r?n:o,i.writeDoubleBE=r?o:n;function s(l,c){return e[0]=l[c],e[1]=l[c+1],e[2]=l[c+2],e[3]=l[c+3],e[4]=l[c+4],e[5]=l[c+5],e[6]=l[c+6],e[7]=l[c+7],t[0]}function a(l,c){return e[7]=l[c],e[6]=l[c+1],e[5]=l[c+2],e[4]=l[c+3],e[3]=l[c+4],e[2]=l[c+5],e[1]=l[c+6],e[0]=l[c+7],t[0]}i.readDoubleLE=r?s:a,i.readDoubleBE=r?a:s})():(function(){function t(r,n,o,s,a,l){var c=s<0?1:0;if(c&&(s=-s),s===0)r(0,a,l+n),r(1/s>0?0:2147483648,a,l+o);else if(isNaN(s))r(0,a,l+n),r(2146959360,a,l+o);else if(s>17976931348623157e292)r(0,a,l+n),r((c<<31|2146435072)>>>0,a,l+o);else{var d;if(s<22250738585072014e-324)d=s/5e-324,r(d>>>0,a,l+n),r((c<<31|d/4294967296)>>>0,a,l+o);else{var u=Math.floor(Math.log(s)/Math.LN2);u===1024&&(u=1023),d=s*Math.pow(2,-u),r(d*4503599627370496>>>0,a,l+n),r((c<<31|u+1023<<20|d*1048576&1048575)>>>0,a,l+o)}}}i.writeDoubleLE=t.bind(null,kA,0,4),i.writeDoubleBE=t.bind(null,MA,4,0);function e(r,n,o,s,a){var l=r(s,a+n),c=r(s,a+o),d=(c>>31)*2+1,u=c>>>20&2047,f=4294967296*(c&1048575)+l;return u===2047?f?NaN:d*(1/0):u===0?d*5e-324*f:d*Math.pow(2,u-1075)*(f+4503599627370496)}i.readDoubleLE=e.bind(null,xA,0,4),i.readDoubleBE=e.bind(null,OA,4,0)})(),i}function kA(i,t,e){t[e]=i&255,t[e+1]=i>>>8&255,t[e+2]=i>>>16&255,t[e+3]=i>>>24}function MA(i,t,e){t[e]=i>>>24,t[e+1]=i>>>16&255,t[e+2]=i>>>8&255,t[e+3]=i&255}function xA(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16|i[t+3]<<24)>>>0}function OA(i,t){return(i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3])>>>0}});var DA=y((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(i){}return null}});var LA=y(NA=>{"use strict";var Zm=NA;Zm.length=function(t){for(var e=0,r=0,n=0;n<t.length;++n)r=t.charCodeAt(n),r<128?e+=1:r<2048?e+=2:(r&64512)===55296&&(t.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e};Zm.read=function(t,e,r){var n=r-e;if(n<1)return"";for(var o=null,s=[],a=0,l;e<r;)l=t[e++],l<128?s[a++]=l:l>191&&l<224?s[a++]=(l&31)<<6|t[e++]&63:l>239&&l<365?(l=((l&7)<<18|(t[e++]&63)<<12|(t[e++]&63)<<6|t[e++]&63)-65536,s[a++]=55296+(l>>10),s[a++]=56320+(l&1023)):s[a++]=(l&15)<<12|(t[e++]&63)<<6|t[e++]&63,a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0);return o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};Zm.write=function(t,e,r){for(var n=r,o,s,a=0;a<t.length;++a)o=t.charCodeAt(a),o<128?e[r++]=o:o<2048?(e[r++]=o>>6|192,e[r++]=o&63|128):(o&64512)===55296&&((s=t.charCodeAt(a+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++a,e[r++]=o>>18|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128,e[r++]=o&63|128):(e[r++]=o>>12|224,e[r++]=o>>6&63|128,e[r++]=o&63|128);return r-n}});var BA=y((Iie,FA)=>{"use strict";FA.exports=K$;function K$(i,t,e){var r=e||8192,n=r>>>1,o=null,s=r;return function(l){if(l<1||l>n)return i(l);s+l>r&&(o=i(r),s=0);var c=t.call(o,s,s+=l);return s&7&&(s=(s|7)+1),c}}});var UA=y((Aie,VA)=>{"use strict";VA.exports=$e;var Ra=ir();function $e(i,t){this.lo=i>>>0,this.hi=t>>>0}var Xr=$e.zero=new $e(0,0);Xr.toNumber=function(){return 0};Xr.zzEncode=Xr.zzDecode=function(){return this};Xr.length=function(){return 1};var J$=$e.zeroHash="\0\0\0\0\0\0\0\0";$e.fromNumber=function(t){if(t===0)return Xr;var e=t<0;e&&(t=-t);var r=t>>>0,n=(t-r)/4294967296>>>0;return e&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new $e(r,n)};$e.from=function(t){if(typeof t=="number")return $e.fromNumber(t);if(Ra.isString(t))if(Ra.Long)t=Ra.Long.fromString(t);else return $e.fromNumber(parseInt(t,10));return t.low||t.high?new $e(t.low>>>0,t.high>>>0):Xr};$e.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=~this.lo+1>>>0,r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+r*4294967296)}return this.lo+this.hi*4294967296};$e.prototype.toLong=function(t){return Ra.Long?new Ra.Long(this.lo|0,this.hi|0,!!t):{low:this.lo|0,high:this.hi|0,unsigned:!!t}};var tr=String.prototype.charCodeAt;$e.fromHash=function(t){return t===J$?Xr:new $e((tr.call(t,0)|tr.call(t,1)<<8|tr.call(t,2)<<16|tr.call(t,3)<<24)>>>0,(tr.call(t,4)|tr.call(t,5)<<8|tr.call(t,6)<<16|tr.call(t,7)<<24)>>>0)};$e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};$e.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this};$e.prototype.zzDecode=function(){var t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this};$e.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10}});var ir=y(eg=>{"use strict";var J=eg;J.asPromise=bA();J.base64=TA();J.EventEmitter=IA();J.float=RA();J.inquire=DA();J.utf8=LA();J.pool=BA();J.LongBits=UA();J.isNode=!!(typeof window<"u"&&window&&window.process&&window.process.versions&&window.process.versions.node);J.global=J.isNode&&window||typeof window<"u"&&window||typeof self<"u"&&self||eg;J.emptyArray=Object.freeze?Object.freeze([]):[];J.emptyObject=Object.freeze?Object.freeze({}):{};J.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};J.isString=function(t){return typeof t=="string"||t instanceof String};J.isObject=function(t){return t&&typeof t=="object"};J.isset=J.isSet=function(t,e){var r=t[e];return r!=null&&t.hasOwnProperty(e)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};J.Buffer=(function(){try{var i=J.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}})();J._Buffer_from=null;J._Buffer_allocUnsafe=null;J.newBuffer=function(t){return typeof t=="number"?J.Buffer?J._Buffer_allocUnsafe(t):new J.Array(t):J.Buffer?J._Buffer_from(t):typeof Uint8Array>"u"?t:new Uint8Array(t)};J.Array=typeof Uint8Array<"u"?Uint8Array:Array;J.Long=J.global.dcodeIO&&J.global.dcodeIO.Long||J.global.Long||J.inquire("long");J.key2Re=/^true|false|0|1$/;J.key32Re=/^-?(?:0|[1-9][0-9]*)$/;J.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;J.longToHash=function(t){return t?J.LongBits.from(t).toHash():J.LongBits.zeroHash};J.longFromHash=function(t,e){var r=J.LongBits.fromHash(t);return J.Long?J.Long.fromBits(r.lo,r.hi,e):r.toNumber(!!e)};function qA(i,t,e){for(var r=Object.keys(t),n=0;n<r.length;++n)(i[r[n]]===void 0||!e)&&(i[r[n]]=t[r[n]]);return i}J.merge=qA;J.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)};function HA(i){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&qA(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return i},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}J.newError=HA;J.ProtocolError=HA("ProtocolError");J.oneOfGetter=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=1;return function(){for(var n=Object.keys(this),o=n.length-1;o>-1;--o)if(e[n[o]]===1&&this[n[o]]!==void 0&&this[n[o]]!==null)return n[o]}};J.oneOfSetter=function(t){return function(e){for(var r=0;r<t.length;++r)t[r]!==e&&delete this[t[r]]}};J.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};J._configure=function(){var i=J.Buffer;if(!i){J._Buffer_from=J._Buffer_allocUnsafe=null;return}J._Buffer_from=i.from!==Uint8Array.from&&i.from||function(e,r){return new i(e,r)},J._Buffer_allocUnsafe=i.allocUnsafe||function(e){return new i(e)}}});var ag=y((Mie,WA)=>{"use strict";WA.exports=ye;var Ct=ir(),tg,Du=Ct.LongBits,zA=Ct.base64,$A=Ct.utf8;function Da(i,t,e){this.fn=i,this.len=t,this.next=void 0,this.val=e}function rg(){}function Q$(i){this.head=i.head,this.tail=i.tail,this.len=i.len,this.next=i.states}function ye(){this.len=0,this.head=new Da(rg,0,0),this.tail=this.head,this.states=null}var jA=function(){return Ct.Buffer?function(){return(ye.create=function(){return new tg})()}:function(){return new ye}};ye.create=jA();ye.alloc=function(t){return new Ct.Array(t)};Ct.Array!==Array&&(ye.alloc=Ct.pool(ye.alloc,Ct.Array.prototype.subarray));ye.prototype._push=function(t,e,r){return this.tail=this.tail.next=new Da(t,e,r),this.len+=e,this};function ng(i,t,e){t[e]=i&255}function X$(i,t,e){for(;i>127;)t[e++]=i&127|128,i>>>=7;t[e]=i}function og(i,t){this.len=i,this.next=void 0,this.val=t}og.prototype=Object.create(Da.prototype);og.prototype.fn=X$;ye.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new og((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};ye.prototype.int32=function(t){return t<0?this._push(sg,10,Du.fromNumber(t)):this.uint32(t)};ye.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)};function sg(i,t,e){for(;i.hi;)t[e++]=i.lo&127|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;i.lo>127;)t[e++]=i.lo&127|128,i.lo=i.lo>>>7;t[e++]=i.lo}ye.prototype.uint64=function(t){var e=Du.from(t);return this._push(sg,e.length(),e)};ye.prototype.int64=ye.prototype.uint64;ye.prototype.sint64=function(t){var e=Du.from(t).zzEncode();return this._push(sg,e.length(),e)};ye.prototype.bool=function(t){return this._push(ng,1,t?1:0)};function ig(i,t,e){t[e]=i&255,t[e+1]=i>>>8&255,t[e+2]=i>>>16&255,t[e+3]=i>>>24}ye.prototype.fixed32=function(t){return this._push(ig,4,t>>>0)};ye.prototype.sfixed32=ye.prototype.fixed32;ye.prototype.fixed64=function(t){var e=Du.from(t);return this._push(ig,4,e.lo)._push(ig,4,e.hi)};ye.prototype.sfixed64=ye.prototype.fixed64;ye.prototype.float=function(t){return this._push(Ct.float.writeFloatLE,4,t)};ye.prototype.double=function(t){return this._push(Ct.float.writeDoubleLE,8,t)};var Y$=Ct.Array.prototype.set?function(t,e,r){e.set(t,r)}:function(t,e,r){for(var n=0;n<t.length;++n)e[r+n]=t[n]};ye.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(ng,1,0);if(Ct.isString(t)){var r=ye.alloc(e=zA.length(t));zA.decode(t,r,0),t=r}return this.uint32(e)._push(Y$,e,t)};ye.prototype.string=function(t){var e=$A.length(t);return e?this.uint32(e)._push($A.write,e,t):this._push(ng,1,0)};ye.prototype.fork=function(){return this.states=new Q$(this),this.head=this.tail=new Da(rg,0,0),this.len=0,this};ye.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Da(rg,0,0),this.len=0),this};ye.prototype.ldelim=function(){var t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this};ye.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,e,r),r+=t.len,t=t.next;return e};ye._configure=function(i){tg=i,ye.create=jA(),tg._configure()}});var JA=y((xie,KA)=>{"use strict";KA.exports=ci;var GA=ag();(ci.prototype=Object.create(GA.prototype)).constructor=ci;var rr=ir();function ci(){GA.call(this)}ci._configure=function(){ci.alloc=rr._Buffer_allocUnsafe,ci.writeBytesBuffer=rr.Buffer&&rr.Buffer.prototype instanceof Uint8Array&&rr.Buffer.prototype.set.name==="set"?function(t,e,r){e.set(t,r)}:function(t,e,r){if(t.copy)t.copy(e,r,0,t.length);else for(var n=0;n<t.length;)e[r++]=t[n++]}};ci.prototype.bytes=function(t){rr.isString(t)&&(t=rr._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(ci.writeBytesBuffer,e,t),this};function Z$(i,t,e){i.length<40?rr.utf8.write(i,t,e):t.utf8Write?t.utf8Write(i,e):t.write(i,e)}ci.prototype.string=function(t){var e=rr.Buffer.byteLength(t);return this.uint32(e),e&&this._push(Z$,e,t),this};ci._configure()});var lg=y((Oie,ek)=>{"use strict";ek.exports=Ne;var qt=ir(),cg,YA=qt.LongBits,e4=qt.utf8;function Ht(i,t){return RangeError("index out of range: "+i.pos+" + "+(t||1)+" > "+i.len)}function Ne(i){this.buf=i,this.pos=0,this.len=i.length}var QA=typeof Uint8Array<"u"?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Ne(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Ne(t);throw Error("illegal buffer")},ZA=function(){return qt.Buffer?function(e){return(Ne.create=function(n){return qt.Buffer.isBuffer(n)?new cg(n):QA(n)})(e)}:QA};Ne.create=ZA();Ne.prototype._slice=qt.Array.prototype.subarray||qt.Array.prototype.slice;Ne.prototype.uint32=(function(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Ht(this,10);return t}})();Ne.prototype.int32=function(){return this.uint32()|0};Ne.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(t&1)|0};function dg(){var i=new YA(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(i.lo=(i.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return i;if(i.lo=(i.lo|(this.buf[this.pos]&127)<<28)>>>0,i.hi=(i.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return i;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Ht(this);if(i.lo=(i.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return i}return i.lo=(i.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,i}if(this.len-this.pos>4){for(;t<5;++t)if(i.hi=(i.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return i}else for(;t<5;++t){if(this.pos>=this.len)throw Ht(this);if(i.hi=(i.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return i}throw Error("invalid varint encoding")}Ne.prototype.bool=function(){return this.uint32()!==0};function Nu(i,t){return(i[t-4]|i[t-3]<<8|i[t-2]<<16|i[t-1]<<24)>>>0}Ne.prototype.fixed32=function(){if(this.pos+4>this.len)throw Ht(this,4);return Nu(this.buf,this.pos+=4)};Ne.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Ht(this,4);return Nu(this.buf,this.pos+=4)|0};function XA(){if(this.pos+8>this.len)throw Ht(this,8);return new YA(Nu(this.buf,this.pos+=4),Nu(this.buf,this.pos+=4))}Ne.prototype.float=function(){if(this.pos+4>this.len)throw Ht(this,4);var t=qt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Ne.prototype.double=function(){if(this.pos+8>this.len)throw Ht(this,4);var t=qt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Ne.prototype.bytes=function(){var t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw Ht(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(e,r);if(e===r){var n=qt.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,e,r)};Ne.prototype.string=function(){var t=this.bytes();return e4.read(t,0,t.length)};Ne.prototype.skip=function(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Ht(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Ht(this);while(this.buf[this.pos++]&128);return this};Ne.prototype.skipType=function(i){switch(i){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(i=this.uint32()&7)!==4;)this.skipType(i);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+i+" at offset "+this.pos)}return this};Ne._configure=function(i){cg=i,Ne.create=ZA(),cg._configure();var t=qt.Long?"toLong":"toNumber";qt.merge(Ne.prototype,{int64:function(){return dg.call(this)[t](!1)},uint64:function(){return dg.call(this)[t](!0)},sint64:function(){return dg.call(this).zzDecode()[t](!1)},fixed64:function(){return XA.call(this)[t](!0)},sfixed64:function(){return XA.call(this)[t](!1)}})}});var nk=y((Pie,rk)=>{"use strict";rk.exports=Yr;var ik=lg();(Yr.prototype=Object.create(ik.prototype)).constructor=Yr;var tk=ir();function Yr(i){ik.call(this,i)}Yr._configure=function(){tk.Buffer&&(Yr.prototype._slice=tk.Buffer.prototype.slice)};Yr.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};Yr._configure()});var sk=y((Rie,ok)=>{"use strict";ok.exports=Na;var ug=ir();(Na.prototype=Object.create(ug.EventEmitter.prototype)).constructor=Na;function Na(i,t,e){if(typeof i!="function")throw TypeError("rpcImpl must be a function");ug.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=!!t,this.responseDelimited=!!e}Na.prototype.rpcCall=function i(t,e,r,n,o){if(!n)throw TypeError("request must be specified");var s=this;if(!o)return ug.asPromise(i,s,t,e,r,n);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(t,e[s.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(l,c){if(l)return s.emit("error",l,t),o(l);if(c===null){s.end(!0);return}if(!(c instanceof r))try{c=r[s.responseDelimited?"decodeDelimited":"decode"](c)}catch(d){return s.emit("error",d,t),o(d)}return s.emit("data",c,t),o(null,c)})}catch(a){s.emit("error",a,t),setTimeout(function(){o(a)},0);return}};Na.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var dk=y(ak=>{"use strict";var t4=ak;t4.Service=sk()});var lk=y((Nie,ck)=>{"use strict";ck.exports={}});var hk=y(fk=>{"use strict";var st=fk;st.build="minimal";st.Writer=ag();st.BufferWriter=JA();st.Reader=lg();st.BufferReader=nk();st.util=ir();st.rpc=dk();st.roots=lk();st.configure=uk;function uk(){st.util._configure(),st.Writer._configure(st.BufferWriter),st.Reader._configure(st.BufferReader)}uk()});var mk=y((Fie,pk)=>{"use strict";pk.exports=hk()});var Oe=y((Bie,gk)=>{"use strict";var X=mk(),w=X.Reader,re=X.Writer,v=X.util,p=X.roots.default||(X.roots.default={});p.SdkSignalFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.timestampMs=v.Long?v.Long.fromBits(0,0,!0):0,i.prototype.type=1,i.prototype.error=null,i.prototype.join=null,i.prototype.joinack=null,i.prototype.sub=null,i.prototype.suback=null,i.prototype.index=null,i.prototype.pause=null,i.prototype.leave=null,i.prototype.leaveAck=null,i.prototype.bitrates=null,i.prototype.audioControl=null,i.prototype.audioMetadata=null,i.prototype.audioStreamIdInfo=null,i.prototype.pingPong=null,i.prototype.audioStatus=null,i.prototype.clientMetric=null,i.prototype.dataMessage=null,i.prototype.remoteVideoUpdate=null,i.prototype.primaryMeetingJoin=null,i.prototype.primaryMeetingJoinAck=null,i.prototype.primaryMeetingLeave=null,i.prototype.notification=null,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),r.uint32(8).uint64(e.timestampMs),r.uint32(16).int32(e.type),e.error!=null&&Object.hasOwnProperty.call(e,"error")&&p.SdkErrorFrame.encode(e.error,r.uint32(26).fork()).ldelim(),e.join!=null&&Object.hasOwnProperty.call(e,"join")&&p.SdkJoinFrame.encode(e.join,r.uint32(34).fork()).ldelim(),e.joinack!=null&&Object.hasOwnProperty.call(e,"joinack")&&p.SdkJoinAckFrame.encode(e.joinack,r.uint32(42).fork()).ldelim(),e.sub!=null&&Object.hasOwnProperty.call(e,"sub")&&p.SdkSubscribeFrame.encode(e.sub,r.uint32(50).fork()).ldelim(),e.suback!=null&&Object.hasOwnProperty.call(e,"suback")&&p.SdkSubscribeAckFrame.encode(e.suback,r.uint32(58).fork()).ldelim(),e.index!=null&&Object.hasOwnProperty.call(e,"index")&&p.SdkIndexFrame.encode(e.index,r.uint32(66).fork()).ldelim(),e.pause!=null&&Object.hasOwnProperty.call(e,"pause")&&p.SdkPauseResumeFrame.encode(e.pause,r.uint32(82).fork()).ldelim(),e.leave!=null&&Object.hasOwnProperty.call(e,"leave")&&p.SdkLeaveFrame.encode(e.leave,r.uint32(90).fork()).ldelim(),e.leaveAck!=null&&Object.hasOwnProperty.call(e,"leaveAck")&&p.SdkLeaveAckFrame.encode(e.leaveAck,r.uint32(98).fork()).ldelim(),e.bitrates!=null&&Object.hasOwnProperty.call(e,"bitrates")&&p.SdkBitrateFrame.encode(e.bitrates,r.uint32(114).fork()).ldelim(),e.audioControl!=null&&Object.hasOwnProperty.call(e,"audioControl")&&p.SdkAudioControlFrame.encode(e.audioControl,r.uint32(138).fork()).ldelim(),e.audioMetadata!=null&&Object.hasOwnProperty.call(e,"audioMetadata")&&p.SdkAudioMetadataFrame.encode(e.audioMetadata,r.uint32(146).fork()).ldelim(),e.audioStreamIdInfo!=null&&Object.hasOwnProperty.call(e,"audioStreamIdInfo")&&p.SdkAudioStreamIdInfoFrame.encode(e.audioStreamIdInfo,r.uint32(154).fork()).ldelim(),e.pingPong!=null&&Object.hasOwnProperty.call(e,"pingPong")&&p.SdkPingPongFrame.encode(e.pingPong,r.uint32(162).fork()).ldelim(),e.audioStatus!=null&&Object.hasOwnProperty.call(e,"audioStatus")&&p.SdkAudioStatusFrame.encode(e.audioStatus,r.uint32(170).fork()).ldelim(),e.clientMetric!=null&&Object.hasOwnProperty.call(e,"clientMetric")&&p.SdkClientMetricFrame.encode(e.clientMetric,r.uint32(178).fork()).ldelim(),e.dataMessage!=null&&Object.hasOwnProperty.call(e,"dataMessage")&&p.SdkDataMessageFrame.encode(e.dataMessage,r.uint32(186).fork()).ldelim(),e.remoteVideoUpdate!=null&&Object.hasOwnProperty.call(e,"remoteVideoUpdate")&&p.SdkRemoteVideoUpdateFrame.encode(e.remoteVideoUpdate,r.uint32(202).fork()).ldelim(),e.primaryMeetingJoin!=null&&Object.hasOwnProperty.call(e,"primaryMeetingJoin")&&p.SdkPrimaryMeetingJoinFrame.encode(e.primaryMeetingJoin,r.uint32(210).fork()).ldelim(),e.primaryMeetingJoinAck!=null&&Object.hasOwnProperty.call(e,"primaryMeetingJoinAck")&&p.SdkPrimaryMeetingJoinAckFrame.encode(e.primaryMeetingJoinAck,r.uint32(218).fork()).ldelim(),e.primaryMeetingLeave!=null&&Object.hasOwnProperty.call(e,"primaryMeetingLeave")&&p.SdkPrimaryMeetingLeaveFrame.encode(e.primaryMeetingLeave,r.uint32(226).fork()).ldelim(),e.notification!=null&&Object.hasOwnProperty.call(e,"notification")&&p.SdkNotificationFrame.encode(e.notification,r.uint32(282).fork()).ldelim(),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkSignalFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.timestampMs=e.uint64();break}case 2:{o.type=e.int32();break}case 3:{o.error=p.SdkErrorFrame.decode(e,e.uint32());break}case 4:{o.join=p.SdkJoinFrame.decode(e,e.uint32());break}case 5:{o.joinack=p.SdkJoinAckFrame.decode(e,e.uint32());break}case 6:{o.sub=p.SdkSubscribeFrame.decode(e,e.uint32());break}case 7:{o.suback=p.SdkSubscribeAckFrame.decode(e,e.uint32());break}case 8:{o.index=p.SdkIndexFrame.decode(e,e.uint32());break}case 10:{o.pause=p.SdkPauseResumeFrame.decode(e,e.uint32());break}case 11:{o.leave=p.SdkLeaveFrame.decode(e,e.uint32());break}case 12:{o.leaveAck=p.SdkLeaveAckFrame.decode(e,e.uint32());break}case 14:{o.bitrates=p.SdkBitrateFrame.decode(e,e.uint32());break}case 17:{o.audioControl=p.SdkAudioControlFrame.decode(e,e.uint32());break}case 18:{o.audioMetadata=p.SdkAudioMetadataFrame.decode(e,e.uint32());break}case 19:{o.audioStreamIdInfo=p.SdkAudioStreamIdInfoFrame.decode(e,e.uint32());break}case 20:{o.pingPong=p.SdkPingPongFrame.decode(e,e.uint32());break}case 21:{o.audioStatus=p.SdkAudioStatusFrame.decode(e,e.uint32());break}case 22:{o.clientMetric=p.SdkClientMetricFrame.decode(e,e.uint32());break}case 23:{o.dataMessage=p.SdkDataMessageFrame.decode(e,e.uint32());break}case 25:{o.remoteVideoUpdate=p.SdkRemoteVideoUpdateFrame.decode(e,e.uint32());break}case 26:{o.primaryMeetingJoin=p.SdkPrimaryMeetingJoinFrame.decode(e,e.uint32());break}case 27:{o.primaryMeetingJoinAck=p.SdkPrimaryMeetingJoinAckFrame.decode(e,e.uint32());break}case 28:{o.primaryMeetingLeave=p.SdkPrimaryMeetingLeaveFrame.decode(e,e.uint32());break}case 35:{o.notification=p.SdkNotificationFrame.decode(e,e.uint32());break}default:e.skipType(s&7);break}}if(!o.hasOwnProperty("timestampMs"))throw v.ProtocolError("missing required 'timestampMs'",{instance:o});if(!o.hasOwnProperty("type"))throw v.ProtocolError("missing required 'type'",{instance:o});return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(!v.isInteger(e.timestampMs)&&!(e.timestampMs&&v.isInteger(e.timestampMs.low)&&v.isInteger(e.timestampMs.high)))return"timestampMs: integer|Long expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 13:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 24:case 25:case 26:case 27:case 34:break}if(e.error!=null&&e.hasOwnProperty("error")){var r=p.SdkErrorFrame.verify(e.error);if(r)return"error."+r}if(e.join!=null&&e.hasOwnProperty("join")){var r=p.SdkJoinFrame.verify(e.join);if(r)return"join."+r}if(e.joinack!=null&&e.hasOwnProperty("joinack")){var r=p.SdkJoinAckFrame.verify(e.joinack);if(r)return"joinack."+r}if(e.sub!=null&&e.hasOwnProperty("sub")){var r=p.SdkSubscribeFrame.verify(e.sub);if(r)return"sub."+r}if(e.suback!=null&&e.hasOwnProperty("suback")){var r=p.SdkSubscribeAckFrame.verify(e.suback);if(r)return"suback."+r}if(e.index!=null&&e.hasOwnProperty("index")){var r=p.SdkIndexFrame.verify(e.index);if(r)return"index."+r}if(e.pause!=null&&e.hasOwnProperty("pause")){var r=p.SdkPauseResumeFrame.verify(e.pause);if(r)return"pause."+r}if(e.leave!=null&&e.hasOwnProperty("leave")){var r=p.SdkLeaveFrame.verify(e.leave);if(r)return"leave."+r}if(e.leaveAck!=null&&e.hasOwnProperty("leaveAck")){var r=p.SdkLeaveAckFrame.verify(e.leaveAck);if(r)return"leaveAck."+r}if(e.bitrates!=null&&e.hasOwnProperty("bitrates")){var r=p.SdkBitrateFrame.verify(e.bitrates);if(r)return"bitrates."+r}if(e.audioControl!=null&&e.hasOwnProperty("audioControl")){var r=p.SdkAudioControlFrame.verify(e.audioControl);if(r)return"audioControl."+r}if(e.audioMetadata!=null&&e.hasOwnProperty("audioMetadata")){var r=p.SdkAudioMetadataFrame.verify(e.audioMetadata);if(r)return"audioMetadata."+r}if(e.audioStreamIdInfo!=null&&e.hasOwnProperty("audioStreamIdInfo")){var r=p.SdkAudioStreamIdInfoFrame.verify(e.audioStreamIdInfo);if(r)return"audioStreamIdInfo."+r}if(e.pingPong!=null&&e.hasOwnProperty("pingPong")){var r=p.SdkPingPongFrame.verify(e.pingPong);if(r)return"pingPong."+r}if(e.audioStatus!=null&&e.hasOwnProperty("audioStatus")){var r=p.SdkAudioStatusFrame.verify(e.audioStatus);if(r)return"audioStatus."+r}if(e.clientMetric!=null&&e.hasOwnProperty("clientMetric")){var r=p.SdkClientMetricFrame.verify(e.clientMetric);if(r)return"clientMetric."+r}if(e.dataMessage!=null&&e.hasOwnProperty("dataMessage")){var r=p.SdkDataMessageFrame.verify(e.dataMessage);if(r)return"dataMessage."+r}if(e.remoteVideoUpdate!=null&&e.hasOwnProperty("remoteVideoUpdate")){var r=p.SdkRemoteVideoUpdateFrame.verify(e.remoteVideoUpdate);if(r)return"remoteVideoUpdate."+r}if(e.primaryMeetingJoin!=null&&e.hasOwnProperty("primaryMeetingJoin")){var r=p.SdkPrimaryMeetingJoinFrame.verify(e.primaryMeetingJoin);if(r)return"primaryMeetingJoin."+r}if(e.primaryMeetingJoinAck!=null&&e.hasOwnProperty("primaryMeetingJoinAck")){var r=p.SdkPrimaryMeetingJoinAckFrame.verify(e.primaryMeetingJoinAck);if(r)return"primaryMeetingJoinAck."+r}if(e.primaryMeetingLeave!=null&&e.hasOwnProperty("primaryMeetingLeave")){var r=p.SdkPrimaryMeetingLeaveFrame.verify(e.primaryMeetingLeave);if(r)return"primaryMeetingLeave."+r}if(e.notification!=null&&e.hasOwnProperty("notification")){var r=p.SdkNotificationFrame.verify(e.notification);if(r)return"notification."+r}return null},i.fromObject=function(e){if(e instanceof p.SdkSignalFrame)return e;var r=new p.SdkSignalFrame;switch(e.timestampMs!=null&&(v.Long?(r.timestampMs=v.Long.fromValue(e.timestampMs)).unsigned=!0:typeof e.timestampMs=="string"?r.timestampMs=parseInt(e.timestampMs,10):typeof e.timestampMs=="number"?r.timestampMs=e.timestampMs:typeof e.timestampMs=="object"&&(r.timestampMs=new v.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0))),e.type){default:if(typeof e.type=="number"){r.type=e.type;break}break;case"JOIN":case 1:r.type=1;break;case"JOIN_ACK":case 2:r.type=2;break;case"SUBSCRIBE":case 3:r.type=3;break;case"SUBSCRIBE_ACK":case 4:r.type=4;break;case"INDEX":case 5:r.type=5;break;case"PAUSE":case 7:r.type=7;break;case"RESUME":case 8:r.type=8;break;case"LEAVE":case 9:r.type=9;break;case"LEAVE_ACK":case 10:r.type=10;break;case"BITRATES":case 13:r.type=13;break;case"AUDIO_CONTROL":case 16:r.type=16;break;case"AUDIO_METADATA":case 17:r.type=17;break;case"AUDIO_STREAM_ID_INFO":case 18:r.type=18;break;case"PING_PONG":case 19:r.type=19;break;case"AUDIO_STATUS":case 20:r.type=20;break;case"CLIENT_METRIC":case 21:r.type=21;break;case"DATA_MESSAGE":case 22:r.type=22;break;case"REMOTE_VIDEO_UPDATE":case 24:r.type=24;break;case"PRIMARY_MEETING_JOIN":case 25:r.type=25;break;case"PRIMARY_MEETING_JOIN_ACK":case 26:r.type=26;break;case"PRIMARY_MEETING_LEAVE":case 27:r.type=27;break;case"NOTIFICATION":case 34:r.type=34;break}if(e.error!=null){if(typeof e.error!="object")throw TypeError(".SdkSignalFrame.error: object expected");r.error=p.SdkErrorFrame.fromObject(e.error)}if(e.join!=null){if(typeof e.join!="object")throw TypeError(".SdkSignalFrame.join: object expected");r.join=p.SdkJoinFrame.fromObject(e.join)}if(e.joinack!=null){if(typeof e.joinack!="object")throw TypeError(".SdkSignalFrame.joinack: object expected");r.joinack=p.SdkJoinAckFrame.fromObject(e.joinack)}if(e.sub!=null){if(typeof e.sub!="object")throw TypeError(".SdkSignalFrame.sub: object expected");r.sub=p.SdkSubscribeFrame.fromObject(e.sub)}if(e.suback!=null){if(typeof e.suback!="object")throw TypeError(".SdkSignalFrame.suback: object expected");r.suback=p.SdkSubscribeAckFrame.fromObject(e.suback)}if(e.index!=null){if(typeof e.index!="object")throw TypeError(".SdkSignalFrame.index: object expected");r.index=p.SdkIndexFrame.fromObject(e.index)}if(e.pause!=null){if(typeof e.pause!="object")throw TypeError(".SdkSignalFrame.pause: object expected");r.pause=p.SdkPauseResumeFrame.fromObject(e.pause)}if(e.leave!=null){if(typeof e.leave!="object")throw TypeError(".SdkSignalFrame.leave: object expected");r.leave=p.SdkLeaveFrame.fromObject(e.leave)}if(e.leaveAck!=null){if(typeof e.leaveAck!="object")throw TypeError(".SdkSignalFrame.leaveAck: object expected");r.leaveAck=p.SdkLeaveAckFrame.fromObject(e.leaveAck)}if(e.bitrates!=null){if(typeof e.bitrates!="object")throw TypeError(".SdkSignalFrame.bitrates: object expected");r.bitrates=p.SdkBitrateFrame.fromObject(e.bitrates)}if(e.audioControl!=null){if(typeof e.audioControl!="object")throw TypeError(".SdkSignalFrame.audioControl: object expected");r.audioControl=p.SdkAudioControlFrame.fromObject(e.audioControl)}if(e.audioMetadata!=null){if(typeof e.audioMetadata!="object")throw TypeError(".SdkSignalFrame.audioMetadata: object expected");r.audioMetadata=p.SdkAudioMetadataFrame.fromObject(e.audioMetadata)}if(e.audioStreamIdInfo!=null){if(typeof e.audioStreamIdInfo!="object")throw TypeError(".SdkSignalFrame.audioStreamIdInfo: object expected");r.audioStreamIdInfo=p.SdkAudioStreamIdInfoFrame.fromObject(e.audioStreamIdInfo)}if(e.pingPong!=null){if(typeof e.pingPong!="object")throw TypeError(".SdkSignalFrame.pingPong: object expected");r.pingPong=p.SdkPingPongFrame.fromObject(e.pingPong)}if(e.audioStatus!=null){if(typeof e.audioStatus!="object")throw TypeError(".SdkSignalFrame.audioStatus: object expected");r.audioStatus=p.SdkAudioStatusFrame.fromObject(e.audioStatus)}if(e.clientMetric!=null){if(typeof e.clientMetric!="object")throw TypeError(".SdkSignalFrame.clientMetric: object expected");r.clientMetric=p.SdkClientMetricFrame.fromObject(e.clientMetric)}if(e.dataMessage!=null){if(typeof e.dataMessage!="object")throw TypeError(".SdkSignalFrame.dataMessage: object expected");r.dataMessage=p.SdkDataMessageFrame.fromObject(e.dataMessage)}if(e.remoteVideoUpdate!=null){if(typeof e.remoteVideoUpdate!="object")throw TypeError(".SdkSignalFrame.remoteVideoUpdate: object expected");r.remoteVideoUpdate=p.SdkRemoteVideoUpdateFrame.fromObject(e.remoteVideoUpdate)}if(e.primaryMeetingJoin!=null){if(typeof e.primaryMeetingJoin!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoin: object expected");r.primaryMeetingJoin=p.SdkPrimaryMeetingJoinFrame.fromObject(e.primaryMeetingJoin)}if(e.primaryMeetingJoinAck!=null){if(typeof e.primaryMeetingJoinAck!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoinAck: object expected");r.primaryMeetingJoinAck=p.SdkPrimaryMeetingJoinAckFrame.fromObject(e.primaryMeetingJoinAck)}if(e.primaryMeetingLeave!=null){if(typeof e.primaryMeetingLeave!="object")throw TypeError(".SdkSignalFrame.primaryMeetingLeave: object expected");r.primaryMeetingLeave=p.SdkPrimaryMeetingLeaveFrame.fromObject(e.primaryMeetingLeave)}if(e.notification!=null){if(typeof e.notification!="object")throw TypeError(".SdkSignalFrame.notification: object expected");r.notification=p.SdkNotificationFrame.fromObject(e.notification)}return r},i.toObject=function(e,r){r||(r={});var n={};if(r.defaults){if(v.Long){var o=new v.Long(0,0,!0);n.timestampMs=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.timestampMs=r.longs===String?"0":0;n.type=r.enums===String?"JOIN":1,n.error=null,n.join=null,n.joinack=null,n.sub=null,n.suback=null,n.index=null,n.pause=null,n.leave=null,n.leaveAck=null,n.bitrates=null,n.audioControl=null,n.audioMetadata=null,n.audioStreamIdInfo=null,n.pingPong=null,n.audioStatus=null,n.clientMetric=null,n.dataMessage=null,n.remoteVideoUpdate=null,n.primaryMeetingJoin=null,n.primaryMeetingJoinAck=null,n.primaryMeetingLeave=null,n.notification=null}return e.timestampMs!=null&&e.hasOwnProperty("timestampMs")&&(typeof e.timestampMs=="number"?n.timestampMs=r.longs===String?String(e.timestampMs):e.timestampMs:n.timestampMs=r.longs===String?v.Long.prototype.toString.call(e.timestampMs):r.longs===Number?new v.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0):e.timestampMs),e.type!=null&&e.hasOwnProperty("type")&&(n.type=r.enums===String?p.SdkSignalFrame.Type[e.type]===void 0?e.type:p.SdkSignalFrame.Type[e.type]:e.type),e.error!=null&&e.hasOwnProperty("error")&&(n.error=p.SdkErrorFrame.toObject(e.error,r)),e.join!=null&&e.hasOwnProperty("join")&&(n.join=p.SdkJoinFrame.toObject(e.join,r)),e.joinack!=null&&e.hasOwnProperty("joinack")&&(n.joinack=p.SdkJoinAckFrame.toObject(e.joinack,r)),e.sub!=null&&e.hasOwnProperty("sub")&&(n.sub=p.SdkSubscribeFrame.toObject(e.sub,r)),e.suback!=null&&e.hasOwnProperty("suback")&&(n.suback=p.SdkSubscribeAckFrame.toObject(e.suback,r)),e.index!=null&&e.hasOwnProperty("index")&&(n.index=p.SdkIndexFrame.toObject(e.index,r)),e.pause!=null&&e.hasOwnProperty("pause")&&(n.pause=p.SdkPauseResumeFrame.toObject(e.pause,r)),e.leave!=null&&e.hasOwnProperty("leave")&&(n.leave=p.SdkLeaveFrame.toObject(e.leave,r)),e.leaveAck!=null&&e.hasOwnProperty("leaveAck")&&(n.leaveAck=p.SdkLeaveAckFrame.toObject(e.leaveAck,r)),e.bitrates!=null&&e.hasOwnProperty("bitrates")&&(n.bitrates=p.SdkBitrateFrame.toObject(e.bitrates,r)),e.audioControl!=null&&e.hasOwnProperty("audioControl")&&(n.audioControl=p.SdkAudioControlFrame.toObject(e.audioControl,r)),e.audioMetadata!=null&&e.hasOwnProperty("audioMetadata")&&(n.audioMetadata=p.SdkAudioMetadataFrame.toObject(e.audioMetadata,r)),e.audioStreamIdInfo!=null&&e.hasOwnProperty("audioStreamIdInfo")&&(n.audioStreamIdInfo=p.SdkAudioStreamIdInfoFrame.toObject(e.audioStreamIdInfo,r)),e.pingPong!=null&&e.hasOwnProperty("pingPong")&&(n.pingPong=p.SdkPingPongFrame.toObject(e.pingPong,r)),e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&(n.audioStatus=p.SdkAudioStatusFrame.toObject(e.audioStatus,r)),e.clientMetric!=null&&e.hasOwnProperty("clientMetric")&&(n.clientMetric=p.SdkClientMetricFrame.toObject(e.clientMetric,r)),e.dataMessage!=null&&e.hasOwnProperty("dataMessage")&&(n.dataMessage=p.SdkDataMessageFrame.toObject(e.dataMessage,r)),e.remoteVideoUpdate!=null&&e.hasOwnProperty("remoteVideoUpdate")&&(n.remoteVideoUpdate=p.SdkRemoteVideoUpdateFrame.toObject(e.remoteVideoUpdate,r)),e.primaryMeetingJoin!=null&&e.hasOwnProperty("primaryMeetingJoin")&&(n.primaryMeetingJoin=p.SdkPrimaryMeetingJoinFrame.toObject(e.primaryMeetingJoin,r)),e.primaryMeetingJoinAck!=null&&e.hasOwnProperty("primaryMeetingJoinAck")&&(n.primaryMeetingJoinAck=p.SdkPrimaryMeetingJoinAckFrame.toObject(e.primaryMeetingJoinAck,r)),e.primaryMeetingLeave!=null&&e.hasOwnProperty("primaryMeetingLeave")&&(n.primaryMeetingLeave=p.SdkPrimaryMeetingLeaveFrame.toObject(e.primaryMeetingLeave,r)),e.notification!=null&&e.hasOwnProperty("notification")&&(n.notification=p.SdkNotificationFrame.toObject(e.notification,r)),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkSignalFrame"},i.Type=(function(){var t={},e=Object.create(t);return e[t[1]="JOIN"]=1,e[t[2]="JOIN_ACK"]=2,e[t[3]="SUBSCRIBE"]=3,e[t[4]="SUBSCRIBE_ACK"]=4,e[t[5]="INDEX"]=5,e[t[7]="PAUSE"]=7,e[t[8]="RESUME"]=8,e[t[9]="LEAVE"]=9,e[t[10]="LEAVE_ACK"]=10,e[t[13]="BITRATES"]=13,e[t[16]="AUDIO_CONTROL"]=16,e[t[17]="AUDIO_METADATA"]=17,e[t[18]="AUDIO_STREAM_ID_INFO"]=18,e[t[19]="PING_PONG"]=19,e[t[20]="AUDIO_STATUS"]=20,e[t[21]="CLIENT_METRIC"]=21,e[t[22]="DATA_MESSAGE"]=22,e[t[24]="REMOTE_VIDEO_UPDATE"]=24,e[t[25]="PRIMARY_MEETING_JOIN"]=25,e[t[26]="PRIMARY_MEETING_JOIN_ACK"]=26,e[t[27]="PRIMARY_MEETING_LEAVE"]=27,e[t[34]="NOTIFICATION"]=34,e})(),i})();p.SdkErrorFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.status=0,i.prototype.description="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.status!=null&&Object.hasOwnProperty.call(e,"status")&&r.uint32(8).uint32(e.status),e.description!=null&&Object.hasOwnProperty.call(e,"description")&&r.uint32(18).string(e.description),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkErrorFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.status=e.uint32();break}case 2:{o.description=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.status!=null&&e.hasOwnProperty("status")&&!v.isInteger(e.status)?"status: integer expected":e.description!=null&&e.hasOwnProperty("description")&&!v.isString(e.description)?"description: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkErrorFrame)return e;var r=new p.SdkErrorFrame;return e.status!=null&&(r.status=e.status>>>0),e.description!=null&&(r.description=String(e.description)),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.status=0,n.description=""),e.status!=null&&e.hasOwnProperty("status")&&(n.status=e.status),e.description!=null&&e.hasOwnProperty("description")&&(n.description=e.description),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkErrorFrame"},i})();p.SdkJoinFlags=(function(){var i={},t=Object.create(i);return t[i[2]="HAS_STREAM_UPDATE"]=2,t[i[16]="COMPLETE_VIDEO_SOURCES_LIST"]=16,t[i[32]="EXCLUDE_SELF_CONTENT_IN_INDEX"]=32,t})();p.SdkClientDetails=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.appName="",i.prototype.appVersion="",i.prototype.deviceModel="",i.prototype.deviceMake="",i.prototype.platformName="",i.prototype.platformVersion="",i.prototype.clientSource="",i.prototype.chimeSdkVersion="",i.prototype.clientUtcOffset="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.appName!=null&&Object.hasOwnProperty.call(e,"appName")&&r.uint32(10).string(e.appName),e.appVersion!=null&&Object.hasOwnProperty.call(e,"appVersion")&&r.uint32(18).string(e.appVersion),e.deviceModel!=null&&Object.hasOwnProperty.call(e,"deviceModel")&&r.uint32(26).string(e.deviceModel),e.deviceMake!=null&&Object.hasOwnProperty.call(e,"deviceMake")&&r.uint32(34).string(e.deviceMake),e.platformName!=null&&Object.hasOwnProperty.call(e,"platformName")&&r.uint32(42).string(e.platformName),e.platformVersion!=null&&Object.hasOwnProperty.call(e,"platformVersion")&&r.uint32(50).string(e.platformVersion),e.clientSource!=null&&Object.hasOwnProperty.call(e,"clientSource")&&r.uint32(58).string(e.clientSource),e.chimeSdkVersion!=null&&Object.hasOwnProperty.call(e,"chimeSdkVersion")&&r.uint32(66).string(e.chimeSdkVersion),e.clientUtcOffset!=null&&Object.hasOwnProperty.call(e,"clientUtcOffset")&&r.uint32(74).string(e.clientUtcOffset),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkClientDetails;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.appName=e.string();break}case 2:{o.appVersion=e.string();break}case 3:{o.deviceModel=e.string();break}case 4:{o.deviceMake=e.string();break}case 5:{o.platformName=e.string();break}case 6:{o.platformVersion=e.string();break}case 7:{o.clientSource=e.string();break}case 8:{o.chimeSdkVersion=e.string();break}case 9:{o.clientUtcOffset=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.appName!=null&&e.hasOwnProperty("appName")&&!v.isString(e.appName)?"appName: string expected":e.appVersion!=null&&e.hasOwnProperty("appVersion")&&!v.isString(e.appVersion)?"appVersion: string expected":e.deviceModel!=null&&e.hasOwnProperty("deviceModel")&&!v.isString(e.deviceModel)?"deviceModel: string expected":e.deviceMake!=null&&e.hasOwnProperty("deviceMake")&&!v.isString(e.deviceMake)?"deviceMake: string expected":e.platformName!=null&&e.hasOwnProperty("platformName")&&!v.isString(e.platformName)?"platformName: string expected":e.platformVersion!=null&&e.hasOwnProperty("platformVersion")&&!v.isString(e.platformVersion)?"platformVersion: string expected":e.clientSource!=null&&e.hasOwnProperty("clientSource")&&!v.isString(e.clientSource)?"clientSource: string expected":e.chimeSdkVersion!=null&&e.hasOwnProperty("chimeSdkVersion")&&!v.isString(e.chimeSdkVersion)?"chimeSdkVersion: string expected":e.clientUtcOffset!=null&&e.hasOwnProperty("clientUtcOffset")&&!v.isString(e.clientUtcOffset)?"clientUtcOffset: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkClientDetails)return e;var r=new p.SdkClientDetails;return e.appName!=null&&(r.appName=String(e.appName)),e.appVersion!=null&&(r.appVersion=String(e.appVersion)),e.deviceModel!=null&&(r.deviceModel=String(e.deviceModel)),e.deviceMake!=null&&(r.deviceMake=String(e.deviceMake)),e.platformName!=null&&(r.platformName=String(e.platformName)),e.platformVersion!=null&&(r.platformVersion=String(e.platformVersion)),e.clientSource!=null&&(r.clientSource=String(e.clientSource)),e.chimeSdkVersion!=null&&(r.chimeSdkVersion=String(e.chimeSdkVersion)),e.clientUtcOffset!=null&&(r.clientUtcOffset=String(e.clientUtcOffset)),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.appName="",n.appVersion="",n.deviceModel="",n.deviceMake="",n.platformName="",n.platformVersion="",n.clientSource="",n.chimeSdkVersion="",n.clientUtcOffset=""),e.appName!=null&&e.hasOwnProperty("appName")&&(n.appName=e.appName),e.appVersion!=null&&e.hasOwnProperty("appVersion")&&(n.appVersion=e.appVersion),e.deviceModel!=null&&e.hasOwnProperty("deviceModel")&&(n.deviceModel=e.deviceModel),e.deviceMake!=null&&e.hasOwnProperty("deviceMake")&&(n.deviceMake=e.deviceMake),e.platformName!=null&&e.hasOwnProperty("platformName")&&(n.platformName=e.platformName),e.platformVersion!=null&&e.hasOwnProperty("platformVersion")&&(n.platformVersion=e.platformVersion),e.clientSource!=null&&e.hasOwnProperty("clientSource")&&(n.clientSource=e.clientSource),e.chimeSdkVersion!=null&&e.hasOwnProperty("chimeSdkVersion")&&(n.chimeSdkVersion=e.chimeSdkVersion),e.clientUtcOffset!=null&&e.hasOwnProperty("clientUtcOffset")&&(n.clientUtcOffset=e.clientUtcOffset),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkClientDetails"},i})();p.SdkServerSideNetworkAdaption=(function(){var i={},t=Object.create(i);return t[i[1]="DEFAULT"]=1,t[i[2]="NONE"]=2,t[i[3]="BANDWIDTH_PROBING"]=3,t[i[4]="BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION"]=4,t})();p.SdkJoinFrame=(function(){function i(t){if(this.supportedServerSideNetworkAdaptions=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.protocolVersion=2,i.prototype.maxNumOfVideos=0,i.prototype.flags=0,i.prototype.clientDetails=null,i.prototype.audioSessionId=v.Long?v.Long.fromBits(0,0,!0):0,i.prototype.wantsCompressedSdp=!1,i.prototype.serverSideNetworkAdaption=1,i.prototype.supportedServerSideNetworkAdaptions=v.emptyArray,i.prototype.wantsAllTemporalLayersInIndex=!1,i.prototype.disablePeriodicKeyframeRequestOnContentSender=!1,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.protocolVersion!=null&&Object.hasOwnProperty.call(e,"protocolVersion")&&r.uint32(8).uint32(e.protocolVersion),e.maxNumOfVideos!=null&&Object.hasOwnProperty.call(e,"maxNumOfVideos")&&r.uint32(16).uint32(e.maxNumOfVideos),e.flags!=null&&Object.hasOwnProperty.call(e,"flags")&&r.uint32(24).uint32(e.flags),e.clientDetails!=null&&Object.hasOwnProperty.call(e,"clientDetails")&&p.SdkClientDetails.encode(e.clientDetails,r.uint32(34).fork()).ldelim(),e.audioSessionId!=null&&Object.hasOwnProperty.call(e,"audioSessionId")&&r.uint32(48).uint64(e.audioSessionId),e.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&r.uint32(56).bool(e.wantsCompressedSdp),e.serverSideNetworkAdaption!=null&&Object.hasOwnProperty.call(e,"serverSideNetworkAdaption")&&r.uint32(80).int32(e.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions!=null&&e.supportedServerSideNetworkAdaptions.length)for(var n=0;n<e.supportedServerSideNetworkAdaptions.length;++n)r.uint32(88).int32(e.supportedServerSideNetworkAdaptions[n]);return e.wantsAllTemporalLayersInIndex!=null&&Object.hasOwnProperty.call(e,"wantsAllTemporalLayersInIndex")&&r.uint32(96).bool(e.wantsAllTemporalLayersInIndex),e.disablePeriodicKeyframeRequestOnContentSender!=null&&Object.hasOwnProperty.call(e,"disablePeriodicKeyframeRequestOnContentSender")&&r.uint32(104).bool(e.disablePeriodicKeyframeRequestOnContentSender),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkJoinFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.protocolVersion=e.uint32();break}case 2:{o.maxNumOfVideos=e.uint32();break}case 3:{o.flags=e.uint32();break}case 4:{o.clientDetails=p.SdkClientDetails.decode(e,e.uint32());break}case 6:{o.audioSessionId=e.uint64();break}case 7:{o.wantsCompressedSdp=e.bool();break}case 10:{o.serverSideNetworkAdaption=e.int32();break}case 11:{if(o.supportedServerSideNetworkAdaptions&&o.supportedServerSideNetworkAdaptions.length||(o.supportedServerSideNetworkAdaptions=[]),(s&7)===2)for(var a=e.uint32()+e.pos;e.pos<a;)o.supportedServerSideNetworkAdaptions.push(e.int32());else o.supportedServerSideNetworkAdaptions.push(e.int32());break}case 12:{o.wantsAllTemporalLayersInIndex=e.bool();break}case 13:{o.disablePeriodicKeyframeRequestOnContentSender=e.bool();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.protocolVersion!=null&&e.hasOwnProperty("protocolVersion")&&!v.isInteger(e.protocolVersion))return"protocolVersion: integer expected";if(e.maxNumOfVideos!=null&&e.hasOwnProperty("maxNumOfVideos")&&!v.isInteger(e.maxNumOfVideos))return"maxNumOfVideos: integer expected";if(e.flags!=null&&e.hasOwnProperty("flags")&&!v.isInteger(e.flags))return"flags: integer expected";if(e.clientDetails!=null&&e.hasOwnProperty("clientDetails")){var r=p.SdkClientDetails.verify(e.clientDetails);if(r)return"clientDetails."+r}if(e.audioSessionId!=null&&e.hasOwnProperty("audioSessionId")&&!v.isInteger(e.audioSessionId)&&!(e.audioSessionId&&v.isInteger(e.audioSessionId.low)&&v.isInteger(e.audioSessionId.high)))return"audioSessionId: integer|Long expected";if(e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&typeof e.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(e.serverSideNetworkAdaption!=null&&e.hasOwnProperty("serverSideNetworkAdaption"))switch(e.serverSideNetworkAdaption){default:return"serverSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:break}if(e.supportedServerSideNetworkAdaptions!=null&&e.hasOwnProperty("supportedServerSideNetworkAdaptions")){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))return"supportedServerSideNetworkAdaptions: array expected";for(var n=0;n<e.supportedServerSideNetworkAdaptions.length;++n)switch(e.supportedServerSideNetworkAdaptions[n]){default:return"supportedServerSideNetworkAdaptions: enum value[] expected";case 1:case 2:case 3:case 4:break}}return e.wantsAllTemporalLayersInIndex!=null&&e.hasOwnProperty("wantsAllTemporalLayersInIndex")&&typeof e.wantsAllTemporalLayersInIndex!="boolean"?"wantsAllTemporalLayersInIndex: boolean expected":e.disablePeriodicKeyframeRequestOnContentSender!=null&&e.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&typeof e.disablePeriodicKeyframeRequestOnContentSender!="boolean"?"disablePeriodicKeyframeRequestOnContentSender: boolean expected":null},i.fromObject=function(e){if(e instanceof p.SdkJoinFrame)return e;var r=new p.SdkJoinFrame;if(e.protocolVersion!=null&&(r.protocolVersion=e.protocolVersion>>>0),e.maxNumOfVideos!=null&&(r.maxNumOfVideos=e.maxNumOfVideos>>>0),e.flags!=null&&(r.flags=e.flags>>>0),e.clientDetails!=null){if(typeof e.clientDetails!="object")throw TypeError(".SdkJoinFrame.clientDetails: object expected");r.clientDetails=p.SdkClientDetails.fromObject(e.clientDetails)}switch(e.audioSessionId!=null&&(v.Long?(r.audioSessionId=v.Long.fromValue(e.audioSessionId)).unsigned=!0:typeof e.audioSessionId=="string"?r.audioSessionId=parseInt(e.audioSessionId,10):typeof e.audioSessionId=="number"?r.audioSessionId=e.audioSessionId:typeof e.audioSessionId=="object"&&(r.audioSessionId=new v.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0))),e.wantsCompressedSdp!=null&&(r.wantsCompressedSdp=!!e.wantsCompressedSdp),e.serverSideNetworkAdaption){default:if(typeof e.serverSideNetworkAdaption=="number"){r.serverSideNetworkAdaption=e.serverSideNetworkAdaption;break}break;case"DEFAULT":case 1:r.serverSideNetworkAdaption=1;break;case"NONE":case 2:r.serverSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:r.serverSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:r.serverSideNetworkAdaption=4;break}if(e.supportedServerSideNetworkAdaptions){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))throw TypeError(".SdkJoinFrame.supportedServerSideNetworkAdaptions: array expected");r.supportedServerSideNetworkAdaptions=[];for(var n=0;n<e.supportedServerSideNetworkAdaptions.length;++n)switch(e.supportedServerSideNetworkAdaptions[n]){default:if(typeof e.supportedServerSideNetworkAdaptions[n]=="number"){r.supportedServerSideNetworkAdaptions[n]=e.supportedServerSideNetworkAdaptions[n];break}case"DEFAULT":case 1:r.supportedServerSideNetworkAdaptions[n]=1;break;case"NONE":case 2:r.supportedServerSideNetworkAdaptions[n]=2;break;case"BANDWIDTH_PROBING":case 3:r.supportedServerSideNetworkAdaptions[n]=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:r.supportedServerSideNetworkAdaptions[n]=4;break}}return e.wantsAllTemporalLayersInIndex!=null&&(r.wantsAllTemporalLayersInIndex=!!e.wantsAllTemporalLayersInIndex),e.disablePeriodicKeyframeRequestOnContentSender!=null&&(r.disablePeriodicKeyframeRequestOnContentSender=!!e.disablePeriodicKeyframeRequestOnContentSender),r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.supportedServerSideNetworkAdaptions=[]),r.defaults){if(n.protocolVersion=2,n.maxNumOfVideos=0,n.flags=0,n.clientDetails=null,v.Long){var o=new v.Long(0,0,!0);n.audioSessionId=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.audioSessionId=r.longs===String?"0":0;n.wantsCompressedSdp=!1,n.serverSideNetworkAdaption=r.enums===String?"DEFAULT":1,n.wantsAllTemporalLayersInIndex=!1,n.disablePeriodicKeyframeRequestOnContentSender=!1}if(e.protocolVersion!=null&&e.hasOwnProperty("protocolVersion")&&(n.protocolVersion=e.protocolVersion),e.maxNumOfVideos!=null&&e.hasOwnProperty("maxNumOfVideos")&&(n.maxNumOfVideos=e.maxNumOfVideos),e.flags!=null&&e.hasOwnProperty("flags")&&(n.flags=e.flags),e.clientDetails!=null&&e.hasOwnProperty("clientDetails")&&(n.clientDetails=p.SdkClientDetails.toObject(e.clientDetails,r)),e.audioSessionId!=null&&e.hasOwnProperty("audioSessionId")&&(typeof e.audioSessionId=="number"?n.audioSessionId=r.longs===String?String(e.audioSessionId):e.audioSessionId:n.audioSessionId=r.longs===String?v.Long.prototype.toString.call(e.audioSessionId):r.longs===Number?new v.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0):e.audioSessionId),e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&(n.wantsCompressedSdp=e.wantsCompressedSdp),e.serverSideNetworkAdaption!=null&&e.hasOwnProperty("serverSideNetworkAdaption")&&(n.serverSideNetworkAdaption=r.enums===String?p.SdkServerSideNetworkAdaption[e.serverSideNetworkAdaption]===void 0?e.serverSideNetworkAdaption:p.SdkServerSideNetworkAdaption[e.serverSideNetworkAdaption]:e.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions&&e.supportedServerSideNetworkAdaptions.length){n.supportedServerSideNetworkAdaptions=[];for(var s=0;s<e.supportedServerSideNetworkAdaptions.length;++s)n.supportedServerSideNetworkAdaptions[s]=r.enums===String?p.SdkServerSideNetworkAdaption[e.supportedServerSideNetworkAdaptions[s]]===void 0?e.supportedServerSideNetworkAdaptions[s]:p.SdkServerSideNetworkAdaption[e.supportedServerSideNetworkAdaptions[s]]:e.supportedServerSideNetworkAdaptions[s]}return e.wantsAllTemporalLayersInIndex!=null&&e.hasOwnProperty("wantsAllTemporalLayersInIndex")&&(n.wantsAllTemporalLayersInIndex=e.wantsAllTemporalLayersInIndex),e.disablePeriodicKeyframeRequestOnContentSender!=null&&e.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&(n.disablePeriodicKeyframeRequestOnContentSender=e.disablePeriodicKeyframeRequestOnContentSender),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkJoinFrame"},i})();p.SdkJoinAckFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.turnCredentials=null,i.prototype.videoSubscriptionLimit=0,i.prototype.wantsCompressedSdp=!1,i.prototype.defaultServerSideNetworkAdaption=1,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.turnCredentials!=null&&Object.hasOwnProperty.call(e,"turnCredentials")&&p.SdkTurnCredentials.encode(e.turnCredentials,r.uint32(10).fork()).ldelim(),e.videoSubscriptionLimit!=null&&Object.hasOwnProperty.call(e,"videoSubscriptionLimit")&&r.uint32(16).uint32(e.videoSubscriptionLimit),e.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&r.uint32(24).bool(e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption!=null&&Object.hasOwnProperty.call(e,"defaultServerSideNetworkAdaption")&&r.uint32(32).int32(e.defaultServerSideNetworkAdaption),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkJoinAckFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.turnCredentials=p.SdkTurnCredentials.decode(e,e.uint32());break}case 2:{o.videoSubscriptionLimit=e.uint32();break}case 3:{o.wantsCompressedSdp=e.bool();break}case 4:{o.defaultServerSideNetworkAdaption=e.int32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.turnCredentials!=null&&e.hasOwnProperty("turnCredentials")){var r=p.SdkTurnCredentials.verify(e.turnCredentials);if(r)return"turnCredentials."+r}if(e.videoSubscriptionLimit!=null&&e.hasOwnProperty("videoSubscriptionLimit")&&!v.isInteger(e.videoSubscriptionLimit))return"videoSubscriptionLimit: integer expected";if(e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&typeof e.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(e.defaultServerSideNetworkAdaption!=null&&e.hasOwnProperty("defaultServerSideNetworkAdaption"))switch(e.defaultServerSideNetworkAdaption){default:return"defaultServerSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:break}return null},i.fromObject=function(e){if(e instanceof p.SdkJoinAckFrame)return e;var r=new p.SdkJoinAckFrame;if(e.turnCredentials!=null){if(typeof e.turnCredentials!="object")throw TypeError(".SdkJoinAckFrame.turnCredentials: object expected");r.turnCredentials=p.SdkTurnCredentials.fromObject(e.turnCredentials)}switch(e.videoSubscriptionLimit!=null&&(r.videoSubscriptionLimit=e.videoSubscriptionLimit>>>0),e.wantsCompressedSdp!=null&&(r.wantsCompressedSdp=!!e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption){default:if(typeof e.defaultServerSideNetworkAdaption=="number"){r.defaultServerSideNetworkAdaption=e.defaultServerSideNetworkAdaption;break}break;case"DEFAULT":case 1:r.defaultServerSideNetworkAdaption=1;break;case"NONE":case 2:r.defaultServerSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:r.defaultServerSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:r.defaultServerSideNetworkAdaption=4;break}return r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.turnCredentials=null,n.videoSubscriptionLimit=0,n.wantsCompressedSdp=!1,n.defaultServerSideNetworkAdaption=r.enums===String?"DEFAULT":1),e.turnCredentials!=null&&e.hasOwnProperty("turnCredentials")&&(n.turnCredentials=p.SdkTurnCredentials.toObject(e.turnCredentials,r)),e.videoSubscriptionLimit!=null&&e.hasOwnProperty("videoSubscriptionLimit")&&(n.videoSubscriptionLimit=e.videoSubscriptionLimit),e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&(n.wantsCompressedSdp=e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption!=null&&e.hasOwnProperty("defaultServerSideNetworkAdaption")&&(n.defaultServerSideNetworkAdaption=r.enums===String?p.SdkServerSideNetworkAdaption[e.defaultServerSideNetworkAdaption]===void 0?e.defaultServerSideNetworkAdaption:p.SdkServerSideNetworkAdaption[e.defaultServerSideNetworkAdaption]:e.defaultServerSideNetworkAdaption),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkJoinAckFrame"},i})();p.SdkLeaveFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkLeaveFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":null},i.fromObject=function(e){return e instanceof p.SdkLeaveFrame?e:new p.SdkLeaveFrame},i.toObject=function(){return{}},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkLeaveFrame"},i})();p.SdkLeaveAckFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkLeaveAckFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":null},i.fromObject=function(e){return e instanceof p.SdkLeaveAckFrame?e:new p.SdkLeaveAckFrame},i.toObject=function(){return{}},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkLeaveAckFrame"},i})();p.SdkStreamServiceType=(function(){var i={},t=Object.create(i);return t[i[1]="RX"]=1,t[i[2]="TX"]=2,t[i[3]="DUPLEX"]=3,t})();p.SdkStreamMediaType=(function(){var i={},t=Object.create(i);return t[i[1]="AUDIO"]=1,t[i[2]="VIDEO"]=2,t})();p.SdkSubscribeFrame=(function(){function i(t){if(this.sendStreams=[],this.receiveStreamIds=[],this.videoSubscriptionConfiguration=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.duplex=1,i.prototype.sendStreams=v.emptyArray,i.prototype.receiveStreamIds=v.emptyArray,i.prototype.sdpOffer="",i.prototype.audioHost="",i.prototype.audioCheckin=!1,i.prototype.audioMuted=!1,i.prototype.compressedSdpOffer=v.newBuffer([]),i.prototype.videoSubscriptionConfiguration=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.duplex!=null&&Object.hasOwnProperty.call(e,"duplex")&&r.uint32(8).int32(e.duplex),e.sendStreams!=null&&e.sendStreams.length)for(var n=0;n<e.sendStreams.length;++n)p.SdkStreamDescriptor.encode(e.sendStreams[n],r.uint32(18).fork()).ldelim();if(e.receiveStreamIds!=null&&e.receiveStreamIds.length)for(var n=0;n<e.receiveStreamIds.length;++n)r.uint32(24).uint32(e.receiveStreamIds[n]);if(e.sdpOffer!=null&&Object.hasOwnProperty.call(e,"sdpOffer")&&r.uint32(34).string(e.sdpOffer),e.audioHost!=null&&Object.hasOwnProperty.call(e,"audioHost")&&r.uint32(42).string(e.audioHost),e.audioCheckin!=null&&Object.hasOwnProperty.call(e,"audioCheckin")&&r.uint32(48).bool(e.audioCheckin),e.audioMuted!=null&&Object.hasOwnProperty.call(e,"audioMuted")&&r.uint32(56).bool(e.audioMuted),e.compressedSdpOffer!=null&&Object.hasOwnProperty.call(e,"compressedSdpOffer")&&r.uint32(66).bytes(e.compressedSdpOffer),e.videoSubscriptionConfiguration!=null&&e.videoSubscriptionConfiguration.length)for(var n=0;n<e.videoSubscriptionConfiguration.length;++n)p.SdkVideoSubscriptionConfiguration.encode(e.videoSubscriptionConfiguration[n],r.uint32(74).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkSubscribeFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.duplex=e.int32();break}case 2:{o.sendStreams&&o.sendStreams.length||(o.sendStreams=[]),o.sendStreams.push(p.SdkStreamDescriptor.decode(e,e.uint32()));break}case 3:{if(o.receiveStreamIds&&o.receiveStreamIds.length||(o.receiveStreamIds=[]),(s&7)===2)for(var a=e.uint32()+e.pos;e.pos<a;)o.receiveStreamIds.push(e.uint32());else o.receiveStreamIds.push(e.uint32());break}case 4:{o.sdpOffer=e.string();break}case 5:{o.audioHost=e.string();break}case 6:{o.audioCheckin=e.bool();break}case 7:{o.audioMuted=e.bool();break}case 8:{o.compressedSdpOffer=e.bytes();break}case 9:{o.videoSubscriptionConfiguration&&o.videoSubscriptionConfiguration.length||(o.videoSubscriptionConfiguration=[]),o.videoSubscriptionConfiguration.push(p.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.duplex!=null&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(e.sendStreams!=null&&e.hasOwnProperty("sendStreams")){if(!Array.isArray(e.sendStreams))return"sendStreams: array expected";for(var r=0;r<e.sendStreams.length;++r){var n=p.SdkStreamDescriptor.verify(e.sendStreams[r]);if(n)return"sendStreams."+n}}if(e.receiveStreamIds!=null&&e.hasOwnProperty("receiveStreamIds")){if(!Array.isArray(e.receiveStreamIds))return"receiveStreamIds: array expected";for(var r=0;r<e.receiveStreamIds.length;++r)if(!v.isInteger(e.receiveStreamIds[r]))return"receiveStreamIds: integer[] expected"}if(e.sdpOffer!=null&&e.hasOwnProperty("sdpOffer")&&!v.isString(e.sdpOffer))return"sdpOffer: string expected";if(e.audioHost!=null&&e.hasOwnProperty("audioHost")&&!v.isString(e.audioHost))return"audioHost: string expected";if(e.audioCheckin!=null&&e.hasOwnProperty("audioCheckin")&&typeof e.audioCheckin!="boolean")return"audioCheckin: boolean expected";if(e.audioMuted!=null&&e.hasOwnProperty("audioMuted")&&typeof e.audioMuted!="boolean")return"audioMuted: boolean expected";if(e.compressedSdpOffer!=null&&e.hasOwnProperty("compressedSdpOffer")&&!(e.compressedSdpOffer&&typeof e.compressedSdpOffer.length=="number"||v.isString(e.compressedSdpOffer)))return"compressedSdpOffer: buffer expected";if(e.videoSubscriptionConfiguration!=null&&e.hasOwnProperty("videoSubscriptionConfiguration")){if(!Array.isArray(e.videoSubscriptionConfiguration))return"videoSubscriptionConfiguration: array expected";for(var r=0;r<e.videoSubscriptionConfiguration.length;++r){var n=p.SdkVideoSubscriptionConfiguration.verify(e.videoSubscriptionConfiguration[r]);if(n)return"videoSubscriptionConfiguration."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkSubscribeFrame)return e;var r=new p.SdkSubscribeFrame;switch(e.duplex){default:if(typeof e.duplex=="number"){r.duplex=e.duplex;break}break;case"RX":case 1:r.duplex=1;break;case"TX":case 2:r.duplex=2;break;case"DUPLEX":case 3:r.duplex=3;break}if(e.sendStreams){if(!Array.isArray(e.sendStreams))throw TypeError(".SdkSubscribeFrame.sendStreams: array expected");r.sendStreams=[];for(var n=0;n<e.sendStreams.length;++n){if(typeof e.sendStreams[n]!="object")throw TypeError(".SdkSubscribeFrame.sendStreams: object expected");r.sendStreams[n]=p.SdkStreamDescriptor.fromObject(e.sendStreams[n])}}if(e.receiveStreamIds){if(!Array.isArray(e.receiveStreamIds))throw TypeError(".SdkSubscribeFrame.receiveStreamIds: array expected");r.receiveStreamIds=[];for(var n=0;n<e.receiveStreamIds.length;++n)r.receiveStreamIds[n]=e.receiveStreamIds[n]>>>0}if(e.sdpOffer!=null&&(r.sdpOffer=String(e.sdpOffer)),e.audioHost!=null&&(r.audioHost=String(e.audioHost)),e.audioCheckin!=null&&(r.audioCheckin=!!e.audioCheckin),e.audioMuted!=null&&(r.audioMuted=!!e.audioMuted),e.compressedSdpOffer!=null&&(typeof e.compressedSdpOffer=="string"?v.base64.decode(e.compressedSdpOffer,r.compressedSdpOffer=v.newBuffer(v.base64.length(e.compressedSdpOffer)),0):e.compressedSdpOffer.length>=0&&(r.compressedSdpOffer=e.compressedSdpOffer)),e.videoSubscriptionConfiguration){if(!Array.isArray(e.videoSubscriptionConfiguration))throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: array expected");r.videoSubscriptionConfiguration=[];for(var n=0;n<e.videoSubscriptionConfiguration.length;++n){if(typeof e.videoSubscriptionConfiguration[n]!="object")throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: object expected");r.videoSubscriptionConfiguration[n]=p.SdkVideoSubscriptionConfiguration.fromObject(e.videoSubscriptionConfiguration[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.sendStreams=[],n.receiveStreamIds=[],n.videoSubscriptionConfiguration=[]),r.defaults&&(n.duplex=r.enums===String?"RX":1,n.sdpOffer="",n.audioHost="",n.audioCheckin=!1,n.audioMuted=!1,r.bytes===String?n.compressedSdpOffer="":(n.compressedSdpOffer=[],r.bytes!==Array&&(n.compressedSdpOffer=v.newBuffer(n.compressedSdpOffer)))),e.duplex!=null&&e.hasOwnProperty("duplex")&&(n.duplex=r.enums===String?p.SdkStreamServiceType[e.duplex]===void 0?e.duplex:p.SdkStreamServiceType[e.duplex]:e.duplex),e.sendStreams&&e.sendStreams.length){n.sendStreams=[];for(var o=0;o<e.sendStreams.length;++o)n.sendStreams[o]=p.SdkStreamDescriptor.toObject(e.sendStreams[o],r)}if(e.receiveStreamIds&&e.receiveStreamIds.length){n.receiveStreamIds=[];for(var o=0;o<e.receiveStreamIds.length;++o)n.receiveStreamIds[o]=e.receiveStreamIds[o]}if(e.sdpOffer!=null&&e.hasOwnProperty("sdpOffer")&&(n.sdpOffer=e.sdpOffer),e.audioHost!=null&&e.hasOwnProperty("audioHost")&&(n.audioHost=e.audioHost),e.audioCheckin!=null&&e.hasOwnProperty("audioCheckin")&&(n.audioCheckin=e.audioCheckin),e.audioMuted!=null&&e.hasOwnProperty("audioMuted")&&(n.audioMuted=e.audioMuted),e.compressedSdpOffer!=null&&e.hasOwnProperty("compressedSdpOffer")&&(n.compressedSdpOffer=r.bytes===String?v.base64.encode(e.compressedSdpOffer,0,e.compressedSdpOffer.length):r.bytes===Array?Array.prototype.slice.call(e.compressedSdpOffer):e.compressedSdpOffer),e.videoSubscriptionConfiguration&&e.videoSubscriptionConfiguration.length){n.videoSubscriptionConfiguration=[];for(var o=0;o<e.videoSubscriptionConfiguration.length;++o)n.videoSubscriptionConfiguration[o]=p.SdkVideoSubscriptionConfiguration.toObject(e.videoSubscriptionConfiguration[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkSubscribeFrame"},i})();p.SdkSubscribeAckFrame=(function(){function i(t){if(this.allocations=[],this.tracks=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.duplex=1,i.prototype.allocations=v.emptyArray,i.prototype.sdpAnswer="",i.prototype.tracks=v.emptyArray,i.prototype.compressedSdpAnswer=v.newBuffer([]),i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.duplex!=null&&Object.hasOwnProperty.call(e,"duplex")&&r.uint32(8).int32(e.duplex),e.allocations!=null&&e.allocations.length)for(var n=0;n<e.allocations.length;++n)p.SdkStreamAllocation.encode(e.allocations[n],r.uint32(18).fork()).ldelim();if(e.sdpAnswer!=null&&Object.hasOwnProperty.call(e,"sdpAnswer")&&r.uint32(26).string(e.sdpAnswer),e.tracks!=null&&e.tracks.length)for(var n=0;n<e.tracks.length;++n)p.SdkTrackMapping.encode(e.tracks[n],r.uint32(34).fork()).ldelim();return e.compressedSdpAnswer!=null&&Object.hasOwnProperty.call(e,"compressedSdpAnswer")&&r.uint32(42).bytes(e.compressedSdpAnswer),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkSubscribeAckFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.duplex=e.int32();break}case 2:{o.allocations&&o.allocations.length||(o.allocations=[]),o.allocations.push(p.SdkStreamAllocation.decode(e,e.uint32()));break}case 3:{o.sdpAnswer=e.string();break}case 4:{o.tracks&&o.tracks.length||(o.tracks=[]),o.tracks.push(p.SdkTrackMapping.decode(e,e.uint32()));break}case 5:{o.compressedSdpAnswer=e.bytes();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.duplex!=null&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(e.allocations!=null&&e.hasOwnProperty("allocations")){if(!Array.isArray(e.allocations))return"allocations: array expected";for(var r=0;r<e.allocations.length;++r){var n=p.SdkStreamAllocation.verify(e.allocations[r]);if(n)return"allocations."+n}}if(e.sdpAnswer!=null&&e.hasOwnProperty("sdpAnswer")&&!v.isString(e.sdpAnswer))return"sdpAnswer: string expected";if(e.tracks!=null&&e.hasOwnProperty("tracks")){if(!Array.isArray(e.tracks))return"tracks: array expected";for(var r=0;r<e.tracks.length;++r){var n=p.SdkTrackMapping.verify(e.tracks[r]);if(n)return"tracks."+n}}return e.compressedSdpAnswer!=null&&e.hasOwnProperty("compressedSdpAnswer")&&!(e.compressedSdpAnswer&&typeof e.compressedSdpAnswer.length=="number"||v.isString(e.compressedSdpAnswer))?"compressedSdpAnswer: buffer expected":null},i.fromObject=function(e){if(e instanceof p.SdkSubscribeAckFrame)return e;var r=new p.SdkSubscribeAckFrame;switch(e.duplex){default:if(typeof e.duplex=="number"){r.duplex=e.duplex;break}break;case"RX":case 1:r.duplex=1;break;case"TX":case 2:r.duplex=2;break;case"DUPLEX":case 3:r.duplex=3;break}if(e.allocations){if(!Array.isArray(e.allocations))throw TypeError(".SdkSubscribeAckFrame.allocations: array expected");r.allocations=[];for(var n=0;n<e.allocations.length;++n){if(typeof e.allocations[n]!="object")throw TypeError(".SdkSubscribeAckFrame.allocations: object expected");r.allocations[n]=p.SdkStreamAllocation.fromObject(e.allocations[n])}}if(e.sdpAnswer!=null&&(r.sdpAnswer=String(e.sdpAnswer)),e.tracks){if(!Array.isArray(e.tracks))throw TypeError(".SdkSubscribeAckFrame.tracks: array expected");r.tracks=[];for(var n=0;n<e.tracks.length;++n){if(typeof e.tracks[n]!="object")throw TypeError(".SdkSubscribeAckFrame.tracks: object expected");r.tracks[n]=p.SdkTrackMapping.fromObject(e.tracks[n])}}return e.compressedSdpAnswer!=null&&(typeof e.compressedSdpAnswer=="string"?v.base64.decode(e.compressedSdpAnswer,r.compressedSdpAnswer=v.newBuffer(v.base64.length(e.compressedSdpAnswer)),0):e.compressedSdpAnswer.length>=0&&(r.compressedSdpAnswer=e.compressedSdpAnswer)),r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.allocations=[],n.tracks=[]),r.defaults&&(n.duplex=r.enums===String?"RX":1,n.sdpAnswer="",r.bytes===String?n.compressedSdpAnswer="":(n.compressedSdpAnswer=[],r.bytes!==Array&&(n.compressedSdpAnswer=v.newBuffer(n.compressedSdpAnswer)))),e.duplex!=null&&e.hasOwnProperty("duplex")&&(n.duplex=r.enums===String?p.SdkStreamServiceType[e.duplex]===void 0?e.duplex:p.SdkStreamServiceType[e.duplex]:e.duplex),e.allocations&&e.allocations.length){n.allocations=[];for(var o=0;o<e.allocations.length;++o)n.allocations[o]=p.SdkStreamAllocation.toObject(e.allocations[o],r)}if(e.sdpAnswer!=null&&e.hasOwnProperty("sdpAnswer")&&(n.sdpAnswer=e.sdpAnswer),e.tracks&&e.tracks.length){n.tracks=[];for(var o=0;o<e.tracks.length;++o)n.tracks[o]=p.SdkTrackMapping.toObject(e.tracks[o],r)}return e.compressedSdpAnswer!=null&&e.hasOwnProperty("compressedSdpAnswer")&&(n.compressedSdpAnswer=r.bytes===String?v.base64.encode(e.compressedSdpAnswer,0,e.compressedSdpAnswer.length):r.bytes===Array?Array.prototype.slice.call(e.compressedSdpAnswer):e.compressedSdpAnswer),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkSubscribeAckFrame"},i})();p.SdkIndexFrame=(function(){function i(t){if(this.sources=[],this.pausedAtSourceIds=[],this.supportedReceiveCodecIntersection=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.atCapacity=!1,i.prototype.sources=v.emptyArray,i.prototype.pausedAtSourceIds=v.emptyArray,i.prototype.numParticipants=0,i.prototype.supportedReceiveCodecIntersection=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.atCapacity!=null&&Object.hasOwnProperty.call(e,"atCapacity")&&r.uint32(8).bool(e.atCapacity),e.sources!=null&&e.sources.length)for(var n=0;n<e.sources.length;++n)p.SdkStreamDescriptor.encode(e.sources[n],r.uint32(18).fork()).ldelim();if(e.pausedAtSourceIds!=null&&e.pausedAtSourceIds.length)for(var n=0;n<e.pausedAtSourceIds.length;++n)r.uint32(24).uint32(e.pausedAtSourceIds[n]);if(e.numParticipants!=null&&Object.hasOwnProperty.call(e,"numParticipants")&&r.uint32(32).uint32(e.numParticipants),e.supportedReceiveCodecIntersection!=null&&e.supportedReceiveCodecIntersection.length)for(var n=0;n<e.supportedReceiveCodecIntersection.length;++n)r.uint32(40).int32(e.supportedReceiveCodecIntersection[n]);return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkIndexFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.atCapacity=e.bool();break}case 2:{o.sources&&o.sources.length||(o.sources=[]),o.sources.push(p.SdkStreamDescriptor.decode(e,e.uint32()));break}case 3:{if(o.pausedAtSourceIds&&o.pausedAtSourceIds.length||(o.pausedAtSourceIds=[]),(s&7)===2)for(var a=e.uint32()+e.pos;e.pos<a;)o.pausedAtSourceIds.push(e.uint32());else o.pausedAtSourceIds.push(e.uint32());break}case 4:{o.numParticipants=e.uint32();break}case 5:{if(o.supportedReceiveCodecIntersection&&o.supportedReceiveCodecIntersection.length||(o.supportedReceiveCodecIntersection=[]),(s&7)===2)for(var a=e.uint32()+e.pos;e.pos<a;)o.supportedReceiveCodecIntersection.push(e.int32());else o.supportedReceiveCodecIntersection.push(e.int32());break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.atCapacity!=null&&e.hasOwnProperty("atCapacity")&&typeof e.atCapacity!="boolean")return"atCapacity: boolean expected";if(e.sources!=null&&e.hasOwnProperty("sources")){if(!Array.isArray(e.sources))return"sources: array expected";for(var r=0;r<e.sources.length;++r){var n=p.SdkStreamDescriptor.verify(e.sources[r]);if(n)return"sources."+n}}if(e.pausedAtSourceIds!=null&&e.hasOwnProperty("pausedAtSourceIds")){if(!Array.isArray(e.pausedAtSourceIds))return"pausedAtSourceIds: array expected";for(var r=0;r<e.pausedAtSourceIds.length;++r)if(!v.isInteger(e.pausedAtSourceIds[r]))return"pausedAtSourceIds: integer[] expected"}if(e.numParticipants!=null&&e.hasOwnProperty("numParticipants")&&!v.isInteger(e.numParticipants))return"numParticipants: integer expected";if(e.supportedReceiveCodecIntersection!=null&&e.hasOwnProperty("supportedReceiveCodecIntersection")){if(!Array.isArray(e.supportedReceiveCodecIntersection))return"supportedReceiveCodecIntersection: array expected";for(var r=0;r<e.supportedReceiveCodecIntersection.length;++r)switch(e.supportedReceiveCodecIntersection[r]){default:return"supportedReceiveCodecIntersection: enum value[] expected";case 1:case 2:case 3:case 4:case 5:case 6:case 8:case 11:break}}return null},i.fromObject=function(e){if(e instanceof p.SdkIndexFrame)return e;var r=new p.SdkIndexFrame;if(e.atCapacity!=null&&(r.atCapacity=!!e.atCapacity),e.sources){if(!Array.isArray(e.sources))throw TypeError(".SdkIndexFrame.sources: array expected");r.sources=[];for(var n=0;n<e.sources.length;++n){if(typeof e.sources[n]!="object")throw TypeError(".SdkIndexFrame.sources: object expected");r.sources[n]=p.SdkStreamDescriptor.fromObject(e.sources[n])}}if(e.pausedAtSourceIds){if(!Array.isArray(e.pausedAtSourceIds))throw TypeError(".SdkIndexFrame.pausedAtSourceIds: array expected");r.pausedAtSourceIds=[];for(var n=0;n<e.pausedAtSourceIds.length;++n)r.pausedAtSourceIds[n]=e.pausedAtSourceIds[n]>>>0}if(e.numParticipants!=null&&(r.numParticipants=e.numParticipants>>>0),e.supportedReceiveCodecIntersection){if(!Array.isArray(e.supportedReceiveCodecIntersection))throw TypeError(".SdkIndexFrame.supportedReceiveCodecIntersection: array expected");r.supportedReceiveCodecIntersection=[];for(var n=0;n<e.supportedReceiveCodecIntersection.length;++n)switch(e.supportedReceiveCodecIntersection[n]){default:if(typeof e.supportedReceiveCodecIntersection[n]=="number"){r.supportedReceiveCodecIntersection[n]=e.supportedReceiveCodecIntersection[n];break}case"VP8":case 1:r.supportedReceiveCodecIntersection[n]=1;break;case"H264_BASELINE_PROFILE":case 2:r.supportedReceiveCodecIntersection[n]=2;break;case"H264_CONSTRAINED_BASELINE_PROFILE":case 3:r.supportedReceiveCodecIntersection[n]=3;break;case"H264_MAIN_PROFILE":case 4:r.supportedReceiveCodecIntersection[n]=4;break;case"H264_HIGH_PROFILE":case 5:r.supportedReceiveCodecIntersection[n]=5;break;case"H264_CONSTRAINED_HIGH_PROFILE":case 6:r.supportedReceiveCodecIntersection[n]=6;break;case"VP9_PROFILE_0":case 8:r.supportedReceiveCodecIntersection[n]=8;break;case"AV1_MAIN_PROFILE":case 11:r.supportedReceiveCodecIntersection[n]=11;break}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.sources=[],n.pausedAtSourceIds=[],n.supportedReceiveCodecIntersection=[]),r.defaults&&(n.atCapacity=!1,n.numParticipants=0),e.atCapacity!=null&&e.hasOwnProperty("atCapacity")&&(n.atCapacity=e.atCapacity),e.sources&&e.sources.length){n.sources=[];for(var o=0;o<e.sources.length;++o)n.sources[o]=p.SdkStreamDescriptor.toObject(e.sources[o],r)}if(e.pausedAtSourceIds&&e.pausedAtSourceIds.length){n.pausedAtSourceIds=[];for(var o=0;o<e.pausedAtSourceIds.length;++o)n.pausedAtSourceIds[o]=e.pausedAtSourceIds[o]}if(e.numParticipants!=null&&e.hasOwnProperty("numParticipants")&&(n.numParticipants=e.numParticipants),e.supportedReceiveCodecIntersection&&e.supportedReceiveCodecIntersection.length){n.supportedReceiveCodecIntersection=[];for(var o=0;o<e.supportedReceiveCodecIntersection.length;++o)n.supportedReceiveCodecIntersection[o]=r.enums===String?p.SdkVideoCodecCapability[e.supportedReceiveCodecIntersection[o]]===void 0?e.supportedReceiveCodecIntersection[o]:p.SdkVideoCodecCapability[e.supportedReceiveCodecIntersection[o]]:e.supportedReceiveCodecIntersection[o]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkIndexFrame"},i})();p.SdkPauseResumeFrame=(function(){function i(t){if(this.streamIds=[],this.groupIds=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.streamIds=v.emptyArray,i.prototype.groupIds=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.streamIds!=null&&e.streamIds.length)for(var n=0;n<e.streamIds.length;++n)r.uint32(8).uint32(e.streamIds[n]);if(e.groupIds!=null&&e.groupIds.length)for(var n=0;n<e.groupIds.length;++n)r.uint32(16).uint32(e.groupIds[n]);return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkPauseResumeFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{if(o.streamIds&&o.streamIds.length||(o.streamIds=[]),(s&7)===2)for(var a=e.uint32()+e.pos;e.pos<a;)o.streamIds.push(e.uint32());else o.streamIds.push(e.uint32());break}case 2:{if(o.groupIds&&o.groupIds.length||(o.groupIds=[]),(s&7)===2)for(var a=e.uint32()+e.pos;e.pos<a;)o.groupIds.push(e.uint32());else o.groupIds.push(e.uint32());break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamIds!=null&&e.hasOwnProperty("streamIds")){if(!Array.isArray(e.streamIds))return"streamIds: array expected";for(var r=0;r<e.streamIds.length;++r)if(!v.isInteger(e.streamIds[r]))return"streamIds: integer[] expected"}if(e.groupIds!=null&&e.hasOwnProperty("groupIds")){if(!Array.isArray(e.groupIds))return"groupIds: array expected";for(var r=0;r<e.groupIds.length;++r)if(!v.isInteger(e.groupIds[r]))return"groupIds: integer[] expected"}return null},i.fromObject=function(e){if(e instanceof p.SdkPauseResumeFrame)return e;var r=new p.SdkPauseResumeFrame;if(e.streamIds){if(!Array.isArray(e.streamIds))throw TypeError(".SdkPauseResumeFrame.streamIds: array expected");r.streamIds=[];for(var n=0;n<e.streamIds.length;++n)r.streamIds[n]=e.streamIds[n]>>>0}if(e.groupIds){if(!Array.isArray(e.groupIds))throw TypeError(".SdkPauseResumeFrame.groupIds: array expected");r.groupIds=[];for(var n=0;n<e.groupIds.length;++n)r.groupIds[n]=e.groupIds[n]>>>0}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.streamIds=[],n.groupIds=[]),e.streamIds&&e.streamIds.length){n.streamIds=[];for(var o=0;o<e.streamIds.length;++o)n.streamIds[o]=e.streamIds[o]}if(e.groupIds&&e.groupIds.length){n.groupIds=[];for(var o=0;o<e.groupIds.length;++o)n.groupIds[o]=e.groupIds[o]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPauseResumeFrame"},i})();p.SdkBitrateFrame=(function(){function i(t){if(this.bitrates=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.bitrates=v.emptyArray,i.prototype.serverAvailableOutgoingBitrate=0,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.bitrates!=null&&e.bitrates.length)for(var n=0;n<e.bitrates.length;++n)p.SdkBitrate.encode(e.bitrates[n],r.uint32(10).fork()).ldelim();return e.serverAvailableOutgoingBitrate!=null&&Object.hasOwnProperty.call(e,"serverAvailableOutgoingBitrate")&&r.uint32(16).uint32(e.serverAvailableOutgoingBitrate),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkBitrateFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.bitrates&&o.bitrates.length||(o.bitrates=[]),o.bitrates.push(p.SdkBitrate.decode(e,e.uint32()));break}case 2:{o.serverAvailableOutgoingBitrate=e.uint32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.bitrates!=null&&e.hasOwnProperty("bitrates")){if(!Array.isArray(e.bitrates))return"bitrates: array expected";for(var r=0;r<e.bitrates.length;++r){var n=p.SdkBitrate.verify(e.bitrates[r]);if(n)return"bitrates."+n}}return e.serverAvailableOutgoingBitrate!=null&&e.hasOwnProperty("serverAvailableOutgoingBitrate")&&!v.isInteger(e.serverAvailableOutgoingBitrate)?"serverAvailableOutgoingBitrate: integer expected":null},i.fromObject=function(e){if(e instanceof p.SdkBitrateFrame)return e;var r=new p.SdkBitrateFrame;if(e.bitrates){if(!Array.isArray(e.bitrates))throw TypeError(".SdkBitrateFrame.bitrates: array expected");r.bitrates=[];for(var n=0;n<e.bitrates.length;++n){if(typeof e.bitrates[n]!="object")throw TypeError(".SdkBitrateFrame.bitrates: object expected");r.bitrates[n]=p.SdkBitrate.fromObject(e.bitrates[n])}}return e.serverAvailableOutgoingBitrate!=null&&(r.serverAvailableOutgoingBitrate=e.serverAvailableOutgoingBitrate>>>0),r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.bitrates=[]),r.defaults&&(n.serverAvailableOutgoingBitrate=0),e.bitrates&&e.bitrates.length){n.bitrates=[];for(var o=0;o<e.bitrates.length;++o)n.bitrates[o]=p.SdkBitrate.toObject(e.bitrates[o],r)}return e.serverAvailableOutgoingBitrate!=null&&e.hasOwnProperty("serverAvailableOutgoingBitrate")&&(n.serverAvailableOutgoingBitrate=e.serverAvailableOutgoingBitrate),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkBitrateFrame"},i})();p.SdkStreamDescriptor=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.streamId=0,i.prototype.framerate=0,i.prototype.maxBitrateKbps=0,i.prototype.trackLabel="",i.prototype.groupId=0,i.prototype.avgBitrateBps=0,i.prototype.attendeeId="",i.prototype.mediaType=1,i.prototype.externalUserId="",i.prototype.width=0,i.prototype.height=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&r.uint32(8).uint32(e.streamId),e.framerate!=null&&Object.hasOwnProperty.call(e,"framerate")&&r.uint32(16).uint32(e.framerate),e.maxBitrateKbps!=null&&Object.hasOwnProperty.call(e,"maxBitrateKbps")&&r.uint32(24).uint32(e.maxBitrateKbps),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&r.uint32(34).string(e.trackLabel),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&r.uint32(48).uint32(e.groupId),e.avgBitrateBps!=null&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&r.uint32(56).uint32(e.avgBitrateBps),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&r.uint32(66).string(e.attendeeId),e.mediaType!=null&&Object.hasOwnProperty.call(e,"mediaType")&&r.uint32(72).int32(e.mediaType),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&r.uint32(82).string(e.externalUserId),e.width!=null&&Object.hasOwnProperty.call(e,"width")&&r.uint32(88).uint32(e.width),e.height!=null&&Object.hasOwnProperty.call(e,"height")&&r.uint32(96).uint32(e.height),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkStreamDescriptor;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.streamId=e.uint32();break}case 2:{o.framerate=e.uint32();break}case 3:{o.maxBitrateKbps=e.uint32();break}case 4:{o.trackLabel=e.string();break}case 6:{o.groupId=e.uint32();break}case 7:{o.avgBitrateBps=e.uint32();break}case 8:{o.attendeeId=e.string();break}case 9:{o.mediaType=e.int32();break}case 10:{o.externalUserId=e.string();break}case 11:{o.width=e.uint32();break}case 12:{o.height=e.uint32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId))return"streamId: integer expected";if(e.framerate!=null&&e.hasOwnProperty("framerate")&&!v.isInteger(e.framerate))return"framerate: integer expected";if(e.maxBitrateKbps!=null&&e.hasOwnProperty("maxBitrateKbps")&&!v.isInteger(e.maxBitrateKbps))return"maxBitrateKbps: integer expected";if(e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!v.isString(e.trackLabel))return"trackLabel: string expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId))return"groupId: integer expected";if(e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&!v.isInteger(e.avgBitrateBps))return"avgBitrateBps: integer expected";if(e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId))return"attendeeId: string expected";if(e.mediaType!=null&&e.hasOwnProperty("mediaType"))switch(e.mediaType){default:return"mediaType: enum value expected";case 1:case 2:break}return e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!v.isString(e.externalUserId)?"externalUserId: string expected":e.width!=null&&e.hasOwnProperty("width")&&!v.isInteger(e.width)?"width: integer expected":e.height!=null&&e.hasOwnProperty("height")&&!v.isInteger(e.height)?"height: integer expected":null},i.fromObject=function(e){if(e instanceof p.SdkStreamDescriptor)return e;var r=new p.SdkStreamDescriptor;switch(e.streamId!=null&&(r.streamId=e.streamId>>>0),e.framerate!=null&&(r.framerate=e.framerate>>>0),e.maxBitrateKbps!=null&&(r.maxBitrateKbps=e.maxBitrateKbps>>>0),e.trackLabel!=null&&(r.trackLabel=String(e.trackLabel)),e.groupId!=null&&(r.groupId=e.groupId>>>0),e.avgBitrateBps!=null&&(r.avgBitrateBps=e.avgBitrateBps>>>0),e.attendeeId!=null&&(r.attendeeId=String(e.attendeeId)),e.mediaType){default:if(typeof e.mediaType=="number"){r.mediaType=e.mediaType;break}break;case"AUDIO":case 1:r.mediaType=1;break;case"VIDEO":case 2:r.mediaType=2;break}return e.externalUserId!=null&&(r.externalUserId=String(e.externalUserId)),e.width!=null&&(r.width=e.width>>>0),e.height!=null&&(r.height=e.height>>>0),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.streamId=0,n.framerate=0,n.maxBitrateKbps=0,n.trackLabel="",n.groupId=0,n.avgBitrateBps=0,n.attendeeId="",n.mediaType=r.enums===String?"AUDIO":1,n.externalUserId="",n.width=0,n.height=0),e.streamId!=null&&e.hasOwnProperty("streamId")&&(n.streamId=e.streamId),e.framerate!=null&&e.hasOwnProperty("framerate")&&(n.framerate=e.framerate),e.maxBitrateKbps!=null&&e.hasOwnProperty("maxBitrateKbps")&&(n.maxBitrateKbps=e.maxBitrateKbps),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(n.trackLabel=e.trackLabel),e.groupId!=null&&e.hasOwnProperty("groupId")&&(n.groupId=e.groupId),e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&(n.avgBitrateBps=e.avgBitrateBps),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(n.attendeeId=e.attendeeId),e.mediaType!=null&&e.hasOwnProperty("mediaType")&&(n.mediaType=r.enums===String?p.SdkStreamMediaType[e.mediaType]===void 0?e.mediaType:p.SdkStreamMediaType[e.mediaType]:e.mediaType),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(n.externalUserId=e.externalUserId),e.width!=null&&e.hasOwnProperty("width")&&(n.width=e.width),e.height!=null&&e.hasOwnProperty("height")&&(n.height=e.height),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamDescriptor"},i})();p.SdkStreamAllocation=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.trackLabel="",i.prototype.streamId=0,i.prototype.groupId=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&r.uint32(10).string(e.trackLabel),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&r.uint32(16).uint32(e.streamId),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&r.uint32(24).uint32(e.groupId),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkStreamAllocation;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.trackLabel=e.string();break}case 2:{o.streamId=e.uint32();break}case 3:{o.groupId=e.uint32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!v.isString(e.trackLabel)?"trackLabel: string expected":e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId)?"streamId: integer expected":e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId)?"groupId: integer expected":null},i.fromObject=function(e){if(e instanceof p.SdkStreamAllocation)return e;var r=new p.SdkStreamAllocation;return e.trackLabel!=null&&(r.trackLabel=String(e.trackLabel)),e.streamId!=null&&(r.streamId=e.streamId>>>0),e.groupId!=null&&(r.groupId=e.groupId>>>0),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.trackLabel="",n.streamId=0,n.groupId=0),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(n.trackLabel=e.trackLabel),e.streamId!=null&&e.hasOwnProperty("streamId")&&(n.streamId=e.streamId),e.groupId!=null&&e.hasOwnProperty("groupId")&&(n.groupId=e.groupId),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamAllocation"},i})();p.SdkTrackMapping=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.streamId=0,i.prototype.ssrc=0,i.prototype.trackLabel="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&r.uint32(8).uint32(e.streamId),e.ssrc!=null&&Object.hasOwnProperty.call(e,"ssrc")&&r.uint32(16).uint32(e.ssrc),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&r.uint32(26).string(e.trackLabel),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTrackMapping;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.streamId=e.uint32();break}case 2:{o.ssrc=e.uint32();break}case 3:{o.trackLabel=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId)?"streamId: integer expected":e.ssrc!=null&&e.hasOwnProperty("ssrc")&&!v.isInteger(e.ssrc)?"ssrc: integer expected":e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!v.isString(e.trackLabel)?"trackLabel: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkTrackMapping)return e;var r=new p.SdkTrackMapping;return e.streamId!=null&&(r.streamId=e.streamId>>>0),e.ssrc!=null&&(r.ssrc=e.ssrc>>>0),e.trackLabel!=null&&(r.trackLabel=String(e.trackLabel)),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.streamId=0,n.ssrc=0,n.trackLabel=""),e.streamId!=null&&e.hasOwnProperty("streamId")&&(n.streamId=e.streamId),e.ssrc!=null&&e.hasOwnProperty("ssrc")&&(n.ssrc=e.ssrc),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(n.trackLabel=e.trackLabel),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTrackMapping"},i})();p.SdkBitrate=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.sourceStreamId=0,i.prototype.avgBitrateBps=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.sourceStreamId!=null&&Object.hasOwnProperty.call(e,"sourceStreamId")&&r.uint32(8).uint32(e.sourceStreamId),e.avgBitrateBps!=null&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&r.uint32(16).uint32(e.avgBitrateBps),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkBitrate;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.sourceStreamId=e.uint32();break}case 2:{o.avgBitrateBps=e.uint32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.sourceStreamId!=null&&e.hasOwnProperty("sourceStreamId")&&!v.isInteger(e.sourceStreamId)?"sourceStreamId: integer expected":e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&!v.isInteger(e.avgBitrateBps)?"avgBitrateBps: integer expected":null},i.fromObject=function(e){if(e instanceof p.SdkBitrate)return e;var r=new p.SdkBitrate;return e.sourceStreamId!=null&&(r.sourceStreamId=e.sourceStreamId>>>0),e.avgBitrateBps!=null&&(r.avgBitrateBps=e.avgBitrateBps>>>0),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.sourceStreamId=0,n.avgBitrateBps=0),e.sourceStreamId!=null&&e.hasOwnProperty("sourceStreamId")&&(n.sourceStreamId=e.sourceStreamId),e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&(n.avgBitrateBps=e.avgBitrateBps),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkBitrate"},i})();p.SdkAudioControlFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.muted=!1,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&r.uint32(8).bool(e.muted),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkAudioControlFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.muted=e.bool();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":null},i.fromObject=function(e){if(e instanceof p.SdkAudioControlFrame)return e;var r=new p.SdkAudioControlFrame;return e.muted!=null&&(r.muted=!!e.muted),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.muted=!1),e.muted!=null&&e.hasOwnProperty("muted")&&(n.muted=e.muted),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioControlFrame"},i})();p.SdkAudioMetadataFrame=(function(){function i(t){if(this.attendeeStates=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.attendeeStates=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.attendeeStates!=null&&e.attendeeStates.length)for(var n=0;n<e.attendeeStates.length;++n)p.SdkAudioAttendeeState.encode(e.attendeeStates[n],r.uint32(10).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkAudioMetadataFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.attendeeStates&&o.attendeeStates.length||(o.attendeeStates=[]),o.attendeeStates.push(p.SdkAudioAttendeeState.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.attendeeStates!=null&&e.hasOwnProperty("attendeeStates")){if(!Array.isArray(e.attendeeStates))return"attendeeStates: array expected";for(var r=0;r<e.attendeeStates.length;++r){var n=p.SdkAudioAttendeeState.verify(e.attendeeStates[r]);if(n)return"attendeeStates."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkAudioMetadataFrame)return e;var r=new p.SdkAudioMetadataFrame;if(e.attendeeStates){if(!Array.isArray(e.attendeeStates))throw TypeError(".SdkAudioMetadataFrame.attendeeStates: array expected");r.attendeeStates=[];for(var n=0;n<e.attendeeStates.length;++n){if(typeof e.attendeeStates[n]!="object")throw TypeError(".SdkAudioMetadataFrame.attendeeStates: object expected");r.attendeeStates[n]=p.SdkAudioAttendeeState.fromObject(e.attendeeStates[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.attendeeStates=[]),e.attendeeStates&&e.attendeeStates.length){n.attendeeStates=[];for(var o=0;o<e.attendeeStates.length;++o)n.attendeeStates[o]=p.SdkAudioAttendeeState.toObject(e.attendeeStates[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioMetadataFrame"},i})();p.SdkAudioAttendeeState=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.audioStreamId=0,i.prototype.volume=0,i.prototype.muted=!1,i.prototype.signalStrength=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.audioStreamId!=null&&Object.hasOwnProperty.call(e,"audioStreamId")&&r.uint32(8).uint32(e.audioStreamId),e.volume!=null&&Object.hasOwnProperty.call(e,"volume")&&r.uint32(16).uint32(e.volume),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&r.uint32(24).bool(e.muted),e.signalStrength!=null&&Object.hasOwnProperty.call(e,"signalStrength")&&r.uint32(32).uint32(e.signalStrength),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkAudioAttendeeState;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.audioStreamId=e.uint32();break}case 2:{o.volume=e.uint32();break}case 3:{o.muted=e.bool();break}case 4:{o.signalStrength=e.uint32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&!v.isInteger(e.audioStreamId)?"audioStreamId: integer expected":e.volume!=null&&e.hasOwnProperty("volume")&&!v.isInteger(e.volume)?"volume: integer expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":e.signalStrength!=null&&e.hasOwnProperty("signalStrength")&&!v.isInteger(e.signalStrength)?"signalStrength: integer expected":null},i.fromObject=function(e){if(e instanceof p.SdkAudioAttendeeState)return e;var r=new p.SdkAudioAttendeeState;return e.audioStreamId!=null&&(r.audioStreamId=e.audioStreamId>>>0),e.volume!=null&&(r.volume=e.volume>>>0),e.muted!=null&&(r.muted=!!e.muted),e.signalStrength!=null&&(r.signalStrength=e.signalStrength>>>0),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.audioStreamId=0,n.volume=0,n.muted=!1,n.signalStrength=0),e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&(n.audioStreamId=e.audioStreamId),e.volume!=null&&e.hasOwnProperty("volume")&&(n.volume=e.volume),e.muted!=null&&e.hasOwnProperty("muted")&&(n.muted=e.muted),e.signalStrength!=null&&e.hasOwnProperty("signalStrength")&&(n.signalStrength=e.signalStrength),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioAttendeeState"},i})();p.SdkAudioStreamIdInfoFrame=(function(){function i(t){if(this.streams=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.streams=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.streams!=null&&e.streams.length)for(var n=0;n<e.streams.length;++n)p.SdkAudioStreamIdInfo.encode(e.streams[n],r.uint32(10).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkAudioStreamIdInfoFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.streams&&o.streams.length||(o.streams=[]),o.streams.push(p.SdkAudioStreamIdInfo.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streams!=null&&e.hasOwnProperty("streams")){if(!Array.isArray(e.streams))return"streams: array expected";for(var r=0;r<e.streams.length;++r){var n=p.SdkAudioStreamIdInfo.verify(e.streams[r]);if(n)return"streams."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkAudioStreamIdInfoFrame)return e;var r=new p.SdkAudioStreamIdInfoFrame;if(e.streams){if(!Array.isArray(e.streams))throw TypeError(".SdkAudioStreamIdInfoFrame.streams: array expected");r.streams=[];for(var n=0;n<e.streams.length;++n){if(typeof e.streams[n]!="object")throw TypeError(".SdkAudioStreamIdInfoFrame.streams: object expected");r.streams[n]=p.SdkAudioStreamIdInfo.fromObject(e.streams[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.streams=[]),e.streams&&e.streams.length){n.streams=[];for(var o=0;o<e.streams.length;++o)n.streams[o]=p.SdkAudioStreamIdInfo.toObject(e.streams[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioStreamIdInfoFrame"},i})();p.SdkAudioStreamIdInfo=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.audioStreamId=0,i.prototype.attendeeId="",i.prototype.muted=!1,i.prototype.externalUserId="",i.prototype.dropped=!1,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.audioStreamId!=null&&Object.hasOwnProperty.call(e,"audioStreamId")&&r.uint32(8).uint32(e.audioStreamId),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&r.uint32(18).string(e.attendeeId),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&r.uint32(24).bool(e.muted),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&r.uint32(34).string(e.externalUserId),e.dropped!=null&&Object.hasOwnProperty.call(e,"dropped")&&r.uint32(40).bool(e.dropped),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkAudioStreamIdInfo;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.audioStreamId=e.uint32();break}case 2:{o.attendeeId=e.string();break}case 3:{o.muted=e.bool();break}case 4:{o.externalUserId=e.string();break}case 5:{o.dropped=e.bool();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&!v.isInteger(e.audioStreamId)?"audioStreamId: integer expected":e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId)?"attendeeId: string expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!v.isString(e.externalUserId)?"externalUserId: string expected":e.dropped!=null&&e.hasOwnProperty("dropped")&&typeof e.dropped!="boolean"?"dropped: boolean expected":null},i.fromObject=function(e){if(e instanceof p.SdkAudioStreamIdInfo)return e;var r=new p.SdkAudioStreamIdInfo;return e.audioStreamId!=null&&(r.audioStreamId=e.audioStreamId>>>0),e.attendeeId!=null&&(r.attendeeId=String(e.attendeeId)),e.muted!=null&&(r.muted=!!e.muted),e.externalUserId!=null&&(r.externalUserId=String(e.externalUserId)),e.dropped!=null&&(r.dropped=!!e.dropped),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.audioStreamId=0,n.attendeeId="",n.muted=!1,n.externalUserId="",n.dropped=!1),e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&(n.audioStreamId=e.audioStreamId),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(n.attendeeId=e.attendeeId),e.muted!=null&&e.hasOwnProperty("muted")&&(n.muted=e.muted),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(n.externalUserId=e.externalUserId),e.dropped!=null&&e.hasOwnProperty("dropped")&&(n.dropped=e.dropped),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioStreamIdInfo"},i})();p.SdkPingPongType=(function(){var i={},t=Object.create(i);return t[i[1]="PING"]=1,t[i[2]="PONG"]=2,t})();p.SdkPingPongFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.type=1,i.prototype.pingId=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),r.uint32(8).int32(e.type),r.uint32(16).uint32(e.pingId),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkPingPongFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.pingId=e.uint32();break}default:e.skipType(s&7);break}}if(!o.hasOwnProperty("type"))throw v.ProtocolError("missing required 'type'",{instance:o});if(!o.hasOwnProperty("pingId"))throw v.ProtocolError("missing required 'pingId'",{instance:o});return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:break}return v.isInteger(e.pingId)?null:"pingId: integer expected"},i.fromObject=function(e){if(e instanceof p.SdkPingPongFrame)return e;var r=new p.SdkPingPongFrame;switch(e.type){default:if(typeof e.type=="number"){r.type=e.type;break}break;case"PING":case 1:r.type=1;break;case"PONG":case 2:r.type=2;break}return e.pingId!=null&&(r.pingId=e.pingId>>>0),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.type=r.enums===String?"PING":1,n.pingId=0),e.type!=null&&e.hasOwnProperty("type")&&(n.type=r.enums===String?p.SdkPingPongType[e.type]===void 0?e.type:p.SdkPingPongType[e.type]:e.type),e.pingId!=null&&e.hasOwnProperty("pingId")&&(n.pingId=e.pingId),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPingPongFrame"},i})();p.SdkAudioStatusFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.audioStatus=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.audioStatus!=null&&Object.hasOwnProperty.call(e,"audioStatus")&&r.uint32(8).uint32(e.audioStatus),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkAudioStatusFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.audioStatus=e.uint32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&!v.isInteger(e.audioStatus)?"audioStatus: integer expected":null},i.fromObject=function(e){if(e instanceof p.SdkAudioStatusFrame)return e;var r=new p.SdkAudioStatusFrame;return e.audioStatus!=null&&(r.audioStatus=e.audioStatus>>>0),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.audioStatus=0),e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&(n.audioStatus=e.audioStatus),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioStatusFrame"},i})();p.SdkMetric=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.type=1,i.prototype.value=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&r.uint32(8).int32(e.type),e.value!=null&&Object.hasOwnProperty.call(e,"value")&&r.uint32(17).double(e.value),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkMetric;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.value=e.double();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 60:case 64:case 66:case 69:case 72:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:break}return e.value!=null&&e.hasOwnProperty("value")&&typeof e.value!="number"?"value: number expected":null},i.fromObject=function(e){if(e instanceof p.SdkMetric)return e;var r=new p.SdkMetric;switch(e.type){default:if(typeof e.type=="number"){r.type=e.type;break}break;case"VIDEO_ACTUAL_ENCODER_BITRATE":case 1:r.type=1;break;case"VIDEO_AVAILABLE_SEND_BANDWIDTH":case 2:r.type=2;break;case"VIDEO_RETRANSMIT_BITRATE":case 3:r.type=3;break;case"VIDEO_AVAILABLE_RECEIVE_BANDWIDTH":case 4:r.type=4;break;case"VIDEO_TARGET_ENCODER_BITRATE":case 5:r.type=5;break;case"VIDEO_BUCKET_DELAY_MS":case 6:r.type=6;break;case"STUN_RTT_MS":case 7:r.type=7;break;case"SOCKET_DISCARDED_PPS":case 8:r.type=8;break;case"RTC_MIC_JITTER_MS":case 9:r.type=9;break;case"RTC_MIC_PPS":case 10:r.type=10;break;case"RTC_MIC_FRACTION_PACKET_LOST_PERCENT":case 11:r.type=11;break;case"RTC_MIC_BITRATE":case 12:r.type=12;break;case"RTC_MIC_RTT_MS":case 13:r.type=13;break;case"RTC_SPK_PPS":case 14:r.type=14;break;case"RTC_SPK_FRACTION_PACKET_LOST_PERCENT":case 15:r.type=15;break;case"RTC_SPK_JITTER_MS":case 16:r.type=16;break;case"RTC_SPK_FRACTION_DECODER_LOSS_PERCENT":case 17:r.type=17;break;case"RTC_SPK_BITRATE":case 18:r.type=18;break;case"RTC_SPK_CURRENT_DELAY_MS":case 19:r.type=19;break;case"RTC_SPK_JITTER_BUFFER_MS":case 20:r.type=20;break;case"VIDEO_SENT_RTT_MS":case 21:r.type=21;break;case"VIDEO_ENCODE_USAGE_PERCENT":case 22:r.type=22;break;case"VIDEO_NACKS_RECEIVED":case 23:r.type=23;break;case"VIDEO_PLIS_RECEIVED":case 24:r.type=24;break;case"VIDEO_ENCODE_MS":case 25:r.type=25;break;case"VIDEO_INPUT_FPS":case 26:r.type=26;break;case"VIDEO_ENCODE_FPS":case 27:r.type=27;break;case"VIDEO_SENT_FPS":case 28:r.type=28;break;case"VIDEO_FIRS_RECEIVED":case 29:r.type=29;break;case"VIDEO_SENT_PPS":case 30:r.type=30;break;case"VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT":case 31:r.type=31;break;case"VIDEO_SENT_BITRATE":case 32:r.type=32;break;case"VIDEO_DROPPED_FPS":case 33:r.type=33;break;case"VIDEO_TARGET_DELAY_MS":case 34:r.type=34;break;case"VIDEO_DECODE_MS":case 35:r.type=35;break;case"VIDEO_OUTPUT_FPS":case 36:r.type=36;break;case"VIDEO_RECEIVED_PPS":case 37:r.type=37;break;case"VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT":case 38:r.type=38;break;case"VIDEO_RENDER_DELAY_MS":case 39:r.type=39;break;case"VIDEO_RECEIVED_FPS":case 40:r.type=40;break;case"VIDEO_DECODE_FPS":case 41:r.type=41;break;case"VIDEO_NACKS_SENT":case 42:r.type=42;break;case"VIDEO_FIRS_SENT":case 43:r.type=43;break;case"VIDEO_RECEIVED_BITRATE":case 44:r.type=44;break;case"VIDEO_CURRENT_DELAY_MS":case 45:r.type=45;break;case"VIDEO_JITTER_BUFFER_MS":case 46:r.type=46;break;case"VIDEO_DISCARDED_PPS":case 47:r.type=47;break;case"VIDEO_PLIS_SENT":case 48:r.type=48;break;case"VIDEO_RECEIVED_JITTER_MS":case 49:r.type=49;break;case"VIDEO_INPUT_HEIGHT":case 60:r.type=60;break;case"VIDEO_ENCODE_HEIGHT":case 64:r.type=64;break;case"VIDEO_SENT_QP_SUM":case 66:r.type=66;break;case"VIDEO_DECODE_HEIGHT":case 69:r.type=69;break;case"VIDEO_RECEIVED_QP_SUM":case 72:r.type=72;break;case"VIDEO_ENCODE_WIDTH":case 86:r.type=86;break;case"VIDEO_DECODE_WIDTH":case 87:r.type=87;break;case"VIDEO_ENCODER_IS_HARDWARE":case 88:r.type=88;break;case"VIDEO_DECODER_IS_HARDWARE":case 89:r.type=89;break;case"VIDEO_FREEZE_COUNT":case 90:r.type=90;break;case"VIDEO_FREEZE_DURATION":case 91:r.type=91;break;case"VIDEO_PAUSE_COUNT":case 92:r.type=92;break;case"VIDEO_PAUSE_DURATION":case 93:r.type=93;break;case"VIDEO_QUALITY_REASON":case 94:r.type=94;break;case"VIDEO_PROCESSING_TIME":case 95:r.type=95;break;case"RTC_SPK_AUDIO_LEVEL":case 96:r.type=96;break;case"RTC_MIC_AUDIO_LEVEL":case 97:r.type=97;break;case"RTC_SPK_TOTAL_LOST":case 98:r.type=98;break;case"RTC_SPK_TOTAL_EXPECTED":case 99:r.type=99;break;case"RTC_SPK_TOTAL_RECOVERED_RED":case 100:r.type=100;break;case"RTC_SPK_TOTAL_RECOVERED_FEC":case 101:r.type=101;break;case"VIDEO_QUALITY_LIMITATION_DURATION_CPU":case 102:r.type=102;break;case"VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU":case 103:r.type=103;break;case"VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE":case 104:r.type=104;break;case"VIDEO_RENDER_HEIGHT":case 105:r.type=105;break;case"VIDEO_RENDER_WIDTH":case 106:r.type=106;break;case"VIDEO_INPUT_WIDTH":case 107:r.type=107;break;case"VIDEO_SENT_JITTER_MS":case 108:r.type=108;break}return e.value!=null&&(r.value=Number(e.value)),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.type=r.enums===String?"VIDEO_ACTUAL_ENCODER_BITRATE":1,n.value=0),e.type!=null&&e.hasOwnProperty("type")&&(n.type=r.enums===String?p.SdkMetric.Type[e.type]===void 0?e.type:p.SdkMetric.Type[e.type]:e.type),e.value!=null&&e.hasOwnProperty("value")&&(n.value=r.json&&!isFinite(e.value)?String(e.value):e.value),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkMetric"},i.Type=(function(){var t={},e=Object.create(t);return e[t[1]="VIDEO_ACTUAL_ENCODER_BITRATE"]=1,e[t[2]="VIDEO_AVAILABLE_SEND_BANDWIDTH"]=2,e[t[3]="VIDEO_RETRANSMIT_BITRATE"]=3,e[t[4]="VIDEO_AVAILABLE_RECEIVE_BANDWIDTH"]=4,e[t[5]="VIDEO_TARGET_ENCODER_BITRATE"]=5,e[t[6]="VIDEO_BUCKET_DELAY_MS"]=6,e[t[7]="STUN_RTT_MS"]=7,e[t[8]="SOCKET_DISCARDED_PPS"]=8,e[t[9]="RTC_MIC_JITTER_MS"]=9,e[t[10]="RTC_MIC_PPS"]=10,e[t[11]="RTC_MIC_FRACTION_PACKET_LOST_PERCENT"]=11,e[t[12]="RTC_MIC_BITRATE"]=12,e[t[13]="RTC_MIC_RTT_MS"]=13,e[t[14]="RTC_SPK_PPS"]=14,e[t[15]="RTC_SPK_FRACTION_PACKET_LOST_PERCENT"]=15,e[t[16]="RTC_SPK_JITTER_MS"]=16,e[t[17]="RTC_SPK_FRACTION_DECODER_LOSS_PERCENT"]=17,e[t[18]="RTC_SPK_BITRATE"]=18,e[t[19]="RTC_SPK_CURRENT_DELAY_MS"]=19,e[t[20]="RTC_SPK_JITTER_BUFFER_MS"]=20,e[t[21]="VIDEO_SENT_RTT_MS"]=21,e[t[22]="VIDEO_ENCODE_USAGE_PERCENT"]=22,e[t[23]="VIDEO_NACKS_RECEIVED"]=23,e[t[24]="VIDEO_PLIS_RECEIVED"]=24,e[t[25]="VIDEO_ENCODE_MS"]=25,e[t[26]="VIDEO_INPUT_FPS"]=26,e[t[27]="VIDEO_ENCODE_FPS"]=27,e[t[28]="VIDEO_SENT_FPS"]=28,e[t[29]="VIDEO_FIRS_RECEIVED"]=29,e[t[30]="VIDEO_SENT_PPS"]=30,e[t[31]="VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT"]=31,e[t[32]="VIDEO_SENT_BITRATE"]=32,e[t[33]="VIDEO_DROPPED_FPS"]=33,e[t[34]="VIDEO_TARGET_DELAY_MS"]=34,e[t[35]="VIDEO_DECODE_MS"]=35,e[t[36]="VIDEO_OUTPUT_FPS"]=36,e[t[37]="VIDEO_RECEIVED_PPS"]=37,e[t[38]="VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT"]=38,e[t[39]="VIDEO_RENDER_DELAY_MS"]=39,e[t[40]="VIDEO_RECEIVED_FPS"]=40,e[t[41]="VIDEO_DECODE_FPS"]=41,e[t[42]="VIDEO_NACKS_SENT"]=42,e[t[43]="VIDEO_FIRS_SENT"]=43,e[t[44]="VIDEO_RECEIVED_BITRATE"]=44,e[t[45]="VIDEO_CURRENT_DELAY_MS"]=45,e[t[46]="VIDEO_JITTER_BUFFER_MS"]=46,e[t[47]="VIDEO_DISCARDED_PPS"]=47,e[t[48]="VIDEO_PLIS_SENT"]=48,e[t[49]="VIDEO_RECEIVED_JITTER_MS"]=49,e[t[60]="VIDEO_INPUT_HEIGHT"]=60,e[t[64]="VIDEO_ENCODE_HEIGHT"]=64,e[t[66]="VIDEO_SENT_QP_SUM"]=66,e[t[69]="VIDEO_DECODE_HEIGHT"]=69,e[t[72]="VIDEO_RECEIVED_QP_SUM"]=72,e[t[86]="VIDEO_ENCODE_WIDTH"]=86,e[t[87]="VIDEO_DECODE_WIDTH"]=87,e[t[88]="VIDEO_ENCODER_IS_HARDWARE"]=88,e[t[89]="VIDEO_DECODER_IS_HARDWARE"]=89,e[t[90]="VIDEO_FREEZE_COUNT"]=90,e[t[91]="VIDEO_FREEZE_DURATION"]=91,e[t[92]="VIDEO_PAUSE_COUNT"]=92,e[t[93]="VIDEO_PAUSE_DURATION"]=93,e[t[94]="VIDEO_QUALITY_REASON"]=94,e[t[95]="VIDEO_PROCESSING_TIME"]=95,e[t[96]="RTC_SPK_AUDIO_LEVEL"]=96,e[t[97]="RTC_MIC_AUDIO_LEVEL"]=97,e[t[98]="RTC_SPK_TOTAL_LOST"]=98,e[t[99]="RTC_SPK_TOTAL_EXPECTED"]=99,e[t[100]="RTC_SPK_TOTAL_RECOVERED_RED"]=100,e[t[101]="RTC_SPK_TOTAL_RECOVERED_FEC"]=101,e[t[102]="VIDEO_QUALITY_LIMITATION_DURATION_CPU"]=102,e[t[103]="VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU"]=103,e[t[104]="VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE"]=104,e[t[105]="VIDEO_RENDER_HEIGHT"]=105,e[t[106]="VIDEO_RENDER_WIDTH"]=106,e[t[107]="VIDEO_INPUT_WIDTH"]=107,e[t[108]="VIDEO_SENT_JITTER_MS"]=108,e})(),i})();p.SdkStreamMetricFrame=(function(){function i(t){if(this.metrics=[],this.dimensions=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.streamId=0,i.prototype.groupId=0,i.prototype.metrics=v.emptyArray,i.prototype.dimensions=v.emptyArray,i.prototype.mediaType=1,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&r.uint32(24).uint32(e.streamId),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&r.uint32(32).uint32(e.groupId),e.metrics!=null&&e.metrics.length)for(var n=0;n<e.metrics.length;++n)p.SdkMetric.encode(e.metrics[n],r.uint32(42).fork()).ldelim();if(e.dimensions!=null&&e.dimensions.length)for(var n=0;n<e.dimensions.length;++n)p.SdkStreamDimension.encode(e.dimensions[n],r.uint32(50).fork()).ldelim();return e.mediaType!=null&&Object.hasOwnProperty.call(e,"mediaType")&&r.uint32(56).int32(e.mediaType),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkStreamMetricFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 3:{o.streamId=e.uint32();break}case 4:{o.groupId=e.uint32();break}case 5:{o.metrics&&o.metrics.length||(o.metrics=[]),o.metrics.push(p.SdkMetric.decode(e,e.uint32()));break}case 6:{o.dimensions&&o.dimensions.length||(o.dimensions=[]),o.dimensions.push(p.SdkStreamDimension.decode(e,e.uint32()));break}case 7:{o.mediaType=e.int32();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId))return"streamId: integer expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId))return"groupId: integer expected";if(e.metrics!=null&&e.hasOwnProperty("metrics")){if(!Array.isArray(e.metrics))return"metrics: array expected";for(var r=0;r<e.metrics.length;++r){var n=p.SdkMetric.verify(e.metrics[r]);if(n)return"metrics."+n}}if(e.dimensions!=null&&e.hasOwnProperty("dimensions")){if(!Array.isArray(e.dimensions))return"dimensions: array expected";for(var r=0;r<e.dimensions.length;++r){var n=p.SdkStreamDimension.verify(e.dimensions[r]);if(n)return"dimensions."+n}}if(e.mediaType!=null&&e.hasOwnProperty("mediaType"))switch(e.mediaType){default:return"mediaType: enum value expected";case 1:case 2:break}return null},i.fromObject=function(e){if(e instanceof p.SdkStreamMetricFrame)return e;var r=new p.SdkStreamMetricFrame;if(e.streamId!=null&&(r.streamId=e.streamId>>>0),e.groupId!=null&&(r.groupId=e.groupId>>>0),e.metrics){if(!Array.isArray(e.metrics))throw TypeError(".SdkStreamMetricFrame.metrics: array expected");r.metrics=[];for(var n=0;n<e.metrics.length;++n){if(typeof e.metrics[n]!="object")throw TypeError(".SdkStreamMetricFrame.metrics: object expected");r.metrics[n]=p.SdkMetric.fromObject(e.metrics[n])}}if(e.dimensions){if(!Array.isArray(e.dimensions))throw TypeError(".SdkStreamMetricFrame.dimensions: array expected");r.dimensions=[];for(var n=0;n<e.dimensions.length;++n){if(typeof e.dimensions[n]!="object")throw TypeError(".SdkStreamMetricFrame.dimensions: object expected");r.dimensions[n]=p.SdkStreamDimension.fromObject(e.dimensions[n])}}switch(e.mediaType){default:if(typeof e.mediaType=="number"){r.mediaType=e.mediaType;break}break;case"AUDIO":case 1:r.mediaType=1;break;case"VIDEO":case 2:r.mediaType=2;break}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.metrics=[],n.dimensions=[]),r.defaults&&(n.streamId=0,n.groupId=0,n.mediaType=r.enums===String?"AUDIO":1),e.streamId!=null&&e.hasOwnProperty("streamId")&&(n.streamId=e.streamId),e.groupId!=null&&e.hasOwnProperty("groupId")&&(n.groupId=e.groupId),e.metrics&&e.metrics.length){n.metrics=[];for(var o=0;o<e.metrics.length;++o)n.metrics[o]=p.SdkMetric.toObject(e.metrics[o],r)}if(e.dimensions&&e.dimensions.length){n.dimensions=[];for(var o=0;o<e.dimensions.length;++o)n.dimensions[o]=p.SdkStreamDimension.toObject(e.dimensions[o],r)}return e.mediaType!=null&&e.hasOwnProperty("mediaType")&&(n.mediaType=r.enums===String?p.SdkStreamMediaType[e.mediaType]===void 0?e.mediaType:p.SdkStreamMediaType[e.mediaType]:e.mediaType),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamMetricFrame"},i})();p.SdkClientMetricFrame=(function(){function i(t){if(this.globalMetrics=[],this.streamMetricFrames=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.globalMetrics=v.emptyArray,i.prototype.streamMetricFrames=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.globalMetrics!=null&&e.globalMetrics.length)for(var n=0;n<e.globalMetrics.length;++n)p.SdkMetric.encode(e.globalMetrics[n],r.uint32(10).fork()).ldelim();if(e.streamMetricFrames!=null&&e.streamMetricFrames.length)for(var n=0;n<e.streamMetricFrames.length;++n)p.SdkStreamMetricFrame.encode(e.streamMetricFrames[n],r.uint32(18).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkClientMetricFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.globalMetrics&&o.globalMetrics.length||(o.globalMetrics=[]),o.globalMetrics.push(p.SdkMetric.decode(e,e.uint32()));break}case 2:{o.streamMetricFrames&&o.streamMetricFrames.length||(o.streamMetricFrames=[]),o.streamMetricFrames.push(p.SdkStreamMetricFrame.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.globalMetrics!=null&&e.hasOwnProperty("globalMetrics")){if(!Array.isArray(e.globalMetrics))return"globalMetrics: array expected";for(var r=0;r<e.globalMetrics.length;++r){var n=p.SdkMetric.verify(e.globalMetrics[r]);if(n)return"globalMetrics."+n}}if(e.streamMetricFrames!=null&&e.hasOwnProperty("streamMetricFrames")){if(!Array.isArray(e.streamMetricFrames))return"streamMetricFrames: array expected";for(var r=0;r<e.streamMetricFrames.length;++r){var n=p.SdkStreamMetricFrame.verify(e.streamMetricFrames[r]);if(n)return"streamMetricFrames."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkClientMetricFrame)return e;var r=new p.SdkClientMetricFrame;if(e.globalMetrics){if(!Array.isArray(e.globalMetrics))throw TypeError(".SdkClientMetricFrame.globalMetrics: array expected");r.globalMetrics=[];for(var n=0;n<e.globalMetrics.length;++n){if(typeof e.globalMetrics[n]!="object")throw TypeError(".SdkClientMetricFrame.globalMetrics: object expected");r.globalMetrics[n]=p.SdkMetric.fromObject(e.globalMetrics[n])}}if(e.streamMetricFrames){if(!Array.isArray(e.streamMetricFrames))throw TypeError(".SdkClientMetricFrame.streamMetricFrames: array expected");r.streamMetricFrames=[];for(var n=0;n<e.streamMetricFrames.length;++n){if(typeof e.streamMetricFrames[n]!="object")throw TypeError(".SdkClientMetricFrame.streamMetricFrames: object expected");r.streamMetricFrames[n]=p.SdkStreamMetricFrame.fromObject(e.streamMetricFrames[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.globalMetrics=[],n.streamMetricFrames=[]),e.globalMetrics&&e.globalMetrics.length){n.globalMetrics=[];for(var o=0;o<e.globalMetrics.length;++o)n.globalMetrics[o]=p.SdkMetric.toObject(e.globalMetrics[o],r)}if(e.streamMetricFrames&&e.streamMetricFrames.length){n.streamMetricFrames=[];for(var o=0;o<e.streamMetricFrames.length;++o)n.streamMetricFrames[o]=p.SdkStreamMetricFrame.toObject(e.streamMetricFrames[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkClientMetricFrame"},i})();p.SdkStreamDimension=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.type=1,i.prototype.value=null,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&r.uint32(8).int32(e.type),e.value!=null&&Object.hasOwnProperty.call(e,"value")&&p.SdkDimensionValue.encode(e.value,r.uint32(18).fork()).ldelim(),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkStreamDimension;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.value=p.SdkDimensionValue.decode(e,e.uint32());break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:break}if(e.value!=null&&e.hasOwnProperty("value")){var r=p.SdkDimensionValue.verify(e.value);if(r)return"value."+r}return null},i.fromObject=function(e){if(e instanceof p.SdkStreamDimension)return e;var r=new p.SdkStreamDimension;switch(e.type){default:if(typeof e.type=="number"){r.type=e.type;break}break;case"VIDEO_ENCODER_NAME":case 1:r.type=1;break;case"VIDEO_DECODER_NAME":case 2:r.type=2;break}if(e.value!=null){if(typeof e.value!="object")throw TypeError(".SdkStreamDimension.value: object expected");r.value=p.SdkDimensionValue.fromObject(e.value)}return r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.type=r.enums===String?"VIDEO_ENCODER_NAME":1,n.value=null),e.type!=null&&e.hasOwnProperty("type")&&(n.type=r.enums===String?p.SdkStreamDimension.Type[e.type]===void 0?e.type:p.SdkStreamDimension.Type[e.type]:e.type),e.value!=null&&e.hasOwnProperty("value")&&(n.value=p.SdkDimensionValue.toObject(e.value,r)),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamDimension"},i.Type=(function(){var t={},e=Object.create(t);return e[t[1]="VIDEO_ENCODER_NAME"]=1,e[t[2]="VIDEO_DECODER_NAME"]=2,e})(),i})();p.SdkDimensionValue=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.stringValue="",i.prototype.boolValue=!1,i.prototype.uintValue=v.Long?v.Long.fromBits(0,0,!0):0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.stringValue!=null&&Object.hasOwnProperty.call(e,"stringValue")&&r.uint32(10).string(e.stringValue),e.boolValue!=null&&Object.hasOwnProperty.call(e,"boolValue")&&r.uint32(16).bool(e.boolValue),e.uintValue!=null&&Object.hasOwnProperty.call(e,"uintValue")&&r.uint32(24).uint64(e.uintValue),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkDimensionValue;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.stringValue=e.string();break}case 2:{o.boolValue=e.bool();break}case 3:{o.uintValue=e.uint64();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.stringValue!=null&&e.hasOwnProperty("stringValue")&&!v.isString(e.stringValue)?"stringValue: string expected":e.boolValue!=null&&e.hasOwnProperty("boolValue")&&typeof e.boolValue!="boolean"?"boolValue: boolean expected":e.uintValue!=null&&e.hasOwnProperty("uintValue")&&!v.isInteger(e.uintValue)&&!(e.uintValue&&v.isInteger(e.uintValue.low)&&v.isInteger(e.uintValue.high))?"uintValue: integer|Long expected":null},i.fromObject=function(e){if(e instanceof p.SdkDimensionValue)return e;var r=new p.SdkDimensionValue;return e.stringValue!=null&&(r.stringValue=String(e.stringValue)),e.boolValue!=null&&(r.boolValue=!!e.boolValue),e.uintValue!=null&&(v.Long?(r.uintValue=v.Long.fromValue(e.uintValue)).unsigned=!0:typeof e.uintValue=="string"?r.uintValue=parseInt(e.uintValue,10):typeof e.uintValue=="number"?r.uintValue=e.uintValue:typeof e.uintValue=="object"&&(r.uintValue=new v.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),r},i.toObject=function(e,r){r||(r={});var n={};if(r.defaults)if(n.stringValue="",n.boolValue=!1,v.Long){var o=new v.Long(0,0,!0);n.uintValue=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.uintValue=r.longs===String?"0":0;return e.stringValue!=null&&e.hasOwnProperty("stringValue")&&(n.stringValue=e.stringValue),e.boolValue!=null&&e.hasOwnProperty("boolValue")&&(n.boolValue=e.boolValue),e.uintValue!=null&&e.hasOwnProperty("uintValue")&&(typeof e.uintValue=="number"?n.uintValue=r.longs===String?String(e.uintValue):e.uintValue:n.uintValue=r.longs===String?v.Long.prototype.toString.call(e.uintValue):r.longs===Number?new v.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkDimensionValue"},i})();p.SdkDataMessageFrame=(function(){function i(t){if(this.messages=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.messages=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.messages!=null&&e.messages.length)for(var n=0;n<e.messages.length;++n)p.SdkDataMessagePayload.encode(e.messages[n],r.uint32(10).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkDataMessageFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.messages&&o.messages.length||(o.messages=[]),o.messages.push(p.SdkDataMessagePayload.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.messages!=null&&e.hasOwnProperty("messages")){if(!Array.isArray(e.messages))return"messages: array expected";for(var r=0;r<e.messages.length;++r){var n=p.SdkDataMessagePayload.verify(e.messages[r]);if(n)return"messages."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkDataMessageFrame)return e;var r=new p.SdkDataMessageFrame;if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".SdkDataMessageFrame.messages: array expected");r.messages=[];for(var n=0;n<e.messages.length;++n){if(typeof e.messages[n]!="object")throw TypeError(".SdkDataMessageFrame.messages: object expected");r.messages[n]=p.SdkDataMessagePayload.fromObject(e.messages[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.messages=[]),e.messages&&e.messages.length){n.messages=[];for(var o=0;o<e.messages.length;++o)n.messages[o]=p.SdkDataMessagePayload.toObject(e.messages[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkDataMessageFrame"},i})();p.SdkDataMessagePayload=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.topic="",i.prototype.data=v.newBuffer([]),i.prototype.lifetimeMs=0,i.prototype.senderAttendeeId="",i.prototype.ingestTimeNs=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.senderExternalUserId="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.topic!=null&&Object.hasOwnProperty.call(e,"topic")&&r.uint32(10).string(e.topic),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&r.uint32(18).bytes(e.data),e.lifetimeMs!=null&&Object.hasOwnProperty.call(e,"lifetimeMs")&&r.uint32(24).uint32(e.lifetimeMs),e.senderAttendeeId!=null&&Object.hasOwnProperty.call(e,"senderAttendeeId")&&r.uint32(34).string(e.senderAttendeeId),e.ingestTimeNs!=null&&Object.hasOwnProperty.call(e,"ingestTimeNs")&&r.uint32(40).int64(e.ingestTimeNs),e.senderExternalUserId!=null&&Object.hasOwnProperty.call(e,"senderExternalUserId")&&r.uint32(50).string(e.senderExternalUserId),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkDataMessagePayload;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.topic=e.string();break}case 2:{o.data=e.bytes();break}case 3:{o.lifetimeMs=e.uint32();break}case 4:{o.senderAttendeeId=e.string();break}case 5:{o.ingestTimeNs=e.int64();break}case 6:{o.senderExternalUserId=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.topic!=null&&e.hasOwnProperty("topic")&&!v.isString(e.topic)?"topic: string expected":e.data!=null&&e.hasOwnProperty("data")&&!(e.data&&typeof e.data.length=="number"||v.isString(e.data))?"data: buffer expected":e.lifetimeMs!=null&&e.hasOwnProperty("lifetimeMs")&&!v.isInteger(e.lifetimeMs)?"lifetimeMs: integer expected":e.senderAttendeeId!=null&&e.hasOwnProperty("senderAttendeeId")&&!v.isString(e.senderAttendeeId)?"senderAttendeeId: string expected":e.ingestTimeNs!=null&&e.hasOwnProperty("ingestTimeNs")&&!v.isInteger(e.ingestTimeNs)&&!(e.ingestTimeNs&&v.isInteger(e.ingestTimeNs.low)&&v.isInteger(e.ingestTimeNs.high))?"ingestTimeNs: integer|Long expected":e.senderExternalUserId!=null&&e.hasOwnProperty("senderExternalUserId")&&!v.isString(e.senderExternalUserId)?"senderExternalUserId: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkDataMessagePayload)return e;var r=new p.SdkDataMessagePayload;return e.topic!=null&&(r.topic=String(e.topic)),e.data!=null&&(typeof e.data=="string"?v.base64.decode(e.data,r.data=v.newBuffer(v.base64.length(e.data)),0):e.data.length>=0&&(r.data=e.data)),e.lifetimeMs!=null&&(r.lifetimeMs=e.lifetimeMs>>>0),e.senderAttendeeId!=null&&(r.senderAttendeeId=String(e.senderAttendeeId)),e.ingestTimeNs!=null&&(v.Long?(r.ingestTimeNs=v.Long.fromValue(e.ingestTimeNs)).unsigned=!1:typeof e.ingestTimeNs=="string"?r.ingestTimeNs=parseInt(e.ingestTimeNs,10):typeof e.ingestTimeNs=="number"?r.ingestTimeNs=e.ingestTimeNs:typeof e.ingestTimeNs=="object"&&(r.ingestTimeNs=new v.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber())),e.senderExternalUserId!=null&&(r.senderExternalUserId=String(e.senderExternalUserId)),r},i.toObject=function(e,r){r||(r={});var n={};if(r.defaults){if(n.topic="",r.bytes===String?n.data="":(n.data=[],r.bytes!==Array&&(n.data=v.newBuffer(n.data))),n.lifetimeMs=0,n.senderAttendeeId="",v.Long){var o=new v.Long(0,0,!1);n.ingestTimeNs=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.ingestTimeNs=r.longs===String?"0":0;n.senderExternalUserId=""}return e.topic!=null&&e.hasOwnProperty("topic")&&(n.topic=e.topic),e.data!=null&&e.hasOwnProperty("data")&&(n.data=r.bytes===String?v.base64.encode(e.data,0,e.data.length):r.bytes===Array?Array.prototype.slice.call(e.data):e.data),e.lifetimeMs!=null&&e.hasOwnProperty("lifetimeMs")&&(n.lifetimeMs=e.lifetimeMs),e.senderAttendeeId!=null&&e.hasOwnProperty("senderAttendeeId")&&(n.senderAttendeeId=e.senderAttendeeId),e.ingestTimeNs!=null&&e.hasOwnProperty("ingestTimeNs")&&(typeof e.ingestTimeNs=="number"?n.ingestTimeNs=r.longs===String?String(e.ingestTimeNs):e.ingestTimeNs:n.ingestTimeNs=r.longs===String?v.Long.prototype.toString.call(e.ingestTimeNs):r.longs===Number?new v.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber():e.ingestTimeNs),e.senderExternalUserId!=null&&e.hasOwnProperty("senderExternalUserId")&&(n.senderExternalUserId=e.senderExternalUserId),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkDataMessagePayload"},i})();p.SdkTurnCredentials=(function(){function i(t){if(this.uris=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.username="",i.prototype.password="",i.prototype.ttl=0,i.prototype.uris=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.username!=null&&Object.hasOwnProperty.call(e,"username")&&r.uint32(10).string(e.username),e.password!=null&&Object.hasOwnProperty.call(e,"password")&&r.uint32(18).string(e.password),e.ttl!=null&&Object.hasOwnProperty.call(e,"ttl")&&r.uint32(24).uint32(e.ttl),e.uris!=null&&e.uris.length)for(var n=0;n<e.uris.length;++n)r.uint32(34).string(e.uris[n]);return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTurnCredentials;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.username=e.string();break}case 2:{o.password=e.string();break}case 3:{o.ttl=e.uint32();break}case 4:{o.uris&&o.uris.length||(o.uris=[]),o.uris.push(e.string());break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.username!=null&&e.hasOwnProperty("username")&&!v.isString(e.username))return"username: string expected";if(e.password!=null&&e.hasOwnProperty("password")&&!v.isString(e.password))return"password: string expected";if(e.ttl!=null&&e.hasOwnProperty("ttl")&&!v.isInteger(e.ttl))return"ttl: integer expected";if(e.uris!=null&&e.hasOwnProperty("uris")){if(!Array.isArray(e.uris))return"uris: array expected";for(var r=0;r<e.uris.length;++r)if(!v.isString(e.uris[r]))return"uris: string[] expected"}return null},i.fromObject=function(e){if(e instanceof p.SdkTurnCredentials)return e;var r=new p.SdkTurnCredentials;if(e.username!=null&&(r.username=String(e.username)),e.password!=null&&(r.password=String(e.password)),e.ttl!=null&&(r.ttl=e.ttl>>>0),e.uris){if(!Array.isArray(e.uris))throw TypeError(".SdkTurnCredentials.uris: array expected");r.uris=[];for(var n=0;n<e.uris.length;++n)r.uris[n]=String(e.uris[n])}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.uris=[]),r.defaults&&(n.username="",n.password="",n.ttl=0),e.username!=null&&e.hasOwnProperty("username")&&(n.username=e.username),e.password!=null&&e.hasOwnProperty("password")&&(n.password=e.password),e.ttl!=null&&e.hasOwnProperty("ttl")&&(n.ttl=e.ttl),e.uris&&e.uris.length){n.uris=[];for(var o=0;o<e.uris.length;++o)n.uris[o]=e.uris[o]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTurnCredentials"},i})();p.SdkTranscriptItem=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.content="",i.prototype.endTime=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.speakerAttendeeId="",i.prototype.speakerExternalUserId="",i.prototype.startTime=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.type=1,i.prototype.vocabularyFilterMatch=!1,i.prototype.confidence=0,i.prototype.stable=!1,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.content!=null&&Object.hasOwnProperty.call(e,"content")&&r.uint32(10).string(e.content),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&r.uint32(16).int64(e.endTime),e.speakerAttendeeId!=null&&Object.hasOwnProperty.call(e,"speakerAttendeeId")&&r.uint32(26).string(e.speakerAttendeeId),e.speakerExternalUserId!=null&&Object.hasOwnProperty.call(e,"speakerExternalUserId")&&r.uint32(34).string(e.speakerExternalUserId),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&r.uint32(40).int64(e.startTime),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&r.uint32(48).int32(e.type),e.vocabularyFilterMatch!=null&&Object.hasOwnProperty.call(e,"vocabularyFilterMatch")&&r.uint32(56).bool(e.vocabularyFilterMatch),e.confidence!=null&&Object.hasOwnProperty.call(e,"confidence")&&r.uint32(65).double(e.confidence),e.stable!=null&&Object.hasOwnProperty.call(e,"stable")&&r.uint32(72).bool(e.stable),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscriptItem;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.content=e.string();break}case 2:{o.endTime=e.int64();break}case 3:{o.speakerAttendeeId=e.string();break}case 4:{o.speakerExternalUserId=e.string();break}case 5:{o.startTime=e.int64();break}case 6:{o.type=e.int32();break}case 7:{o.vocabularyFilterMatch=e.bool();break}case 8:{o.confidence=e.double();break}case 9:{o.stable=e.bool();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.content!=null&&e.hasOwnProperty("content")&&!v.isString(e.content))return"content: string expected";if(e.endTime!=null&&e.hasOwnProperty("endTime")&&!v.isInteger(e.endTime)&&!(e.endTime&&v.isInteger(e.endTime.low)&&v.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(e.speakerAttendeeId!=null&&e.hasOwnProperty("speakerAttendeeId")&&!v.isString(e.speakerAttendeeId))return"speakerAttendeeId: string expected";if(e.speakerExternalUserId!=null&&e.hasOwnProperty("speakerExternalUserId")&&!v.isString(e.speakerExternalUserId))return"speakerExternalUserId: string expected";if(e.startTime!=null&&e.hasOwnProperty("startTime")&&!v.isInteger(e.startTime)&&!(e.startTime&&v.isInteger(e.startTime.low)&&v.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:break}return e.vocabularyFilterMatch!=null&&e.hasOwnProperty("vocabularyFilterMatch")&&typeof e.vocabularyFilterMatch!="boolean"?"vocabularyFilterMatch: boolean expected":e.confidence!=null&&e.hasOwnProperty("confidence")&&typeof e.confidence!="number"?"confidence: number expected":e.stable!=null&&e.hasOwnProperty("stable")&&typeof e.stable!="boolean"?"stable: boolean expected":null},i.fromObject=function(e){if(e instanceof p.SdkTranscriptItem)return e;var r=new p.SdkTranscriptItem;switch(e.content!=null&&(r.content=String(e.content)),e.endTime!=null&&(v.Long?(r.endTime=v.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?r.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?r.endTime=e.endTime:typeof e.endTime=="object"&&(r.endTime=new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.speakerAttendeeId!=null&&(r.speakerAttendeeId=String(e.speakerAttendeeId)),e.speakerExternalUserId!=null&&(r.speakerExternalUserId=String(e.speakerExternalUserId)),e.startTime!=null&&(v.Long?(r.startTime=v.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?r.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?r.startTime=e.startTime:typeof e.startTime=="object"&&(r.startTime=new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.type){default:if(typeof e.type=="number"){r.type=e.type;break}break;case"PRONUNCIATION":case 1:r.type=1;break;case"PUNCTUATION":case 2:r.type=2;break}return e.vocabularyFilterMatch!=null&&(r.vocabularyFilterMatch=!!e.vocabularyFilterMatch),e.confidence!=null&&(r.confidence=Number(e.confidence)),e.stable!=null&&(r.stable=!!e.stable),r},i.toObject=function(e,r){r||(r={});var n={};if(r.defaults){if(n.content="",v.Long){var o=new v.Long(0,0,!1);n.endTime=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.endTime=r.longs===String?"0":0;if(n.speakerAttendeeId="",n.speakerExternalUserId="",v.Long){var o=new v.Long(0,0,!1);n.startTime=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.startTime=r.longs===String?"0":0;n.type=r.enums===String?"PRONUNCIATION":1,n.vocabularyFilterMatch=!1,n.confidence=0,n.stable=!1}return e.content!=null&&e.hasOwnProperty("content")&&(n.content=e.content),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?n.endTime=r.longs===String?String(e.endTime):e.endTime:n.endTime=r.longs===String?v.Long.prototype.toString.call(e.endTime):r.longs===Number?new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.speakerAttendeeId!=null&&e.hasOwnProperty("speakerAttendeeId")&&(n.speakerAttendeeId=e.speakerAttendeeId),e.speakerExternalUserId!=null&&e.hasOwnProperty("speakerExternalUserId")&&(n.speakerExternalUserId=e.speakerExternalUserId),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?n.startTime=r.longs===String?String(e.startTime):e.startTime:n.startTime=r.longs===String?v.Long.prototype.toString.call(e.startTime):r.longs===Number?new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.type!=null&&e.hasOwnProperty("type")&&(n.type=r.enums===String?p.SdkTranscriptItem.Type[e.type]===void 0?e.type:p.SdkTranscriptItem.Type[e.type]:e.type),e.vocabularyFilterMatch!=null&&e.hasOwnProperty("vocabularyFilterMatch")&&(n.vocabularyFilterMatch=e.vocabularyFilterMatch),e.confidence!=null&&e.hasOwnProperty("confidence")&&(n.confidence=r.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),e.stable!=null&&e.hasOwnProperty("stable")&&(n.stable=e.stable),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptItem"},i.Type=(function(){var t={},e=Object.create(t);return e[t[1]="PRONUNCIATION"]=1,e[t[2]="PUNCTUATION"]=2,e})(),i})();p.SdkTranscriptEntity=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.category="",i.prototype.confidence=0,i.prototype.content="",i.prototype.endTime=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.startTime=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.type="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.category!=null&&Object.hasOwnProperty.call(e,"category")&&r.uint32(10).string(e.category),e.confidence!=null&&Object.hasOwnProperty.call(e,"confidence")&&r.uint32(17).double(e.confidence),e.content!=null&&Object.hasOwnProperty.call(e,"content")&&r.uint32(26).string(e.content),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&r.uint32(32).int64(e.endTime),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&r.uint32(40).int64(e.startTime),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&r.uint32(50).string(e.type),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscriptEntity;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.category=e.string();break}case 2:{o.confidence=e.double();break}case 3:{o.content=e.string();break}case 4:{o.endTime=e.int64();break}case 5:{o.startTime=e.int64();break}case 6:{o.type=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.category!=null&&e.hasOwnProperty("category")&&!v.isString(e.category)?"category: string expected":e.confidence!=null&&e.hasOwnProperty("confidence")&&typeof e.confidence!="number"?"confidence: number expected":e.content!=null&&e.hasOwnProperty("content")&&!v.isString(e.content)?"content: string expected":e.endTime!=null&&e.hasOwnProperty("endTime")&&!v.isInteger(e.endTime)&&!(e.endTime&&v.isInteger(e.endTime.low)&&v.isInteger(e.endTime.high))?"endTime: integer|Long expected":e.startTime!=null&&e.hasOwnProperty("startTime")&&!v.isInteger(e.startTime)&&!(e.startTime&&v.isInteger(e.startTime.low)&&v.isInteger(e.startTime.high))?"startTime: integer|Long expected":e.type!=null&&e.hasOwnProperty("type")&&!v.isString(e.type)?"type: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkTranscriptEntity)return e;var r=new p.SdkTranscriptEntity;return e.category!=null&&(r.category=String(e.category)),e.confidence!=null&&(r.confidence=Number(e.confidence)),e.content!=null&&(r.content=String(e.content)),e.endTime!=null&&(v.Long?(r.endTime=v.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?r.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?r.endTime=e.endTime:typeof e.endTime=="object"&&(r.endTime=new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.startTime!=null&&(v.Long?(r.startTime=v.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?r.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?r.startTime=e.startTime:typeof e.startTime=="object"&&(r.startTime=new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.type!=null&&(r.type=String(e.type)),r},i.toObject=function(e,r){r||(r={});var n={};if(r.defaults){if(n.category="",n.confidence=0,n.content="",v.Long){var o=new v.Long(0,0,!1);n.endTime=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.endTime=r.longs===String?"0":0;if(v.Long){var o=new v.Long(0,0,!1);n.startTime=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.startTime=r.longs===String?"0":0;n.type=""}return e.category!=null&&e.hasOwnProperty("category")&&(n.category=e.category),e.confidence!=null&&e.hasOwnProperty("confidence")&&(n.confidence=r.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),e.content!=null&&e.hasOwnProperty("content")&&(n.content=e.content),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?n.endTime=r.longs===String?String(e.endTime):e.endTime:n.endTime=r.longs===String?v.Long.prototype.toString.call(e.endTime):r.longs===Number?new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?n.startTime=r.longs===String?String(e.startTime):e.startTime:n.startTime=r.longs===String?v.Long.prototype.toString.call(e.startTime):r.longs===Number?new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.type!=null&&e.hasOwnProperty("type")&&(n.type=e.type),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptEntity"},i})();p.SdkTranscriptAlternative=(function(){function i(t){if(this.items=[],this.entities=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.items=v.emptyArray,i.prototype.transcript="",i.prototype.entities=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.items!=null&&e.items.length)for(var n=0;n<e.items.length;++n)p.SdkTranscriptItem.encode(e.items[n],r.uint32(10).fork()).ldelim();if(e.transcript!=null&&Object.hasOwnProperty.call(e,"transcript")&&r.uint32(18).string(e.transcript),e.entities!=null&&e.entities.length)for(var n=0;n<e.entities.length;++n)p.SdkTranscriptEntity.encode(e.entities[n],r.uint32(26).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscriptAlternative;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.items&&o.items.length||(o.items=[]),o.items.push(p.SdkTranscriptItem.decode(e,e.uint32()));break}case 2:{o.transcript=e.string();break}case 3:{o.entities&&o.entities.length||(o.entities=[]),o.entities.push(p.SdkTranscriptEntity.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.items!=null&&e.hasOwnProperty("items")){if(!Array.isArray(e.items))return"items: array expected";for(var r=0;r<e.items.length;++r){var n=p.SdkTranscriptItem.verify(e.items[r]);if(n)return"items."+n}}if(e.transcript!=null&&e.hasOwnProperty("transcript")&&!v.isString(e.transcript))return"transcript: string expected";if(e.entities!=null&&e.hasOwnProperty("entities")){if(!Array.isArray(e.entities))return"entities: array expected";for(var r=0;r<e.entities.length;++r){var n=p.SdkTranscriptEntity.verify(e.entities[r]);if(n)return"entities."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkTranscriptAlternative)return e;var r=new p.SdkTranscriptAlternative;if(e.items){if(!Array.isArray(e.items))throw TypeError(".SdkTranscriptAlternative.items: array expected");r.items=[];for(var n=0;n<e.items.length;++n){if(typeof e.items[n]!="object")throw TypeError(".SdkTranscriptAlternative.items: object expected");r.items[n]=p.SdkTranscriptItem.fromObject(e.items[n])}}if(e.transcript!=null&&(r.transcript=String(e.transcript)),e.entities){if(!Array.isArray(e.entities))throw TypeError(".SdkTranscriptAlternative.entities: array expected");r.entities=[];for(var n=0;n<e.entities.length;++n){if(typeof e.entities[n]!="object")throw TypeError(".SdkTranscriptAlternative.entities: object expected");r.entities[n]=p.SdkTranscriptEntity.fromObject(e.entities[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.items=[],n.entities=[]),r.defaults&&(n.transcript=""),e.items&&e.items.length){n.items=[];for(var o=0;o<e.items.length;++o)n.items[o]=p.SdkTranscriptItem.toObject(e.items[o],r)}if(e.transcript!=null&&e.hasOwnProperty("transcript")&&(n.transcript=e.transcript),e.entities&&e.entities.length){n.entities=[];for(var o=0;o<e.entities.length;++o)n.entities[o]=p.SdkTranscriptEntity.toObject(e.entities[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptAlternative"},i})();p.SdkTranscriptLanguageWithScore=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.languageCode="",i.prototype.score=0,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.languageCode!=null&&Object.hasOwnProperty.call(e,"languageCode")&&r.uint32(10).string(e.languageCode),e.score!=null&&Object.hasOwnProperty.call(e,"score")&&r.uint32(17).double(e.score),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscriptLanguageWithScore;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.languageCode=e.string();break}case 2:{o.score=e.double();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.languageCode!=null&&e.hasOwnProperty("languageCode")&&!v.isString(e.languageCode)?"languageCode: string expected":e.score!=null&&e.hasOwnProperty("score")&&typeof e.score!="number"?"score: number expected":null},i.fromObject=function(e){if(e instanceof p.SdkTranscriptLanguageWithScore)return e;var r=new p.SdkTranscriptLanguageWithScore;return e.languageCode!=null&&(r.languageCode=String(e.languageCode)),e.score!=null&&(r.score=Number(e.score)),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.languageCode="",n.score=0),e.languageCode!=null&&e.hasOwnProperty("languageCode")&&(n.languageCode=e.languageCode),e.score!=null&&e.hasOwnProperty("score")&&(n.score=r.json&&!isFinite(e.score)?String(e.score):e.score),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptLanguageWithScore"},i})();p.SdkTranscriptResult=(function(){function i(t){if(this.alternatives=[],this.languageIdentification=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.alternatives=v.emptyArray,i.prototype.channelId="",i.prototype.endTime=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.isPartial=!1,i.prototype.resultId="",i.prototype.startTime=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.languageCode="",i.prototype.languageIdentification=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.alternatives!=null&&e.alternatives.length)for(var n=0;n<e.alternatives.length;++n)p.SdkTranscriptAlternative.encode(e.alternatives[n],r.uint32(10).fork()).ldelim();if(e.channelId!=null&&Object.hasOwnProperty.call(e,"channelId")&&r.uint32(18).string(e.channelId),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&r.uint32(24).int64(e.endTime),e.isPartial!=null&&Object.hasOwnProperty.call(e,"isPartial")&&r.uint32(32).bool(e.isPartial),e.resultId!=null&&Object.hasOwnProperty.call(e,"resultId")&&r.uint32(42).string(e.resultId),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&r.uint32(48).int64(e.startTime),e.languageCode!=null&&Object.hasOwnProperty.call(e,"languageCode")&&r.uint32(58).string(e.languageCode),e.languageIdentification!=null&&e.languageIdentification.length)for(var n=0;n<e.languageIdentification.length;++n)p.SdkTranscriptLanguageWithScore.encode(e.languageIdentification[n],r.uint32(66).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscriptResult;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.alternatives&&o.alternatives.length||(o.alternatives=[]),o.alternatives.push(p.SdkTranscriptAlternative.decode(e,e.uint32()));break}case 2:{o.channelId=e.string();break}case 3:{o.endTime=e.int64();break}case 4:{o.isPartial=e.bool();break}case 5:{o.resultId=e.string();break}case 6:{o.startTime=e.int64();break}case 7:{o.languageCode=e.string();break}case 8:{o.languageIdentification&&o.languageIdentification.length||(o.languageIdentification=[]),o.languageIdentification.push(p.SdkTranscriptLanguageWithScore.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.alternatives!=null&&e.hasOwnProperty("alternatives")){if(!Array.isArray(e.alternatives))return"alternatives: array expected";for(var r=0;r<e.alternatives.length;++r){var n=p.SdkTranscriptAlternative.verify(e.alternatives[r]);if(n)return"alternatives."+n}}if(e.channelId!=null&&e.hasOwnProperty("channelId")&&!v.isString(e.channelId))return"channelId: string expected";if(e.endTime!=null&&e.hasOwnProperty("endTime")&&!v.isInteger(e.endTime)&&!(e.endTime&&v.isInteger(e.endTime.low)&&v.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(e.isPartial!=null&&e.hasOwnProperty("isPartial")&&typeof e.isPartial!="boolean")return"isPartial: boolean expected";if(e.resultId!=null&&e.hasOwnProperty("resultId")&&!v.isString(e.resultId))return"resultId: string expected";if(e.startTime!=null&&e.hasOwnProperty("startTime")&&!v.isInteger(e.startTime)&&!(e.startTime&&v.isInteger(e.startTime.low)&&v.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(e.languageCode!=null&&e.hasOwnProperty("languageCode")&&!v.isString(e.languageCode))return"languageCode: string expected";if(e.languageIdentification!=null&&e.hasOwnProperty("languageIdentification")){if(!Array.isArray(e.languageIdentification))return"languageIdentification: array expected";for(var r=0;r<e.languageIdentification.length;++r){var n=p.SdkTranscriptLanguageWithScore.verify(e.languageIdentification[r]);if(n)return"languageIdentification."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkTranscriptResult)return e;var r=new p.SdkTranscriptResult;if(e.alternatives){if(!Array.isArray(e.alternatives))throw TypeError(".SdkTranscriptResult.alternatives: array expected");r.alternatives=[];for(var n=0;n<e.alternatives.length;++n){if(typeof e.alternatives[n]!="object")throw TypeError(".SdkTranscriptResult.alternatives: object expected");r.alternatives[n]=p.SdkTranscriptAlternative.fromObject(e.alternatives[n])}}if(e.channelId!=null&&(r.channelId=String(e.channelId)),e.endTime!=null&&(v.Long?(r.endTime=v.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?r.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?r.endTime=e.endTime:typeof e.endTime=="object"&&(r.endTime=new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.isPartial!=null&&(r.isPartial=!!e.isPartial),e.resultId!=null&&(r.resultId=String(e.resultId)),e.startTime!=null&&(v.Long?(r.startTime=v.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?r.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?r.startTime=e.startTime:typeof e.startTime=="object"&&(r.startTime=new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.languageCode!=null&&(r.languageCode=String(e.languageCode)),e.languageIdentification){if(!Array.isArray(e.languageIdentification))throw TypeError(".SdkTranscriptResult.languageIdentification: array expected");r.languageIdentification=[];for(var n=0;n<e.languageIdentification.length;++n){if(typeof e.languageIdentification[n]!="object")throw TypeError(".SdkTranscriptResult.languageIdentification: object expected");r.languageIdentification[n]=p.SdkTranscriptLanguageWithScore.fromObject(e.languageIdentification[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.alternatives=[],n.languageIdentification=[]),r.defaults){if(n.channelId="",v.Long){var o=new v.Long(0,0,!1);n.endTime=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.endTime=r.longs===String?"0":0;if(n.isPartial=!1,n.resultId="",v.Long){var o=new v.Long(0,0,!1);n.startTime=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.startTime=r.longs===String?"0":0;n.languageCode=""}if(e.alternatives&&e.alternatives.length){n.alternatives=[];for(var s=0;s<e.alternatives.length;++s)n.alternatives[s]=p.SdkTranscriptAlternative.toObject(e.alternatives[s],r)}if(e.channelId!=null&&e.hasOwnProperty("channelId")&&(n.channelId=e.channelId),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?n.endTime=r.longs===String?String(e.endTime):e.endTime:n.endTime=r.longs===String?v.Long.prototype.toString.call(e.endTime):r.longs===Number?new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.isPartial!=null&&e.hasOwnProperty("isPartial")&&(n.isPartial=e.isPartial),e.resultId!=null&&e.hasOwnProperty("resultId")&&(n.resultId=e.resultId),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?n.startTime=r.longs===String?String(e.startTime):e.startTime:n.startTime=r.longs===String?v.Long.prototype.toString.call(e.startTime):r.longs===Number?new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.languageCode!=null&&e.hasOwnProperty("languageCode")&&(n.languageCode=e.languageCode),e.languageIdentification&&e.languageIdentification.length){n.languageIdentification=[];for(var s=0;s<e.languageIdentification.length;++s)n.languageIdentification[s]=p.SdkTranscriptLanguageWithScore.toObject(e.languageIdentification[s],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptResult"},i})();p.SdkTranscript=(function(){function i(t){if(this.results=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.results=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.results!=null&&e.results.length)for(var n=0;n<e.results.length;++n)p.SdkTranscriptResult.encode(e.results[n],r.uint32(10).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscript;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.results&&o.results.length||(o.results=[]),o.results.push(p.SdkTranscriptResult.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.results!=null&&e.hasOwnProperty("results")){if(!Array.isArray(e.results))return"results: array expected";for(var r=0;r<e.results.length;++r){var n=p.SdkTranscriptResult.verify(e.results[r]);if(n)return"results."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkTranscript)return e;var r=new p.SdkTranscript;if(e.results){if(!Array.isArray(e.results))throw TypeError(".SdkTranscript.results: array expected");r.results=[];for(var n=0;n<e.results.length;++n){if(typeof e.results[n]!="object")throw TypeError(".SdkTranscript.results: object expected");r.results[n]=p.SdkTranscriptResult.fromObject(e.results[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.results=[]),e.results&&e.results.length){n.results=[];for(var o=0;o<e.results.length;++o)n.results[o]=p.SdkTranscriptResult.toObject(e.results[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscript"},i})();p.SdkTranscriptionStatus=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.type=1,i.prototype.eventTime=v.Long?v.Long.fromBits(0,0,!1):0,i.prototype.transcriptionRegion="",i.prototype.transcriptionConfiguration="",i.prototype.message="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&r.uint32(8).int32(e.type),e.eventTime!=null&&Object.hasOwnProperty.call(e,"eventTime")&&r.uint32(16).int64(e.eventTime),e.transcriptionRegion!=null&&Object.hasOwnProperty.call(e,"transcriptionRegion")&&r.uint32(26).string(e.transcriptionRegion),e.transcriptionConfiguration!=null&&Object.hasOwnProperty.call(e,"transcriptionConfiguration")&&r.uint32(34).string(e.transcriptionConfiguration),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&r.uint32(42).string(e.message),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscriptionStatus;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.eventTime=e.int64();break}case 3:{o.transcriptionRegion=e.string();break}case 4:{o.transcriptionConfiguration=e.string();break}case 5:{o.message=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:break}return e.eventTime!=null&&e.hasOwnProperty("eventTime")&&!v.isInteger(e.eventTime)&&!(e.eventTime&&v.isInteger(e.eventTime.low)&&v.isInteger(e.eventTime.high))?"eventTime: integer|Long expected":e.transcriptionRegion!=null&&e.hasOwnProperty("transcriptionRegion")&&!v.isString(e.transcriptionRegion)?"transcriptionRegion: string expected":e.transcriptionConfiguration!=null&&e.hasOwnProperty("transcriptionConfiguration")&&!v.isString(e.transcriptionConfiguration)?"transcriptionConfiguration: string expected":e.message!=null&&e.hasOwnProperty("message")&&!v.isString(e.message)?"message: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkTranscriptionStatus)return e;var r=new p.SdkTranscriptionStatus;switch(e.type){default:if(typeof e.type=="number"){r.type=e.type;break}break;case"STARTED":case 1:r.type=1;break;case"INTERRUPTED":case 2:r.type=2;break;case"RESUMED":case 3:r.type=3;break;case"STOPPED":case 4:r.type=4;break;case"FAILED":case 5:r.type=5;break}return e.eventTime!=null&&(v.Long?(r.eventTime=v.Long.fromValue(e.eventTime)).unsigned=!1:typeof e.eventTime=="string"?r.eventTime=parseInt(e.eventTime,10):typeof e.eventTime=="number"?r.eventTime=e.eventTime:typeof e.eventTime=="object"&&(r.eventTime=new v.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber())),e.transcriptionRegion!=null&&(r.transcriptionRegion=String(e.transcriptionRegion)),e.transcriptionConfiguration!=null&&(r.transcriptionConfiguration=String(e.transcriptionConfiguration)),e.message!=null&&(r.message=String(e.message)),r},i.toObject=function(e,r){r||(r={});var n={};if(r.defaults){if(n.type=r.enums===String?"STARTED":1,v.Long){var o=new v.Long(0,0,!1);n.eventTime=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else n.eventTime=r.longs===String?"0":0;n.transcriptionRegion="",n.transcriptionConfiguration="",n.message=""}return e.type!=null&&e.hasOwnProperty("type")&&(n.type=r.enums===String?p.SdkTranscriptionStatus.Type[e.type]===void 0?e.type:p.SdkTranscriptionStatus.Type[e.type]:e.type),e.eventTime!=null&&e.hasOwnProperty("eventTime")&&(typeof e.eventTime=="number"?n.eventTime=r.longs===String?String(e.eventTime):e.eventTime:n.eventTime=r.longs===String?v.Long.prototype.toString.call(e.eventTime):r.longs===Number?new v.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber():e.eventTime),e.transcriptionRegion!=null&&e.hasOwnProperty("transcriptionRegion")&&(n.transcriptionRegion=e.transcriptionRegion),e.transcriptionConfiguration!=null&&e.hasOwnProperty("transcriptionConfiguration")&&(n.transcriptionConfiguration=e.transcriptionConfiguration),e.message!=null&&e.hasOwnProperty("message")&&(n.message=e.message),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptionStatus"},i.Type=(function(){var t={},e=Object.create(t);return e[t[1]="STARTED"]=1,e[t[2]="INTERRUPTED"]=2,e[t[3]="RESUMED"]=3,e[t[4]="STOPPED"]=4,e[t[5]="FAILED"]=5,e})(),i})();p.SdkTranscriptEvent=(function(){function i(e){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)e[r[n]]!=null&&(this[r[n]]=e[r[n]])}i.prototype.status=null,i.prototype.transcript=null;var t;return Object.defineProperty(i.prototype,"Event",{get:v.oneOfGetter(t=["status","transcript"]),set:v.oneOfSetter(t)}),i.create=function(r){return new i(r)},i.encode=function(r,n){return n||(n=re.create()),r.status!=null&&Object.hasOwnProperty.call(r,"status")&&p.SdkTranscriptionStatus.encode(r.status,n.uint32(10).fork()).ldelim(),r.transcript!=null&&Object.hasOwnProperty.call(r,"transcript")&&p.SdkTranscript.encode(r.transcript,n.uint32(18).fork()).ldelim(),n},i.encodeDelimited=function(r,n){return this.encode(r,n).ldelim()},i.decode=function(r,n){r instanceof w||(r=w.create(r));for(var o=n===void 0?r.len:r.pos+n,s=new p.SdkTranscriptEvent;r.pos<o;){var a=r.uint32();switch(a>>>3){case 1:{s.status=p.SdkTranscriptionStatus.decode(r,r.uint32());break}case 2:{s.transcript=p.SdkTranscript.decode(r,r.uint32());break}default:r.skipType(a&7);break}}return s},i.decodeDelimited=function(r){return r instanceof w||(r=new w(r)),this.decode(r,r.uint32())},i.verify=function(r){if(typeof r!="object"||r===null)return"object expected";var n={};if(r.status!=null&&r.hasOwnProperty("status")){n.Event=1;{var o=p.SdkTranscriptionStatus.verify(r.status);if(o)return"status."+o}}if(r.transcript!=null&&r.hasOwnProperty("transcript")){if(n.Event===1)return"Event: multiple values";n.Event=1;{var o=p.SdkTranscript.verify(r.transcript);if(o)return"transcript."+o}}return null},i.fromObject=function(r){if(r instanceof p.SdkTranscriptEvent)return r;var n=new p.SdkTranscriptEvent;if(r.status!=null){if(typeof r.status!="object")throw TypeError(".SdkTranscriptEvent.status: object expected");n.status=p.SdkTranscriptionStatus.fromObject(r.status)}if(r.transcript!=null){if(typeof r.transcript!="object")throw TypeError(".SdkTranscriptEvent.transcript: object expected");n.transcript=p.SdkTranscript.fromObject(r.transcript)}return n},i.toObject=function(r,n){n||(n={});var o={};return r.status!=null&&r.hasOwnProperty("status")&&(o.status=p.SdkTranscriptionStatus.toObject(r.status,n),n.oneofs&&(o.Event="status")),r.transcript!=null&&r.hasOwnProperty("transcript")&&(o.transcript=p.SdkTranscript.toObject(r.transcript,n),n.oneofs&&(o.Event="transcript")),o},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(r){return r===void 0&&(r="type.googleapis.com"),r+"/SdkTranscriptEvent"},i})();p.SdkTranscriptFrame=(function(){function i(t){if(this.events=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.events=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.events!=null&&e.events.length)for(var n=0;n<e.events.length;++n)p.SdkTranscriptEvent.encode(e.events[n],r.uint32(10).fork()).ldelim();return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkTranscriptFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.events&&o.events.length||(o.events=[]),o.events.push(p.SdkTranscriptEvent.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.events!=null&&e.hasOwnProperty("events")){if(!Array.isArray(e.events))return"events: array expected";for(var r=0;r<e.events.length;++r){var n=p.SdkTranscriptEvent.verify(e.events[r]);if(n)return"events."+n}}return null},i.fromObject=function(e){if(e instanceof p.SdkTranscriptFrame)return e;var r=new p.SdkTranscriptFrame;if(e.events){if(!Array.isArray(e.events))throw TypeError(".SdkTranscriptFrame.events: array expected");r.events=[];for(var n=0;n<e.events.length;++n){if(typeof e.events[n]!="object")throw TypeError(".SdkTranscriptFrame.events: object expected");r.events[n]=p.SdkTranscriptEvent.fromObject(e.events[n])}}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.events=[]),e.events&&e.events.length){n.events=[];for(var o=0;o<e.events.length;++o)n.events[o]=p.SdkTranscriptEvent.toObject(e.events[o],r)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptFrame"},i})();p.SdkRemoteVideoUpdateFrame=(function(){function i(t){if(this.addedOrUpdatedVideoSubscriptions=[],this.removedVideoSubscriptionMids=[],t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.addedOrUpdatedVideoSubscriptions=v.emptyArray,i.prototype.removedVideoSubscriptionMids=v.emptyArray,i.create=function(e){return new i(e)},i.encode=function(e,r){if(r||(r=re.create()),e.addedOrUpdatedVideoSubscriptions!=null&&e.addedOrUpdatedVideoSubscriptions.length)for(var n=0;n<e.addedOrUpdatedVideoSubscriptions.length;++n)p.SdkVideoSubscriptionConfiguration.encode(e.addedOrUpdatedVideoSubscriptions[n],r.uint32(10).fork()).ldelim();if(e.removedVideoSubscriptionMids!=null&&e.removedVideoSubscriptionMids.length)for(var n=0;n<e.removedVideoSubscriptionMids.length;++n)r.uint32(18).string(e.removedVideoSubscriptionMids[n]);return r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkRemoteVideoUpdateFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.addedOrUpdatedVideoSubscriptions&&o.addedOrUpdatedVideoSubscriptions.length||(o.addedOrUpdatedVideoSubscriptions=[]),o.addedOrUpdatedVideoSubscriptions.push(p.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break}case 2:{o.removedVideoSubscriptionMids&&o.removedVideoSubscriptionMids.length||(o.removedVideoSubscriptionMids=[]),o.removedVideoSubscriptionMids.push(e.string());break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.addedOrUpdatedVideoSubscriptions!=null&&e.hasOwnProperty("addedOrUpdatedVideoSubscriptions")){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))return"addedOrUpdatedVideoSubscriptions: array expected";for(var r=0;r<e.addedOrUpdatedVideoSubscriptions.length;++r){var n=p.SdkVideoSubscriptionConfiguration.verify(e.addedOrUpdatedVideoSubscriptions[r]);if(n)return"addedOrUpdatedVideoSubscriptions."+n}}if(e.removedVideoSubscriptionMids!=null&&e.hasOwnProperty("removedVideoSubscriptionMids")){if(!Array.isArray(e.removedVideoSubscriptionMids))return"removedVideoSubscriptionMids: array expected";for(var r=0;r<e.removedVideoSubscriptionMids.length;++r)if(!v.isString(e.removedVideoSubscriptionMids[r]))return"removedVideoSubscriptionMids: string[] expected"}return null},i.fromObject=function(e){if(e instanceof p.SdkRemoteVideoUpdateFrame)return e;var r=new p.SdkRemoteVideoUpdateFrame;if(e.addedOrUpdatedVideoSubscriptions){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: array expected");r.addedOrUpdatedVideoSubscriptions=[];for(var n=0;n<e.addedOrUpdatedVideoSubscriptions.length;++n){if(typeof e.addedOrUpdatedVideoSubscriptions[n]!="object")throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: object expected");r.addedOrUpdatedVideoSubscriptions[n]=p.SdkVideoSubscriptionConfiguration.fromObject(e.addedOrUpdatedVideoSubscriptions[n])}}if(e.removedVideoSubscriptionMids){if(!Array.isArray(e.removedVideoSubscriptionMids))throw TypeError(".SdkRemoteVideoUpdateFrame.removedVideoSubscriptionMids: array expected");r.removedVideoSubscriptionMids=[];for(var n=0;n<e.removedVideoSubscriptionMids.length;++n)r.removedVideoSubscriptionMids[n]=String(e.removedVideoSubscriptionMids[n])}return r},i.toObject=function(e,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.addedOrUpdatedVideoSubscriptions=[],n.removedVideoSubscriptionMids=[]),e.addedOrUpdatedVideoSubscriptions&&e.addedOrUpdatedVideoSubscriptions.length){n.addedOrUpdatedVideoSubscriptions=[];for(var o=0;o<e.addedOrUpdatedVideoSubscriptions.length;++o)n.addedOrUpdatedVideoSubscriptions[o]=p.SdkVideoSubscriptionConfiguration.toObject(e.addedOrUpdatedVideoSubscriptions[o],r)}if(e.removedVideoSubscriptionMids&&e.removedVideoSubscriptionMids.length){n.removedVideoSubscriptionMids=[];for(var o=0;o<e.removedVideoSubscriptionMids.length;++o)n.removedVideoSubscriptionMids[o]=e.removedVideoSubscriptionMids[o]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkRemoteVideoUpdateFrame"},i})();p.SdkVideoQualityAdaptationPreference=(function(){var i={},t=Object.create(i);return t[i[1]="BALANCED"]=1,t[i[2]="MAINTAIN_FRAMERATE"]=2,t[i[3]="MAINTAIN_RESOLUTION"]=3,t})();p.SdkVideoSubscriptionConfiguration=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.mid="",i.prototype.attendeeId="",i.prototype.streamId=0,i.prototype.priority=0,i.prototype.targetBitrateKbps=0,i.prototype.groupId=0,i.prototype.qualityAdaptationPreference=1,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),r.uint32(10).string(e.mid),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&r.uint32(18).string(e.attendeeId),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&r.uint32(24).uint32(e.streamId),e.priority!=null&&Object.hasOwnProperty.call(e,"priority")&&r.uint32(32).uint32(e.priority),e.targetBitrateKbps!=null&&Object.hasOwnProperty.call(e,"targetBitrateKbps")&&r.uint32(40).uint32(e.targetBitrateKbps),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&r.uint32(48).uint32(e.groupId),e.qualityAdaptationPreference!=null&&Object.hasOwnProperty.call(e,"qualityAdaptationPreference")&&r.uint32(56).int32(e.qualityAdaptationPreference),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkVideoSubscriptionConfiguration;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.mid=e.string();break}case 2:{o.attendeeId=e.string();break}case 3:{o.streamId=e.uint32();break}case 4:{o.priority=e.uint32();break}case 5:{o.targetBitrateKbps=e.uint32();break}case 6:{o.groupId=e.uint32();break}case 7:{o.qualityAdaptationPreference=e.int32();break}default:e.skipType(s&7);break}}if(!o.hasOwnProperty("mid"))throw v.ProtocolError("missing required 'mid'",{instance:o});return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(!v.isString(e.mid))return"mid: string expected";if(e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId))return"attendeeId: string expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId))return"streamId: integer expected";if(e.priority!=null&&e.hasOwnProperty("priority")&&!v.isInteger(e.priority))return"priority: integer expected";if(e.targetBitrateKbps!=null&&e.hasOwnProperty("targetBitrateKbps")&&!v.isInteger(e.targetBitrateKbps))return"targetBitrateKbps: integer expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId))return"groupId: integer expected";if(e.qualityAdaptationPreference!=null&&e.hasOwnProperty("qualityAdaptationPreference"))switch(e.qualityAdaptationPreference){default:return"qualityAdaptationPreference: enum value expected";case 1:case 2:case 3:break}return null},i.fromObject=function(e){if(e instanceof p.SdkVideoSubscriptionConfiguration)return e;var r=new p.SdkVideoSubscriptionConfiguration;switch(e.mid!=null&&(r.mid=String(e.mid)),e.attendeeId!=null&&(r.attendeeId=String(e.attendeeId)),e.streamId!=null&&(r.streamId=e.streamId>>>0),e.priority!=null&&(r.priority=e.priority>>>0),e.targetBitrateKbps!=null&&(r.targetBitrateKbps=e.targetBitrateKbps>>>0),e.groupId!=null&&(r.groupId=e.groupId>>>0),e.qualityAdaptationPreference){default:if(typeof e.qualityAdaptationPreference=="number"){r.qualityAdaptationPreference=e.qualityAdaptationPreference;break}break;case"BALANCED":case 1:r.qualityAdaptationPreference=1;break;case"MAINTAIN_FRAMERATE":case 2:r.qualityAdaptationPreference=2;break;case"MAINTAIN_RESOLUTION":case 3:r.qualityAdaptationPreference=3;break}return r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.mid="",n.attendeeId="",n.streamId=0,n.priority=0,n.targetBitrateKbps=0,n.groupId=0,n.qualityAdaptationPreference=r.enums===String?"BALANCED":1),e.mid!=null&&e.hasOwnProperty("mid")&&(n.mid=e.mid),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(n.attendeeId=e.attendeeId),e.streamId!=null&&e.hasOwnProperty("streamId")&&(n.streamId=e.streamId),e.priority!=null&&e.hasOwnProperty("priority")&&(n.priority=e.priority),e.targetBitrateKbps!=null&&e.hasOwnProperty("targetBitrateKbps")&&(n.targetBitrateKbps=e.targetBitrateKbps),e.groupId!=null&&e.hasOwnProperty("groupId")&&(n.groupId=e.groupId),e.qualityAdaptationPreference!=null&&e.hasOwnProperty("qualityAdaptationPreference")&&(n.qualityAdaptationPreference=r.enums===String?p.SdkVideoQualityAdaptationPreference[e.qualityAdaptationPreference]===void 0?e.qualityAdaptationPreference:p.SdkVideoQualityAdaptationPreference[e.qualityAdaptationPreference]:e.qualityAdaptationPreference),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkVideoSubscriptionConfiguration"},i})();p.SdkNotificationFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.level=3,i.prototype.message="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.level!=null&&Object.hasOwnProperty.call(e,"level")&&r.uint32(8).int32(e.level),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&r.uint32(18).string(e.message),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkNotificationFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.level=e.int32();break}case 2:{o.message=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.level!=null&&e.hasOwnProperty("level"))switch(e.level){default:return"level: enum value expected";case 1:case 2:case 3:break}return e.message!=null&&e.hasOwnProperty("message")&&!v.isString(e.message)?"message: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkNotificationFrame)return e;var r=new p.SdkNotificationFrame;switch(e.level){case"INFO":case 1:r.level=1;break;case"WARNING":case 2:r.level=2;break;default:if(typeof e.level=="number"){r.level=e.level;break}break;case"ERROR":case 3:r.level=3;break}return e.message!=null&&(r.message=String(e.message)),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.level=r.enums===String?"ERROR":3,n.message=""),e.level!=null&&e.hasOwnProperty("level")&&(n.level=r.enums===String?p.SdkNotificationFrame.NotificationLevel[e.level]===void 0?e.level:p.SdkNotificationFrame.NotificationLevel[e.level]:e.level),e.message!=null&&e.hasOwnProperty("message")&&(n.message=e.message),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkNotificationFrame"},i.NotificationLevel=(function(){var t={},e=Object.create(t);return e[t[1]="INFO"]=1,e[t[2]="WARNING"]=2,e[t[3]="ERROR"]=3,e})(),i})();p.SdkPrimaryMeetingJoinFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.credentials=null,i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.credentials!=null&&Object.hasOwnProperty.call(e,"credentials")&&p.SdkMeetingSessionCredentials.encode(e.credentials,r.uint32(10).fork()).ldelim(),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkPrimaryMeetingJoinFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.credentials=p.SdkMeetingSessionCredentials.decode(e,e.uint32());break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.credentials!=null&&e.hasOwnProperty("credentials")){var r=p.SdkMeetingSessionCredentials.verify(e.credentials);if(r)return"credentials."+r}return null},i.fromObject=function(e){if(e instanceof p.SdkPrimaryMeetingJoinFrame)return e;var r=new p.SdkPrimaryMeetingJoinFrame;if(e.credentials!=null){if(typeof e.credentials!="object")throw TypeError(".SdkPrimaryMeetingJoinFrame.credentials: object expected");r.credentials=p.SdkMeetingSessionCredentials.fromObject(e.credentials)}return r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.credentials=null),e.credentials!=null&&e.hasOwnProperty("credentials")&&(n.credentials=p.SdkMeetingSessionCredentials.toObject(e.credentials,r)),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPrimaryMeetingJoinFrame"},i})();p.SdkPrimaryMeetingJoinAckFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkPrimaryMeetingJoinAckFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":null},i.fromObject=function(e){return e instanceof p.SdkPrimaryMeetingJoinAckFrame?e:new p.SdkPrimaryMeetingJoinAckFrame},i.toObject=function(){return{}},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPrimaryMeetingJoinAckFrame"},i})();p.SdkPrimaryMeetingLeaveFrame=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkPrimaryMeetingLeaveFrame;e.pos<n;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":null},i.fromObject=function(e){return e instanceof p.SdkPrimaryMeetingLeaveFrame?e:new p.SdkPrimaryMeetingLeaveFrame},i.toObject=function(){return{}},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPrimaryMeetingLeaveFrame"},i})();p.SdkMeetingSessionCredentials=(function(){function i(t){if(t)for(var e=Object.keys(t),r=0;r<e.length;++r)t[e[r]]!=null&&(this[e[r]]=t[e[r]])}return i.prototype.attendeeId="",i.prototype.externalUserId="",i.prototype.joinToken="",i.create=function(e){return new i(e)},i.encode=function(e,r){return r||(r=re.create()),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&r.uint32(10).string(e.attendeeId),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&r.uint32(18).string(e.externalUserId),e.joinToken!=null&&Object.hasOwnProperty.call(e,"joinToken")&&r.uint32(26).string(e.joinToken),r},i.encodeDelimited=function(e,r){return this.encode(e,r).ldelim()},i.decode=function(e,r){e instanceof w||(e=w.create(e));for(var n=r===void 0?e.len:e.pos+r,o=new p.SdkMeetingSessionCredentials;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:{o.attendeeId=e.string();break}case 2:{o.externalUserId=e.string();break}case 3:{o.joinToken=e.string();break}default:e.skipType(s&7);break}}return o},i.decodeDelimited=function(e){return e instanceof w||(e=new w(e)),this.decode(e,e.uint32())},i.verify=function(e){return typeof e!="object"||e===null?"object expected":e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId)?"attendeeId: string expected":e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!v.isString(e.externalUserId)?"externalUserId: string expected":e.joinToken!=null&&e.hasOwnProperty("joinToken")&&!v.isString(e.joinToken)?"joinToken: string expected":null},i.fromObject=function(e){if(e instanceof p.SdkMeetingSessionCredentials)return e;var r=new p.SdkMeetingSessionCredentials;return e.attendeeId!=null&&(r.attendeeId=String(e.attendeeId)),e.externalUserId!=null&&(r.externalUserId=String(e.externalUserId)),e.joinToken!=null&&(r.joinToken=String(e.joinToken)),r},i.toObject=function(e,r){r||(r={});var n={};return r.defaults&&(n.attendeeId="",n.externalUserId="",n.joinToken=""),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(n.attendeeId=e.attendeeId),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(n.externalUserId=e.externalUserId),e.joinToken!=null&&e.hasOwnProperty("joinToken")&&(n.joinToken=e.joinToken),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,X.util.toJSONOptions)},i.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkMeetingSessionCredentials"},i})();p.SdkVideoCodecCapability=(function(){var i={},t=Object.create(i);return t[i[1]="VP8"]=1,t[i[2]="H264_BASELINE_PROFILE"]=2,t[i[3]="H264_CONSTRAINED_BASELINE_PROFILE"]=3,t[i[4]="H264_MAIN_PROFILE"]=4,t[i[5]="H264_HIGH_PROFILE"]=5,t[i[6]="H264_CONSTRAINED_HIGH_PROFILE"]=6,t[i[8]="VP9_PROFILE_0"]=8,t[i[11]="AV1_MAIN_PROFILE"]=11,t})();gk.exports=p;v.Long=void 0;X.configure()});var Jo=y(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.ClientMetricReportDirection=void 0;var Sk;(function(i){i[i.UPSTREAM=0]="UPSTREAM",i[i.DOWNSTREAM=1]="DOWNSTREAM"})(Sk=Ko.ClientMetricReportDirection||(Ko.ClientMetricReportDirection={}));Ko.default=Sk});var Xo=y(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.ClientMetricReportMediaType=void 0;var yk;(function(i){i[i.AUDIO=0]="AUDIO",i[i.VIDEO=1]="VIDEO"})(yk=Qo.ClientMetricReportMediaType||(Qo.ClientMetricReportMediaType={}));Qo.default=yk});var pg=y(hg=>{"use strict";Object.defineProperty(hg,"__esModule",{value:!0});var fg=class{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}};hg.default=fg});var Sg=y(La=>{"use strict";var gg=La&&La.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(La,"__esModule",{value:!0});var U=Oe(),le=gg(Jo()),he=gg(Xo()),i4=gg(pg()),mg=class i{constructor(t,e,r){this.logger=t,this.videoStreamIndex=e,this.selfAttendeeId=r,this.globalMetricReport=new i4.default,this.streamMetricReports={},this.rtcStatsReport={},this.customStatsReports=[],this.currentTimestampMs=0,this.previousTimestampMs=0,this.currentSsrcs={},this.overriddenObservableMetrics=new Map,this.identityValue=(n,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport;return Number(s.currentMetrics[n])},this.decoderLossPercent=(n,o)=>{let s=this.streamMetricReports[o],a=s.currentMetrics.concealedSamples-(s.previousMetrics.concealedSamples||0),l=s.currentMetrics.totalSamplesReceived-(s.previousMetrics.totalSamplesReceived||0);return l<=0||l-a<=0?0:a/l*100},this.packetLossPercent=(n,o)=>{let s=this.streamMetricReports[o],a=s.currentMetrics[n]-(s.previousMetrics[n]||0),l=s.currentMetrics.packetsLost-(s.previousMetrics.packetsLost||0),c=a+l;return c<=0||l<=0?0:l*100/c},this.jitterBufferMs=(n,o)=>{let s=this.streamMetricReports[o],a=s.currentMetrics.jitterBufferDelay-(s.previousMetrics.jitterBufferDelay||0),l=s.currentMetrics.jitterBufferEmittedCount-(s.previousMetrics.jitterBufferEmittedCount||0);return a<=0||l<=0?0:a/l*1e3},this.countPerSecond=(n,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport,a=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(a<=0)return 0;this.previousTimestampMs<=0&&(a=1);let l=s.currentMetrics[n]-(s.previousMetrics[n]||0);return l<=0?0:Math.trunc(l/a)},this.bitsPerSecond=(n,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport,a=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(a<=0)return 0;this.previousTimestampMs<=0&&(a=1);let l=(s.currentMetrics[n]-(s.previousMetrics[n]||0))*8;return l<=0?0:Math.trunc(l/a)},this.secondsToMilliseconds=(n,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport;return Number(s.currentMetrics[n]*1e3)},this.averageTimeSpentPerSecondInMilliseconds=(n,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport,a=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(a<=0)return 0;this.previousTimestampMs<=0&&(a=1);let l=s.currentMetrics[n]-(s.previousMetrics[n]||0);return l<=0?0:l*1e3/a},this.averageCpuQualityLimitationDurationPerSecondInMilliseconds=(n,o)=>{let s=this.streamMetricReports[o];if(s.previousObjectMetrics[n]===void 0||s.currentObjectMetrics[n]===void 0)return NaN;let a=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(a<=0)return 0;this.previousTimestampMs<=0&&(a=1);let l=0,c=0;for(let[u,f]of Object.entries(s.previousObjectMetrics[n]))u==="cpu"&&(l=f);for(let[u,f]of Object.entries(s.currentObjectMetrics[n]))u==="cpu"&&(c=f);let d=c-l;return d<=0?0:d*1e3/a},this.isHardwareImplementation=(n,o)=>{let s=this.streamMetricReports[o];if(s.currentStringMetrics[n]===void 0)return NaN;let a=String(s.currentStringMetrics[n]),l=a.includes("ExternalDecoder")||a.includes("ExternalEncoder")||a.includes("EncodeAccelerator")||a.includes("DecodeAccelerator"),c=a.includes("fallback from");return l&&!c?1:0},this.globalMetricMap={retransmittedBytesSent:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_RETRANSMIT_BITRATE},totalEncodedBytesTarget:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_TARGET_ENCODER_BITRATE},totalPacketSendDelay:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_BUCKET_DELAY_MS},packetsDiscardedOnSend:{transform:this.countPerSecond,type:U.SdkMetric.Type.SOCKET_DISCARDED_PPS},availableIncomingBitrate:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_AVAILABLE_RECEIVE_BANDWIDTH},availableOutgoingBitrate:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_AVAILABLE_SEND_BANDWIDTH},currentRoundTripTime:{transform:this.secondsToMilliseconds,type:U.SdkMetric.Type.STUN_RTT_MS},audioLevel:{transform:this.identityValue,type:U.SdkMetric.Type.RTC_MIC_AUDIO_LEVEL,source:"audioLevel"}},this.audioUpstreamMetricMap={jitter:{transform:this.secondsToMilliseconds,type:U.SdkMetric.Type.RTC_MIC_JITTER_MS},packetsSent:{transform:this.countPerSecond,type:U.SdkMetric.Type.RTC_MIC_PPS},bytesSent:{transform:this.bitsPerSecond,type:U.SdkMetric.Type.RTC_MIC_BITRATE},roundTripTime:{transform:this.secondsToMilliseconds,type:U.SdkMetric.Type.RTC_MIC_RTT_MS},packetsLost:{transform:this.packetLossPercent,type:U.SdkMetric.Type.RTC_MIC_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"}},this.audioDownstreamMetricMap={concealedSamples:{transform:this.countPerSecond},totalSamplesReceived:{transform:this.countPerSecond},decoderLoss:{transform:this.decoderLossPercent,type:U.SdkMetric.Type.RTC_SPK_FRACTION_DECODER_LOSS_PERCENT},packetsReceived:{transform:this.countPerSecond,type:U.SdkMetric.Type.RTC_SPK_PPS},packetsLost:{transform:this.packetLossPercent,type:U.SdkMetric.Type.RTC_SPK_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},jitter:{transform:this.secondsToMilliseconds,type:U.SdkMetric.Type.RTC_SPK_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:U.SdkMetric.Type.RTC_SPK_JITTER_BUFFER_MS},bytesReceived:{transform:this.bitsPerSecond,type:U.SdkMetric.Type.RTC_SPK_BITRATE},audioLevel:{transform:this.identityValue,type:U.SdkMetric.Type.RTC_SPK_AUDIO_LEVEL},totalAudioPacketsLost:{transform:this.identityValue,type:U.SdkMetric.Type.RTC_SPK_TOTAL_LOST},totalAudioPacketsExpected:{transform:this.identityValue,type:U.SdkMetric.Type.RTC_SPK_TOTAL_EXPECTED},totalAudioPacketsRecoveredRed:{transform:this.identityValue,type:U.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_RED},totalAudioPacketsRecoveredFec:{transform:this.identityValue,type:U.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_FEC}},this.videoUpstreamMetricMap={roundTripTime:{transform:this.secondsToMilliseconds,type:U.SdkMetric.Type.VIDEO_SENT_RTT_MS},nackCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_NACKS_RECEIVED},pliCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_PLIS_RECEIVED},firCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_FIRS_RECEIVED},framesPerSecond:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_INPUT_FPS},framesEncoded:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_ENCODE_FPS},packetsSent:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_SENT_PPS},packetsLost:{transform:this.packetLossPercent,type:U.SdkMetric.Type.VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"},bytesSent:{transform:this.bitsPerSecond,type:U.SdkMetric.Type.VIDEO_SENT_BITRATE},qpSum:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_SENT_QP_SUM},frameHeight:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_ENCODE_HEIGHT},frameWidth:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_ENCODE_WIDTH},jitter:{transform:this.secondsToMilliseconds,type:U.SdkMetric.Type.VIDEO_SENT_JITTER_MS},totalEncodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:U.SdkMetric.Type.VIDEO_ENCODE_MS},encoderImplementation:{transform:this.isHardwareImplementation,type:U.SdkMetric.Type.VIDEO_ENCODER_IS_HARDWARE},qualityLimitationDurations:{transform:this.averageCpuQualityLimitationDurationPerSecondInMilliseconds,type:U.SdkMetric.Type.VIDEO_QUALITY_LIMITATION_DURATION_CPU},videoCodecDegradationHighEncodeCpu:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU},videoCodecDegradationEncodeFailure:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE},videoInputWidth:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_INPUT_WIDTH},videoInputHeight:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_INPUT_HEIGHT}},this.videoDownstreamMetricMap={packetsReceived:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_RECEIVED_PPS},packetsLost:{transform:this.packetLossPercent,type:U.SdkMetric.Type.VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},framesReceived:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_RECEIVED_FPS},framesDecoded:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_DECODE_FPS},nackCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_NACKS_SENT},firCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_FIRS_SENT},pliCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_PLIS_SENT},bytesReceived:{transform:this.bitsPerSecond,type:U.SdkMetric.Type.VIDEO_RECEIVED_BITRATE},jitter:{transform:this.secondsToMilliseconds,type:U.SdkMetric.Type.VIDEO_RECEIVED_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:U.SdkMetric.Type.VIDEO_JITTER_BUFFER_MS},qpSum:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_RECEIVED_QP_SUM},frameHeight:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_DECODE_HEIGHT},frameWidth:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_DECODE_WIDTH},totalDecodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:U.SdkMetric.Type.VIDEO_DECODE_MS},decoderImplementation:{transform:this.isHardwareImplementation,type:U.SdkMetric.Type.VIDEO_DECODER_IS_HARDWARE},totalFreezesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:U.SdkMetric.Type.VIDEO_FREEZE_DURATION},freezeCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_FREEZE_COUNT},totalPausesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:U.SdkMetric.Type.VIDEO_PAUSE_DURATION},pauseCount:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_PAUSE_COUNT},framesDropped:{transform:this.countPerSecond,type:U.SdkMetric.Type.VIDEO_DROPPED_FPS},videoRenderWidth:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_RENDER_WIDTH},videoRenderHeight:{transform:this.identityValue,type:U.SdkMetric.Type.VIDEO_RENDER_HEIGHT}},this.streamDimensionMap={encoderImplementation:U.SdkStreamDimension.Type.VIDEO_ENCODER_NAME,decoderImplementation:U.SdkStreamDimension.Type.VIDEO_DECODER_NAME},this.observableVideoMetricSpec={videoUpstreamBitrate:{source:"bytesSent",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamPacketsSent:{source:"packetsSent",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamPacketLossPercent:{source:"packetsLost",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamFramesEncodedPerSecond:{source:"framesEncoded",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamFramesInputPerSecond:{source:"framesPerSecond",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamFrameHeight:{source:"frameHeight",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamFrameWidth:{source:"frameWidth",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamJitterMs:{source:"jitter",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamRoundTripTimeMs:{source:"roundTripTime",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamEncoderImplementation:{source:"encoderImplementation",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamTotalEncodeTimePerSecond:{source:"totalEncodeTime",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoUpstreamCpuQualityLimitationDurationPerSecond:{source:"qualityLimitationDurations",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoDownstreamBitrate:{source:"bytesReceived",media:he.default.VIDEO,dir:le.default.DOWNSTREAM},videoDownstreamPacketLossPercent:{source:"packetsLost",media:he.default.VIDEO,dir:le.default.DOWNSTREAM},videoDownstreamPacketsReceived:{source:"packetsReceived",media:he.default.VIDEO,dir:le.default.DOWNSTREAM},videoDownstreamFramesDecodedPerSecond:{source:"framesDecoded",media:he.default.VIDEO,dir:le.default.DOWNSTREAM},videoDownstreamFrameHeight:{source:"frameHeight",media:he.default.VIDEO,dir:le.default.DOWNSTREAM},videoDownstreamFrameWidth:{source:"frameWidth",media:he.default.VIDEO,dir:le.default.DOWNSTREAM},videoDownstreamJitterMs:{source:"jitter",media:he.default.VIDEO,dir:le.default.DOWNSTREAM},videoDownstreamDelayMs:{source:"jitterBufferMs",media:he.default.VIDEO,dir:le.default.DOWNSTREAM}},this.observableMetricSpec={audioPacketsReceived:{source:"packetsReceived",media:he.default.AUDIO,dir:le.default.DOWNSTREAM},audioPacketsReceivedFractionLoss:{source:"packetsLost",media:he.default.AUDIO,dir:le.default.DOWNSTREAM},audioDecoderLoss:{source:"decoderLoss",media:he.default.AUDIO,dir:le.default.DOWNSTREAM},audioPacketsSent:{source:"packetsSent",media:he.default.AUDIO,dir:le.default.UPSTREAM},audioPacketLossPercent:{source:"packetsLost",media:he.default.AUDIO,dir:le.default.UPSTREAM},audioUpstreamRoundTripTimeMs:{source:"roundTripTime",media:he.default.AUDIO,dir:le.default.UPSTREAM},videoUpstreamBitrate:{source:"bytesSent",media:he.default.VIDEO,dir:le.default.UPSTREAM},videoPacketSentPerSecond:{source:"packetsSent",media:he.default.VIDEO,dir:le.default.UPSTREAM},audioSpeakerDelayMs:{source:"jitterBufferMs",media:he.default.AUDIO,dir:le.default.DOWNSTREAM},audioUpstreamJitterMs:{source:"jitter",media:he.default.AUDIO,dir:le.default.UPSTREAM},audioDownstreamJitterMs:{source:"jitter",media:he.default.AUDIO,dir:le.default.DOWNSTREAM},nackCountReceivedPerSecond:{source:"nackCount",media:he.default.VIDEO,dir:le.default.UPSTREAM},availableOutgoingBitrate:{source:"availableOutgoingBitrate"},availableIncomingBitrate:{source:"availableIncomingBitrate"},currentRoundTripTimeMs:{source:"currentRoundTripTime"},audioDownstreamLevel:{source:"audioLevel",media:he.default.AUDIO,dir:le.default.DOWNSTREAM},audioUpstreamLevel:{source:"audioLevel"}}}getMetricMap(t,e){switch(t){case he.default.AUDIO:switch(e){case le.default.UPSTREAM:return this.audioUpstreamMetricMap;case le.default.DOWNSTREAM:return this.audioDownstreamMetricMap}case he.default.VIDEO:switch(e){case le.default.UPSTREAM:return this.videoUpstreamMetricMap;case le.default.DOWNSTREAM:return this.videoDownstreamMetricMap}default:return this.globalMetricMap}}getStreamDimensionMap(){return this.streamDimensionMap}getObservableMetricValue(t){if(this.overriddenObservableMetrics.has(t))return this.overriddenObservableMetrics.get(t);let e=this.observableMetricSpec[t],n=this.getMetricMap(e.media,e.dir)[e.source],{transform:o,source:s}=n;if(e.hasOwnProperty("media"))for(let a in this.streamMetricReports){let l=this.streamMetricReports[a];if(l.direction===e.dir&&l.mediaType===e.media)return o(s||e.source,Number(a))}else return o(s||e.source);return 0}getObservableVideoMetricValue(t,e){let r=this.observableVideoMetricSpec[t],o=this.getMetricMap(r.media,r.dir)[r.source],{transform:s,source:a}=o;return s(a||r.source,e)}getVideoUpstreamSsrcs(){let t=[];for(let e in this.streamMetricReports)this.streamMetricReports[e].mediaType===he.default.VIDEO&&this.streamMetricReports[e].direction===le.default.UPSTREAM&&t.push(Number(e));return t}getObservableMetrics(){let t={};for(let e in this.observableMetricSpec)t[e]=this.getObservableMetricValue(e);return t}getObservableVideoMetrics(){let t={};if(!this.videoStreamIndex||!this.selfAttendeeId)return this.logger.error("Need to define VideoStreamIndex and selfAttendeeId if using getObservableVideoMetrics API"),t;for(let e in this.streamMetricReports)if(this.streamMetricReports[e].mediaType===he.default.VIDEO){let r={};for(let a in this.observableVideoMetricSpec)if(this.observableVideoMetricSpec[a].dir===this.streamMetricReports[e].direction){let l=this.getObservableVideoMetricValue(a,Number(e));isNaN(l)||(r[a]=l)}let n=this.streamMetricReports[e].groupId,o=this.streamMetricReports[e].streamId,s="";this.videoStreamIndex.attendeeIdForGroupId!==void 0?s=n?this.videoStreamIndex.attendeeIdForGroupId(n):this.selfAttendeeId:s=o?this.videoStreamIndex.attendeeIdForStreamId(o):this.selfAttendeeId,t[s]=t[s]?t[s]:{},t[s][e]=r}return t}getRTCStatsReport(){return this.rtcStatsReport}clone(){let t=new i(this.logger,this.videoStreamIndex,this.selfAttendeeId);return t.globalMetricReport=this.globalMetricReport,t.streamMetricReports=this.streamMetricReports,t.rtcStatsReport=this.rtcStatsReport,t.customStatsReports=this.customStatsReports,t.currentTimestampMs=this.currentTimestampMs,t.previousTimestampMs=this.previousTimestampMs,t.overriddenObservableMetrics=this.overriddenObservableMetrics,t}print(){let t={globalMetricReport:this.globalMetricReport,streamMetricReports:this.streamMetricReports,currentTimestampMs:this.currentTimestampMs,previousTimestampMs:this.previousTimestampMs};this.logger.debug(()=>`Client Metric Report: ${JSON.stringify(t)}`)}removeDestroyedSsrcs(){for(let t in this.streamMetricReports)this.currentSsrcs[t]||delete this.streamMetricReports[t]}overrideObservableMetric(t,e){this.overriddenObservableMetrics.set(t,e)}};La.default=mg});var vk=y(vg=>{"use strict";Object.defineProperty(vg,"__esModule",{value:!0});var yg=class{};vg.default=yg});var Cg=y(wg=>{"use strict";Object.defineProperty(wg,"__esModule",{value:!0});var bg=class i{constructor(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.isVideoEncoderHardware=!1,this.videoEncodingTimeInMs=0,this.videoEncodingTimePerFrameInMs=0,this.cpuLimitationDuration=0,this.videoInputFps=0,this.videoEncodeFps=0,this.isContentShare=!1,this.numberOfPublishedVideoSources=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}static isTimestampRecent(t,e){return Date.now()<t+e}setConnectionStartTime(){this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}reset(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now(),this.isVideoEncoderHardware=!1,this.videoEncodingTimeInMs=0,this.videoEncodingTimePerFrameInMs=0,this.cpuLimitationDuration=0,this.videoInputFps=0,this.videoEncodeFps=0,this.isContentShare=!1,this.numberOfPublishedVideoSources=0}isConnectionStartRecent(t){return i.isTimestampRecent(this.connectionStartTimestampMs,t)}isLastPacketLossRecent(t){return i.isTimestampRecent(this.lastPacketLossInboundTimestampMs,t)}isGoodSignalRecent(t){return i.isTimestampRecent(this.lastGoodSignalTimestampMs,t)}isWeakSignalRecent(t){return i.isTimestampRecent(this.lastWeakSignalTimestampMs,t)}isNoSignalRecent(t){return i.isTimestampRecent(this.lastNoSignalTimestampMs,t)}clone(){let t=new i;return t.connectionStartTimestampMs=this.connectionStartTimestampMs,t.consecutiveStatsWithNoPackets=this.consecutiveStatsWithNoPackets,t.consecutiveStatsWithNoAudioPacketsSent=this.consecutiveStatsWithNoAudioPacketsSent,t.lastPacketLossInboundTimestampMs=this.lastPacketLossInboundTimestampMs,t.lastGoodSignalTimestampMs=this.lastGoodSignalTimestampMs,t.lastWeakSignalTimestampMs=this.lastWeakSignalTimestampMs,t.lastNoSignalTimestampMs=this.lastNoSignalTimestampMs,t.consecutiveMissedPongs=this.consecutiveMissedPongs,t.packetsReceivedInLastMinute=this.packetsReceivedInLastMinute.slice(0),t.fractionPacketsLostInboundInLastMinute=this.fractionPacketsLostInboundInLastMinute.slice(0),t.audioSpeakerDelayMs=this.audioSpeakerDelayMs,t.isVideoEncoderHardware=this.isVideoEncoderHardware,t.videoEncodingTimeInMs=this.videoEncodingTimeInMs,t.videoEncodingTimePerFrameInMs=this.videoEncodingTimePerFrameInMs,t.cpuLimitationDuration=this.cpuLimitationDuration,t.videoInputFps=this.videoInputFps,t.videoEncodeFps=this.videoEncodeFps,t.isContentShare=this.isContentShare,t.numberOfPublishedVideoSources=this.numberOfPublishedVideoSources,t}setConsecutiveMissedPongs(t){this.consecutiveMissedPongs=t}setConsecutiveStatsWithNoPackets(t){this.consecutiveStatsWithNoPackets=t}setConsecutiveStatsWithNoAudioPacketsSent(t){this.consecutiveStatsWithNoAudioPacketsSent=t}setLastPacketLossInboundTimestampMs(t){this.lastPacketLossInboundTimestampMs=t}setLastNoSignalTimestampMs(t){this.lastNoSignalTimestampMs=t}setLastWeakSignalTimestampMs(t){this.lastWeakSignalTimestampMs=t}setLastGoodSignalTimestampMs(t){this.lastGoodSignalTimestampMs=t}setAudioSpeakerDelayMs(t){this.audioSpeakerDelayMs=t}setIsVideoEncoderHardware(t){this.isVideoEncoderHardware=t}setVideoEncodingTimeInMs(t){this.videoEncodingTimeInMs=t}setVideoEncodingTimePerFrameInMs(t){this.videoEncodingTimePerFrameInMs=t}setCpuLimitationDuration(t){this.cpuLimitationDuration=t}setVideoInputFps(t){this.videoInputFps=t}setVideoEncodeFps(t){this.videoEncodeFps=t}setIsContentShare(t){this.isContentShare=t}setNumberOfPublishedVideoSources(t){this.numberOfPublishedVideoSources=t}};wg.default=bg});var Zo=y(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.VideoEncodingConnectionHealthPolicyName=void 0;var bk;(function(i){i.VideoEncodingCpuHealth="Video Encoding CPU Health",i.VideoEncodingFramerateHealth="Video Encoding framerate Health",i.VideoConcurrentSendersHealth="Video Concurrent Senders Health"})(bk=Yo.VideoEncodingConnectionHealthPolicyName||(Yo.VideoEncodingConnectionHealthPolicyName={}));Yo.default=bk});var Tg=y(Fa=>{"use strict";var wk=Fa&&Fa.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Fa,"__esModule",{value:!0});var r4=wk(er()),n4=wk(Zo()),_g=class extends r4.default{constructor(t,e){super(t,e,n4.default.VideoConcurrentSendersHealth),this.concurrentVideoSendersThreshold=t.concurrentVideoSendersThreshold}health(){return this.currentData.isContentShare?this.maximumHealth():this.currentData.numberOfPublishedVideoSources>this.concurrentVideoSendersThreshold?this.minimumHealth():this.maximumHealth()}};Fa.default=_g});var Ig=y(Ba=>{"use strict";var Ck=Ba&&Ba.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ba,"__esModule",{value:!0});var o4=Ck(er()),s4=Ck(Zo()),Eg=class extends o4.default{constructor(t,e){super(t,e,s4.default.VideoEncodingCpuHealth),this.consecutiveHighEncodeCpuCnt=0,this.consecutiveHighEncodeCpuThreshold=t.consecutiveHighEncodeCpuThreshold,this.highEncodeCpuMsThreshold=t.highEncodeCpuMsThreshold,this.highEncodeCpuMsPerFrameThreshold=t.highEncodeCpuMsPerFrameThreshold}health(){let t=this.currentData.videoEncodingTimeInMs>=this.highEncodeCpuMsThreshold&&this.currentData.videoEncodingTimePerFrameInMs>=this.highEncodeCpuMsPerFrameThreshold;if(!this.currentData.isVideoEncoderHardware&&(t||this.currentData.cpuLimitationDuration>0)){if(this.consecutiveHighEncodeCpuCnt++,this.consecutiveHighEncodeCpuCnt>this.consecutiveHighEncodeCpuThreshold)return this.consecutiveHighEncodeCpuCnt=0,this.minimumHealth()}else this.consecutiveHighEncodeCpuCnt=0;return this.maximumHealth()}};Ba.default=Eg});var kg=y(Va=>{"use strict";var _k=Va&&Va.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Va,"__esModule",{value:!0});var a4=_k(er()),d4=_k(Zo()),Ag=class extends a4.default{constructor(t,e){super(t,e,d4.default.VideoEncodingFramerateHealth),this.consecutiveEncodeFailureCnt=0,this.consecutiveVideoEncodingFailureThreshold=t.consecutiveVideoEncodingFailureThreshold}health(){if(this.currentData.videoEncodeFps===0&&this.currentData.videoInputFps>0){if(this.consecutiveEncodeFailureCnt++,this.consecutiveEncodeFailureCnt>this.consecutiveVideoEncodingFailureThreshold)return this.consecutiveEncodeFailureCnt=0,this.minimumHealth()}else this.consecutiveEncodeFailureCnt=0;return this.maximumHealth()}};Va.default=Ag});var Og=y(Ua=>{"use strict";var xg=Ua&&Ua.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ua,"__esModule",{value:!0});var c4=xg(Tg()),l4=xg(Ig()),u4=xg(kg()),Mg=class{constructor(){this.minHealth=0,this.maxHealth=1,this.initialHealth=1,this.connectionUnhealthyThreshold=25,this.noSignalThresholdTimeMs=1e4,this.connectionWaitTimeMs=1e4,this.zeroBarsNoSignalTimeMs=5e3,this.oneBarWeakSignalTimeMs=5e3,this.twoBarsTimeMs=5e3,this.threeBarsTimeMs=1e4,this.fourBarsTimeMs=2e4,this.fiveBarsTimeMs=6e4,this.cooldownTimeMs=6e4,this.pastSamplesToConsider=15,this.goodSignalTimeMs=15e3,this.fractionalLoss=.5,this.packetsExpected=50,this.maximumTimesToWarn=2,this.missedPongsLowerThreshold=1,this.missedPongsUpperThreshold=4,this.maximumAudioDelayMs=6e4,this.maximumAudioDelayDataPoints=10,this.sendingAudioFailureSamplesToConsider=2,this.sendingAudioFailureInitialWaitTimeMs=3e3,this.videoEncodingHealthPolicies=[c4.default,l4.default,u4.default],this.consecutiveHighEncodeCpuThreshold=10,this.highEncodeCpuMsThreshold=500,this.highEncodeCpuMsPerFrameThreshold=15,this.consecutiveVideoEncodingFailureThreshold=5,this.concurrentVideoSendersThreshold=15}};Ua.default=Mg});var es=y(Rg=>{"use strict";Object.defineProperty(Rg,"__esModule",{value:!0});var Pg;(function(i){i.Modality="#content"})(Pg||(Pg={}));Rg.default=Pg});var nr=y(Ng=>{"use strict";Object.defineProperty(Ng,"__esModule",{value:!0});var Dg=class{constructor(t){this.intervalMs=t}start(t){this.stop(),this.timer=setInterval(t,this.intervalMs)}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.timer=void 0)}running(){return this.timer!==void 0}};Ng.default=Dg});var Lg=y(Zr=>{"use strict";var Tk=Zr&&Zr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Ek=Zr&&Zr.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Zr,"__esModule",{value:!0});var f4=Ek(wt()),h4=Ek(nr()),Lu=class i{constructor(){this.scheduler=null,this.devices=null,this.deviceChangeListeners=new Set,this.get=(t,e,r)=>{if(!Reflect.has(t,e))return;if(!("ondevicechange"in navigator.mediaDevices)){if(e==="addEventListener")return this.patchAddEventListener(t,e,r);if(e==="removeEventListener")return this.patchRemoveEventListener(t,e,r)}let n=Reflect.get(t,e,r);return typeof n=="function"?n.bind(t):n},this.patchAddEventListener=(t,e,r)=>{let n=Reflect.get(t,e,r);return(o,s,a)=>{if(o==="devicechange")this.deviceChangeListeners.add(s),this.scheduler||(this.scheduler=new h4.default(i.INTERVAL_MS),this.scheduler.start(this.pollDeviceLists));else return Reflect.apply(n,t,[o,s,a])}},this.patchRemoveEventListener=(t,e,r)=>{let n=Reflect.get(t,e,r);return(o,s,a)=>{if(o==="devicechange")this.deviceChangeListeners.delete(s),this.deviceChangeListeners.size===0&&this.scheduler&&(this.scheduler.stop(),this.scheduler=null);else return Reflect.apply(n,t,[o,s,a])}},this.pollDeviceLists=()=>Tk(this,void 0,void 0,function*(){let t=yield this.sortedDeviceList();this.devices&&(t.length!==this.devices.length||t.some((r,n)=>r.deviceId!==this.devices[n].deviceId))&&this.handleDeviceChangeEvent(),this.devices=t})}sortedDeviceList(){return Tk(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).sort((e,r)=>e.deviceId<r.deviceId?1:e.deviceId>r.deviceId?-1:0)})}handleDeviceChangeEvent(){for(let t of this.deviceChangeListeners)f4.default.nextTick(()=>{if(this.deviceChangeListeners.has(t)){let e=new Event("devicechange");typeof t=="function"?t(e):t.handleEvent(e)}})}};Zr.default=Lu;Lu.INTERVAL_MS=1e3});var Bg=y(qa=>{"use strict";var p4=qa&&qa.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qa,"__esModule",{value:!0});var m4=p4(Lg()),Fg=class{constructor(){this.isMediaDevicesSupported=typeof navigator<"u"&&!!navigator.mediaDevices}create(){if(this.isMediaDevicesSupported)return new Proxy(navigator.mediaDevices,new m4.default);throw new Error("navigator.mediaDevices is not supported")}};qa.default=Fg});var qg=y(Ug=>{"use strict";Object.defineProperty(Ug,"__esModule",{value:!0});var Vg=class{constructor(){this.queue=Promise.resolve()}add(t){return new Promise((e,r)=>{this.queue=this.queue.then(t).then(e).catch(r)})}};Ug.default=Vg});var _t=y(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.None=or.Some=or.Maybe=void 0;var ts=class{static of(t){return t==null?Bu.of():Fu.of(t)}};or.Maybe=ts;var Fu=class i{constructor(t){this.value=t,this.isSome=!0,this.isNone=!1}map(t){return ts.of(t(this.value))}flatMap(t){return t(this.value)}get(){return this.value}getOrElse(t){return this.value}defaulting(t){return ts.of(this.getOrElse(t))}static of(t){if(t==null)throw new Error("value is ${value}");return new i(t)}};or.Some=Fu;var Bu=class i{constructor(){this.isSome=!1,this.isNone=!0}get(){throw new Error("value is null")}getOrElse(t){return t}map(t){return new i}flatMap(t){return new i}defaulting(t){return ts.of(this.getOrElse(t))}static of(){return new i}};or.None=Bu});var zg=y(Ha=>{"use strict";var Ik=Ha&&Ha.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(Ha,"__esModule",{value:!0});var Hg=class{constructor(){this.workerTimer=void 0,this.callback=void 0,this.workerTimer=this.createWorkerTimer()}createWorkerTimer(){try{let t=new Blob([`self.onmessage = async function(e){ 
            var timerID = null;
            const awaitTimeout = delay => new Promise( resolve => {
              timerID = setTimeout(resolve, delay);
            })
            await awaitTimeout(e.data);
            postMessage(timerID);
          }`],{type:"application/javascript"});return new Worker(window.URL.createObjectURL(t))}catch{}}start(t,e){return Ik(this,void 0,void 0,function*(){this.callback=e,this.workerTimer?(this.workerTimer.onmessage=r=>{this.lastTimeout=r.data,this.callback()},this.workerTimer.postMessage(t)):this.lastTimeout=setTimeout(()=>{this.callback()},t)})}destroy(){return Ik(this,void 0,void 0,function*(){this.callback=void 0,this.lastTimeout&&(clearTimeout(this.lastTimeout),this.lastTimeout=void 0),this.workerTimer&&(this.workerTimer.terminate(),this.workerTimer=void 0)})}};Ha.default=Hg});var Wg=y(en=>{"use strict";var $g=en&&en.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},kk=en&&en.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(en,"__esModule",{value:!0});var g4=kk(ka()),S4=kk(zg()),Ak=15,jg=class{constructor(t,e,r=new S4.default){this.logger=t,this.stages=e,this.fr=Ak,this.outputMediaStream=new MediaStream,this.videoInput=document.createElement("video"),this.canvasOutput=document.createElement("canvas"),this.outputCtx=this.canvasOutput.getContext("2d"),this.canvasInput=document.createElement("canvas"),this.inputCtx=this.canvasInput.getContext("2d"),this.inputVideoStream=null,this.sourceBuffers=[],this.destBuffers=[],this.observers=new Set,this.hasStarted=!1,this.process=n=>$g(this,void 0,void 0,function*(){if(!this.inputVideoStream)return;let o=performance.now();this.videoInput.videoWidth&&(this.canvasInput.width!==this.videoInput.videoWidth&&(this.canvasInput.width=this.videoInput.videoWidth,this.canvasInput.height=this.videoInput.videoHeight,this.sourceBuffers[0].height=this.canvasInput.height,this.sourceBuffers[0].width=this.canvasInput.width,this.sourceBuffers[0].framerate=this.framerate),this.inputCtx.drawImage(this.videoInput,0,0));let s=[];s.push(this.sourceBuffers[0]);try{for(let m of this.processors)s=yield m.process(s)}catch{this.forEachObserver(S=>{S.processingDidFailToStart&&S.processingDidFailToStart()});return}this.destBuffers=s;let a;try{a=yield this.destBuffers[0].asCanvasImageSource()}catch{this.inputVideoStream&&(this.logger.info("buffers are destroyed and pipeline could not start"),this.forEachObserver(S=>{S.processingDidFailToStart&&S.processingDidFailToStart()}));return}let l=a.width,c=a.height;l!==0&&c!==0&&(this.canvasOutput.width!==l&&this.canvasOutput.height!==c&&(this.canvasOutput.width=l,this.canvasOutput.height=c),this.outputCtx.drawImage(a,0,0,l,c,0,0,l,c),this.hasStarted||(this.hasStarted=!0,this.forEachObserver(m=>{m.processingDidStart&&m.processingDidStart()})));let d=performance.now()-o,u=1e3*2/this.framerate-d,f=Math.max(0,1e3/this.framerate-d);u<=0&&this.forEachObserver(m=>{m.processingLatencyTooHigh&&m.processingLatencyTooHigh(d)}),yield this.timer.start(f,this.process.bind(this))}),this.timer=r}destroy(){if(this.stop(),this.stages)for(let t of this.stages)t.destroy();this.timer.destroy()}get framerate(){return this.fr}set framerate(t){this.fr=t<0||t===void 0?Ak:t}stop(){if(this.videoInput.removeEventListener("loadedmetadata",this.process),this.videoInput.srcObject=null,this.destroyInputMediaStreamAndBuffers(),this.outputMediaStream)for(let t of this.outputMediaStream.getVideoTracks())t.stop();this.hasStarted&&(this.hasStarted=!1,this.forEachObserver(t=>{t.processingDidStop&&t.processingDidStop()}))}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}getInputMediaStream(){return $g(this,void 0,void 0,function*(){return this.inputVideoStream})}getActiveOutputMediaStream(){return this.isOutputMediaStreamActive()?this.outputMediaStream:(this.outputMediaStream=this.canvasOutput.captureStream(this.framerate),this.cloneInputAudioTracksToOutput(),this.outputMediaStream)}setInputMediaStream(t){return $g(this,void 0,void 0,function*(){if(!t){this.stop();return}if(t.getVideoTracks().length===0){this.logger.error("No video tracks in input media stream, ignoring");return}this.inputVideoStream=t;let e=this.inputVideoStream.getVideoTracks()[0].getSettings();this.logger.info(`processing pipeline input stream settings ${JSON.stringify(e)}`),this.framerate=e.frameRate,this.canvasOutput.width=e.width,this.canvasOutput.height=e.height,this.videoInput.addEventListener("loadedmetadata",this.process),this.videoInput.srcObject=this.inputVideoStream,this.videoInput.setAttribute("playsinline","true");let r=new g4.default(this.canvasInput);this.sourceBuffers.push(r),this.videoInput.load();try{yield this.videoInput.play()}catch{this.logger.warn("Video element play() overrided by another load().")}this.cloneInputAudioTracksToOutput()})}cloneInputAudioTracksToOutput(){if(!this.isOutputMediaStreamActive()||this.inputVideoStream===null){this.logger.info("Not cloning input audio tracks to output, do not have media streams ready");return}for(let t of this.outputMediaStream.getAudioTracks())this.logger.info(`Removing audio track ${t.id} from output stream`),this.outputMediaStream.removeTrack(t);for(let t of this.inputVideoStream.getAudioTracks())this.logger.info(`Adding audio track ${t.id} to output stream`),this.outputMediaStream.addTrack(t)}isOutputMediaStreamActive(){return this.outputMediaStream&&this.outputMediaStream.active}set processors(t){this.stages=t}get processors(){return this.stages}forEachObserver(t){for(let e of this.observers)setTimeout(()=>{t(e)},0)}destroyInputMediaStreamAndBuffers(){if(this.inputVideoStream)for(let t of this.inputVideoStream.getTracks())t.stop();this.inputVideoStream=null;for(let t of this.sourceBuffers)t.destroy();this.sourceBuffers=[]}};en.default=jg});var Jg=y(tn=>{"use strict";var Gg=tn&&tn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Mk=tn&&tn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(tn,"__esModule",{value:!0});var y4=Mk(We()),v4=Mk(Wg()),Kg=class i{constructor(t,e,r,n=new y4.default){this.logger=t,this.device=e,this.processors=r,this.browserBehavior=n,this.observers=new Set,this.pipe=new v4.default(this.logger,this.processors),this.pipe.addObserver(this)}get outputMediaStream(){return this.pipe.outputMediaStream}passEventControllerToProcessors(t){if(this.pipe.processors)for(let e of this.pipe.processors)typeof e.setEventController=="function"&&e.setEventController(t)}chooseNewInnerDevice(t){let e=new i(this.logger,t,this.processors,this.browserBehavior);return e.pipe=this.pipe,e}getInnerDevice(){return this.device}intrinsicDevice(){return Gg(this,void 0,void 0,function*(){return this.device})}transformStream(t){return Gg(this,void 0,void 0,function*(){return yield this.pipe.setInputMediaStream(t),this.inputMediaStream=t,this.pipe.getActiveOutputMediaStream()})}onOutputStreamDisconnect(){this.logger.info("DefaultVideoTransformDevice: detach stopping input media stream");let t=this.device&&this.device.id;if(this.pipe.stop(),!t&&this.inputMediaStream)for(let e of this.inputMediaStream.getVideoTracks())e.stop()}stop(){return Gg(this,void 0,void 0,function*(){if(this.inputMediaStream)for(let t of this.inputMediaStream.getVideoTracks())t.stop();this.pipe.destroy(),this.inputMediaStream=null})}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}processingDidStart(){this.logger.info("video transform device processing started"),this.forEachObserver(t=>{t.processingDidStart&&t.processingDidStart()})}processingLatencyTooHigh(t){this.forEachObserver(e=>{e.processingLatencyTooHigh&&e.processingLatencyTooHigh(t)})}processingDidFailToStart(){this.logger.info("video transform device processing failed to start"),this.forEachObserver(t=>{t.processingDidFailToStart&&t.processingDidFailToStart()})}processingDidStop(){this.logger.info("video transform device processing stopped"),this.forEachObserver(t=>{t.processingDidStop&&t.processingDidStop()})}forEachObserver(t){for(let e of this.observers)setTimeout(()=>{t(e)},0)}get framerate(){return this.pipe.framerate}set framerate(t){this.pipe.framerate=t}};tn.default=Kg});var sr=y($a=>{"use strict";var b4=$a&&$a.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty($a,"__esModule",{value:!0});var xk=b4(es()),za=class i{constructor(t){this._id=t}id(){return this._id}base(){return this._id?this._id.split(i.MODALITY_SEPARATOR)[0]:""}modality(){if(!this._id)return"";let t=this._id.split(i.MODALITY_SEPARATOR);return t.length===2?t[1]:""}hasModality(t){return t!==""&&this.modality()===t}withModality(t){let e=new i(this.base()+i.MODALITY_SEPARATOR+t);return t===""||this.base()===""||new i(e._id).modality()!==t?new i(this.base()):e}};$a.default=za;za.MODALITY_SEPARATOR=xk.default.Modality[0];za.MODALITY_CONTENT=xk.default.Modality.substring(1)});var Yg=y(Xg=>{"use strict";Object.defineProperty(Xg,"__esModule",{value:!0});var Qg=class i{constructor(){this.tileId=null,this.localTile=!1,this.localTileStarted=!1,this.isContent=!1,this.active=!1,this.paused=!1,this.poorConnection=!1,this.boundAttendeeId=null,this.boundExternalUserId=null,this.boundVideoStream=null,this.boundVideoElement=null,this.nameplate=null,this.videoStreamContentWidth=null,this.videoStreamContentHeight=null,this.videoElementCSSWidthPixels=null,this.videoElementCSSHeightPixels=null,this.devicePixelRatio=0,this.videoElementPhysicalWidthPixels=null,this.videoElementPhysicalHeightPixels=null,this.streamId=null,this.groupId=null}clone(){let t=new i;return t.tileId=this.tileId,t.localTile=this.localTile,t.isContent=this.isContent,t.active=this.active,t.paused=this.paused,t.poorConnection=this.poorConnection,t.boundAttendeeId=this.boundAttendeeId,t.boundExternalUserId=this.boundExternalUserId,t.boundVideoStream=this.boundVideoStream,t.boundVideoElement=this.boundVideoElement,t.nameplate=this.nameplate,t.videoStreamContentWidth=this.videoStreamContentWidth,t.videoStreamContentHeight=this.videoStreamContentHeight,t.videoElementCSSWidthPixels=this.videoElementCSSWidthPixels,t.videoElementCSSHeightPixels=this.videoElementCSSHeightPixels,t.devicePixelRatio=this.devicePixelRatio,t.videoElementPhysicalWidthPixels=this.videoElementPhysicalWidthPixels,t.videoElementPhysicalHeightPixels=this.videoElementPhysicalHeightPixels,t.streamId=this.streamId,t.groupId=this.groupId,t}};Xg.default=Qg});var Wa=y(ja=>{"use strict";var eS=ja&&ja.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ja,"__esModule",{value:!0});var w4=eS(We()),Ok=eS(sr()),Pk=eS(Yg()),Zg=class i{constructor(t,e,r,n,o=void 0){this.tileController=r,this.devicePixelRatioMonitor=n,this.resolutionMonitor=o,this.tileState=new Pk.default,this.tileState.tileId=t,this.tileState.localTile=e,this.devicePixelRatioMonitor.registerObserver(this)}static connectVideoStreamToVideoElement(t,e,r){let n=r&&t.getVideoTracks()[0].getSettings().facingMode!=="environment"?"rotateY(180deg)":"";if(i.setVideoElementFlag(e,"disablePictureInPicture",r),i.setVideoElementFlag(e,"disableRemotePlayback",r),e.style.transform!==n&&(e.style.transform=n),e.hasAttribute("controls")&&e.removeAttribute("controls"),e.hasAttribute("autoplay")||e.setAttribute("autoplay","true"),e.hasAttribute("playsinline")||e.setAttribute("playsinline","true"),e.hasAttribute("muted")||(e.setAttribute("muted","true"),e.muted=!0),e.srcObject!==t&&(e.srcObject=t,new w4.default().requiresVideoPlayWorkaround()&&e.paused)){let o=e.play();o!==void 0&&o.catch(s=>{console.warn("Error playing video in Safari",s)}).then(()=>{console.debug("Video played successfully in Safari")})}}static disconnectVideoStreamFromVideoElement(t,e,r=!1){if(t)if(e)r||(t.srcObject=null,t.style.transform="");else{if(!t.srcObject)return;t.pause(),t.style.transform="",i.setVideoElementFlag(t,"disablePictureInPicture",!1),i.setVideoElementFlag(t,"disableRemotePlayback",!1),t.srcObject=null}}destroy(){this.devicePixelRatioMonitor.removeObserver(this),this.tileState.boundVideoElement&&this.tileState.boundVideoElement.srcObject===this.tileState.boundVideoStream&&i.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,!1),this.tileState=new Pk.default}devicePixelRatioChanged(t){this.tileState.devicePixelRatio=t,this.sendTileStateUpdate()}id(){return this.tileState.tileId}state(){return this.tileState.clone()}stateRef(){return this.tileState}bindVideoStream(t,e,r,n,o,s,a,l){let c=!1;this.tileState.boundAttendeeId!==t&&(this.tileState.boundAttendeeId=t,new Ok.default(t).hasModality(Ok.default.MODALITY_CONTENT)&&(this.tileState.isContent=!0),c=!0),this.tileState.boundExternalUserId!==a&&(this.tileState.boundExternalUserId=a,c=!0),this.tileState.localTile!==e&&(this.tileState.localTile=e,c=!0),this.tileState.boundVideoStream!==r&&(this.tileState.boundVideoStream=r,c=!0),this.tileState.videoStreamContentWidth!==n&&(this.tileState.videoStreamContentWidth=n,c=!0),this.tileState.videoStreamContentHeight!==o&&(this.tileState.videoStreamContentHeight=o,c=!0),this.tileState.streamId!==s&&(this.tileState.streamId=s,c=!0),this.tileState.groupId!==l&&(this.tileState.groupId=l,c=!0),c&&this.sendTileStateUpdate()}bindVideoElement(t){var e;let r=!1;this.tileState.boundVideoElement!==t&&(this.tileState.boundVideoElement=t,(e=this.resolutionMonitor)===null||e===void 0||e.bindVideoElement(this.tileState.boundVideoElement),r=!0),this.tileState.boundVideoElement!==null?(this.tileState.videoElementCSSWidthPixels!==t.clientWidth&&(this.tileState.videoElementCSSWidthPixels=t.clientWidth,r=!0),this.tileState.videoElementCSSHeightPixels!==t.clientHeight&&(this.tileState.videoElementCSSHeightPixels=t.clientHeight,r=!0)):(this.tileState.videoElementCSSWidthPixels=null,this.tileState.videoElementCSSHeightPixels=null),r&&this.sendTileStateUpdate()}pause(){this.tileState.paused||(this.tileState.paused=!0,this.sendTileStateUpdate())}unpause(){this.tileState.paused&&(this.tileState.paused=!1,this.sendTileStateUpdate())}markPoorConnection(){return this.tileState.poorConnection?!1:(this.tileState.poorConnection=!0,this.sendTileStateUpdate(),!0)}unmarkPoorConnection(){return this.tileState.poorConnection?(this.tileState.poorConnection=!1,this.sendTileStateUpdate(),!0):!1}capture(){if(!this.tileState.active)return null;let t=document.createElement("canvas"),e=this.tileState.boundVideoElement;t.width=e.videoWidth||e.width,t.height=e.videoHeight||e.height;let r=t.getContext("2d");return r.drawImage(e,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)}setStreamId(t){this.tileState.streamId=t,this.tileController.sendTileStateUpdate(this.state())}sendTileStateUpdate(){this.updateActiveState(),this.updateVideoStreamOnVideoElement(),this.updateVideoElementPhysicalPixels(),this.tileController.sendTileStateUpdate(this.state())}updateActiveState(){this.tileState.active=!!(!this.tileState.paused&&!this.tileState.poorConnection&&this.tileState.boundAttendeeId&&this.tileState.boundVideoElement&&this.tileState.boundVideoStream)}updateVideoElementPhysicalPixels(){typeof this.tileState.videoElementCSSWidthPixels=="number"&&typeof this.tileState.videoElementCSSHeightPixels=="number"?(this.tileState.videoElementPhysicalWidthPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSWidthPixels,this.tileState.videoElementPhysicalHeightPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSHeightPixels):(this.tileState.videoElementPhysicalWidthPixels=null,this.tileState.videoElementPhysicalHeightPixels=null)}updateVideoStreamOnVideoElement(){this.tileState.active?i.connectVideoStreamToVideoElement(this.tileState.boundVideoStream,this.tileState.boundVideoElement,this.tileState.localTile):i.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,this.tileState.paused,this.tileController.keepLastFrameWhenPaused)}static setVideoElementFlag(t,e,r){e in t&&(t[e]=r)}};ja.default=Zg});var tS=y(Vu=>{"use strict";Object.defineProperty(Vu,"__esModule",{value:!0});Vu.isAudioTransformDevice=void 0;function C4(i){return!!i&&typeof i=="object"&&"mute"in i&&"stop"in i&&"intrinsicDevice"in i}Vu.isAudioTransformDevice=C4});var nS=y(rS=>{"use strict";Object.defineProperty(rS,"__esModule",{value:!0});var iS=class{constructor(){this.groupId=""}matchesConstraints(t){return JSON.stringify(this.constraints)===JSON.stringify(t)}};rS.default=iS});var ar=y(sS=>{"use strict";Object.defineProperty(sS,"__esModule",{value:!0});var oS=class extends Error{constructor(t,e){super(e||"Error fetching device."),this.cause=t,this.name="GetUserMediaError"}};sS.default=oS});var dS=y(Ga=>{"use strict";var _4=Ga&&Ga.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ga,"__esModule",{value:!0});var T4=_4(ar()),aS=class extends T4.default{constructor(t){super(t),this.name="NotFoundError"}};Ga.default=aS});var lS=y(Ka=>{"use strict";var E4=Ka&&Ka.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ka,"__esModule",{value:!0});var I4=E4(ar()),cS=class extends I4.default{constructor(t){super(t),this.name="NotReadableError"}};Ka.default=cS});var fS=y(Ja=>{"use strict";var A4=Ja&&Ja.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ja,"__esModule",{value:!0});var k4=A4(ar()),uS=class extends k4.default{constructor(t,e){super(t),this.constraint=e,this.name="OverconstrainedError"}};Ja.default=uS});var Uu=y(Qa=>{"use strict";var M4=Qa&&Qa.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Qa,"__esModule",{value:!0});var x4=M4(ar()),hS=class extends x4.default{constructor(t,e){super(t,e),this.name="PermissionDeniedError"}};Qa.default=hS});var mS=y(Xa=>{"use strict";var O4=Xa&&Xa.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Xa,"__esModule",{value:!0});var P4=O4(ar()),pS=class extends P4.default{constructor(t){super(t),this.name="TypeError"}};Xa.default=pS});var Pi=y(gS=>{"use strict";Object.defineProperty(gS,"__esModule",{value:!0});var zt=class{constructor(t,e,r){this.videoWidth=t,this.videoHeight=e,this.videoFrameRate=r}equals(t){return this.videoWidth===t.videoWidth&&this.videoHeight===t.videoHeight&&this.videoFrameRate===t.videoFrameRate}};gS.default=zt;zt.VideoDisabled=new zt(0,0,0);zt.VideoResolutionHD=new zt(1280,720,30);zt.VideoResolutionFHD=new zt(1920,1080,30);zt.VideoResolutionUHD=new zt(3840,2160,30)});var Hu=y(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});qu.isVideoTransformDevice=void 0;function R4(i){return!!i&&typeof i=="object"&&"transformStream"in i&&"stop"in i&&"intrinsicDevice"in i}qu.isVideoTransformDevice=R4});var $u=y(rn=>{"use strict";var Ae=rn&&rn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},at=rn&&rn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(rn,"__esModule",{value:!0});var Rk=at(We()),D4=at(Bg()),zu=at(wt()),Dk=at(qg()),Ya=_t(),N4=at(Jg()),Nk=at(Wa()),L4=tS(),F4=at(nS()),Lk=at(ar()),B4=at(dS()),V4=at(lS()),U4=at(fS()),Fk=at(Uu()),q4=at(mS()),Bk=at(Pi()),H4=Hu(),$t=class i{constructor(t,e,r=new Rk.default,n){this.logger=t,this.browserBehavior=r,this.eventController=n,this.deviceInfoCache=null,this.activeDevices={audio:null,video:null},this.chosenVideoTransformDevice=null,this.audioOutputDeviceId=void 0,this.deviceChangeObservers=new Set,this.mediaStreamBrokerObservers=new Set,this.deviceLabelTrigger=()=>navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),this.audioInputDestinationNode=null,this.audioInputSourceNode=null,this.videoInputQualitySettings=null,this.useWebAudio=!1,this.useMediaConstraintsFallback=!0,this.audioInputTaskQueue=new Dk.default,this.videoInputTaskQueue=new Dk.default,this.muted=!1,this.mediaStreamMuteObserver=(l,c)=>{for(let d of this.deviceChangeObservers)zu.default.nextTick(()=>{this.deviceChangeObservers.has(d)&&d.audioInputMuteStateChanged&&d.audioInputMuteStateChanged(l,c)})},this.alreadyHandlingDeviceChange=!1;let{enableWebAudio:o=!1,useMediaConstraintsFallback:s=!0}=e||{};this.useWebAudio=o,this.useMediaConstraintsFallback=s,this.videoInputQualitySettings=new Bk.default(i.defaultVideoWidth,i.defaultVideoHeight,i.defaultVideoFrameRate);let a=this.browserBehavior.requiresResolutionAlignment(this.videoInputQualitySettings.videoWidth,this.videoInputQualitySettings.videoHeight);this.videoInputQualitySettings.videoWidth=a[0],this.videoInputQualitySettings.videoHeight=a[1],this.logger.info(`DefaultDeviceController video dimension ${this.videoInputQualitySettings.videoWidth} x ${this.videoInputQualitySettings.videoHeight}`);try{this.mediaDeviceWrapper=new D4.default().create();let l=navigator.mediaDevices.getSupportedConstraints();this.logger.info(`Supported Constraints in this browser ${JSON.stringify(l)}`)}catch(l){t.error(l.message)}}isWatchingForDeviceChanges(){return!!this.onDeviceChangeCallback}ensureWatchingDeviceChanges(){var t;this.isWatchingForDeviceChanges()||(this.logger.info("Starting devicechange listener."),this.onDeviceChangeCallback=()=>{this.logger.info("Device change event callback is triggered"),this.handleDeviceChange()},(t=this.mediaDeviceWrapper)===null||t===void 0||t.addEventListener("devicechange",this.onDeviceChangeCallback))}stopWatchingDeviceChanges(){var t;this.isWatchingForDeviceChanges()&&(this.logger.info("Stopping devicechange listener."),(t=this.mediaDeviceWrapper)===null||t===void 0||t.removeEventListener("devicechange",this.onDeviceChangeCallback),this.onDeviceChangeCallback=void 0)}shouldObserveDeviceChanges(){return this.deviceChangeObservers.size?!0:this.activeDevices.audio&&this.activeDevices.audio.constraints!==null||this.activeDevices.video&&this.activeDevices.video.constraints!==null||!!this.audioOutputDeviceId}watchForDeviceChangesIfNecessary(){this.shouldObserveDeviceChanges()?this.ensureWatchingDeviceChanges():this.stopWatchingDeviceChanges()}destroy(){return Ae(this,void 0,void 0,function*(){this.stopWatchingDeviceChanges(),yield this.stopAudioInput(),yield this.stopVideoInput()})}listAudioInputDevices(t=!1){return Ae(this,void 0,void 0,function*(){let e=yield this.listDevicesOfKind("audioinput",t);return this.trace("listAudioInputDevices",t,e),e})}listVideoInputDevices(t=!1){return Ae(this,void 0,void 0,function*(){let e=yield this.listDevicesOfKind("videoinput",t);return this.trace("listVideoInputDevices",t,e),e})}listAudioOutputDevices(t=!1){return Ae(this,void 0,void 0,function*(){let e=yield this.listDevicesOfKind("audiooutput",t);return this.trace("listAudioOutputDevices",t,e),e})}pushAudioMeetingStateForPermissions(t){var e;(e=this.eventController)===null||e===void 0||e.publishEvent(t===void 0?"audioInputUnselected":"audioInputSelected")}pushVideoMeetingStateForPermissions(t){var e;(e=this.eventController)===null||e===void 0||e.publishEvent(t===void 0?"videoInputUnselected":"videoInputSelected")}startAudioInput(t){return Ae(this,void 0,void 0,function*(){return yield this.audioInputTaskQueue.add(()=>this.startAudioInputTask(t))})}startAudioInputTask(t){var e;return Ae(this,void 0,void 0,function*(){if(t===void 0){this.logger.error("Audio input device cannot be undefined");return}try{return L4.isAudioTransformDevice(t)?(this.logger.info(`Choosing transform input device ${t}`),yield this.chooseAudioTransformInputDevice(t)):(this.logger.info(`Choosing intrinsic audio input device ${t}`),this.removeTransform(),yield this.chooseInputIntrinsicDevice("audio",t)),this.trace("startAudioInputDevice",t,"success"),this.useWebAudio?(this.attachAudioInputStreamToAudioContext(this.activeDevices.audio.stream),this.pushAudioMeetingStateForPermissions(this.getMediaStreamDestinationNode().stream),yield(e=this.transform)===null||e===void 0?void 0:e.device.mute(this.muted),this.getMediaStreamDestinationNode().stream):(this.publishAudioInputDidChangeEvent(this.activeDevices.audio.stream),this.activeDevices.audio.stream)}catch(r){throw r}})}stopAudioInput(){return Ae(this,void 0,void 0,function*(){return this.audioInputTaskQueue.add(()=>this.stopAudioInputTask())})}stopAudioInputTask(){return Ae(this,void 0,void 0,function*(){try{if(this.useWebAudio){this.releaseAudioTransformStream();return}this.stopTracksAndRemoveCallbacks("audio")}finally{this.watchForDeviceChangesIfNecessary(),this.publishAudioInputDidChangeEvent(void 0)}})}chooseAudioTransformInputDevice(t){var e;return Ae(this,void 0,void 0,function*(){if(((e=this.transform)===null||e===void 0?void 0:e.device)===t)return;if(!this.useWebAudio)throw new Error("Cannot apply transform device without enabling Web Audio.");let r=i.getAudioContext();if(!(r instanceof OfflineAudioContext))switch(r.state){case"running":break;case"closed":throw new Error("Cannot choose a transform device with a closed audio context.");case"suspended":yield r.resume()}let n;try{n=yield t.createAudioNode(r)}catch(s){throw this.logger.error(`Unable to create transform device node: ${s}.`),s}let o=yield t.intrinsicDevice();yield this.chooseInputIntrinsicDevice("audio",o),this.logger.debug(`Got inner stream: ${o}.`),this.setTransform(t,n)})}chooseVideoTransformInputDevice(t){var e;return Ae(this,void 0,void 0,function*(){if(this.eventController&&t instanceof N4.default&&t.passEventControllerToProcessors(this.eventController),t===this.chosenVideoTransformDevice){this.logger.info("Reselecting same VideoTransformDevice");return}let r=this.chosenVideoTransformDevice;r&&this.logger.info("Switched from previous VideoTransformDevice");let n=!!r,o=yield t.intrinsicDevice();if(!this.isMediaStreamReusableByDeviceId((e=this.activeDevices.video)===null||e===void 0?void 0:e.stream,o)){this.logger.info("video transform device needs new intrinsic device"),n&&r.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=t,this.activeDevices.video=null,yield this.chooseInputIntrinsicDevice("video",o),this.logger.info("apply processors to transform"),yield this.chosenVideoTransformDevice.transformStream(this.activeDevices.video.stream);return}this.chosenVideoTransformDevice=t,this.logger.info("video transform device uses previous stream"),this.logger.info("apply processors to transform"),yield t.transformStream(this.activeDevices.video.stream)})}startVideoInput(t){return Ae(this,void 0,void 0,function*(){return yield this.videoInputTaskQueue.add(()=>this.startVideoInputTask(t))})}startVideoInputTask(t){return Ae(this,void 0,void 0,function*(){if(!t){this.logger.error("Invalid video input device");return}try{return H4.isVideoTransformDevice(t)?(this.logger.info(`Choosing video transform device ${t}`),yield this.chooseVideoTransformInputDevice(t),this.publishVideoInputDidChangeEvent(this.chosenVideoTransformDevice.outputMediaStream),this.chosenVideoTransformDevice.outputMediaStream):(this.chosenVideoInputIsTransformDevice()&&(this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null),yield this.chooseInputIntrinsicDevice("video",t),this.trace("startVideoInputDevice",t),this.publishVideoInputDidChangeEvent(this.activeDevices.video.stream),this.activeDevices.video.stream)}catch(e){throw e}})}stopVideoInput(){return Ae(this,void 0,void 0,function*(){return this.videoInputTaskQueue.add(()=>this.stopVideoInputTask())})}stopVideoInputTask(){return Ae(this,void 0,void 0,function*(){try{if(this.chosenVideoInputIsTransformDevice()){this.releaseVideoTransformStream();return}this.stopTracksAndRemoveCallbacks("video")}finally{this.watchForDeviceChangesIfNecessary(),this.publishVideoInputDidChangeEvent(void 0)}})}chooseAudioOutput(t){return Ae(this,void 0,void 0,function*(){this.audioOutputDeviceId=t,this.watchForDeviceChangesIfNecessary();let e=this.deviceInfoFromDeviceId("audiooutput",this.audioOutputDeviceId);this.publishAudioOutputDidChangeEvent(e),this.trace("chooseAudioOutput",t,null)})}addDeviceChangeObserver(t){this.logger.info("adding device change observer"),this.deviceChangeObservers.add(t),this.watchForDeviceChangesIfNecessary(),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(t){this.logger.info("removing device change observer"),this.deviceChangeObservers.delete(t),this.watchForDeviceChangesIfNecessary(),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){var t,e;if(!this.activeDevices.audio)return null;let r=(e=(t=this.transform)===null||t===void 0?void 0:t.nodes)===null||e===void 0?void 0:e.end;if(r){let n=r.context.createAnalyser();return n.removeOriginalInputs=()=>{try{r.disconnect(n)}catch{}},r.connect(n),n}return this.createAnalyserNodeForRawAudioInput()}createAnalyserNodeForRawAudioInput(){return this.activeDevices.audio?this.createAnalyserNodeForStream(this.activeDevices.audio.stream):null}createAnalyserNodeForStream(t){let e=i.getAudioContext(),r=e.createAnalyser(),n=e.createMediaStreamSource(t);return n.connect(r),this.trace("createAnalyserNodeForAudioInput"),r.removeOriginalInputs=()=>{try{n.disconnect(r)}catch{}},r}startVideoPreviewForVideoInput(t){if(!this.activeDevices.video){this.logger.warn("cannot bind video preview since video input device has not been chosen"),this.trace("startVideoPreviewForVideoInput",t.id);return}Nk.default.connectVideoStreamToVideoElement(this.chosenVideoTransformDevice?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream,t,!0),this.trace("startVideoPreviewForVideoInput",t.id)}stopVideoPreviewForVideoInput(t){Nk.default.disconnectVideoStreamFromVideoElement(t,!1),this.trace("stopVideoPreviewForVideoInput",t.id)}setDeviceLabelTrigger(t){if(this.deviceInfoCache){for(let e of this.deviceInfoCache)if(!e.label){this.deviceInfoCache=null;break}}this.deviceLabelTrigger=t,this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(t){let e=null;return this.useWebAudio?(e=i.getAudioContext().createMediaStreamSource(t),e.connect(this.getMediaStreamOutputNode())):this.logger.warn("WebAudio is not enabled, mixIntoAudioInput will not work"),this.trace("mixIntoAudioInput",t.id),e}chooseVideoInputQuality(t,e,r){let n=this.browserBehavior.requiresResolutionAlignment(t,e);this.videoInputQualitySettings=new Bk.default(n[0],n[1],r)}getVideoInputQualitySettings(){return this.videoInputQualitySettings}acquireAudioInputStream(){return Ae(this,void 0,void 0,function*(){return this.activeDevices.audio||(this.logger.info("No audio device chosen, creating empty audio device"),yield this.startAudioInput(null)),this.useWebAudio?this.getMediaStreamDestinationNode().stream:this.activeDevices.audio.stream})}acquireVideoInputStream(){return Ae(this,void 0,void 0,function*(){if(!this.activeDevices.video)throw new Error("No video device chosen");return this.chosenVideoInputIsTransformDevice()?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream})}acquireDisplayInputStream(t){return Ae(this,void 0,void 0,function*(){throw new Error("unsupported")})}releaseAudioTransformStream(){this.logger.info("Stopping audio track for Web Audio graph"),this.stopTracksAndRemoveCallbacks("audio"),this.logger.info("Removing audio transform, if there is one."),this.removeTransform(),this.audioInputSourceNode&&(this.audioInputSourceNode.disconnect(),this.audioInputSourceNode=void 0),this.audioInputDestinationNode&&(this.audioInputDestinationNode.disconnect(),this.audioInputDestinationNode=void 0)}releaseVideoTransformStream(){this.logger.info("Stopping video track for transform"),this.stopTracksAndRemoveCallbacks("video"),this.logger.info("Disconnecting video transform"),this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null}stopTracksAndRemoveCallbacks(t){let e=this.activeDevices[t];if(!e)return;let r=e.endedCallback,n=e.trackMuteCallback,o=e.trackUnmuteCallback;for(let s of e.stream.getTracks())s.stop(),r&&s.removeEventListener("ended",r),n&&s.removeEventListener("mute",n),o&&s.removeEventListener("unmute",o),delete e.endedCallback,delete e.trackMuteCallback,delete e.trackUnmuteCallback,delete this.activeDevices[t]}chosenVideoInputIsTransformDevice(){return!!this.chosenVideoTransformDevice}muteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!1)}unmuteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!0)}toggleLocalAudioInputStream(t){var e;let r=this.activeDevices.audio;if(this.useWebAudio&&(r=this.getMediaStreamDestinationNode()),!!r){for(let n of r.stream.getTracks())n.enabled!==t&&(n.enabled=t);this.muted!==!t&&(this.muted=!t,(e=this.transform)===null||e===void 0||e.device.mute(this.muted))}}static getIntrinsicDeviceId(t){if(!t)return;if(typeof t=="string")return t;if(t.id)return t.id;let r=t.deviceId;if(!r)return;if(typeof r=="string"||Array.isArray(r))return r;let n=r;if(typeof n.exact=="string"||Array.isArray(n.exact))return n.exact}static createEmptyAudioDevice(){return i.synthesizeAudioDevice(0)}static synthesizeAudioDevice(t){let e=i.getAudioContext(),r=e.createMediaStreamDestination();if(t){let n=e.createGain();n.gain.value=.1,n.connect(r);let o=e.createOscillator();o.frequency.value=t,o.connect(n),o.start()}else{let n=e.createBufferSource();try{n.buffer=e.createBuffer(1,e.sampleRate*5,e.sampleRate)}catch(o){if(o&&o.name==="NotSupportedError")n.buffer=e.createBuffer(1,i.defaultSampleRate*5,i.defaultSampleRate);else throw o}n.buffer.getChannelData(0)[0]=3e-4,n.loop=!0,n.connect(r),n.start()}return r.stream}listDevicesOfKind(t,e){return Ae(this,void 0,void 0,function*(){return(e||this.deviceInfoCache===null||!this.isWatchingForDeviceChanges())&&(yield this.updateDeviceInfoCacheFromBrowser()),this.listCachedDevicesOfKind(t)})}updateDeviceInfoCacheFromBrowser(){var t;return Ae(this,void 0,void 0,function*(){if(typeof MediaDeviceInfo>"u"){this.deviceInfoCache=[];return}let r=yield navigator.mediaDevices.enumerateDevices(),n=!0;for(let o of r)if(!o.label){n=!1;break}if(!n)try{this.logger.info("attempting to trigger media device labels since they are hidden");let o=yield this.deviceLabelTrigger();r=yield navigator.mediaDevices.enumerateDevices();for(let s of o.getTracks())s.stop()}catch(o){this.logger.info("unable to get media device labels"),(t=this.eventController)===null||t===void 0||t.publishEvent("deviceLabelTriggerFailed",{deviceLabelTriggerErrorMessage:this.getErrorMessage(o)})}this.logger.debug(`Update device info cache with devices: ${JSON.stringify(r)}`),this.deviceInfoCache=r})}listCachedDevicesOfKind(t){let e=[];if(this.deviceInfoCache)for(let r of this.deviceInfoCache)r.kind===t&&e.push(r);return e}handleDeviceChange(){return Ae(this,void 0,void 0,function*(){if(this.deviceInfoCache===null)return;if(this.alreadyHandlingDeviceChange){zu.default.nextTick(()=>{this.handleDeviceChange()});return}this.alreadyHandlingDeviceChange=!0;let t=this.listCachedDevicesOfKind("audioinput"),e=this.listCachedDevicesOfKind("videoinput"),r=this.listCachedDevicesOfKind("audiooutput");yield this.updateDeviceInfoCacheFromBrowser();let n=this.listCachedDevicesOfKind("audioinput"),o=this.listCachedDevicesOfKind("videoinput"),s=this.listCachedDevicesOfKind("audiooutput");this.forEachObserver(a=>{this.areDeviceListsEqual(t,n)||Ya.Maybe.of(a.audioInputsChanged).map(l=>l.bind(a)(n)),this.areDeviceListsEqual(e,o)||Ya.Maybe.of(a.videoInputsChanged).map(l=>l.bind(a)(o)),this.areDeviceListsEqual(r,s)||Ya.Maybe.of(a.audioOutputsChanged).map(l=>l.bind(a)(s))}),this.alreadyHandlingDeviceChange=!1})}handleDeviceStreamEnded(t,e){return Ae(this,void 0,void 0,function*(){try{t==="audio"?(this.useWebAudio&&this.browserBehavior.requiresAudioContextResetOnDeviceFailureForWebAudio()?(this.logger.warn("Audio input device which was active is no longer available, suspending and resuming audio context before resetting to empty device to ensure packets are sent"),yield this.stopAudioInput(),i.suspendAudioContext(),i.resumeAudioContext()):this.logger.warn("Audio input device which was active is no longer available, resetting to empty device to ensure packets are sent"),yield this.startAudioInput(null)):(this.logger.warn("Video input device which was active is no longer available, stopping video"),yield this.stopVideoInput())}catch{this.logger.error("Failed to choose null device after stream ended.")}t==="audio"?this.forEachObserver(r=>{Ya.Maybe.of(r.audioInputStreamEnded).map(n=>n.bind(r)(e))}):this.forEachObserver(r=>{Ya.Maybe.of(r.videoInputStreamEnded).map(n=>n.bind(r)(e))})})}forEachObserver(t){for(let e of this.deviceChangeObservers)zu.default.nextTick(()=>{this.deviceChangeObservers.has(e)&&t(e)})}forEachMediaStreamBrokerObserver(t){for(let e of this.mediaStreamBrokerObservers)zu.default.nextTick(()=>{this.mediaStreamBrokerObservers.has(e)&&t(e)})}areDeviceListsEqual(t,e){return JSON.stringify(t.map(r=>JSON.stringify(r)).sort())===JSON.stringify(e.map(r=>JSON.stringify(r)).sort())}intrinsicDeviceAsMediaStream(t){return t&&t.id?t:null}hasSameMediaStreamId(t,e,r){var n,o,s,a;let l;return t==="audio"?(l=r?.audio.streamId,!!l&&l===((o=(n=e.constraints)===null||n===void 0?void 0:n.audio)===null||o===void 0?void 0:o.streamId)):(l=r?.video.streamId,!!l&&l===((a=(s=e?.constraints)===null||s===void 0?void 0:s.video)===null||a===void 0?void 0:a.streamId))}hasSameGroupId(t,e,r){if(t==="")return!0;let n=i.getIntrinsicDeviceId(r);return this.logger.debug(`Checking deviceIds ${n} of type ${typeof n} with groupId ${t}`),typeof n=="string"&&t===this.getGroupIdFromDeviceId(e,n)}getGroupIdFromDeviceId(t,e){if(this.deviceInfoCache!==null){let r=this.listCachedDevicesOfKind(`${t}input`).find(n=>n.deviceId===e);if(r&&r.groupId)return this.logger.debug(`GroupId of deviceId ${e} found in cache is ${r.groupId}`),r.groupId}return this.logger.debug(`GroupId of deviceId ${e} found in cache is empty`),""}handleGetUserMediaError(t,e){if(!t)throw new Lk.default(t);switch(t.name){case"NotReadableError":case"TrackStartError":throw new V4.default(t);case"NotFoundError":case"DevicesNotFoundError":throw new B4.default(t);case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":throw e&&e<i.permissionDeniedOriginDetectionThresholdMs?new Fk.default(t,"Permission denied by browser"):new Fk.default(t,"Permission denied by user");case"OverconstrainedError":case"ConstraintNotSatisfiedError":throw new U4.default(t);case"TypeError":throw new q4.default(t);case"AbortError":default:throw new Lk.default(t)}}matchesDeviceSelection(t,e,r,n){return r&&r.stream.active&&(this.hasSameMediaStreamId(t,r,n)||r.groupId!==null&&this.hasSameGroupId(r.groupId,t,e))?(this.logger.debug(`Compare current device constraint ${JSON.stringify(r.constraints)} to proposed constraints ${JSON.stringify(n)}`),r.matchesConstraints(n)):!1}chooseInputIntrinsicDevice(t,e){var r,n;return Ae(this,void 0,void 0,function*(){let o=this.getMediaStreamConstraints(t,e);if(this.matchesDeviceSelection(t,e,this.activeDevices[t],o)){this.logger.info(`reusing existing ${t} input device`);return}this.activeDevices[t]&&this.activeDevices[t].stream&&this.stopTracksAndRemoveCallbacks(t);let s=Date.now(),a=new F4.default;try{this.logger.info(`requesting new ${t} device with constraint ${JSON.stringify(o)}`);let l=this.intrinsicDeviceAsMediaStream(e);t==="audio"&&e===null?(a.stream=i.createEmptyAudioDevice(),a.constraints=null):l?(this.logger.info(`using media stream ${l.id} for ${t} device`),a.stream=l,a.constraints=o):(a.stream=yield navigator.mediaDevices.getUserMedia(o),a.constraints=o),yield this.handleNewInputDevice(t,a)}catch(l){let c=this.getErrorMessage(l);t==="audio"?(r=this.eventController)===null||r===void 0||r.publishEvent("audioInputFailed",{audioInputErrorMessage:c}):(n=this.eventController)===null||n===void 0||n.publishEvent("videoInputFailed",{videoInputErrorMessage:c}),this.logger.error(`failed to get ${t} device for constraints ${JSON.stringify(o)}: ${c}`);let d=!0;if(l&&"constraint"in l&&(this.logger.error(`Over-constrained by constraint: ${l.constraint}`),this.useMediaConstraintsFallback)){let u=this.getMediaStreamConstraints(t,e,!0),f=JSON.stringify(u);if(f!==JSON.stringify(o)){this.logger.info(`retry requesting new ${t} device with minimal constraint ${f}`);try{a.stream=yield navigator.mediaDevices.getUserMedia(u),a.constraints=u,yield this.handleNewInputDevice(t,a),d=!1}catch(m){this.logger.error(`failed to get ${t} device for constraints ${f}: ${this.getErrorMessage(m)}`)}}}if(d){if(t==="audio"){this.logger.info(`choosing null ${t} device instead`);try{a.stream=i.createEmptyAudioDevice(),a.constraints=null,yield this.handleNewInputDevice(t,a)}catch(u){this.logger.error(`failed to choose null ${t} device. ${u.name}: ${u.message}`)}}this.handleGetUserMediaError(l,Date.now()-s)}}finally{this.watchForDeviceChangesIfNecessary()}})}getErrorMessage(t){return t?t.name&&t.message?`${t.name}: ${t.message}`:t.name?t.name:t.message?t.message:"UnknownError":"UnknownError"}handleNewInputDevice(t,e){var r;return Ae(this,void 0,void 0,function*(){this.logger.info(`got ${t} device for constraints ${JSON.stringify(e.constraints)}`);let n=(r=this.getMediaTrackSettings(e.stream))===null||r===void 0?void 0:r.deviceId;e.groupId=n?this.getGroupIdFromDeviceId(t,n):"",this.activeDevices[t]=e,this.logger.debug(`Set activeDevice to ${JSON.stringify(e)}`),this.watchForDeviceChangesIfNecessary();let o=e.stream.getTracks()[0];if(o&&(e.endedCallback=()=>{this.activeDevices[t]&&this.activeDevices[t].stream===e.stream&&(this.handleDeviceStreamEnded(t,n),delete e.endedCallback)},o.addEventListener("ended",e.endedCallback,{once:!0})),t==="audio"){let s=e.stream.getAudioTracks()[0];if(s){let a=s.getSettings().deviceId||e.stream;e.trackMuteCallback=()=>{this.mediaStreamMuteObserver(a,!0)},e.trackUnmuteCallback=()=>{this.mediaStreamMuteObserver(a,!1)},s.addEventListener("mute",e.trackMuteCallback,{once:!1}),s.addEventListener("unmute",e.trackUnmuteCallback,{once:!1}),this.logger.debug("Notifying mute state after selection"),s.muted?e.trackMuteCallback():e.trackUnmuteCallback()}}})}calculateMediaStreamConstraints(t,e,r,n){if(n&&this.listCachedDevicesOfKind(`${t}input`).length===1)return!0;let o={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?o.deviceId=e:o.deviceId={exact:e},r&&(o.groupId=r),n?o:t==="video"?(o.width={ideal:this.videoInputQualitySettings.videoWidth},o.height={ideal:this.videoInputQualitySettings.videoHeight},o.frameRate={ideal:this.videoInputQualitySettings.videoFrameRate},o):(this.supportSampleRateConstraint()&&(o.sampleRate={ideal:i.defaultSampleRate}),this.supportSampleSizeConstraint()&&(o.sampleSize={ideal:i.defaultSampleSize}),this.supportChannelCountConstraint()&&(o.channelCount={ideal:i.defaultChannelCount}),Object.assign({echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0},o))}getMediaStreamConstraintsFromTrackConstraints(t,e){return t==="audio"?{audio:e}:{video:e}}getMediaStreamConstraints(t,e,r=!1){let n={};if(!e)return null;let o=this.intrinsicDeviceAsMediaStream(e);if(o)return n.streamId=o.id,this.getMediaStreamConstraintsFromTrackConstraints(t,n);if(typeof e=="string"){let s="";return this.browserBehavior.requiresGroupIdMediaStreamConstraints()&&(this.deviceInfoCache!==null?s=this.getGroupIdFromDeviceId(t,e):this.logger.error("Device cache is not populated. Please make sure to call list devices first")),n=this.calculateMediaStreamConstraints(t,e,s,r),this.getMediaStreamConstraintsFromTrackConstraints(t,n)}return z4(e)?(n=this.calculateMediaStreamConstraints(t,e.deviceId,e.groupId,r),this.getMediaStreamConstraintsFromTrackConstraints(t,n)):(n=e,this.getMediaStreamConstraintsFromTrackConstraints(t,n))}deviceInfoFromDeviceId(t,e){if(this.deviceInfoCache===null)return null;for(let r of this.deviceInfoCache)if(r.kind===t&&r.deviceId===e)return r;return null}hasAppliedTransform(){return!!this.transform}isMediaStreamReusableByDeviceId(t,e){if(!t||!t.active||!e)return!1;if(e.id)return t.id===e.id;let r=this.getMediaTrackSettings(t);if(!r.deviceId)return!1;let n=i.getIntrinsicDeviceId(e);return typeof n=="string"?r.deviceId===n:!1}getMediaTrackSettings(t){var e;return(e=t.getTracks()[0])===null||e===void 0?void 0:e.getSettings()}reconnectAudioInputs(){if(!this.audioInputSourceNode)return;this.audioInputSourceNode.disconnect();let t=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(t)}setTransform(t,e){var r,n;(n=(r=this.transform)===null||r===void 0?void 0:r.nodes)===null||n===void 0||n.end.disconnect(),this.transform={nodes:e,device:t};let o=e?.end,s=this.getMediaStreamDestinationNode();this.logger.debug(`Connecting transform node ${o} to destination ${s}.`),o?.connect(s),this.reconnectAudioInputs()}removeTransform(){var t;let e=this.transform;if(e)return(t=this.transform.nodes)===null||t===void 0||t.end.disconnect(),this.transform=void 0,this.reconnectAudioInputs(),e}attachAudioInputStreamToAudioContext(t){var e;(e=this.audioInputSourceNode)===null||e===void 0||e.disconnect(),this.audioInputSourceNode=i.getAudioContext().createMediaStreamSource(t);let r=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(r)}getMediaStreamDestinationNode(){return this.audioInputDestinationNode||(this.audioInputDestinationNode=i.getAudioContext().createMediaStreamDestination()),this.audioInputDestinationNode}getMediaStreamOutputNode(){var t,e;return((e=(t=this.transform)===null||t===void 0?void 0:t.nodes)===null||e===void 0?void 0:e.start)||this.getMediaStreamDestinationNode()}static setDefaultLatencyHint(t){i.defaultLatencyHint=t}static getAudioContext(){if(!i.audioContext){let t={};navigator.mediaDevices.getSupportedConstraints().sampleRate&&(t.sampleRate=i.defaultSampleRate),new Rk.default().requiresPlaybackLatencyHintForAudioContext()&&(t.latencyHint="playback"),i.defaultLatencyHint&&(t.latencyHint=i.defaultLatencyHint),i.audioContext=new(window.AudioContext||window.webkitAudioContext)(t)}return i.audioContext}static suspendAudioContext(){return Ae(this,void 0,void 0,function*(){return i.audioContext?i.audioContext.suspend():Promise.resolve()})}static resumeAudioContext(){return Ae(this,void 0,void 0,function*(){return i.audioContext?i.audioContext.resume():Promise.resolve()})}static closeAudioContext(){if(i.audioContext)try{i.audioContext.close()}catch{}i.audioContext=null}addMediaStreamBrokerObserver(t){this.mediaStreamBrokerObservers.add(t)}removeMediaStreamBrokerObserver(t){this.mediaStreamBrokerObservers.delete(t)}publishVideoInputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.videoInputDidChange&&e.videoInputDidChange(t)}),this.pushVideoMeetingStateForPermissions(t)}publishAudioInputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.audioInputDidChange&&e.audioInputDidChange(t)}),this.pushAudioMeetingStateForPermissions(t)}publishAudioOutputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.audioOutputDidChange&&e.audioOutputDidChange(t)})}supportSampleRateConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleRate}supportSampleSizeConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleSize}supportChannelCountConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().channelCount}trace(t,e,r){let n=`API/DefaultDeviceController/${t}`;typeof e<"u"&&(n+=` ${JSON.stringify(e)}`),typeof r<"u"&&(n+=` -> ${JSON.stringify(r)}`),this.logger.info(n)}};rn.default=$t;$t.permissionDeniedOriginDetectionThresholdMs=500;$t.defaultVideoWidth=960;$t.defaultVideoHeight=540;$t.defaultVideoFrameRate=15;$t.defaultSampleRate=48e3;$t.defaultSampleSize=16;$t.defaultChannelCount=1;$t.audioContext=null;function z4(i){return typeof i=="object"&&"deviceId"in i&&"groupId"in i&&"kind"in i&&"label"in i}});var SS=y(nn=>{"use strict";var ju=nn&&nn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Vk=nn&&nn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(nn,"__esModule",{value:!0});var $4=Vk(We()),j4=Vk($u()),Wu=class i{constructor(t){this.logger=t}get mediaStream(){return this._mediaStream}set mediaStream(t){this._mediaStream=t}acquireAudioInputStream(){return ju(this,void 0,void 0,function*(){return this._mediaStream.getAudioTracks().length===0?(this.logger.info("No audio stream available. Synthesizing an audio stream."),j4.default.synthesizeAudioDevice(0)):this._mediaStream})}acquireVideoInputStream(){return ju(this,void 0,void 0,function*(){return this._mediaStream})}acquireDisplayInputStream(t){return ju(this,void 0,void 0,function*(){return t&&t.video&&t.video.mandatory&&t.video.mandatory.chromeMediaSource&&t.video.mandatory.chromeMediaSourceId?navigator.mediaDevices.getUserMedia(t):navigator.mediaDevices.getDisplayMedia(t)})}acquireScreenCaptureDisplayInputStream(t,e){return ju(this,void 0,void 0,function*(){return this.acquireDisplayInputStream(this.screenCaptureDisplayMediaConstraints(t,e))})}screenCaptureDisplayMediaConstraints(t,e){return{audio:!!(!t&&new $4.default().getDisplayMediaAudioCaptureSupport()),video:Object.assign(Object.assign({},!t&&{frameRate:{max:e||i.defaultFrameRate}}),t&&{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e||i.defaultFrameRate}})}}toggleMediaStream(t){let e=!1;if(this.mediaStream)for(let r=0;r<this.mediaStream.getTracks().length;r++)this.mediaStream.getTracks()[r].enabled!==t&&(this.mediaStream.getTracks()[r].enabled=t,e=!0);return e}cleanup(){if(this.mediaStream)for(let t=0;t<this.mediaStream.getTracks().length;t++)this.mediaStream.getTracks()[t].stop();this.mediaStream=null}muteLocalAudioInputStream(){throw new Error("unsupported")}unmuteLocalAudioInputStream(){throw new Error("unsupported")}addMediaStreamBrokerObserver(t){}removeMediaStreamBrokerObserver(t){}};nn.default=Wu;Wu.defaultFrameRate=15});var yS=y(on=>{"use strict";var W4=on&&on.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},G4=on&&on.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(on,"__esModule",{value:!0});var K4=G4(_e()),Gu=class extends K4.default{constructor(t){super(t.logger),this.context=t,this.taskName="CreatePeerConnectionTask",this.removeTrackAddedEventListener=null,this.removeTrackRemovedEventListeners={},this.trackEvents=["ended","mute","unmute","isolationchange","overconstrained"],this.removeVideoTrackEventListeners={},this.trackAddedHandler=e=>{let r=e.track;if(this.context.logger.info(`received track event: kind=${r.kind} id=${r.id} label=${r.label}`),e.transceiver&&e.transceiver.currentDirection==="inactive")return;if(e.streams.length===0){this.context.logger.warn("Track event but no stream");return}let n=e.streams[0];r.kind==="audio"?this.context.audioMixController.bindAudioStream(n):r.kind==="video"&&!this.trackIsVideoInput(r)&&this.addRemoteVideoTrack(r,n)}}removeObserver(){this.removeTrackAddedEventListener&&this.removeTrackAddedEventListener();for(let t in this.removeTrackRemovedEventListeners)this.removeTrackRemovedEventListeners[t]()}addPeerConnectionEventLogger(){let t=this.context.peer;t.addEventListener("connectionstatechange",()=>{this.context.logger.info(`peer connection state changed: ${t.connectionState}`)}),t.addEventListener("negotiationneeded",()=>{this.context.logger.info("peer connection negotiation is needed")}),t.addEventListener("icegatheringstatechange",()=>{this.context.logger.info(`peer connection ice gathering state changed: ${t.iceGatheringState}`)}),t.addEventListener("icecandidate",e=>{this.context.logger.info(`peer connection ice candidate: ${e.candidate?e.candidate.candidate:"(null)"}`)}),t.addEventListener("iceconnectionstatechange",()=>{this.context.logger.info(`peer connection ice connection state changed: ${t.iceConnectionState}`)})}run(){return W4(this,void 0,void 0,function*(){this.context.removableObservers.push(this);let e=this.context.turnCredentials&&this.context.turnCredentials.uris.length>0?{iceServers:[{urls:this.context.turnCredentials.uris,username:this.context.turnCredentials.username,credential:this.context.turnCredentials.password,credentialType:"password"}],iceTransportPolicy:"relay"}:{};e.bundlePolicy=this.context.browserBehavior.requiresBundlePolicy(),e.sdpSemantics="unified-plan",e.encodedInsertableStreams=this.context.audioProfile.hasRedundancyEnabled(),this.context.peer?this.context.logger.info("reusing peer connection"):(this.context.logger.info("creating new peer connection"),this.context.peer=new RTCPeerConnection(e),this.addPeerConnectionEventLogger()),this.removeTrackAddedEventListener=()=>{this.context.peer&&this.context.peer.removeEventListener("track",this.trackAddedHandler),this.removeTrackAddedEventListener=null},this.context.peer.addEventListener("track",this.trackAddedHandler)})}trackIsVideoInput(t){return this.context.transceiverController.useTransceivers()?(this.logger.debug(()=>"getting video track type"),this.context.transceiverController.trackIsVideoInput(t)):!1}addRemoteVideoTrack(t,e){var r;let n=e.id,o=this.context.videoStreamIndex.attendeeIdForTrack(n),s,a;if(this.context.videoTileController.getVideoTileForAttendeeId?(a=this.context.videoTileController.getVideoTileForAttendeeId(o),s=!!(!((r=a?.state())===null||r===void 0)&&r.boundVideoStream)):s=this.context.videoTileController.haveVideoTileForAttendeeId(o),s){this.context.logger.info(`Not adding remote track. Already have tile for attendeeId:  ${o}`);return}a||(a=this.context.videoTileController.addVideoTile(),this.logger.info(`Created video tile ${a.id()}`));let l=this.context.videoStreamIndex.streamIdForTrack(n);typeof l>"u"&&(this.logger.warn(`stream not found for tile=${a.id()} track=${n}`),l=null);let c=this.context.videoStreamIndex.groupIdForStreamId(l);c===void 0&&(c=null);for(let _=0;_<this.trackEvents.length;_++){let C=this.trackEvents[_],I=e.getVideoTracks();if(I&&I.length){let A=I[0],E=()=>{this.context.logger.info(`received the ${C} event for tile=${a.id()} id=${t.id} streamId=${l}`),C==="ended"&&this.removeRemoteVideoTrack(t,a.state())};A.addEventListener(C,E),this.removeVideoTrackEventListeners[t.id]||(this.removeVideoTrackEventListeners[t.id]=[]),this.removeVideoTrackEventListeners[t.id].push(()=>{A.removeEventListener(C,E)})}}let d,u;if(t.getSettings){let _=t.getSettings();d=_.width,u=_.height}else{let _=t.getCapabilities();d=_.width,u=_.height}let f=this.context.videoStreamIndex.externalUserIdForTrack(n);a.bindVideoStream(o,!1,e,d,u,l,f,c),this.logger.info(`video track added, use tile=${a.id()} track=${n} streamId=${l} groupId=${c}`);let m="removetrack",S=e,T=()=>this.removeRemoteVideoTrack(t,a.state());this.removeTrackRemovedEventListeners[t.id]=()=>{S.removeEventListener(m,T),delete this.removeTrackRemovedEventListeners[t.id]},S.addEventListener(m,T)}removeRemoteVideoTrack(t,e){if(this.removeTrackRemovedEventListeners.hasOwnProperty(t.id)){this.removeTrackRemovedEventListeners[t.id]();for(let r of this.removeVideoTrackEventListeners[t.id])r();delete this.removeVideoTrackEventListeners[t.id]}this.logger.info(`video track ended, removing tile=${e.tileId} id=${t.id} stream=${e.streamId}`),e.streamId?this.context.videosPaused.remove(e.streamId):this.logger.warn(`no stream found for tile=${e.tileId}`),this.context.videoTileController.removeVideoTile(e.tileId)}};on.default=Gu;Gu.REMOVE_HANDLER_INTERVAL_MS=1e4});var jt=y(is=>{"use strict";Object.defineProperty(is,"__esModule",{value:!0});is.MeetingSessionStatusCode=void 0;var Uk;(function(i){i[i.OK=0]="OK",i[i.Left=1]="Left",i[i.AudioJoinedFromAnotherDevice=2]="AudioJoinedFromAnotherDevice",i[i.AudioAuthenticationRejected=3]="AudioAuthenticationRejected",i[i.AudioCallAtCapacity=4]="AudioCallAtCapacity",i[i.MeetingEnded=5]="MeetingEnded",i[i.AudioInternalServerError=6]="AudioInternalServerError",i[i.AudioServiceUnavailable=7]="AudioServiceUnavailable",i[i.AudioDisconnected=8]="AudioDisconnected",i[i.VideoCallSwitchToViewOnly=9]="VideoCallSwitchToViewOnly",i[i.VideoCallAtSourceCapacity=10]="VideoCallAtSourceCapacity",i[i.SignalingBadRequest=11]="SignalingBadRequest",i[i.SignalingInternalServerError=12]="SignalingInternalServerError",i[i.SignalingRequestFailed=13]="SignalingRequestFailed",i[i.SignalingChannelClosedUnexpectedly=14]="SignalingChannelClosedUnexpectedly",i[i.ICEGatheringTimeoutWorkaround=15]="ICEGatheringTimeoutWorkaround",i[i.ConnectionHealthReconnect=16]="ConnectionHealthReconnect",i[i.RealtimeApiFailed=17]="RealtimeApiFailed",i[i.TaskFailed=18]="TaskFailed",i[i.IncompatibleSDP=19]="IncompatibleSDP",i[i.TURNCredentialsForbidden=20]="TURNCredentialsForbidden",i[i.NoAttendeePresent=21]="NoAttendeePresent",i[i.AudioAttendeeRemoved=22]="AudioAttendeeRemoved",i[i.AudioVideoWasRemovedFromPrimaryMeeting=23]="AudioVideoWasRemovedFromPrimaryMeeting",i[i.AudioVideoDisconnectedWhilePromoted=24]="AudioVideoDisconnectedWhilePromoted",i[i.AudioDisconnectAudio=25]="AudioDisconnectAudio"})(Uk=is.MeetingSessionStatusCode||(is.MeetingSessionStatusCode={}));is.default=Uk});var vS=y(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.SDPCandidateType=void 0;var qk;(function(i){i.Host="host",i.ServerReflexive="srflx",i.PeerReflexive="prflx",i.Relay="relay"})(qk=rs.SDPCandidateType||(rs.SDPCandidateType={}));rs.default=qk});var CS=y(wS=>{"use strict";Object.defineProperty(wS,"__esModule",{value:!0});var bS=class{};wS.default=bS});var sn=y(TS=>{"use strict";Object.defineProperty(TS,"__esModule",{value:!0});var dr=Oe(),_S=class i{constructor(t,e){this.codecName=t,this.codecCapability=e}equals(t){if(t===void 0||this.codecName!==t.codecName||this.codecCapability.mimeType!==t.codecCapability.mimeType||this.codecCapability.clockRate!==t.codecCapability.clockRate)return!1;let e=this.codecCapability.sdpFmtpLine?this.cleanupFmtpLine(this.codecCapability.sdpFmtpLine,this.codecName):"",r=t.codecCapability.sdpFmtpLine?this.cleanupFmtpLine(t.codecCapability.sdpFmtpLine,t.codecName):"";return e===r}fmtpLineMatches(t,e){let r=this.codecCapability.sdpFmtpLine;if(!r)return!1;let n=`a=fmtp:${e} `;if(!t.startsWith(n))return!1;let o=t.substring(n.length);return this.cleanupFmtpLine(o,this.codecName)===this.cleanupFmtpLine(r,this.codecName)}cleanupFmtpLine(t,e){let r=/;x-google-start-bitrate=\d+/g,n=t.replace(r,"");if(e==="H264"){let o=/profile-level-id=([0-9a-f]{4})[0-9a-f]{2}/i;n=n.replace(o,"profile-level-id=$1")}return n}static vp8(){return new i("VP8",{clockRate:9e4,mimeType:"video/VP8"})}static h264BaselineProfile(){return new i("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"})}static h264ConstrainedBaselineProfile(){return new i("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"})}static h264MainProfile(){return new i("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f"})}static h264HighProfile(){return new i("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f"})}static h264ConstrainedHighProfile(){return new i("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=640c1f"})}static h264(){return i.h264ConstrainedBaselineProfile()}static vp9Profile0(){return new i("VP9",{clockRate:9e4,mimeType:"video/VP9",sdpFmtpLine:"profile-id=0"})}static vp9(){return i.vp9Profile0()}static av1Main(){return new i("AV1",{clockRate:9e4,mimeType:"video/AV1"})}static av1(){return i.av1Main()}static fromSignaled(t){switch(t){case dr.SdkVideoCodecCapability.VP8:return i.vp8();case dr.SdkVideoCodecCapability.H264_BASELINE_PROFILE:return i.h264BaselineProfile();case dr.SdkVideoCodecCapability.H264_CONSTRAINED_BASELINE_PROFILE:return i.h264ConstrainedBaselineProfile();case dr.SdkVideoCodecCapability.H264_MAIN_PROFILE:return i.h264MainProfile();case dr.SdkVideoCodecCapability.H264_HIGH_PROFILE:return i.h264HighProfile();case dr.SdkVideoCodecCapability.H264_CONSTRAINED_HIGH_PROFILE:return i.h264ConstrainedHighProfile();case dr.SdkVideoCodecCapability.VP9_PROFILE_0:return i.vp9Profile0();case dr.SdkVideoCodecCapability.AV1_MAIN_PROFILE:return i.av1Main();default:return}}};TS.default=_S});var an=y(Za=>{"use strict";var ES=Za&&Za.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Za,"__esModule",{value:!0});var Ri=ES(vS()),J4=ES(CS()),Hk=ES(sn()),cr=class i{constructor(t){this.sdp=t}clone(){return new i(this.sdp)}static isRTPCandidate(t){let e=/candidate[:](\S+) (\d+)/g.exec(t);return!(e===null||e[2]!=="1")}static linesToSDP(t){return new i(t.join(i.CRLF))}static candidateTypeFromString(t){switch(t){case Ri.default.Host:return Ri.default.Host;case Ri.default.ServerReflexive:return Ri.default.ServerReflexive;case Ri.default.PeerReflexive:return Ri.default.PeerReflexive;case Ri.default.Relay:return Ri.default.Relay}return null}static candidateType(t){let e=/a[=]candidate[:].* typ ([a-z]+) /g.exec(t);return e===null?null:i.candidateTypeFromString(e[1])}static mediaType(t){let e=/m=(audio|video)/g.exec(t);if(e!==null)return e[1]}static mid(t){if(t.includes("a=mid:"))return t.replace(/^(a=mid:)/,"")}static direction(t){let e=/a=(sendrecv|sendonly|recvonly|inactive)/g.exec(t);if(e!==null)return e[1]}static splitLines(t){return t.trim().split(`
`).map(e=>e.trim())}static splitSections(t){return t.split(`
m=`).map((r,n)=>(n>0?"m="+r:r).trim()+i.CRLF)}static findActiveCameraSection(t){let e=0,r=!1;for(let n of t){if(/^m=video/.test(n)&&(n.indexOf("sendrecv")>-1||n.indexOf("sendonly")===-1&&n.indexOf("recvonly")===-1&&n.indexOf("inactive")===-1)){r=!0;break}e++}return r===!1&&(e=-1),e}static extractSSRCsFromFIDGroupLine(t){return/^a=ssrc-group:FID\s(.+)/.exec(t)[1]}static matchPrefix(t,e){return i.splitLines(t).filter(r=>r.indexOf(e)===0)}lines(){return this.sdp.split(i.CRLF)}hasVideo(){return/^m=video/gm.exec(this.sdp)!==null}hasCandidates(){return/a[=]candidate[:]/g.exec(this.sdp)!==null}hasCandidatesForAllMLines(){return!(this.sdp.indexOf("c=IN IP4 0.0.0.0")>-1)}withoutCandidateType(t){return i.linesToSDP(this.lines().filter(e=>i.candidateType(e)!==t))}withoutServerReflexiveCandidates(){return this.withoutCandidateType(Ri.default.ServerReflexive)}withAudioMaxAverageBitrate(t){if(!t)return this.clone();t=Math.trunc(Math.min(Math.max(t,i.rfc7587LowestBitrate),i.rfc7587HighestBitrate));let e=this.lines(),r=i.findOpusFmtpAttributes(e),n=i.updateOpusFmtpAttributes(e,r,[`maxaveragebitrate=${t}`]);return i.linesToSDP(n)}withStereoAudio(){let t=this.lines(),e=i.findOpusFmtpAttributes(t),r=i.updateOpusFmtpAttributes(t,e,["stereo=1","sprop-stereo=1"]);return i.linesToSDP(r)}static findOpusFmtpAttributes(t){let e=/^a=rtpmap:\s*(\d+)\s+opus\/48000/,r=!1,n=[];for(let o of t)if(o.startsWith("m=audio")&&(n.push(null),r=!0),o.startsWith("m=video")&&(r=!1),r){let s=e.exec(o);s!==null&&(n[n.length-1]=`a=fmtp:${s[1]} `)}return n}static updateOpusFmtpAttributes(t,e,r){let n=[],o=0,s=null;for(let a of t)if(a.startsWith("m=audio")&&(s=e[o],o++),a.startsWith("m=video")&&(s=null),s&&a.startsWith(s)){let l=a.slice(s.length).split(";"),c=[];for(let d of l)r.findIndex(f=>f.startsWith(d.split("=")[0]))<0&&c.push(d);for(let d of r)c.push(d);n.push(s+c.join(";"))}else n.push(a);return n}withUnifiedPlanFormat(){let t=this.sdp;return t.includes("mozilla")?this.clone():(t=t.replace("o=-","o=mozilla-chrome"),new i(t))}getUniqueRtpHeaderExtensionId(t){let e=[];for(let n of t)if(/^a=extmap:/.test(n.trim())){let s=+n.split("a=extmap:")[1].split(" ")[0];e.includes(s)||e.push(s)}e.sort((n,o)=>n-o);let r=0;for(let n of e){if(n-r>1)return r+1;r=n}return r===14?-1:r+1}withVideoLayersAllocationRtpHeaderExtension(t){return this.withRtpHeaderExtension(t,i.videoLayersAllocationRtpHeaderExtensionUrl)}withDependencyDescriptorRtpHeaderExtension(t){return this.withRtpHeaderExtension(t,i.dependencyDescriptorRtpHeaderExtensionUrl)}withoutDependencyDescriptorRtpHeaderExtension(){let t=i.splitLines(this.sdp).filter(e=>!e.includes(i.dependencyDescriptorRtpHeaderExtensionUrl));return new i(t.join(i.CRLF)+i.CRLF)}withRtpHeaderExtension(t,e){let r=t?t.getRtpHeaderExtensionId(e):-1,n=r===-1?this.getUniqueRtpHeaderExtensionId(i.splitLines(this.sdp)):r,o=i.splitSections(this.sdp),s=[];for(let l of o){if(/^m=video/.test(l)&&i.getRtpHeaderExtensionIdInSection(l,e)===-1){let c=i.splitLines(l),d=[];if(n===-1||this.hasRtpHeaderExtensionId(n)){s.push(l);continue}for(let u of c)if(d.push(u),/^a=sendrecv/.test(u.trim())){let f="a=extmap:"+n+" "+e;d.push(f)}l=d.join(i.CRLF)+i.CRLF}else if(r!==-1&&/^m=video/.test(l)&&i.getRtpHeaderExtensionIdInSection(l,e)!==r){let c=i.splitLines(l),d=[];for(let u of c){if(/^a=extmap:/.test(u.trim())&&u.split("a=extmap:")[1].split(" ")[1]===e){if(!this.hasRtpHeaderExtensionId(r)){let m="a=extmap:"+r+" "+e;d.push(m)}continue}d.push(u)}l=d.join(i.CRLF)+i.CRLF}s.push(l)}let a=s.join("");return new i(a)}ssrcForVideoSendingSection(){let t=this.sdp,e=i.splitSections(t);if(e.length<2)return"";let r=i.findActiveCameraSection(e);if(r===-1)return"";let n=i.matchPrefix(e[r],"a=ssrc-group:FID ");if(n.length<1)return"";let o=i.extractSSRCsFromFIDGroupLine(n[0]),[s]=o.split(" ").map(a=>parseInt(a,10));return s.toString()}videoSendSectionHasDifferentSSRC(t){let e=this.ssrcForVideoSendingSection(),r=t.ssrcForVideoSendingSection();if(e===""||r==="")return!1;let n=parseInt(e,10),o=parseInt(r,10);return n!==o}removeH264SupportFromSendSection(){let t=this.sdp,e=i.splitSections(t),r=i.findActiveCameraSection(e);if(r===-1)return new i(this.sdp);let n=e[r],o=i.splitLines(n),s=[],a=new Map;o.forEach(u=>{if(/^a=rtpmap:/.test(u)){let f=/^a=rtpmap:([0-9]+)\s/.exec(u);f&&u.toLowerCase().includes("h264")&&s.push(parseInt(f[1],10))}if(/^a=fmtp:/.test(u)){let f=/^a=fmtp:([0-9]+) apt=([0-9]+)/.exec(u);if(f&&f.length===3){let m=parseInt(f[1],10),S=parseInt(f[2],10);a.has(S)?a.get(S).push(m):a.set(S,[m])}}});let l=new Set;for(let u of s){l.add(u);let f=a.get(u);if(f)for(let m of f)l.add(m)}if(s.length>0){let u=o[0].split(" ");o[0]=u.filter(f=>!l.has(parseInt(f))).join(" ")}let c=o.filter(u=>{if(!u.includes("rtpmap")&&!u.includes("rtcp-fb")&&!u.includes("fmtp"))return!0;for(let f of l)if(u.includes(f.toString()))return!1;return!0});e[r]=c.join(i.CRLF)+i.CRLF;let d=e.join("");return new i(d)}mediaSections(){let t=i.splitSections(this.sdp);if(t.length<2)return[];let e=[];for(let r=1;r<t.length;r++){let n=new J4.default,o=i.splitLines(t[r]);for(let s of o){let a=i.mediaType(s);if(a!==void 0){n.mediaType=a;continue}let l=i.direction(s);if(l!==void 0){n.direction=l;continue}let c=i.mid(s);if(c!==void 0){n.mid=c;continue}}e.push(n)}return e}static getRtpHeaderExtensionIdInSection(t,e){let r=i.splitLines(t);for(let n of r)if(/^a=extmap:/.test(n.trim())){let o=n.split("a=extmap:")[1].split(" "),s=+o[0];if(o[1]===e)return s}return-1}getRtpHeaderExtensionId(t){let e=i.splitSections(this.sdp);for(let r of e)if(/^m=video/.test(r)){let n=i.getRtpHeaderExtensionIdInSection(r,t);if(n!==-1)return n}return-1}hasRtpHeaderExtensionId(t){let e=i.splitLines(this.sdp);for(let r of e)if(/^a=extmap:/.test(r.trim())&&+r.split("a=extmap:")[1].split(" ")[0]===t)return!0;return!1}withVideoSendCodecPreferences(t){let e=this.sdp,r=i.splitSections(e),n=i.findActiveCameraSection(r);if(n===-1)return new i(this.sdp);r[n]=this.sectionWithCodecPreferences(r[n],t);let o=r.join("");return new i(o)}sectionWithCodecPreferences(t,e){let r=new Map,n=i.splitLines(t);n.forEach(l=>{if(!l.startsWith("a=rtpmap:"))return;let c=/^a=rtpmap:(\d+)\s/.exec(l);if(!c)return;let d=c[1];for(let u of e){if(!l.includes(`${u.codecName}/${u.codecCapability.clockRate}`))continue;let f=!1;if(u.codecCapability.sdpFmtpLine!==void 0){let m=!1;for(let S of n){if(u.fmtpLineMatches(S,parseInt(d))){f=!0;break}m||(m=S.startsWith(`a=fmtp:${d} profile-id=`))}u.equals(Hk.default.vp9Profile0())&&!m&&(f=!0)}else f=!0;if(f){r.set(d,u);break}}});let o=new Set(r.keys()),s=n[0].split(" ").filter(l=>!o.has(l)),a=Array.from(r.entries()).sort(([l,c],[d,u])=>{let f=e.indexOf(c),m=e.indexOf(u);return f-m}).map(([l,c])=>l);return s.splice(3,0,...a),n[0]=s.join(" "),n.join(i.CRLF)+i.CRLF}highestPriorityVideoSendCodec(){let t=this.prioritizedSendVideoCodecCapabilities();return t.length>0?t[0]:void 0}prioritizedSendVideoCodecCapabilities(){let t=this.sdp,e=i.splitSections(t),r=i.findActiveCameraSection(e);if(r===-1)return[];let n=i.splitLines(e[r]),o=n[0].split(" ");return o.length<4?[]:o.slice(3).map(l=>this.videoCodecCapabilityForPayloadType(n,l)).filter(l=>l!==void 0&&["VP8","H264","VP9","AV1"].includes(l.codecName))}videoCodecCapabilityForPayloadType(t,e){let r,n,o;for(let s of t){let a=/^a=rtpmap:([0-9]+)\s/.exec(s);if(a&&a[1]===e){let c=s.split(" ")[1].split("/");c.length>=2&&(r=c[0],n=c[1])}s.startsWith(`a=fmtp:${e} `)&&(o=s.split(" ")[1])}if(r!==void 0)return new Hk.default(r,{clockRate:parseInt(n),mimeType:`video/${r}`,sdpFmtpLine:o})}getAudioPayloadTypes(){let t=new Map,e=this.sdp,r=i.splitSections(e);return t.set("opus",i.findAudioPayloadType("opus",r)),t.set("red",i.findAudioPayloadType("red",r)),t}static findAudioPayloadType(t,e){let r=`a=rtpmap:\\s*(\\d+)\\s+${t}\\/48000`,n=new RegExp(r);for(let o of e)if(/^m=audio/.test(o)){let s=n.exec(o);if(s!==null)return Number(s[1])}return 0}withStartingVideoSendBitrate(t){let e=i.splitSections(this.sdp),r=i.findActiveCameraSection(e);if(r===-1)return this;let n=i.splitLines(e[r]),o=[];for(let a of n)if(/^a=fmtp:\d*/.test(a)){let l=a+`;x-google-start-bitrate=${t}`;o.push(l)}else o.push(a);e[r]=o.join(i.CRLF)+i.CRLF;let s=e.join("");return new i(s)}};Za.default=cr;cr.CRLF=`\r
`;cr.rfc7587LowestBitrate=6e3;cr.rfc7587HighestBitrate=51e4;cr.dependencyDescriptorRtpHeaderExtensionUrl="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";cr.videoLayersAllocationRtpHeaderExtensionUrl="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00"});var kS=y(dn=>{"use strict";var zk=dn&&dn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},AS=dn&&dn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(dn,"__esModule",{value:!0});var Q4=AS(jt()),X4=AS(an()),Y4=AS(_e()),IS=class extends Y4.default{constructor(t){super(t.logger),this.context=t,this.taskName="CreateSDPTask"}cancel(){if(this.cancelPromise){let t=new Error(`canceling ${this.name()}`);this.cancelPromise(t),delete this.cancelPromise}}sessionUsesAudio(){var t,e;return!!(!((e=(t=this.context.meetingSessionConfiguration)===null||t===void 0?void 0:t.urls)===null||e===void 0)&&e.audioHostURL)}sessionUsesVideo(){let e;this.context.transceiverController.useTransceivers()?e=this.context.transceiverController.hasVideoInput():e=this.context.videoTileController.hasStartedLocalVideoTile();let r=!!this.context.videosToReceive&&!this.context.videosToReceive.empty(),n=e||r;return this.context.logger.info(`uses video: ${n} (enabled: true, sending: ${e}, receiving: ${r})`),n}run(){return zk(this,void 0,void 0,function*(){let t={offerToReceiveAudio:this.sessionUsesAudio(),offerToReceiveVideo:this.sessionUsesVideo()};this.logger.info(`peer connection offerOptions: ${JSON.stringify(t)}`),yield new Promise((e,r)=>zk(this,void 0,void 0,function*(){this.cancelPromise=n=>{r(n)};try{if(this.context.sdpOfferInit=yield this.context.peer.createOffer(t),this.context.logger.info("peer connection created offer"),this.context.previousSdpOffer&&new X4.default(this.context.sdpOfferInit.sdp).videoSendSectionHasDifferentSSRC(this.context.previousSdpOffer)){let n=new Error(`canceling ${this.name()} due to the meeting status code: ${Q4.default.IncompatibleSDP}`);this.context.previousSdpOffer=null,r(n);return}e()}catch(n){r(n)}finally{delete this.cancelPromise}}))})}};dn.default=IS});var OS=y(xS=>{"use strict";Object.defineProperty(xS,"__esModule",{value:!0});var MS=class{constructor(t,e,r,n,o,s){this.timestampMs=t,this.topic=e,this.data=r,this.senderAttendeeId=n,this.senderExternalUserId=o,this.throttled=!!s}text(){return new TextDecoder().decode(this.data)}json(){return JSON.parse(new TextDecoder().decode(this.data))}};xS.default=MS});var RS=y(cn=>{"use strict";var Z4=cn&&cn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},e6=cn&&cn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(cn,"__esModule",{value:!0});var $k=e6(nr()),PS=class{constructor(t,e,r,n=1e3,o=200){this.realtimeController=t,this.selfAttendeeId=e,this.hasBandwidthPriorityCallback=r,this.waitIntervalMs=n,this.updateIntervalMs=o,this.speakerScores={},this.speakerMuteState={},this.detectorCallbackToHandler=new Map,this.detectorCallbackToScoresTimer=new Map,this.detectorCallbackToActivityTimer=new Map,this.hasBandwidthPriority=!1,this.mostRecentUpdateTimestamp={}}needUpdate(t){return this.activeSpeakers?this.speakerScores[t]===0&&this.activeSpeakers.includes(t)||this.speakerScores[t]>0&&!this.activeSpeakers.includes(t):!0}updateActiveSpeakers(t,e,r){if(!this.needUpdate(r))return;let n=[],o=Object.keys(this.speakerScores);for(let d=0;d<o.length;d++){let u=o[d];n.push({attendeeId:u,activeScore:this.speakerScores[u]})}let s=n.sort((d,u)=>u.activeScore-d.activeScore).filter(function(d){return d.activeScore>0}).map(function(d){return d.attendeeId});this.activeSpeakers=s,e(s);let l=s.length>0&&s[0]===this.selfAttendeeId&&t.prioritizeVideoSendBandwidthForActiveSpeaker();this.hasBandwidthPriority!==l&&(this.hasBandwidthPriority=l,this.hasBandwidthPriorityCallback(l))}updateScore(t,e,r,n,o){let s=t.calculateScore(r,n,o);this.speakerScores[r]!==s&&(this.speakerScores[r]=s,this.mostRecentUpdateTimestamp[r]=Date.now(),this.updateActiveSpeakers(t,e,r))}subscribe(t,e,r,n){let o=(a,l)=>{if(!l){this.speakerScores[a]=0,this.mostRecentUpdateTimestamp[a]=Date.now(),this.updateActiveSpeakers(t,e,a);return}this.realtimeController.realtimeSubscribeToVolumeIndicator(a,(c,d,u,f)=>{this.mostRecentUpdateTimestamp[c]=Date.now(),u!==null&&(this.speakerMuteState[c]=u),this.updateScore(t,e,c,d,u)})};this.detectorCallbackToHandler.set(e,o);let s=new $k.default(this.updateIntervalMs);if(s.start(()=>{for(let a in this.speakerScores)Date.now()-this.mostRecentUpdateTimestamp[a]>this.waitIntervalMs&&this.updateScore(t,e,a,0,this.speakerMuteState[a])}),this.detectorCallbackToActivityTimer.set(e,s),r&&n){let a=new $k.default(n);a.start(()=>{r(this.speakerScores)}),this.detectorCallbackToScoresTimer.set(e,a)}this.realtimeController.realtimeSubscribeToAttendeeIdPresence(o)}unsubscribe(t){let e=this.detectorCallbackToHandler.get(t);this.detectorCallbackToHandler.delete(t),e&&this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(e);let r=this.detectorCallbackToActivityTimer.get(t);r&&(r.stop(),this.detectorCallbackToActivityTimer.delete(t));let n=this.detectorCallbackToScoresTimer.get(t);n&&(n.stop(),this.detectorCallbackToHandler.delete(t))}destroy(){return Z4(this,void 0,void 0,function*(){for(let t of this.detectorCallbackToHandler.values())this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t);for(let t of this.detectorCallbackToActivityTimer.values())t.stop();for(let t of this.detectorCallbackToScoresTimer.values())t.stop();this.detectorCallbackToHandler.clear(),this.detectorCallbackToActivityTimer.clear(),this.detectorCallbackToScoresTimer.clear()})}};cn.default=PS});var jk=y(NS=>{"use strict";Object.defineProperty(NS,"__esModule",{value:!0});var DS=class{constructor(t=.9,e=.01,r=.2,n=.2){this.speakerWeight=t,this.cutoffThreshold=e,this.silenceThreshold=r,this.takeoverRate=n,this.volumes={}}calculateScore(t,e,r){(r||e===null)&&(e=0),this.volumes.hasOwnProperty(t)||(this.volumes[t]=0),e>this.silenceThreshold?e=1:e=0;let n=this.volumes[t]*this.speakerWeight+e*(1-this.speakerWeight);this.volumes[t]=n;for(let o in this.volumes)o!==t&&(this.volumes[o]=Math.max(this.volumes[o]-this.takeoverRate*e,0));return n<this.cutoffThreshold?0:n}prioritizeVideoSendBandwidthForActiveSpeaker(){return!0}};NS.default=DS});var Ku=y(ln=>{"use strict";var lr=ln&&ln.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Wk=ln&&ln.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ln,"__esModule",{value:!0});var t6=Wk(We()),i6=Wk(wt()),LS=class{constructor(t){this.logger=t,this.audioDevice=null,this.audioElement=null,this.audioStream=null,this.browserBehavior=new t6.default,this.observers=new Set}bindAudioElement(t){return lr(this,void 0,void 0,function*(){if(!t)throw new Error(`Cannot bind audio element: ${t}`);return this.audioElement=t,this.audioElement.autoplay=!0,this.bindAudioMix()})}unbindAudioElement(){this.audioElement&&(this.audioElement.srcObject=null,this.audioElement=null,this.forEachObserver(t=>{this.audioStream&&t.meetingAudioStreamBecameInactive(this.audioStream)}))}bindAudioStream(t){return lr(this,void 0,void 0,function*(){if(t){this.audioStream=t;try{yield this.bindAudioMix()}catch(e){this.logger&&this.logger.warn(`Failed to bind audio stream: ${e}`)}}})}bindAudioDevice(t){return lr(this,void 0,void 0,function*(){if(t&&!this.browserBehavior.supportsSetSinkId())throw new Error("Cannot select audio output device. This browser does not support setSinkId.");return this.audioDevice=t,this.bindAudioMix()})}forEachObserver(t){for(let e of this.observers)i6.default.nextTick(()=>{t(e)})}bindAudioMix(){var t,e;return lr(this,void 0,void 0,function*(){if(!this.audioElement)return;let r=this.audioElement.srcObject;this.audioStream&&(this.audioElement.srcObject=this.audioStream),r!==this.audioStream&&this.forEachObserver(c=>{r&&c.meetingAudioStreamBecameInactive(r),this.audioStream&&c.meetingAudioStreamBecameActive(this.audioStream)});let n=((t=this.audioDevice)===null||t===void 0?void 0:t.deviceId)!==this.audioElement.sinkId;if(n&&typeof this.audioElement.sinkId>"u")throw new Error("Cannot select audio output device. This browser does not support setSinkId.");let o=this.audioDevice?this.audioDevice.deviceId:"",s=this.audioElement.sinkId;if(o===s)return;let a=this.audioElement,l=this.audioStream;if(this.browserBehavior.hasChromiumWebRTC()&&(a.srcObject=null),n)try{yield a.setSinkId(o)}catch(c){throw(e=this.logger)===null||e===void 0||e.error(`Failed to set sinkId for audio element: ${c}`),c}this.browserBehavior.hasChromiumWebRTC()&&(a.srcObject=l)})}getCurrentMeetingAudioStream(){return lr(this,void 0,void 0,function*(){return this.audioStream})}addAudioMixObserver(t){return lr(this,void 0,void 0,function*(){this.observers.add(t)})}removeAudioMixObserver(t){return lr(this,void 0,void 0,function*(){this.observers.delete(t)})}audioOutputDidChange(t){return lr(this,void 0,void 0,function*(){return this.logger.info("Receive an audio output change event"),this.bindAudioDevice(t)})}};ln.default=LS});var VS=y(BS=>{"use strict";Object.defineProperty(BS,"__esModule",{value:!0});var r6=_t(),FS=class{constructor(t,e,r,n,o){this.audioVideoController=t,this.realtimeController=e,this.connectionHealthData=r,this.pingPong=n,this.statsCollector=o,this.isActive=!1,this.hasSeenValidCandidatePairMetricsBefore=!1,this.lastTotalBytesReceived=0,this.lastTotalStunMessagesReceived=0,this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(s=>{this.isActive&&this.receiveSignalStrengthChange(s)})}start(){this.isActive=!0,this.pingPong.addObserver(this),this.pingPong.start(),this.audioVideoController.addObserver(this)}stop(){this.isActive=!1,this.pingPong.removeObserver(this),this.pingPong.stop(),this.audioVideoController.removeObserver(this)}receiveSignalStrengthChange(t){t===0?this.connectionHealthData.setLastNoSignalTimestampMs(Date.now()):t<=.5?this.connectionHealthData.setLastWeakSignalTimestampMs(Date.now()):this.connectionHealthData.setLastGoodSignalTimestampMs(Date.now()),this.updateConnectionHealth()}didReceivePong(t,e,r){this.connectionHealthData.setConsecutiveMissedPongs(0),this.statsCollector.logLatency("ping_pong",e),this.statsCollector.logLatency("ping_pong_clock_skew",r),this.updateConnectionHealth()}didMissPongs(){this.connectionHealthData.setConsecutiveMissedPongs(this.connectionHealthData.consecutiveMissedPongs+1),this.updateConnectionHealth()}metricsDidReceive(t){let e=0,r=0,n=t.getObservableMetrics(),o=n.audioPacketsReceived,s=n.audioPacketsReceivedFractionLoss,a=n.audioSpeakerDelayMs;typeof a=="number"&&!isNaN(a)&&this.connectionHealthData.setAudioSpeakerDelayMs(a);let l=t.getRTCStatsReport(),c=0,d=0;l.forEach(m=>{m.type==="candidate-pair"&&(m.bytesReceived&&(c+=m.bytesReceived),m.requestsReceived&&(d+=m.requestsReceived),m.responsesReceived&&(d+=m.responsesReceived))});let u=c-this.lastTotalBytesReceived;this.lastTotalBytesReceived=c;let f=d-this.lastTotalStunMessagesReceived;if(this.lastTotalStunMessagesReceived=d,typeof o=="number"&&typeof s=="number"){if(e=o,r=s,e<0||r<0||u<0||f<0)return}else return;this.addToMinuteWindow(this.connectionHealthData.packetsReceivedInLastMinute,e),this.addToMinuteWindow(this.connectionHealthData.fractionPacketsLostInboundInLastMinute,r),u>0||f>0?(this.hasSeenValidCandidatePairMetricsBefore=!0,this.connectionHealthData.setConsecutiveStatsWithNoPackets(0)):this.hasSeenValidCandidatePairMetricsBefore&&this.connectionHealthData.setConsecutiveStatsWithNoPackets(this.connectionHealthData.consecutiveStatsWithNoPackets+1),(e===0||r>0)&&this.connectionHealthData.setLastPacketLossInboundTimestampMs(Date.now()),typeof n.audioPacketsSent=="number"&&this.updateAudioPacketsSentInConnectionHealth(n.audioPacketsSent),this.updateVideoEncodingHealth(t),this.updateConnectionHealth()}updateAudioPacketsSentInConnectionHealth(t){t>0?this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(0):this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(this.connectionHealthData.consecutiveStatsWithNoAudioPacketsSent+1)}updateVideoEncodingHealth(t){let e=this.audioVideoController.videoTileController.hasStartedLocalVideoTile(),r=t.getVideoUpstreamSsrcs();if(!e||r.length===0){this.connectionHealthData.setIsVideoEncoderHardware(!1),this.connectionHealthData.setVideoEncodingTimePerFrameInMs(0),this.connectionHealthData.setCpuLimitationDuration(0),this.connectionHealthData.setVideoInputFps(0),this.connectionHealthData.setVideoEncodeFps(0);return}let n=!1,o=0,s=0,a=0,l=0;for(let d of r)n||(n=!!t.getObservableVideoMetricValue("videoUpstreamEncoderImplementation",d)),o+=t.getObservableVideoMetricValue("videoUpstreamTotalEncodeTimePerSecond",d),s+=t.getObservableVideoMetricValue("videoUpstreamCpuQualityLimitationDurationPerSecond",d),a+=t.getObservableVideoMetricValue("videoUpstreamFramesInputPerSecond",d),l+=t.getObservableVideoMetricValue("videoUpstreamFramesEncodedPerSecond",d);let c=l>0?o/l:0;this.connectionHealthData.setIsVideoEncoderHardware(!!n),this.connectionHealthData.setVideoEncodingTimeInMs(o),this.connectionHealthData.setVideoEncodingTimePerFrameInMs(c),this.connectionHealthData.setCpuLimitationDuration(s),this.connectionHealthData.setVideoInputFps(a),this.connectionHealthData.setVideoEncodeFps(l)}addToMinuteWindow(t,e){t.unshift(e),t.length>60&&t.pop()}updateConnectionHealth(){this.audioVideoController.forEachObserver(t=>{r6.Maybe.of(t.connectionHealthDidChange).map(e=>e.bind(t)(this.connectionHealthData.clone()))})}};BS.default=FS});var un=y(ed=>{"use strict";var n6=ed&&ed.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ed,"__esModule",{value:!0});var Gk=Oe(),L=n6(jt()),US=class i{constructor(t){this._statusCode=t}statusCode(){return this._statusCode}isFailure(){switch(this._statusCode){case L.default.AudioAuthenticationRejected:case L.default.AudioCallAtCapacity:case L.default.AudioInternalServerError:case L.default.AudioServiceUnavailable:case L.default.AudioDisconnected:case L.default.VideoCallAtSourceCapacity:case L.default.SignalingBadRequest:case L.default.SignalingInternalServerError:case L.default.SignalingRequestFailed:case L.default.ICEGatheringTimeoutWorkaround:case L.default.ConnectionHealthReconnect:case L.default.RealtimeApiFailed:case L.default.TaskFailed:case L.default.NoAttendeePresent:case L.default.SignalingChannelClosedUnexpectedly:return!0;default:return!1}}isTerminal(){switch(this._statusCode){case L.default.Left:case L.default.AudioJoinedFromAnotherDevice:case L.default.AudioAuthenticationRejected:case L.default.AudioCallAtCapacity:case L.default.MeetingEnded:case L.default.AudioDisconnected:case L.default.TURNCredentialsForbidden:case L.default.SignalingBadRequest:case L.default.SignalingRequestFailed:case L.default.VideoCallAtSourceCapacity:case L.default.RealtimeApiFailed:case L.default.AudioAttendeeRemoved:return!0;default:return!1}}isAudioConnectionFailure(){switch(this._statusCode){case L.default.AudioAuthenticationRejected:case L.default.AudioInternalServerError:case L.default.AudioServiceUnavailable:case L.default.ICEGatheringTimeoutWorkaround:case L.default.SignalingBadRequest:case L.default.SignalingInternalServerError:case L.default.SignalingRequestFailed:case L.default.RealtimeApiFailed:case L.default.NoAttendeePresent:return!0;default:return!1}}toString(){switch(this._statusCode){case L.default.OK:return"Everything is OK so far.";case L.default.Left:return"The attendee left the meeting.";case L.default.AudioJoinedFromAnotherDevice:return"The attendee joined from another device.";case L.default.AudioAuthenticationRejected:return"The meeting rejected the attendee.";case L.default.AudioCallAtCapacity:return"The attendee couldn't join because the meeting was at capacity.";case L.default.MeetingEnded:return"The meeting ended.";case L.default.AudioInternalServerError:case L.default.AudioServiceUnavailable:case L.default.AudioDisconnected:return"The audio connection failed.";case L.default.VideoCallSwitchToViewOnly:return"The attendee couldn't start the local video because the maximum video capacity was reached.";case L.default.VideoCallAtSourceCapacity:return"The connection failed due to an internal server error.";case L.default.SignalingBadRequest:case L.default.SignalingInternalServerError:case L.default.SignalingRequestFailed:return"The signaling connection failed.";case L.default.ICEGatheringTimeoutWorkaround:return"Gathering ICE candidates timed out. In Chrome, this might indicate that the browser is in a bad state after reconnecting to VPN.";case L.default.ConnectionHealthReconnect:return"The meeting was reconnected.";case L.default.RealtimeApiFailed:return"The real-time API failed. This status code might indicate that the callback you passed to the real-time API threw an exception.";case L.default.TaskFailed:return"The connection failed. See the error message for more details.";case L.default.IncompatibleSDP:return"The connection failed due to incompatible SDP.";case L.default.TURNCredentialsForbidden:return"The meeting ended, or the attendee was removed.";case L.default.NoAttendeePresent:return"The attendee was not present.";case L.default.AudioAttendeeRemoved:return"The meeting ended because attendee removed.";case L.default.AudioVideoWasRemovedFromPrimaryMeeting:return"The Primary meeting credentials provided are no longer valid. chime::DeleteAttendee may have been called on them.";case L.default.AudioVideoDisconnectedWhilePromoted:return"The client disconnected while promoted, which will automatically demote. The attendee must promote again to participate.";case L.default.AudioDisconnectAudio:return"The audio connection failed.";case L.default.SignalingChannelClosedUnexpectedly:return"The signaling channel was closed unexpectedly. This may be due to a network change or backend detected failure.";default:{let t=this._statusCode;throw new Error(`Unhandled case: ${t}`)}}}static fromSignalFrame(t){return t.error&&t.error.status?this.fromSignalingStatus(t.error.status):t.type===Gk.SdkSignalFrame.Type.AUDIO_STATUS?t.audioStatus?this.fromAudioStatus(t.audioStatus.audioStatus):new i(L.default.SignalingRequestFailed):t.type===Gk.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE?new i(L.default.AudioVideoWasRemovedFromPrimaryMeeting):new i(L.default.OK)}static fromAudioStatus(t){switch(t){case 200:return new i(L.default.OK);case 301:return new i(L.default.AudioJoinedFromAnotherDevice);case 302:return new i(L.default.AudioDisconnectAudio);case 403:return new i(L.default.AudioAuthenticationRejected);case 409:return new i(L.default.AudioCallAtCapacity);case 410:return new i(L.default.MeetingEnded);case 411:return new i(L.default.AudioAttendeeRemoved);case 500:return new i(L.default.AudioInternalServerError);case 503:return new i(L.default.AudioServiceUnavailable);default:switch(Math.floor(t/100)){case 2:return new i(L.default.OK);default:return new i(L.default.AudioDisconnected)}}}static fromSignalingStatus(t){switch(t){case 206:return new i(L.default.VideoCallSwitchToViewOnly);case 509:return new i(L.default.VideoCallAtSourceCapacity);case 403:return new i(L.default.AudioAuthenticationRejected);case 409:return new i(L.default.AudioCallAtCapacity);default:switch(Math.floor(t/100)){case 2:return new i(L.default.OK);case 4:return new i(L.default.SignalingBadRequest);case 5:return new i(L.default.SignalingInternalServerError);default:return new i(L.default.SignalingRequestFailed)}}}};ed.default=US});var Ju=y(HS=>{"use strict";Object.defineProperty(HS,"__esModule",{value:!0});var qS=class i{constructor(){this.remoteVideoAvailable=!1,this.canStartLocalVideo=!1}equal(t){return this.remoteVideoAvailable===t.remoteVideoAvailable&&this.canStartLocalVideo===t.canStartLocalVideo}clone(){let t=new i;return t.remoteVideoAvailable=this.remoteVideoAvailable,t.canStartLocalVideo=this.canStartLocalVideo,t}};HS.default=qS});var jS=y(td=>{"use strict";var $S=td&&td.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(td,"__esModule",{value:!0});var o6=$S(wt()),s6=$S(nr()),ur=$S(Ge()),ns=Oe(),Kk=_t(),zS=class{constructor(t,e,r){this.signalingClient=t,this.intervalMs=e,this.logger=r,this.observerQueue=new Set,this.consecutivePongsUnaccountedFor=0,this.intervalScheduler=new s6.default(this.intervalMs),this.pingId=0}addObserver(t){this.logger.info("adding a ping-pong observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing a ping-pong observer"),this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)o6.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}start(){this.stop(),this.signalingClient.registerObserver(this),this.signalingClient.ready()&&this.startPingInterval()}stop(){this.stopPingInterval(),this.signalingClient.removeObserver(this)}startPingInterval(){this.intervalScheduler.start(()=>{this.ping()}),this.ping()}stopPingInterval(){this.intervalScheduler.stop(),this.pingId=0,this.consecutivePongsUnaccountedFor=0}ping(){this.consecutivePongsUnaccountedFor>0&&(this.logger.warn(`missed pong ${this.consecutivePongsUnaccountedFor} time(s)`),this.forEachObserver(e=>{Kk.Maybe.of(e.didMissPongs).map(r=>r.bind(e)(this.consecutivePongsUnaccountedFor))})),this.consecutivePongsUnaccountedFor+=1,this.pingId=this.pingId+1&4294967295;let t=ns.SdkPingPongFrame.create();t.pingId=this.pingId,t.type=ns.SdkPingPongType.PING,this.pingTimestampLocalMs=this.signalingClient.pingPong(t),this.logger.debug(()=>`sent ping ${this.pingId}`)}pong(t){let e=ns.SdkPingPongFrame.create();e.pingId=t,e.type=ns.SdkPingPongType.PONG,this.signalingClient.pingPong(e)}handleSignalingClientEvent(t){switch(t.type){case ur.default.WebSocketOpen:this.startPingInterval();break;case ur.default.WebSocketFailed:case ur.default.WebSocketError:this.logger.warn(`stopped pinging (${ur.default[t.type]})`),this.stopPingInterval();break;case ur.default.WebSocketClosing:case ur.default.WebSocketClosed:this.logger.info(`stopped pinging (${ur.default[t.type]})`),this.stopPingInterval();break;case ur.default.ReceivedSignalFrame:if(t.message.type!==ns.SdkSignalFrame.Type.PING_PONG)break;if(t.message.pingPong.type===ns.SdkPingPongType.PONG){let e=t.message.pingPong.pingId;if(e!==this.pingId){this.logger.warn(`unexpected ping id ${e} (expected ${this.pingId})`);break}this.consecutivePongsUnaccountedFor=0;let r;if(typeof t.message.timestampMs=="number")r=t.message.timestampMs;else break;this.logger.debug(()=>`received pong ${e} with timestamp ${r}`);let o=t.timestampMs-this.pingTimestampLocalMs,s=Math.round(r-o/2),a=this.pingTimestampLocalMs-s;this.logger.info(`local clock skew estimate=${a}ms from ping-pong time=${o}ms`),this.forEachObserver(l=>{Kk.Maybe.of(l.didReceivePong).map(c=>c.bind(l)(e,a,o))})}else this.pong(t.message.pingPong.pingId);break}}};td.default=zS});var KS=y(GS=>{"use strict";Object.defineProperty(GS,"__esModule",{value:!0});var WS=class{};GS.default=WS});var XS=y(QS=>{"use strict";Object.defineProperty(QS,"__esModule",{value:!0});var JS=class{};QS.default=JS});var ey=y(ZS=>{"use strict";Object.defineProperty(ZS,"__esModule",{value:!0});var YS;(function(i){i.STARTED="started",i.INTERRUPTED="interrupted",i.RESUMED="resumed",i.STOPPED="stopped",i.FAILED="failed"})(YS||(YS={}));ZS.default=YS});var ry=y(iy=>{"use strict";Object.defineProperty(iy,"__esModule",{value:!0});var ty;(function(i){i.PRONUNCIATION="pronunciation",i.PUNCTUATION="punctuation"})(ty||(ty={}));iy.default=ty});var Qk=y(os=>{"use strict";var Qu=os&&os.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(os,"__esModule",{value:!0});os.TranscriptEventConverter=void 0;var fr=Oe(),a6=Qu(KS()),d6=Qu(XS()),id=Qu(ey()),Jk=Qu(ry()),c6={[fr.SdkTranscriptionStatus.Type.STARTED]:id.default.STARTED,[fr.SdkTranscriptionStatus.Type.INTERRUPTED]:id.default.INTERRUPTED,[fr.SdkTranscriptionStatus.Type.RESUMED]:id.default.RESUMED,[fr.SdkTranscriptionStatus.Type.STOPPED]:id.default.STOPPED,[fr.SdkTranscriptionStatus.Type.FAILED]:id.default.FAILED},ny=class{static from(t){let e;try{e=fr.SdkTranscriptFrame.decode(t.data)}catch(n){throw new Error("Cannot decode transcript data message: "+n)}let r=[];for(let n of e.events)if(n.status){let o=c6[n.status.type];if(!o)continue;let s=new d6.default;s.type=o,s.eventTimeMs=n.status.eventTime,s.transcriptionRegion=n.status.transcriptionRegion,s.transcriptionConfiguration=n.status.transcriptionConfiguration,n.status.message&&(s.message=n.status.message),r.push(s)}else if(n.transcript){let o=new a6.default;o.results=[];for(let s of n.transcript.results){let a={channelId:s.channelId,isPartial:s.isPartial,resultId:s.resultId,startTimeMs:s.startTime,endTimeMs:s.endTime,alternatives:[]};if(s.languageCode&&(a.languageCode=s.languageCode),s.languageIdentification&&s.languageIdentification.length>0){a.languageIdentification=[];for(let l of s.languageIdentification){let c={languageCode:l.languageCode,score:l.score};a.languageIdentification.push(c)}}for(let l of s.alternatives){let c={items:[],transcript:l.transcript};for(let d of l.items){let u={content:d.content,attendee:{attendeeId:d.speakerAttendeeId,externalUserId:d.speakerExternalUserId},startTimeMs:d.startTime,endTimeMs:d.endTime,type:null};switch(d.vocabularyFilterMatch&&(u.vocabularyFilterMatch=d.vocabularyFilterMatch),d.hasOwnProperty("stable")&&(u.stable=d.stable),d.hasOwnProperty("confidence")&&(u.confidence=d.confidence),d.type){case fr.SdkTranscriptItem.Type.PRONUNCIATION:u.type=Jk.default.PRONUNCIATION;break;case fr.SdkTranscriptItem.Type.PUNCTUATION:u.type=Jk.default.PUNCTUATION;break}c.items.push(u)}for(let d of l.entities){c.entities||(c.entities=[]);let u={category:d.category,confidence:d.confidence,content:d.content,startTimeMs:d.startTime,endTimeMs:d.endTime};d.type&&(u.type=d.type),c.entities.push(u)}a.alternatives.push(c)}o.results.push(a)}r.push(o)}return r}};os.TranscriptEventConverter=ny});var sy=y(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.TRANSCRIPTION_DATA_MESSAGE_TOPIC=void 0;var l6=Qk();fn.TRANSCRIPTION_DATA_MESSAGE_TOPIC="aws:chime:transcription";var oy=class{constructor(t){this.realtimeController=t,this.transcriptEventCallbacks=new Set}subscribeToTranscriptEvent(t){this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeSubscribeToReceiveDataMessage(fn.TRANSCRIPTION_DATA_MESSAGE_TOPIC,e=>{for(let r of l6.TranscriptEventConverter.from(e))for(let n of this.transcriptEventCallbacks)n(r)}),this.transcriptEventCallbacks.add(t)}unsubscribeFromTranscriptEvent(t){this.transcriptEventCallbacks.delete(t),this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(fn.TRANSCRIPTION_DATA_MESSAGE_TOPIC)}};fn.default=oy});var hr=y(Ve=>{"use strict";var u6=Ve&&Ve.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.iterateEvery=Ve.SuppressedError=Ve.getRandomValues=Ve.getFormattedOffset=Ve.getDefaultAssetSpec=Ve.toLowerCasePropertyNames=Ve.isIFramed=Ve.wait=void 0;var f6=u6(Vt());function h6(i){return new Promise(t=>setTimeout(t,i))}Ve.wait=h6;function p6(){var i;try{return((i=window.frameElement)===null||i===void 0?void 0:i.nodeName)==="IFRAME"||parent!==top}catch{return!0}}Ve.isIFramed=p6;function ay(i){return i===null?null:typeof i!="object"?i:Array.isArray(i)?i.map(ay):Object.keys(i).reduce((t,e)=>{let r=i[e],n=typeof r=="object"?ay(r):r;return t[e.toLowerCase()]=n,t},{})}Ve.toLowerCasePropertyNames=ay;function m6(){let i=f6.default.sdkVersionSemVer;return{assetGroup:`sdk-${i.major}.${i.minor}`}}Ve.getDefaultAssetSpec=m6;function g6(i){let t=Math.abs(i),e=i<=0?"+":"-",r=Math.floor(t/60).toString().padStart(2,"0"),n=Math.floor(t%60).toString().padStart(2,"0");return`${e}${r}:${n}`}Ve.getFormattedOffset=g6;function S6(i){try{window.crypto.getRandomValues(i)}catch{new DataView(i.buffer).setUint32(0,Math.trunc(Math.random()*Math.pow(2,32)),!0)}}Ve.getRandomValues=S6;var Xu=class extends Error{constructor(t,e,r){var n;super(r??`${(n=t?.message)!==null&&n!==void 0?n:t}`),this.error=t,this.suppressed=e}};Ve.SuppressedError=Xu;function y6(i,t){if(!i)return;let e;for(let r of i)try{t(r)}catch(n){e=new Xu(n,e)}if(e)throw e}Ve.iterateEvery=y6});var ly=y(cy=>{"use strict";Object.defineProperty(cy,"__esModule",{value:!0});var dy=class{constructor(){this.localAttendeeId=null,this.localExternalUserId=null,this.attendeeIdChangesCallbacks=[],this.canUnmute=!0,this.setCanUnmuteLocalAudioCallbacks=[],this.muted=!1,this.muteAndUnmuteLocalAudioCallbacks=[],this.volumeIndicatorState={},this.attendeeIdToExternalUserId={},this.volumeIndicatorCallbacks={},this.localSignalStrengthChangeCallbacks=[],this.fatalErrorCallbacks=[],this.sendDataMessageCallbacks=[],this.receiveDataMessageCallbacks=new Map}};cy.default=dy});var hy=y(fy=>{"use strict";Object.defineProperty(fy,"__esModule",{value:!0});var uy=class{constructor(){this.volume=null,this.muted=null,this.signalStrength=null}};fy.default=uy});var gy=y(rd=>{"use strict";var my=rd&&rd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(rd,"__esModule",{value:!0});var v6=my(sy()),b6=hr(),w6=my(ly()),Xk=my(hy()),py=class{constructor(t,e){this.mediaStreamBroker=t,this.state=new w6.default,this._transcriptionController=e||new v6.default(this)}realtimeSetLocalAttendeeId(t,e){this.state.localAttendeeId=t,this.state.localExternalUserId=e}realtimeSetAttendeeIdPresence(t,e,r,n,o){try{e&&(this.state.attendeeIdToExternalUserId[t]=r);for(let s of this.state.attendeeIdChangesCallbacks)s(t,e,r,n,o)}catch(s){this.onError(s)}}realtimeSubscribeToAttendeeIdPresence(t){try{this.state.attendeeIdChangesCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToAttendeeIdPresence(t){try{let e=this.state.attendeeIdChangesCallbacks.indexOf(t);e!==-1&&this.state.attendeeIdChangesCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSetCanUnmuteLocalAudio(t){try{if(this.state.canUnmute===t)return;this.state.canUnmute=t;for(let e of this.state.setCanUnmuteLocalAudioCallbacks)e(t)}catch(e){this.onError(e)}}realtimeSubscribeToSetCanUnmuteLocalAudio(t){try{this.state.setCanUnmuteLocalAudioCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToSetCanUnmuteLocalAudio(t){try{let e=this.state.setCanUnmuteLocalAudioCallbacks.indexOf(t);e!==-1&&this.state.setCanUnmuteLocalAudioCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeCanUnmuteLocalAudio(){return this.state.canUnmute}realtimeMuteLocalAudio(){if(!this.state.muted)try{this.setAudioInputEnabled(!1),this.state.muted=!0,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(let t of this.state.muteAndUnmuteLocalAudioCallbacks)t(!0)}catch(t){this.onError(t)}}realtimeUnmuteLocalAudio(){if(!this.state.muted)return!0;if(!this.state.canUnmute)return!1;try{this.setAudioInputEnabled(!0),this.state.muted=!1,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(let t of this.state.muteAndUnmuteLocalAudioCallbacks)t(!1);return!0}catch(t){return this.onError(t),!1}}realtimeSubscribeToMuteAndUnmuteLocalAudio(t){try{this.state.muteAndUnmuteLocalAudioCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t){try{let e=this.state.muteAndUnmuteLocalAudioCallbacks.indexOf(t);e!==-1&&this.state.muteAndUnmuteLocalAudioCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeIsLocalAudioMuted(){return this.state.muted}realtimeSubscribeToVolumeIndicator(t,e){try{this.state.volumeIndicatorCallbacks.hasOwnProperty(t)||(this.state.volumeIndicatorCallbacks[t]=[]),this.state.volumeIndicatorCallbacks[t].push(e),this.sendVolumeIndicatorChange(t,!0,!0,!0,this.state.attendeeIdToExternalUserId[t])}catch(r){this.onError(r)}}realtimeUnsubscribeFromVolumeIndicator(t,e){if(this.state.volumeIndicatorCallbacks[t])if(e){let n=this.state.volumeIndicatorCallbacks[t].indexOf(e);n>=0&&this.state.volumeIndicatorCallbacks[t].splice(n,1)}else delete this.state.volumeIndicatorCallbacks[t]}realtimeUpdateVolumeIndicator(t,e,r,n,o){try{r=this.applyLocalMuteOverride(t,r);let s=this.getVolumeIndicatorState(t),a=!1,l=!1,c=!1;r!==null&&s.muted!==r&&(s.muted=r,l=!0,s.muted&&s.volume!==0&&(s.volume=0,a=!0)),!s.muted&&e!==null&&(s.volume!==e&&(s.volume=e,a=!0),s.muted===null&&(s.muted=!1,l=!0)),n!==null&&s.signalStrength!==n&&(s.signalStrength=n,c=!0),this.sendVolumeIndicatorChange(t,a,l,c,o)}catch(s){this.onError(s)}}realtimeSubscribeToLocalSignalStrengthChange(t){try{if(this.state.localSignalStrengthChangeCallbacks.push(t),this.state.localAttendeeId===null)return;this.sendLocalSignalStrengthChange(this.state.localAttendeeId,!0)}catch(e){this.onError(e)}}realtimeUnsubscribeToLocalSignalStrengthChange(t){try{let e=this.state.localSignalStrengthChangeCallbacks.indexOf(t);e!==-1&&this.state.localSignalStrengthChangeCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSubscribeToSendDataMessage(t){try{this.state.sendDataMessageCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeFromSendDataMessage(t){try{let e=this.state.sendDataMessageCallbacks.indexOf(t);e!==-1&&this.state.sendDataMessageCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSendDataMessage(t,e,r){try{for(let n of this.state.sendDataMessageCallbacks)n(t,e,r)}catch(n){this.onError(n)}}realtimeSubscribeToReceiveDataMessage(t,e){try{this.state.receiveDataMessageCallbacks.has(t)?this.state.receiveDataMessageCallbacks.get(t).push(e):this.state.receiveDataMessageCallbacks.set(t,[e])}catch(r){this.onError(r)}}realtimeUnsubscribeFromReceiveDataMessage(t){try{this.state.receiveDataMessageCallbacks.delete(t)}catch(e){this.onError(e)}}realtimeReceiveDataMessage(t){try{b6.iterateEvery(this.state.receiveDataMessageCallbacks.get(t.topic),e=>{e(t)})}catch(e){Promise.reject(e)}}realtimeSubscribeToFatalError(t){try{this.state.fatalErrorCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToFatalError(t){try{let e=this.state.fatalErrorCallbacks.indexOf(t);e!==-1&&this.state.fatalErrorCallbacks.splice(e,1)}catch(e){this.onError(e)}}get transcriptionController(){return this._transcriptionController}setAudioInputEnabled(t){t?this.mediaStreamBroker.unmuteLocalAudioInputStream():this.mediaStreamBroker.muteLocalAudioInputStream()}applyLocalMuteOverride(t,e){let r=this.state.localAttendeeId,n=this.state.muted;return t!==r||!("activeDevices"in this.mediaStreamBroker&&this.mediaStreamBroker.activeDevices.audio)?e:n}sendVolumeIndicatorChange(t,e,r,n,o){if(this.sendLocalSignalStrengthChange(t,n),!this.state.volumeIndicatorCallbacks.hasOwnProperty(t))return;let s=this.getVolumeIndicatorState(t),a=new Xk.default;if(e&&(a.volume=s.volume),r&&(a.muted=s.muted),n&&(a.signalStrength=s.signalStrength),!this.stateIsEmpty(a))for(let l of this.state.volumeIndicatorCallbacks[t])l(t,a.volume,a.muted,a.signalStrength,o)}sendLocalSignalStrengthChange(t,e){if(!e||t!==this.state.localAttendeeId)return;let n=this.getVolumeIndicatorState(t).signalStrength;if(n!==null)for(let o of this.state.localSignalStrengthChangeCallbacks)o(n)}getVolumeIndicatorState(t){return this.state.volumeIndicatorState.hasOwnProperty(t)||(this.state.volumeIndicatorState[t]=new Xk.default),this.state.volumeIndicatorState[t]}stateIsEmpty(t){return t.volume===null&&t.muted===null&&t.signalStrength===null}onError(t){try{for(let e of this.state.fatalErrorCallbacks)e(t)}catch(e){try{console.error(t),console.error(e)}catch{}}}};rd.default=py});var Yu=y(ss=>{"use strict";Object.defineProperty(ss,"__esModule",{value:!0});ss.SessionStateControllerAction=void 0;var Yk;(function(i){i[i.Connect=0]="Connect",i[i.FinishConnecting=1]="FinishConnecting",i[i.Update=2]="Update",i[i.FinishUpdating=3]="FinishUpdating",i[i.Reconnect=4]="Reconnect",i[i.Disconnect=5]="Disconnect",i[i.Fail=6]="Fail",i[i.FinishDisconnecting=7]="FinishDisconnecting"})(Yk=ss.SessionStateControllerAction||(ss.SessionStateControllerAction={}));ss.default=Yk});var Sy=y(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});as.SessionStateControllerDeferPriority=void 0;var Zk;(function(i){i[i.DoNotDefer=0]="DoNotDefer",i[i.Low=1]="Low",i[i.Medium=2]="Medium",i[i.High=3]="High",i[i.VeryHigh=4]="VeryHigh"})(Zk=as.SessionStateControllerDeferPriority||(as.SessionStateControllerDeferPriority={}));as.default=Zk});var Zu=y(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.SessionStateControllerState=void 0;var eM;(function(i){i[i.NotConnected=0]="NotConnected",i[i.Connecting=1]="Connecting",i[i.Connected=2]="Connected",i[i.Updating=3]="Updating",i[i.Disconnecting=4]="Disconnecting"})(eM=ds.SessionStateControllerState||(ds.SessionStateControllerState={}));ds.default=eM});var ef=y(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.SessionStateControllerTransitionResult=void 0;var tM;(function(i){i[i.Transitioned=0]="Transitioned",i[i.NoTransitionAvailable=1]="NoTransitionAvailable",i[i.DeferredTransition=2]="DeferredTransition",i[i.TransitionFailed=3]="TransitionFailed"})(tM=cs.SessionStateControllerTransitionResult||(cs.SessionStateControllerTransitionResult={}));cs.default=tM});var by=y(vy=>{"use strict";Object.defineProperty(vy,"__esModule",{value:!0});var Ue=Yu(),ls=Sy(),Ce=Zu(),nd=ef(),yy=class{constructor(t){this.logger=t,this.currentState=Ce.SessionStateControllerState.NotConnected,this.deferredAction=null,this.deferredWork=null}perform(t,e){let r=this.currentState;if(r===Ce.SessionStateControllerState.NotConnected&&t===Ue.SessionStateControllerAction.Connect)this.transition(Ce.SessionStateControllerState.Connecting,t);else if(r===Ce.SessionStateControllerState.Connecting&&t===Ue.SessionStateControllerAction.Fail)this.transition(Ce.SessionStateControllerState.Disconnecting,t);else if(r===Ce.SessionStateControllerState.Connecting&&t===Ue.SessionStateControllerAction.FinishConnecting)this.transition(Ce.SessionStateControllerState.Connected,t);else if(r===Ce.SessionStateControllerState.Connected&&t===Ue.SessionStateControllerAction.Disconnect)this.transition(Ce.SessionStateControllerState.Disconnecting,t);else if(r===Ce.SessionStateControllerState.Connected&&t===Ue.SessionStateControllerAction.Reconnect)this.transition(Ce.SessionStateControllerState.Connecting,t);else if(r===Ce.SessionStateControllerState.Connected&&t===Ue.SessionStateControllerAction.Fail)this.transition(Ce.SessionStateControllerState.Disconnecting,t);else if(r===Ce.SessionStateControllerState.Connected&&t===Ue.SessionStateControllerAction.Update)this.transition(Ce.SessionStateControllerState.Updating,t);else if(r===Ce.SessionStateControllerState.Updating&&t===Ue.SessionStateControllerAction.Fail)this.transition(Ce.SessionStateControllerState.Disconnecting,t);else if(r===Ce.SessionStateControllerState.Updating&&t===Ue.SessionStateControllerAction.FinishUpdating)this.transition(Ce.SessionStateControllerState.Connected,t);else if(r===Ce.SessionStateControllerState.Disconnecting&&t===Ue.SessionStateControllerAction.FinishDisconnecting)this.transition(Ce.SessionStateControllerState.NotConnected,t);else return this.canDefer(t)?(this.logger.info(`deferring transition from ${Ce.SessionStateControllerState[this.currentState]} with ${Ue.SessionStateControllerAction[t]}`),this.deferAction(t,e),nd.SessionStateControllerTransitionResult.DeferredTransition):(this.logger.warn(`no transition found from ${Ce.SessionStateControllerState[this.currentState]} with ${Ue.SessionStateControllerAction[t]}`),nd.SessionStateControllerTransitionResult.NoTransitionAvailable);try{e()}catch(n){return this.logger.error(`error during state ${Ce.SessionStateControllerState[this.currentState]} with action ${Ue.SessionStateControllerAction[t]}: ${n}`),this.logger.info(`rolling back transition to ${Ce.SessionStateControllerState[r]}`),this.currentState=r,nd.SessionStateControllerTransitionResult.TransitionFailed}return this.performDeferredAction(),nd.SessionStateControllerTransitionResult.Transitioned}state(){return this.currentState}transition(t,e){this.logger.info(`transitioning from ${Ce.SessionStateControllerState[this.currentState]} to ${Ce.SessionStateControllerState[t]} with ${Ue.SessionStateControllerAction[e]}`),this.currentState=t}deferPriority(t){switch(t){case Ue.SessionStateControllerAction.Disconnect:return ls.SessionStateControllerDeferPriority.VeryHigh;case Ue.SessionStateControllerAction.Fail:return ls.SessionStateControllerDeferPriority.High;case Ue.SessionStateControllerAction.Reconnect:return ls.SessionStateControllerDeferPriority.Medium;case Ue.SessionStateControllerAction.Update:return ls.SessionStateControllerDeferPriority.Low;default:return ls.SessionStateControllerDeferPriority.DoNotDefer}}deferAction(t,e){this.deferredAction!==null&&this.deferPriority(this.deferredAction)>this.deferPriority(t)||(this.deferredAction=t,this.deferredWork=e)}canDefer(t){return this.deferPriority(t)!==ls.SessionStateControllerDeferPriority.DoNotDefer&&(this.currentState===Ce.SessionStateControllerState.Connecting||this.currentState===Ce.SessionStateControllerState.Updating)}performDeferredAction(){if(!this.deferredAction)return;let t=this.deferredAction,e=this.deferredWork;this.deferredAction=null,this.deferredWork=null,this.logger.info(`performing deferred action ${Ue.SessionStateControllerAction[t]}`),this.perform(t,e)!==nd.SessionStateControllerTransitionResult.Transitioned&&this.logger.info(`unable to perform deferred action ${Ue.SessionStateControllerAction[t]} in state ${Ce.SessionStateControllerState[this.currentState]}`)}};vy.default=yy});var od=y(us=>{"use strict";Object.defineProperty(us,"__esModule",{value:!0});us.VideoQualityAdaptationPreference=void 0;var iM;(function(i){i[i.Balanced=0]="Balanced",i[i.MaintainFramerate=1]="MaintainFramerate",i[i.MaintainResolution=2]="MaintainResolution"})(iM=us.VideoQualityAdaptationPreference||(us.VideoQualityAdaptationPreference={}));us.default=iM});var sd=y(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.WebSocketReadyState=void 0;var rM;(function(i){i[i.None=0]="None",i[i.Connecting=1]="Connecting",i[i.Open=2]="Open",i[i.Closing=3]="Closing",i[i.Closed=4]="Closed"})(rM=fs.WebSocketReadyState||(fs.WebSocketReadyState={}));fs.default=rM});var li=y(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.convertServerSideNetworkAdaptionEnumToSignaled=Et.convertServerSideNetworkAdaptionEnumFromSignaled=Et.serverSideNetworkAdaptionIsNoneOrDefault=Et.ServerSideNetworkAdaption=void 0;var pr=Oe(),Tt;(function(i){i[i.Default=0]="Default",i[i.None=1]="None",i[i.BandwidthProbing=2]="BandwidthProbing",i[i.BandwidthProbingAndRemoteVideoQualityAdaption=3]="BandwidthProbingAndRemoteVideoQualityAdaption"})(Tt=Et.ServerSideNetworkAdaption||(Et.ServerSideNetworkAdaption={}));Et.default=Tt;function C6(i){return i===Tt.None||i===Tt.Default}Et.serverSideNetworkAdaptionIsNoneOrDefault=C6;function _6(i){switch(i){case pr.SdkServerSideNetworkAdaption.DEFAULT:return Tt.Default;case pr.SdkServerSideNetworkAdaption.NONE:return Tt.None;case pr.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING:return Tt.BandwidthProbing;case pr.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION:return Tt.BandwidthProbingAndRemoteVideoQualityAdaption}}Et.convertServerSideNetworkAdaptionEnumFromSignaled=_6;function T6(i){switch(i){case Tt.Default:return pr.SdkServerSideNetworkAdaption.DEFAULT;case Tt.None:return pr.SdkServerSideNetworkAdaption.NONE;case Tt.BandwidthProbing:return pr.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING;case Tt.BandwidthProbingAndRemoteVideoQualityAdaption:return pr.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION}}Et.convertServerSideNetworkAdaptionEnumToSignaled=T6});var Cy=y(ad=>{"use strict";var E6=ad&&ad.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ad,"__esModule",{value:!0});var tf=E6(Ge()),wy=class{constructor(t,e,r,n,o){this.client=t,this.type=e,this.message=r,this.closeCode=n,this.closeReason=o,this.timestampMs=Date.now()}isConnectionTerminated(){switch(this.type){case tf.default.WebSocketFailed:case tf.default.WebSocketError:case tf.default.WebSocketClosing:case tf.default.WebSocketClosed:return!0;default:return!1}}};ad.default=wy});var Ty=y(cd=>{"use strict";var hn=cd&&cd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(cd,"__esModule",{value:!0});var I6=hn(We()),A6=hn(Ro()),ne=Oe(),nM=hr(),oM=hn(Vt()),_y=hn(od()),dd=hn(sd()),sM=li(),It=hn(Cy()),Le=hn(Ge()),hs=class i{constructor(t,e){this.webSocket=t,this.logger=e,this.unloadHandler=null,this.closeEventHandler=r=>{this.deactivatePageUnloadHandler(),this.resetConnection(),this.sendEvent(new It.default(this,Le.default.WebSocketClosed,null,r.code,r.reason)),this.serviceConnectionRequestQueue()},this.observerQueue=new Set,this.connectionRequestQueue=[],this.resetConnection(),this.logger.debug(()=>"signaling client init"),this.audioSessionId=this.generateNewAudioSessionId()}registerObserver(t){this.logger.debug(()=>"registering signaling client observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.debug(()=>"removing signaling client observer"),this.observerQueue.delete(t)}openConnection(t){this.logger.info("adding connection request to queue: "+t.url()),this.connectionRequestQueue.push(t),this.closeConnection()}pingPong(t){this.logger.debug(()=>"sending ping");let e=ne.SdkSignalFrame.create();return e.type=ne.SdkSignalFrame.Type.PING_PONG,e.pingPong=t,this.sendMessage(e),e.timestampMs}join(t){this.logger.info("sending join");let e=ne.SdkJoinFrame.create();e.protocolVersion=2,e.flags=ne.SdkJoinFlags.HAS_STREAM_UPDATE;let r=new I6.default,n={platformName:r.name(),platformVersion:r.version(),clientSource:oM.default.sdkName,chimeSdkVersion:oM.default.sdkVersion,clientUtcOffset:nM.getFormattedOffset(new Date().getTimezoneOffset())};if(t.applicationMetadata){let{appName:s,appVersion:a}=t.applicationMetadata;n.appName=s,n.appVersion=a}e.clientDetails=ne.SdkClientDetails.create(n),e.audioSessionId=this.audioSessionId,e.wantsCompressedSdp=i.CLIENT_SUPPORTS_COMPRESSION,e.disablePeriodicKeyframeRequestOnContentSender=t.disablePeriodicKeyframeRequestOnContentSender,e.serverSideNetworkAdaption=sM.convertServerSideNetworkAdaptionEnumToSignaled(t.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions=t.supportedServerSideNetworkAdaptions.map(sM.convertServerSideNetworkAdaptionEnumToSignaled),e.wantsAllTemporalLayersInIndex=t.wantsAllTemporalLayersInIndex;let o=ne.SdkSignalFrame.create();o.type=ne.SdkSignalFrame.Type.JOIN,o.join=e,this.sendMessage(o)}subscribe(t){let e=ne.SdkSubscribeFrame.create();if(e.sendStreams=[],e.sdpOffer=t.sdpOffer,t.connectionTypeHasVideo&&(e.receiveStreamIds=t.receiveStreamIds),t.audioHost&&(e.audioCheckin=t.audioCheckin,e.audioHost=t.audioHost,e.audioMuted=t.audioMuted,!t.audioCheckin)){let n=ne.SdkStreamDescriptor.create();n.mediaType=ne.SdkStreamMediaType.AUDIO,n.trackLabel="AmazonChimeExpressAudio",n.attendeeId=t.attendeeId,n.streamId=1,n.groupId=1,n.framerate=15,n.maxBitrateKbps=600,n.avgBitrateBps=4e5,e.sendStreams.push(n)}if(e.compressedSdpOffer=t.compressedSdpOffer,e.duplex=ne.SdkStreamServiceType.RX,t.localVideoEnabled){e.duplex=ne.SdkStreamServiceType.DUPLEX;for(let n=0;n<t.videoStreamDescriptions.length;n++){let o=t.videoStreamDescriptions[n].clone();o.attendeeId=t.attendeeId,e.sendStreams.push(o.toStreamDescriptor())}}t.videoSubscriptionConfiguration.length>0&&(e.videoSubscriptionConfiguration=t.videoSubscriptionConfiguration.map(this.convertSignalingClientVideoSubscriptionConfiguration));let r=ne.SdkSignalFrame.create();r.type=ne.SdkSignalFrame.Type.SUBSCRIBE,r.sub=e,this.sendMessage(r)}remoteVideoUpdate(t,e){let r=ne.SdkRemoteVideoUpdateFrame.create();r.addedOrUpdatedVideoSubscriptions=t.map(this.convertSignalingClientVideoSubscriptionConfiguration),r.removedVideoSubscriptionMids=e;let n=ne.SdkSignalFrame.create();n.type=ne.SdkSignalFrame.Type.REMOTE_VIDEO_UPDATE,n.remoteVideoUpdate=r,this.sendMessage(n)}convertSignalingClientVideoSubscriptionConfiguration(t){let e=new ne.SdkVideoSubscriptionConfiguration;switch(e.mid=t.mid,e.attendeeId=t.attendeeId,e.streamId=t.streamId,e.groupId=t.groupId,e.priority=t.priority,e.targetBitrateKbps=t.targetBitrateKbps,t.qualityAdaptationPreference){case _y.default.Balanced:e.qualityAdaptationPreference=ne.SdkVideoQualityAdaptationPreference.BALANCED;break;case _y.default.MaintainFramerate:e.qualityAdaptationPreference=ne.SdkVideoQualityAdaptationPreference.MAINTAIN_FRAMERATE;break;case _y.default.MaintainResolution:e.qualityAdaptationPreference=ne.SdkVideoQualityAdaptationPreference.MAINTAIN_RESOLUTION;break;default:e.qualityAdaptationPreference=ne.SdkVideoQualityAdaptationPreference.BALANCED}return e}leave(){let t=ne.SdkSignalFrame.create();t.type=ne.SdkSignalFrame.Type.LEAVE,t.leave=ne.SdkLeaveFrame.create(),this.sendMessage(t),this.logger.debug(()=>"sent leave")}sendClientMetrics(t){let e=ne.SdkSignalFrame.create();e.type=ne.SdkSignalFrame.Type.CLIENT_METRIC,e.clientMetric=t,this.sendMessage(e)}sendDataMessage(t){let e=ne.SdkSignalFrame.create();e.type=ne.SdkSignalFrame.Type.DATA_MESSAGE,e.dataMessage=t,this.sendMessage(e)}closeConnection(){var t,e;if(this.webSocket.readyState()!==dd.default.None&&this.webSocket.readyState()!==dd.default.Closed){this.isClosing=!0,this.sendEvent(new It.default(this,Le.default.WebSocketClosing,null));let r=new A6.default(i.CLOSE_EVENT_TIMEOUT_MS),n=o=>{var s,a;(a=(s=this.webSocket).removeEventListener)===null||a===void 0||a.call(s,"close",n),r.stop(),this.closeEventHandler(o)};(e=(t=this.webSocket).removeEventListener)===null||e===void 0||e.call(t,"close",this.closeEventHandler),this.webSocket.addEventListener("close",n),r.start(()=>{n(new CloseEvent("close",{wasClean:!1,code:1005,reason:"",bubbles:!1}))}),this.webSocket.close(),this.deactivatePageUnloadHandler()}else this.logger.info("no existing signaling client connection needs closing"),this.serviceConnectionRequestQueue()}ready(){return this.webSocket.readyState()===dd.default.Open&&!this.isClosing&&this.wasOpened}mute(t){let e=ne.SdkSignalFrame.create();e.type=ne.SdkSignalFrame.Type.AUDIO_CONTROL;let r=ne.SdkAudioControlFrame.create();r.muted=t,e.audioControl=r,this.sendMessage(e)}pause(t){let e=ne.SdkSignalFrame.create();e.type=ne.SdkSignalFrame.Type.PAUSE,e.pause=ne.SdkPauseResumeFrame.create(),e.pause.streamIds=t,this.sendMessage(e)}resume(t){let e=ne.SdkSignalFrame.create();e.type=ne.SdkSignalFrame.Type.RESUME,e.pause=ne.SdkPauseResumeFrame.create(),e.pause.streamIds=t,this.sendMessage(e)}resetConnection(){this.webSocket.destroy(),this.wasOpened=!1}sendMessage(t){t.timestampMs=Date.now(),this.logger.debug(()=>`sending: ${JSON.stringify(t)}`);let e=this.prependWithFrameTypeRTC(ne.SdkSignalFrame.encode(t).finish());if(this.ready()){if(!this.webSocket.send(e)){this.sendEvent(new It.default(this,Le.default.WebSocketSendMessageFailure,null));return}this.sendEvent(new It.default(this,Le.default.WebSocketSentMessage,null))}else this.sendEvent(new It.default(this,Le.default.WebSocketSkippedMessage,null))}receiveMessage(t){let e;try{e=ne.SdkSignalFrame.decode(t)}catch{this.logger.info(`failed to decode: ${t}`),this.sendEvent(new It.default(this,Le.default.ProtocolDecodeFailure,null));return}this.logger.debug(()=>`received: ${JSON.stringify(e)}`),this.webSocket.readyState()===dd.default.Open?this.sendEvent(new It.default(this,Le.default.ReceivedSignalFrame,e)):this.logger.info(`skipping notification of message since WebSocket is not open: ${JSON.stringify(e)}`)}stripFrameTypeRTC(t){let e=t[0];return e!==i.FRAME_TYPE_RTC&&e!==2&&this.logger.warn(`expected FrameTypeRTC for message but got ${e}`),t.slice(1)}prependWithFrameTypeRTC(t){let e=new Uint8Array(t.length+1);return e[0]=i.FRAME_TYPE_RTC,e.set(t,1),e}serviceConnectionRequestQueue(){if(this.connectionRequestQueue.length===0){this.logger.info("no connection requests to service");return}let t=this.connectionRequestQueue.shift();this.logger.info(`opening connection to ${t.url()}`),this.isClosing=!1,this.webSocket.create(t.url(),t.protocols()),this.setUpEventListeners(),this.sendEvent(new It.default(this,Le.default.WebSocketConnecting,null))}sendEvent(t){switch(t.type){case Le.default.WebSocketMessage:case Le.default.ReceivedSignalFrame:case Le.default.WebSocketSentMessage:this.logger.debug(()=>`notifying event: ${Le.default[t.type]}`);break;case Le.default.WebSocketSkippedMessage:this.logger.debug(()=>`notifying event: ${Le.default[t.type]}, websocket state=${dd.default[this.webSocket.readyState()]}`);break;case Le.default.WebSocketClosed:this.logger.info(`notifying event: ${Le.default[t.type]}, 
              code: ${t.closeCode} reason: ${t.closeReason}`);break;default:this.logger.info(`notifying event: ${Le.default[t.type]}`);break}for(let e of this.observerQueue)e.handleSignalingClientEvent(t)}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.activatePageUnloadHandler(),this.wasOpened=!0,this.sendEvent(new It.default(this,Le.default.WebSocketOpen,null))}),this.webSocket.addEventListener("message",t=>{this.sendEvent(new It.default(this,Le.default.WebSocketMessage,null)),this.receiveMessage(this.stripFrameTypeRTC(new Uint8Array(t.data)))}),this.webSocket.addEventListener("close",this.closeEventHandler),this.webSocket.addEventListener("error",()=>{if(this.isClosing&&!this.wasOpened){this.logger.info("Signaling WebSocket ignoring error closing while connecting");return}this.wasOpened?(this.logger.error("Signaling WebSocket received error while connected"),this.sendEvent(new It.default(this,Le.default.WebSocketError,null))):(this.logger.error("Signaling WebSocket received error while connecting"),this.sendEvent(new It.default(this,Le.default.WebSocketFailed,null)))})}activatePageUnloadHandler(){this.unloadHandler=()=>{this.leave()};let t=window;t.window&&t.window.addEventListener&&window.addEventListener("unload",this.unloadHandler)}deactivatePageUnloadHandler(){let t=window;t.window&&t.window.removeEventListener&&window.removeEventListener("unload",this.unloadHandler),this.unloadHandler=null}generateNewAudioSessionId(){let t=new Uint32Array(1);return nM.getRandomValues(t),t[0]}promoteToPrimaryMeeting(t){let e=ne.SdkMeetingSessionCredentials.create();e.attendeeId=t.attendeeId,e.externalUserId=t.externalUserId,e.joinToken=t.joinToken;let r=ne.SdkPrimaryMeetingJoinFrame.create();r.credentials=e;let n=ne.SdkSignalFrame.create();n.type=ne.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN,n.primaryMeetingJoin=r,this.sendMessage(n)}demoteFromPrimaryMeeting(){let t=ne.SdkPrimaryMeetingLeaveFrame.create(),e=ne.SdkSignalFrame.create();e.type=ne.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE,e.primaryMeetingLeave=t,this.sendMessage(e)}};cd.default=hs;hs.FRAME_TYPE_RTC=5;hs.CLOSE_EVENT_TIMEOUT_MS=2e3;hs.CLIENT_SUPPORTS_COMPRESSION=!0});var rf=y(Iy=>{"use strict";Object.defineProperty(Iy,"__esModule",{value:!0});var Ey=class{equals(t){return t!==void 0&&this.mid===t.mid&&this.attendeeId===t.attendeeId&&this.streamId===t.streamId&&this.groupId===t.groupId&&this.priority===t.priority&&this.targetBitrateKbps===t.targetBitrateKbps&&this.qualityAdaptationPreference===t.qualityAdaptationPreference}};Iy.default=Ey});var nf=y(ky=>{"use strict";Object.defineProperty(ky,"__esModule",{value:!0});var Ay=class{constructor(){this.currentTimestampMs=0,this.ssrc=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsExpected=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}};ky.default=Ay});var Oy=y(xy=>{"use strict";Object.defineProperty(xy,"__esModule",{value:!0});var My=class{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}};xy.default=My});var Py=y(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.MeetingSessionLifecycleEvent=void 0;var aM;(function(i){i[i.Connecting=0]="Connecting",i[i.Started=1]="Started",i[i.Stopped=2]="Stopped"})(aM=ps.MeetingSessionLifecycleEvent||(ps.MeetingSessionLifecycleEvent={}));ps.default=aM});var Ry=y(ms=>{"use strict";Object.defineProperty(ms,"__esModule",{value:!0});ms.MeetingSessionLifecycleEventCondition=void 0;var dM;(function(i){i[i.ConnectingNew=0]="ConnectingNew",i[i.ReconnectingExisting=1]="ReconnectingExisting",i[i.StartedNew=2]="StartedNew",i[i.StartedExisting=3]="StartedExisting",i[i.StartedAfterReconnect=4]="StartedAfterReconnect",i[i.StoppedCleanly=5]="StoppedCleanly",i[i.StoppedWithFailure=6]="StoppedWithFailure"})(dM=ms.MeetingSessionLifecycleEventCondition||(ms.MeetingSessionLifecycleEventCondition={}));ms.default=dM});var lM=y(gn=>{"use strict";var cM=gn&&gn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},ui=gn&&gn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(gn,"__esModule",{value:!0});var k6=ui(Sg()),pn=ui(Jo()),mr=ui(Xo()),M6=ui(nf()),x6=ui(Oy()),O6=ui(Py()),P6=ui(Ry()),R6=ui(nr()),mn=Oe(),D6=_t(),N6=ui(vu()),L6=ui(Su()),ld=class i{constructor(t,e,r=i.INTERVAL_MS){this.audioVideoController=t,this.logger=e,this.interval=r,this.intervalScheduler=null,this.redRecoveryMetricReport=new M6.default,this.lastRedRecoveryMetricReportConsumedTimestampMs=0,this.videoCodecDegradationHighEncodeCpuCount=0,this.videoCodecDegradationEncodeFailureCount=0,this.videoCodecDegradationConcurrentSendersCount=0,this.resolutionMap=new Map,this.metricsAddTime=(n,o,s)=>{},this.metricsLogEvent=(n,o)=>{}}toAttribute(t){return this.toSuffix(t).substring(1)}toSuffix(t){return t.toLowerCase()===t?`_${t}`:t.toUpperCase()===t?`_${t.toLowerCase()}`:t.replace(/([A-Z][a-z]+)/g,function(e){return`_${e}`}).replace(/([A-Z][A-Z]+)/g,function(e){return`_${e}`}).toLowerCase()}logLatency(t,e,r){let n=this.toSuffix(t);this.logEventTime("meeting"+n,e,r)}logStateTimeout(t,e){let r=this.toSuffix(t);this.logEvent("meeting_session_state_timeout",Object.assign(Object.assign({},e),{state:`state${r}`}))}logAudioEvent(t,e){let r="audio"+this.toSuffix(N6.default[t]);this.logEvent(r,e)}logVideoEvent(t,e){let r="video"+this.toSuffix(L6.default[t]);this.logEvent(r,e)}logEventTime(t,e,r={}){let n=Object.assign(Object.assign({},r),{call_id:this.audioVideoController.configuration.meetingId,client_type:i.CLIENT_TYPE,metric_type:"latency"});this.logger.debug(()=>`[StatsCollector] ${t}: ${JSON.stringify(n)}`),this.metricsAddTime(t,e,n)}logMeetingSessionStatus(t){let e=`${t.statusCode()}`;this.logEvent(e);let r={status:e,status_code:`${t.statusCode()}`};this.logEvent("meeting_session_status",r),t.isTerminal()&&this.logEvent("meeting_session_stopped",r),t.isAudioConnectionFailure()&&this.logEvent("meeting_session_audio_failed",r),t.isFailure()&&this.logEvent("meeting_session_failed",r)}logLifecycleEvent(t,e){let r={lifecycle_event:`lifecycle${this.toSuffix(O6.default[t])}`,lifecycle_event_code:`${t}`,lifecycle_event_condition:`condition${this.toSuffix(P6.default[e])}`,lifecycle_event_condition_code:`${e}`};this.logEvent("meeting_session_lifecycle",r)}logEvent(t,e={}){let r=Object.assign(Object.assign({},e),{call_id:this.audioVideoController.configuration.meetingId,client_type:i.CLIENT_TYPE});this.logger.debug(()=>`[StatsCollector] ${t}: ${JSON.stringify(r)}`),this.metricsLogEvent(t,r)}start(t,e){return this.intervalScheduler?!1:(this.logger.info("Starting StatsCollector"),this.signalingClient=t,this.videoStreamIndex=e,this.clientMetricReport=new k6.default(this.logger,this.videoStreamIndex,this.audioVideoController.configuration.credentials.attendeeId),this.intervalScheduler=new R6.default(this.interval),this.intervalScheduler.start(()=>cM(this,void 0,void 0,function*(){yield this.getStatsWrapper()})),!0)}stop(){this.logger.info("Stopping StatsCollector"),this.intervalScheduler&&this.intervalScheduler.stop(),this.intervalScheduler=null}videoTileResolutionDidChange(t,e,r){this.resolutionMap.set(t,{width:e,height:r})}videoTileUnbound(t){this.resolutionMap.delete(t)}updateMetricValues(t,e){let r=e?this.clientMetricReport.streamMetricReports[Number(t.ssrc)]:this.clientMetricReport.globalMetricReport,n;if(e){let o=r.mediaType,s=r.direction;n=this.clientMetricReport.getMetricMap(o,s),o===mr.default.VIDEO&&s===pn.default.DOWNSTREAM&&this.addRenderResolutionToVideoDownstreamMetrics(r,t.ssrc)}else n=this.clientMetricReport.getMetricMap();for(let o in t)o in n&&(typeof t[o]=="number"?(r.previousMetrics[o]=r.currentMetrics[o],r.currentMetrics[o]=t[o]):typeof t[o]=="string"?r.currentStringMetrics[o]=t[o]:typeof t[o]=="object"?(r.previousObjectMetrics[o]=r.currentObjectMetrics[o]===void 0?t[o]:r.currentObjectMetrics[o],r.currentObjectMetrics[o]=t[o]):this.logger.error(`Unknown metric value type ${typeof t[o]} for metric ${o}`))}processRawMetricReports(t){this.clientMetricReport.currentSsrcs={};let e=Date.now();for(let r of t){if(this.isVideoSourceMetricReport(r))continue;let n=this.isStreamRawMetricReport(r);if(n){let o=this.clientMetricReport.streamMetricReports[Number(r.ssrc)];if(o)o.mediaType===mr.default.VIDEO&&o.direction===pn.default.UPSTREAM?o.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(r.rid):o.streamId=this.videoStreamIndex.streamIdForSSRC(Number(r.ssrc));else{let s=new x6.default;s.mediaType=this.getMediaType(r),s.direction=this.getDirectionType(r),s.mediaType===mr.default.VIDEO&&s.direction===pn.default.UPSTREAM?s.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(r.rid):this.videoStreamIndex.allStreams().empty()||(s.streamId=this.videoStreamIndex.streamIdForSSRC(Number(r.ssrc)),this.videoStreamIndex.groupIdForSSRC!==void 0&&(s.groupId=this.videoStreamIndex.groupIdForSSRC(Number(r.ssrc)))),this.clientMetricReport.streamMetricReports[Number(r.ssrc)]=s}this.clientMetricReport.currentSsrcs[Number(r.ssrc)]=1}this.updateMetricValues(r,n)}this.clientMetricReport.removeDestroyedSsrcs(),this.clientMetricReport.previousTimestampMs=this.clientMetricReport.currentTimestampMs,this.clientMetricReport.currentTimestampMs=e,this.clientMetricReport.print()}addStreamMetricDimensionFrames(t,e){let r=this.clientMetricReport.getStreamDimensionMap();for(let n in e.currentStringMetrics)if(n in r){let o=mn.SdkStreamDimension.create();o.type=r[n];let s=mn.SdkDimensionValue.create();s.stringValue=e.currentStringMetrics[n],o.value=s,t.dimensions.push(o)}}addMetricFrame(t,e,r,n){let o=r.type,s=r.transform,a=r.source,l=e.streamMetricFrames.length,c=e.streamMetricFrames[l-1];if(o){let d=mn.SdkMetric.create();d.type=o,d.value=s(a||t,n),n?c.metrics.push(d):e.globalMetrics.push(d)}}addGlobalMetricsToProtobuf(t){let e=this.clientMetricReport.getMetricMap();for(let r in this.clientMetricReport.globalMetricReport.currentMetrics)this.addMetricFrame(r,t,e[r])}addStreamMetricsToProtobuf(t){for(let e in this.clientMetricReport.streamMetricReports){let r=this.clientMetricReport.streamMetricReports[e],n=mn.SdkStreamMetricFrame.create();n.streamId=r.streamId,n.mediaType=r.mediaType===mr.default.AUDIO?mn.SdkStreamMediaType.AUDIO:mn.SdkStreamMediaType.VIDEO,n.metrics=[],this.addStreamMetricDimensionFrames(n,r),t.streamMetricFrames.push(n);let o=this.clientMetricReport.getMetricMap(r.mediaType,r.direction);for(let s in o)this.hasMetricDependenciesInReport(s,r)&&this.addMetricFrame(s,t,o[s],Number(e))}}hasMetricDependenciesInReport(t,e){return t==="decoderLoss"&&e.currentMetrics.concealedSamples!==void 0&&e.currentMetrics.totalSamplesReceived!==void 0||t==="jitterBufferMs"&&e.currentMetrics.jitterBufferDelay!==void 0&&e.currentMetrics.jitterBufferEmittedCount!==void 0||t in e.currentMetrics||t in e.currentStringMetrics||t in e.currentObjectMetrics}makeClientMetricProtobuf(){let t=mn.SdkClientMetricFrame.create();return t.globalMetrics=[],t.streamMetricFrames=[],this.addGlobalMetricsToProtobuf(t),this.addStreamMetricsToProtobuf(t),t}sendClientMetricProtobuf(t){this.signalingClient.sendClientMetrics(t)}isStreamRawMetricReport(t){return["inbound-rtp","inbound-rtp-red","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp"].includes(t.type)||this.isVideoSourceMetricReport(t)}getMediaType(t){return t.kind==="audio"?mr.default.AUDIO:mr.default.VIDEO}getDirectionType(t){let{type:e}=t;return e==="inbound-rtp"||e==="remote-outbound-rtp"||e==="inbound-rtp-red"?pn.default.DOWNSTREAM:pn.default.UPSTREAM}isValidStandardRawMetric(t){return t.type==="inbound-rtp"||t.type==="inbound-rtp-red"||t.type==="outbound-rtp"||t.type==="remote-inbound-rtp"||t.type==="remote-outbound-rtp"||t.type==="candidate-pair"&&t.state==="succeeded"||t.type==="media-source"}isValidSsrc(t){let e=!0;return this.isStreamRawMetricReport(t)&&this.getDirectionType(t)===pn.default.DOWNSTREAM&&this.getMediaType(t)===mr.default.VIDEO&&(e=this.videoStreamIndex.streamIdForSSRC(Number(t.ssrc))>0),e}isValidRawMetricReport(t){return this.isValidStandardRawMetric(t)&&this.isValidSsrc(t)}filterRawMetricReports(t){let e=[];for(let r of t)this.isValidRawMetricReport(r)&&e.push(r);return e}handleRawMetricReports(t){let e=this.filterRawMetricReports(t);this.logger.debug(()=>`Filtered raw metrics : ${JSON.stringify(e)}`);let r=[];this.maybeAddRedRecoveryMetrics(r);let n=this.getVideoUpstreamSsrcFromRawMetricReports(e);n!==null&&this.addVideoCodecDegradationMetrics(r,n),this.clientMetricReport.customStatsReports=r,e.push(...r),this.processRawMetricReports(e),this.updateVideoSourceMetrics(e);let o=this.makeClientMetricProtobuf();this.sendClientMetricProtobuf(o),this.audioVideoController.forEachObserver(s=>{D6.Maybe.of(s.metricsDidReceive).map(a=>a.bind(s)(this.clientMetricReport.clone()))})}getStatsWrapper(){return cM(this,void 0,void 0,function*(){if(!this.audioVideoController.rtcPeerConnection)return;let t=[];try{let e=yield this.audioVideoController.rtcPeerConnection.getStats();this.clientMetricReport.rtcStatsReport=e,e.forEach(r=>{t.push(r)}),this.handleRawMetricReports(t)}catch(e){this.logger.error(e.message)}})}overrideObservableMetric(t,e){this.clientMetricReport.overrideObservableMetric(t,e)}recoveryMetricsDidReceive(t){this.redRecoveryMetricReport=t}maybeAddRedRecoveryMetrics(t){this.redRecoveryMetricReport.currentTimestampMs!==this.lastRedRecoveryMetricReportConsumedTimestampMs&&(t.push({kind:"audio",type:"inbound-rtp-red",ssrc:this.redRecoveryMetricReport.ssrc,timestamp:this.redRecoveryMetricReport.currentTimestampMs,totalAudioPacketsLost:this.redRecoveryMetricReport.totalAudioPacketsLost,totalAudioPacketsExpected:this.redRecoveryMetricReport.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.redRecoveryMetricReport.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.redRecoveryMetricReport.totalAudioPacketsRecoveredFec}),this.lastRedRecoveryMetricReportConsumedTimestampMs=this.redRecoveryMetricReport.currentTimestampMs)}videoCodecDegradationHighEncodeCpuDidReceive(){this.videoCodecDegradationHighEncodeCpuCount+=1}videoCodecDegradationEncodeFailureDidReceive(){this.videoCodecDegradationEncodeFailureCount+=1}videoCodecDegradationConcurrentSendersDidReceive(){this.videoCodecDegradationConcurrentSendersCount+=1}addVideoCodecDegradationMetrics(t,e){t.push({kind:"video",type:"outbound-rtp",ssrc:e,timestamp:Date.now(),videoCodecDegradationHighEncodeCpu:this.videoCodecDegradationHighEncodeCpuCount,videoCodecDegradationEncodeFailure:this.videoCodecDegradationEncodeFailureCount,videoCodecDegradationConcurrentSenders:this.videoCodecDegradationConcurrentSendersCount}),this.videoCodecDegradationHighEncodeCpuCount=0,this.videoCodecDegradationEncodeFailureCount=0,this.videoCodecDegradationConcurrentSendersCount=0}getVideoUpstreamSsrcFromRawMetricReports(t){for(let e of t)if(this.isStreamRawMetricReport(e)&&this.getMediaType(e)===mr.default.VIDEO&&this.getDirectionType(e)===pn.default.UPSTREAM)return e.ssrc;return null}isVideoSourceMetricReport(t){return t.type==="media-source"&&t.kind==="video"}addRenderResolutionToVideoDownstreamMetrics(t,e){let r=this.videoStreamIndex.streamIdForSSRC(Number(e)),n=this.videoStreamIndex.attendeeIdForStreamId(r);if(r===void 0||n===""){this.logger.warn(`No attendee found for ssrc ${e}`);return}this.resolutionMap.has(n)&&(t.currentMetrics.videoRenderWidth=this.resolutionMap.get(n).width,t.currentMetrics.videoRenderHeight=this.resolutionMap.get(n).height)}updateVideoSourceMetrics(t){for(let e of t)if(this.isVideoSourceMetricReport(e)){let r=this.clientMetricReport.getVideoUpstreamSsrcs();if(r.length===0){this.logger.warn("No video upstream ssrcs found");return}for(let n of r)this.clientMetricReport.streamMetricReports[n].currentMetrics.videoInputWidth=e.width,this.clientMetricReport.streamMetricReports[n].currentMetrics.videoInputHeight=e.height}}};gn.default=ld;ld.INTERVAL_MS=1e3;ld.CLIENT_TYPE="amazon-chime-sdk-js"});var Ny=y(Sn=>{"use strict";var F6=Sn&&Sn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Dy=Sn&&Sn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Sn,"__esModule",{value:!0});var B6=Dy(jt()),of=Dy(an()),V6=Dy(_e()),sf=class i extends V6.default{constructor(t,e=i.CHROME_VPN_TIMEOUT_MS){super(t.logger),this.context=t,this.chromeVpnTimeoutMs=e,this.taskName="FinishGatheringICECandidatesTask"}removeEventListener(){this.context.peer&&(this.context.peer.removeEventListener("icecandidate",this.context.iceCandidateHandler),this.context.turnCredentials||this.context.peer.removeEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler))}cancel(){let t;this.context.browserBehavior.requiresIceCandidateGatheringTimeoutWorkaround()&&this.chromeVpnTimeoutMs<this.context.meetingSessionConfiguration.connectionTimeoutMs&&Date.now()-this.startTimestampMs>this.chromeVpnTimeoutMs&&(t=new Error(`canceling ${this.name()} due to the meeting status code: ${B6.default.ICEGatheringTimeoutWorkaround}`)),this.cancelPromise&&(t=t||new Error(`canceling ${this.name()}`),this.cancelPromise(t),delete this.cancelPromise)}run(){return F6(this,void 0,void 0,function*(){if(this.context.peer||this.logAndThrow("session does not have peer connection; bypass ice gathering"),this.context.browserBehavior.requiresCheckForSdpConnectionAttributes()){if(new of.default(this.context.peer.localDescription.sdp).hasCandidatesForAllMLines()){this.context.logger.info(`ice gathering already complete; bypass gathering, current local description ${this.context.peer.localDescription.sdp}`);return}}else this.context.logger.info(`iOS device does not require checking for connection attributes in SDP, current local description ${this.context.peer.localDescription.sdp}`);if((this.context.browserBehavior.hasFirefoxWebRTC()||this.context.peer.iceGatheringState==="complete")&&new of.default(this.context.peer.localDescription.sdp).hasCandidates()){this.context.logger.info("ice gathering state is complete and candidates are in SDP; bypass gathering");return}try{yield new Promise((t,e)=>{this.cancelPromise=r=>{this.removeEventListener(),e(r)},this.context.turnCredentials||(this.context.iceGatheringStateEventHandler=()=>{if(this.context.peer.iceGatheringState==="complete"){this.removeEventListener(),t(),delete this.cancelPromise;return}},this.context.peer.addEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler)),this.context.iceCandidateHandler=r=>{if(this.context.logger.info(`ice candidate: ${r.candidate?r.candidate.candidate:"(null)"} state: ${this.context.peer.iceGatheringState}`),r.candidate&&(of.default.isRTPCandidate(r.candidate.candidate)&&this.context.iceCandidates.push(r.candidate),this.context.turnCredentials&&this.context.iceCandidates.length>=1)){this.context.logger.info("gathered at least one relay candidate"),this.removeEventListener(),t(),delete this.cancelPromise;return}this.context.peer.iceGatheringState==="complete"&&(this.context.logger.info("done gathering ice candidates"),this.removeEventListener(),!new of.default(this.context.peer.localDescription.sdp).hasCandidates()||this.context.iceCandidates.length===0?(e(new Error("no ice candidates were gathered")),delete this.cancelPromise):(t(),delete this.cancelPromise))},this.context.peer.addEventListener("icecandidate",this.context.iceCandidateHandler),this.startTimestampMs=Date.now()})}catch(t){throw t}finally{this.startTimestampMs&&(this.context.iceGatheringDurationMs=Math.round(Date.now()-this.startTimestampMs))}})}};Sn.default=sf;sf.CHROME_VPN_TIMEOUT_MS=5e3});var By=y(Fy=>{"use strict";Object.defineProperty(Fy,"__esModule",{value:!0});var Ly=class{constructor(){this.username=null,this.password=null,this.ttl=null,this.uris=null}};Fy.default=Ly});var Uy=y(ud=>{"use strict";var U6=ud&&ud.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ud,"__esModule",{value:!0});var q6=U6(li()),Vy=class{constructor(t){this.applicationMetadata=t,this.serverSideNetworkAdaption=q6.default.Default,this.supportedServerSideNetworkAdaptions=[],this.wantsAllTemporalLayersInIndex=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1}};ud.default=Vy});var Hy=y(mt=>{"use strict";var H6=mt&&mt.__createBinding||(Object.create?(function(i,t,e,r){r===void 0&&(r=e),Object.defineProperty(i,r,{enumerable:!0,get:function(){return t[e]}})}):(function(i,t,e,r){r===void 0&&(r=e),i[r]=t[e]})),z6=mt&&mt.__setModuleDefault||(Object.create?(function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}):function(i,t){i.default=t}),$6=mt&&mt.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var e in i)e!=="default"&&Object.prototype.hasOwnProperty.call(i,e)&&H6(t,i,e);return z6(t,i),t},j6=mt&&mt.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},gs=mt&&mt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(mt,"__esModule",{value:!0});var uM=gs(un()),af=gs(jt()),W6=gs(By()),fM=$6(li()),hM=gs(Ge()),G6=gs(Uy()),pM=Oe(),K6=gs(_e()),qy=class extends K6.default{constructor(t){super(t.logger),this.context=t,this.taskName="JoinAndReceiveIndexTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return j6(this,void 0,void 0,function*(){let t=yield new Promise((e,r)=>{let n=this.context;n.turnCredentials=null;class o{constructor(c){this.signalingClient=c}cancel(){this.signalingClient.removeObserver(this),r(new Error("JoinAndReceiveIndexTask got canceled while waiting for SdkIndexFrame"))}handleSignalingClientEvent(c){if(c.type===hM.default.WebSocketClosed){let u=`The signaling connection was closed with code ${c.closeCode} and reason: ${c.closeReason}`;n.logger.warn(u);let f=af.default.SignalingBadRequest;c.closeCode===4410?(u="The meeting already ended.",n.logger.warn(u),f=af.default.MeetingEnded):c.closeCode>=4500&&c.closeCode<4600&&(f=af.default.SignalingInternalServerError),n.audioVideoController.handleMeetingSessionStatus(new uM.default(f),new Error(u));return}if(c.type!==hM.default.ReceivedSignalFrame)return;if(c.message.type===pM.SdkSignalFrame.Type.JOIN_ACK){let u=c.message.joinack;if(!u){n.audioVideoController.handleMeetingSessionStatus(new uM.default(af.default.SignalingRequestFailed),new Error("Join ACK message did not include expected frame"));return}if(u.videoSubscriptionLimit&&(n.videoSubscriptionLimit=u.videoSubscriptionLimit),n.serverSupportsCompression=u.wantsCompressedSdp,u.defaultServerSideNetworkAdaption!==void 0&&u.defaultServerSideNetworkAdaption!==fM.default.Default&&n.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption!==void 0){let f=u.defaultServerSideNetworkAdaption;n.logger.info(`Overriding server side network adaption value to ${f}`),n.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption(fM.convertServerSideNetworkAdaptionEnumFromSignaled(f))}u&&u.turnCredentials?(n.turnCredentials=new W6.default,n.turnCredentials.username=u.turnCredentials.username,n.turnCredentials.password=u.turnCredentials.password,n.turnCredentials.ttl=u.turnCredentials.ttl,n.turnCredentials.uris=u.turnCredentials.uris.map(f=>n.meetingSessionConfiguration.urls.urlRewriter(f)).filter(f=>!!f)):n.logger.error("missing TURN credentials in JoinAckFrame");return}if(c.message.type!==pM.SdkSignalFrame.Type.INDEX)return;this.signalingClient.removeObserver(this);let d=c.message.index;e(d)}}let s=new o(this.context.signalingClient);this.context.signalingClient.registerObserver(s),this.taskCanceler=s,this.context.previousSdpAnswerAsString="",this.context.previousSdpOffer=null,this.context.serverSupportsCompression=!1;let a=new G6.default(this.context.meetingSessionConfiguration.applicationMetadata);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions!==void 0&&(a.serverSideNetworkAdaption=this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption(),a.supportedServerSideNetworkAdaptions=this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions()),this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex!==void 0&&(a.wantsAllTemporalLayersInIndex=this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex()),a.disablePeriodicKeyframeRequestOnContentSender=this.context.meetingSessionConfiguration.disablePeriodicKeyframeRequestOnContentSender,this.context.signalingClient.join(a)});this.context.logger.info(`received first index ${JSON.stringify(t)}`),this.context.indexFrame=t})}};mt.default=qy});var $y=y(yn=>{"use strict";var J6=yn&&yn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},mM=yn&&yn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(yn,"__esModule",{value:!0});var Q6=mM(Ge()),X6=Oe(),Y6=mM(_e()),zy=class extends Y6.default{constructor(t){super(t.logger),this.context=t,this.taskName="LeaveAndReceiveLeaveAckTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return J6(this,void 0,void 0,function*(){this.context.signalingClient.ready()&&(this.context.signalingClient.leave(),this.context.logger.info("sent leave"),yield this.receiveLeaveAck())})}receiveLeaveAck(){return new Promise((t,e)=>{class r{constructor(s,a){this.signalingClient=s,this.logger=a}cancel(){this.signalingClient.removeObserver(this),e(new Error("LeaveAndReceiveLeaveAckTask got canceled while waiting for IndexFrame"))}handleSignalingClientEvent(s){if(s.isConnectionTerminated()){this.signalingClient.removeObserver(this),this.logger.info("LeaveAndReceiveLeaveAckTask connection terminated"),t();return}s.type===Q6.default.ReceivedSignalFrame&&s.message.type===X6.SdkSignalFrame.Type.LEAVE_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("got leave ack"),t())}}let n=new r(this.context.signalingClient,this.context.logger);this.taskCanceler=n,this.context.signalingClient.registerObserver(n)})}};yn.default=zy});var Wy=y(vn=>{"use strict";var Z6=vn&&vn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},SM=vn&&vn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(vn,"__esModule",{value:!0});var e8=SM(Ge()),gM=Oe(),t8=SM(_e()),jy=class extends t8.default{constructor(t){super(t.logger),this.context=t,this.taskName="ListenForVolumeIndicatorsTask",this.realtimeMuteAndUnmuteHandler=e=>{this.context.signalingClient.mute(e)}}run(){return Z6(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(t){if(t.type===e8.default.ReceivedSignalFrame){if(t.message.type===gM.SdkSignalFrame.Type.AUDIO_STREAM_ID_INFO){let e=t.message.audioStreamIdInfo;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioStreamIdInfo(e)}else if(t.message.type===gM.SdkSignalFrame.Type.AUDIO_METADATA){let e=t.message.audioMetadata;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioMetadata(e)}}}};vn.default=jy});var Ky=y(fd=>{"use strict";var i8=fd&&fd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(fd,"__esModule",{value:!0});var r8=i8(er()),Gy=class i extends r8.default{constructor(t,e,r){super(e,r,"Reconnection Health"),this.logger=t,this.audioDelayPointsOverMaximum=0,i.CONNECTION_UNHEALTHY_THRESHOLD=e.connectionUnhealthyThreshold,i.CONNECTION_WAIT_TIME_MS=e.connectionWaitTimeMs,i.MISSED_PONGS_THRESHOLD=e.missedPongsUpperThreshold,i.MAXIMUM_AUDIO_DELAY_MS=e.maximumAudioDelayMs,i.MAXIMUM_AUDIO_DELAY_DATA_POINTS=e.maximumAudioDelayDataPoints}health(){if(this.currentData.isConnectionStartRecent(i.CONNECTION_WAIT_TIME_MS))return 1;let e=this.currentData.consecutiveStatsWithNoPackets>=i.CONNECTION_UNHEALTHY_THRESHOLD,r=this.currentData.consecutiveMissedPongs>=i.MISSED_PONGS_THRESHOLD;this.currentData.audioSpeakerDelayMs>i.MAXIMUM_AUDIO_DELAY_MS?this.audioDelayPointsOverMaximum+=1:this.audioDelayPointsOverMaximum=0;let n=this.audioDelayPointsOverMaximum>i.MAXIMUM_AUDIO_DELAY_DATA_POINTS;return n&&(this.audioDelayPointsOverMaximum=0),e||r||n?(this.logger.warn(`reconnection recommended due to: no packets received: ${e}, missed pongs: ${r}, bad audio delay: ${n}`),0):1}};fd.default=Gy});var Qy=y(hd=>{"use strict";var n8=hd&&hd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(hd,"__esModule",{value:!0});var o8=n8(er()),Jy=class extends o8.default{constructor(t,e,r){super(e,r,"Sending Audio Health"),this.logger=t,this.sendingAudioFailureSamplesToConsider=e.sendingAudioFailureSamplesToConsider>0?e.sendingAudioFailureSamplesToConsider:1,this.sendingAudioFailureInitialWaitTimeMs=e.sendingAudioFailureInitialWaitTimeMs,this.maximumTimesToWarn=e.maximumTimesToWarn,this.coolDownTimeMs=e.cooldownTimeMs,this.lastWarnTimestampMs=0,this.warnCount=0}isSendingAudioUnhealthy(){let t=!this.currentData.isConnectionStartRecent(this.sendingAudioFailureInitialWaitTimeMs),e=this.currentData.consecutiveStatsWithNoAudioPacketsSent>=this.sendingAudioFailureSamplesToConsider;return t&&e}health(){if(this.isSendingAudioUnhealthy()){let t=Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs;return this.currentHealth>this.minimumHealth()&&!t?(this.logger.warn(`Sending Audio is unhealthy for ${this.sendingAudioFailureSamplesToConsider} seconds consecutively.`),this.warnCount++,this.warnCount>this.maximumTimesToWarn?(this.logger.warn("SendingAudioFailure health policy maximum warnings breached. Falling back to reporting healthy."),this.maximumHealth()):(this.lastWarnTimestampMs=Date.now(),this.minimumHealth())):this.currentHealth}return this.maximumHealth()}};hd.default=Jy});var Yy=y(pd=>{"use strict";var s8=pd&&pd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(pd,"__esModule",{value:!0});var a8=s8(er()),Xy=class extends a8.default{constructor(t,e){super(t,e,"Unusable Audio Warning"),this.coolDownTimeMs=t.cooldownTimeMs,this.pastSamplesToConsider=t.pastSamplesToConsider,this.fractionalLoss=t.fractionalLoss,this.packetsExpected=t.packetsExpected,this.maximumTimesToWarn=t.maximumTimesToWarn,this.lastWarnTimestampMs=0,this.warnCount=0}calculateFractionalLoss(){if(this.currentData.packetsReceivedInLastMinute.length<this.pastSamplesToConsider)return 0;let t=this.pastSamplesToConsider,e=t*this.packetsExpected,r=0;for(let n=0;n<t;n++)r+=this.currentData.packetsReceivedInLastMinute[n];return Math.min(Math.max(1-r/e,0),1)}health(){return Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs?this.currentHealth:this.calculateFractionalLoss()>=this.fractionalLoss?this.currentHealth!==0&&(this.lastWarnTimestampMs=Date.now(),this.warnCount++,this.warnCount>this.maximumTimesToWarn)?1:0:1}};pd.default=Xy});var tv=y(bn=>{"use strict";var d8=bn&&bn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},At=bn&&bn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(bn,"__esModule",{value:!0});var c8=At(Jo()),l8=At(Xo()),u8=At(Ky()),f8=At(Qy()),h8=At(Yy()),Zy=At(Zo()),df=At(un()),md=At(jt()),yM=At(sn()),Ss=At(Ge()),gd=Oe(),vM=At(vu()),Sd=_t(),p8=At(_e()),ev=class extends p8.default{constructor(t,e,r){super(t.logger),this.context=t,this.initialConnectionHealthData=r,this.taskName="MonitorTask",this.prevSignalStrength=1,this.currentAvailableStreamAvgBitrates=null,this.hasSignalingError=!1,this.presenceHandlerCalled=!1,this.isResubscribeCheckPaused=!1,this.pendingMetricsReport=void 0,this.videoEncodingHealthPolicies=[],this.checkAndSendWeakSignalEvent=n=>{let o=n<1,s=this.prevSignalStrength<1,a=o?s?null:vM.default.RedmicStartLoss:s?vM.default.RedmicEndLoss:null;a&&this.context.statsCollector.logAudioEvent(a),this.prevSignalStrength=n},this.realtimeFatalErrorCallback=n=>{this.logger.error(`realtime error: ${n}: ${n.stack}`),this.context.audioVideoController.handleMeetingSessionStatus(new df.default(md.default.RealtimeApiFailed),n)},this.realtimeAttendeeIdPresenceHandler=(n,o)=>{var s;let a=this.context.meetingSessionConfiguration.credentials.attendeeId;this.logger.info(`attendeePresenceReceived: ${a}`),a===n&&o&&!this.presenceHandlerCalled&&(this.presenceHandlerCalled=!0,this.context.attendeePresenceDurationMs=Date.now()-this.context.startAudioVideoTimestamp,(s=this.context.eventController)===null||s===void 0||s.publishEvent("attendeePresenceReceived",{attendeePresenceDurationMs:this.context.attendeePresenceDurationMs}))},this.generateBaseAudioVideoEventAttributes=()=>{let{signalingOpenDurationMs:n,startTimeMs:o,iceGatheringDurationMs:s,attendeePresenceDurationMs:a,meetingStartDurationMs:l}=this.context;return{meetingDurationMs:o===null?0:Math.round(Date.now()-o),signalingOpenDurationMs:n,iceGatheringDurationMs:s,attendeePresenceDurationMs:a,meetingStartDurationMs:l}},this.generateAudioVideoEventAttributesForReceivingAudioDropped=()=>{let n=this.generateBaseAudioVideoEventAttributes();return Object.assign(Object.assign({},n),{maxVideoTileCount:this.context.maxVideoTileCount,poorConnectionCount:this.context.poorConnectionCount})},this.reconnectionHealthPolicy=new u8.default(t.logger,Object.assign({},e),this.initialConnectionHealthData.clone()),this.unusableAudioWarningHealthPolicy=new h8.default(Object.assign({},e),this.initialConnectionHealthData.clone()),this.sendingAudioFailureHealthPolicy=new f8.default(t.logger,Object.assign({},e),this.initialConnectionHealthData.clone());for(let n of e.videoEncodingHealthPolicies)this.videoEncodingHealthPolicies.push(new n(Object.assign({},e),this.initialConnectionHealthData.clone()))}removeObserver(){this.context.audioVideoController.removeObserver(this),this.context.realtimeController.realtimeUnsubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.signalingClient.removeObserver(this)}run(){return d8(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.audioVideoController.addObserver(this),this.context.realtimeController.realtimeSubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.connectionMonitor.start(),this.context.statsCollector.start(this.context.signalingClient,this.context.videoStreamIndex),this.context.signalingClient.registerObserver(this)})}pauseResubscribeCheck(){this.isResubscribeCheckPaused=!0}resumeResubscribeCheck(){this.isResubscribeCheckPaused&&(this.isResubscribeCheckPaused=!1,this.pendingMetricsReport&&(this.context.logger.info("Resuming resubscribe check with pending metrics report"),this.checkResubscribe(this.pendingMetricsReport)&&this.context.audioVideoController.update({needsRenegotiation:!1})))}videoTileDidUpdate(t){this.context.maxVideoTileCount=Math.max(this.context.maxVideoTileCount,this.context.videoTileController.getAllVideoTiles().length)}checkResubscribe(t){if(this.isResubscribeCheckPaused){this.context.logger.info("Resubscribe check is paused, setting incoming client metric report as pending"),this.pendingMetricsReport=t;return}else this.pendingMetricsReport=void 0;let e=t.getObservableMetrics(),r=e.availableOutgoingBitrate,n=e.nackCountReceivedPerSecond,o=!1;this.context.videoDownlinkBandwidthPolicy.updateMetrics(t);let s=this.context.videoDownlinkBandwidthPolicy.wantsResubscribe();if(o=o||s,s){let a=this.context.videoDownlinkBandwidthPolicy.chooseSubscriptions();this.context.videosToReceive=a.truncate(this.context.videoSubscriptionLimit),a.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.logger.info(`trigger resubscribe for down=${s}; videosToReceive=[${this.context.videosToReceive.array()}]`)}if(this.context.videoTileController.hasStartedLocalVideoTile()){this.context.videoUplinkBandwidthPolicy.updateConnectionMetric({uplinkKbps:r/1e3,nackCountPerSecond:n});let a=this.context.videoUplinkBandwidthPolicy.wantsResubscribe();o=o||a,a&&(this.logger.info(`trigger resubscribe for up=${a}; videosToReceive=[${this.context.videosToReceive.array()}]`),this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters())}return o}metricsDidReceive(t){if(this.checkResubscribe(t)&&this.context.audioVideoController.update({needsRenegotiation:!1}),!this.currentAvailableStreamAvgBitrates)return;let e=t.streamMetricReports,r=new Map;for(let n in e)e[n].mediaType===l8.default.VIDEO&&e[n].direction===c8.default.DOWNSTREAM&&r.set(e[n].streamId,e[n])}connectionHealthDidChange(t){t.consecutiveMissedPongs===0&&this.context.reconnectController&&this.context.reconnectController.setLastActiveTimestampMs(Date.now()),this.applyHealthPolicy(this.reconnectionHealthPolicy,t,()=>{this.context.audioVideoController.handleMeetingSessionStatus(new df.default(md.default.ConnectionHealthReconnect),null)}),this.applyHealthPolicy(this.unusableAudioWarningHealthPolicy,t,()=>{var e;this.context.poorConnectionCount+=1;let r=this.generateAudioVideoEventAttributesForReceivingAudioDropped();(e=this.context.eventController)===null||e===void 0||e.publishEvent("receivingAudioDropped",r),this.context.videoTileController.haveVideoTilesWithStreams()?this.context.audioVideoController.forEachObserver(n=>{Sd.Maybe.of(n.connectionDidSuggestStopVideo).map(o=>o.bind(n)())}):this.context.audioVideoController.forEachObserver(n=>{Sd.Maybe.of(n.connectionDidBecomePoor).map(o=>o.bind(n)())})},()=>{this.context.audioVideoController.forEachObserver(e=>{Sd.Maybe.of(e.connectionDidBecomeGood).map(r=>r.bind(e)())})});for(let e of this.videoEncodingHealthPolicies)this.applyHealthPolicy(e,t,()=>{switch(this.degradeVideoCodec(e.name),e.name){case Zy.default.VideoEncodingCpuHealth:this.context.statsCollector.videoCodecDegradationHighEncodeCpuDidReceive();break;case Zy.default.VideoEncodingFramerateHealth:this.context.statsCollector.videoCodecDegradationEncodeFailureDidReceive();break;case Zy.default.VideoConcurrentSendersHealth:this.context.statsCollector.videoCodecDegradationConcurrentSendersDidReceive();break}});this.context.isSessionConnected&&this.applyHealthPolicy(this.sendingAudioFailureHealthPolicy,t,()=>{var e;let r=this.generateBaseAudioVideoEventAttributes();(e=this.context.eventController)===null||e===void 0||e.publishEvent("sendingAudioFailed",r)},()=>{var e;let r=this.generateBaseAudioVideoEventAttributes();(e=this.context.eventController)===null||e===void 0||e.publishEvent("sendingAudioRecovered",r)})}applyHealthPolicy(t,e,r,n){t.update(e);let o=t.healthIfChanged();o!==null&&(this.logger.info(`${t.name} value is now ${o}`),o<=t.minimumHealth()?Sd.Maybe.of(r).map(s=>s.bind(this)()):Sd.Maybe.of(n).map(s=>s.bind(this)()))}handleBitrateFrame(t){this.currentAvailableStreamAvgBitrates=t,t.serverAvailableOutgoingBitrate>0&&(this.logger.info(`Received server side estimation of available incoming bitrate ${t.serverAvailableOutgoingBitrate}kbps`),this.context.statsCollector.overrideObservableMetric("availableIncomingBitrate",t.serverAvailableOutgoingBitrate*1e3))}handleSignalingClientEvent(t){var e;if(t.type===Ss.default.WebSocketClosed&&this.isUnexpectedWebsocketCloseCode(t.closeCode)||t.type===Ss.default.WebSocketError||t.type===Ss.default.WebSocketFailed){if(t.type===Ss.default.WebSocketClosed&&this.context.logger.info(`The signaling connection was closed with code ${t.closeCode} and reason: ${t.closeReason}`),!this.hasSignalingError){let r=this.generateAudioVideoEventAttributesForReceivingAudioDropped();(e=this.context.eventController)===null||e===void 0||e.publishEvent("signalingDropped",r),this.hasSignalingError=!0}this.context.isSessionConnected&&this.context.audioVideoController.handleMeetingSessionStatus(new df.default(this.isInternalServerFailureCloseCode(t.closeCode)?md.default.SignalingInternalServerError:md.default.SignalingChannelClosedUnexpectedly),null)}else t.type===Ss.default.WebSocketOpen&&(this.hasSignalingError=!1);if(t.type===Ss.default.ReceivedSignalFrame){if(t.message.type===gd.SdkSignalFrame.Type.NOTIFICATION){switch(t.message.notification.level){case gd.SdkNotificationFrame.NotificationLevel.INFO:this.logger.info(`Received notification from server: ${t.message.notification.message}`);break;case gd.SdkNotificationFrame.NotificationLevel.WARNING:this.logger.warn(`Received warning from server: ${t.message.notification.message}`);break;case gd.SdkNotificationFrame.NotificationLevel.ERROR:this.logger.error(`Received error from server: ${t.message.notification.message}`);break;default:this.logger.error(`Received notification from server with unknown level ${t.message.notification.level}: ${t.message.notification.message}`);break}return}if(t.message.bitrates){let n=t.message.bitrates;this.context.videoStreamIndex.integrateBitratesFrame(n),this.context.videoDownlinkBandwidthPolicy.updateIndex(this.context.videoStreamIndex),this.handleBitrateFrame(t.message.bitrates)}let r=df.default.fromSignalFrame(t.message);t.message.type!==gd.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&r.statusCode()!==md.default.OK&&this.context.audioVideoController.handleMeetingSessionStatus(r,null)}}isUnexpectedWebsocketCloseCode(t){return t===1006||this.isInternalServerFailureCloseCode(t)}isInternalServerFailureCloseCode(t){return t>=4500&&t<4600}degradeVideoCodec(t){if(this.context.meetingSupportedVideoSendCodecPreferences!==void 0&&this.context.meetingSupportedVideoSendCodecPreferences.length>1&&!(this.context.meetingSupportedVideoSendCodecPreferences[0].equals(yM.default.h264ConstrainedBaselineProfile())||this.context.meetingSupportedVideoSendCodecPreferences[0].equals(yM.default.vp8()))){let e=[];for(let r of this.context.videoSendCodecPreferences)r.equals(this.context.meetingSupportedVideoSendCodecPreferences[0])||e.push(r);e.length>0?(this.context.logger.info(`Downgrading codec from ${this.context.meetingSupportedVideoSendCodecPreferences[0].codecName} to ${e[0].codecName} due to ${t}`),this.context.degradedVideoSendCodecs.push(this.context.meetingSupportedVideoSendCodecPreferences[0]),this.context.meetingSupportedVideoSendCodecPreferences=e,this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs&&this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs(this.context.meetingSupportedVideoSendCodecPreferences,this.context.videoSendCodecPreferences),this.context.audioVideoController.update({needsRenegotiation:!0})):this.context.logger.warn(`Degrading video codec failed since there is no alternative codec to select. Currently degraded codecs: ${this.context.degradedVideoSendCodecs.map(r=>r.codecName).join(",")}`)}}};bn.default=ev});var nv=y(rv=>{"use strict";Object.defineProperty(rv,"__esModule",{value:!0});var iv=class{constructor(t,e){this.signalingURL=t,this.joinToken=e}url(){return this.signalingURL+"?X-Chime-Control-Protocol-Version=3&X-Amzn-Chime-Send-Close-On-Error=1"}protocols(){return["_aws_wt_session",this.joinToken]}};rv.default=iv});var av=y(wn=>{"use strict";var m8=wn&&wn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},sv=wn&&wn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(wn,"__esModule",{value:!0});var g8=sv(nv()),bM=sv(Ge()),S8=sv(_e()),ov=class extends S8.default{constructor(t){super(t.logger),this.context=t,this.taskName="OpenSignalingConnectionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return m8(this,void 0,void 0,function*(){let t=this.context.meetingSessionConfiguration;this.context.signalingClient.openConnection(new g8.default(t.urls.signalingURL,t.credentials.joinToken));let e=Date.now();try{yield new Promise((r,n)=>{class o{constructor(l){this.signalingClient=l}cancel(){this.signalingClient.removeObserver(this),n(new Error("OpenSignalingConnectionTask got canceled while waiting to open signaling connection"))}handleSignalingClientEvent(l){switch(l.type){case bM.default.WebSocketOpen:this.signalingClient.removeObserver(this),r();break;case bM.default.WebSocketFailed:this.signalingClient.removeObserver(this),n(new Error("WebSocket connection failed"));break}}}let s=new o(this.context.signalingClient);this.context.signalingClient.registerObserver(s),this.taskCanceler=s})}catch(r){throw r}finally{this.context.signalingOpenDurationMs=Math.round(Date.now()-e),this.logger.info(`Opening signaling connection took ${this.context.signalingOpenDurationMs} ms`)}})}};wn.default=ov});var cv=y(Cn=>{"use strict";var y8=Cn&&Cn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},v8=Cn&&Cn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Cn,"__esModule",{value:!0});var b8=v8(_e()),dv=class extends b8.default{constructor(t,e,r){super(t),this.taskName=e,this.tasksToRunParallel=r;for(let n of r)n.setParent(this)}cancel(){for(let t of this.tasksToRunParallel)this.logger.info(`canceling parallel group task ${this.name()} subtask ${t.name()}`),t.cancel()}run(){return y8(this,void 0,void 0,function*(){let t=[];for(let r of this.tasksToRunParallel)this.logger.info(`parallel group task ${this.name()} running subtask ${r.name()}`),t.push(r.run());let e=[];for(let r=0;r<t.length;r++){try{yield t[r]}catch(n){e.push(`task ${this.tasksToRunParallel[r].name()} failed: ${n.message}`)}this.logger.info(`parallel group task ${this.name()} completed subtask ${this.tasksToRunParallel[r].name()}`)}if(e.length>0){let r=e.join(", ");this.logAndThrow(`parallel group task ${this.name()} failed for tasks: ${r}`)}this.logger.info(`parallel group task ${this.name()} completed`)})}};Cn.default=dv});var uv=y(Tn=>{"use strict";var w8=Tn&&Tn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},wM=Tn&&Tn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Tn,"__esModule",{value:!0});var _n=CM(),C8=wM(Ge()),_8=Oe(),T8=wM(_e()),lv=class extends T8.default{constructor(t,e,r){super(t.logger),this.context=t,this.credentials=e,this.completionCallback=r,this.taskName="PromoteToPrimaryMeetingTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return w8(this,void 0,void 0,function*(){this.context.signalingClient.ready()?(this.context.signalingClient.promoteToPrimaryMeeting(this.credentials),this.context.logger.info("Sent request to join primary meeting"),yield this.receivePrimaryMeetingJoinAck()):this.completionCallback(new _n.MeetingSessionStatus(_n.MeetingSessionStatusCode.SignalingRequestFailed))})}receivePrimaryMeetingJoinAck(){return new Promise((t,e)=>{class r{constructor(s,a,l){this.signalingClient=s,this.completionCallback=a,this.logger=l}cancel(){this.signalingClient.removeObserver(this),this.completionCallback(new _n.MeetingSessionStatus(_n.MeetingSessionStatusCode.SignalingRequestFailed)),t()}handleSignalingClientEvent(s){s.isConnectionTerminated()&&(this.signalingClient.removeObserver(this),this.logger.info("PromoteToPrimaryMeetingTask connection terminated"),this.completionCallback(new _n.MeetingSessionStatus(_n.MeetingSessionStatusCode.SignalingRequestFailed)),t()),s.type===C8.default.ReceivedSignalFrame&&s.message.type===_8.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("Got a primary meeting join ACK"),this.completionCallback(_n.MeetingSessionStatus.fromSignalFrame(s.message)),t())}}let n=new r(this.context.signalingClient,this.completionCallback,this.context.logger);this.taskCanceler=n,this.context.signalingClient.registerObserver(n)})}};Tn.default=lv});var hv=y(En=>{"use strict";var E8=En&&En.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},I8=En&&En.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(En,"__esModule",{value:!0});var A8=I8(_e()),fv=class extends A8.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveAudioInputTask"}run(){var t,e;return E8(this,void 0,void 0,function*(){if(!(!((e=(t=this.context.meetingSessionConfiguration)===null||t===void 0?void 0:t.urls)===null||e===void 0)&&e.audioHostURL)){this.context.logger.info("No audio connection: not acquiring audio input");return}if(this.context.activeAudioInput){this.context.logger.info("an active audio input exists");return}let r;try{r=yield this.context.mediaStreamBroker.acquireAudioInputStream()}catch{this.context.logger.warn("could not acquire audio input from current device")}r?this.context.activeAudioInput=r:this.context.logger.warn("an audio input is not available")})}};En.default=fv});var mv=y(In=>{"use strict";var k8=In&&In.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},_M=In&&In.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(In,"__esModule",{value:!0});var M8=_M(Ge()),cf=Oe(),x8=_M(_e()),pv=class extends x8.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveRemoteVideoPauseResume",this.serverPausedVideoTileIds=new Set}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return k8(this,void 0,void 0,function*(){this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)})}updateSubscribedGroupdIds(t){let e=new Set;for(let r of t){let n=this.context.videoStreamIndex.attendeeIdForGroupId(r);if(n.length===0){this.logger.warn(`Could not find attendee ID for newly subscribed group ID ${r}`);continue}let o=this.context.videoTileController.getVideoTileForAttendeeId(n);o===void 0&&(this.logger.info(`No existing video tile for attendee ID ${n} with new group ID ${r}. Creating new one.`),o=this.context.videoTileController.addVideoTile(),o.bindVideoStream(n,!1,null,0,0,0,null)),e.add(o.id())}this.serverPausedVideoTileIds.forEach(r=>{e.has(r)||this.serverPausedVideoTileIds.delete(r)})}handleSignalingClientEvent(t){if(t.type!==M8.default.ReceivedSignalFrame||t.message.type!==cf.SdkSignalFrame.Type.PAUSE&&t.message.type!==cf.SdkSignalFrame.Type.RESUME)return;let e=t.message.pause,r=t.message.type;if(this.logger.info(`Received new ${r===cf.SdkSignalFrame.Type.PAUSE?"pause":"resume"} frame: ${JSON.stringify(e)}`),!e||this.context.videoTileController.getVideoTileForAttendeeId===void 0||this.context.videoDownlinkBandwidthPolicy.forEachObserver===void 0||this.context.videoStreamIndex.attendeeIdForGroupId===void 0)return;let n=e.groupIds.map(o=>{let s=this.context.videoStreamIndex.attendeeIdForGroupId(o);if(s.length===0){this.logger.warn(`Could not find attendee ID for paused group ID ${o}`);return}return this.context.videoTileController.getVideoTileForAttendeeId(s)});for(let o of n)o!==void 0&&(r===cf.SdkSignalFrame.Type.PAUSE?o.state().paused||(this.serverPausedVideoTileIds.add(o.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver(s=>{s.tileWillBePausedByDownlinkPolicy(o.id())}),o.pause()):o.state().paused&&this.serverPausedVideoTileIds.has(o.id())&&(this.serverPausedVideoTileIds.delete(o.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver(s=>{s.tileWillBeUnpausedByDownlinkPolicy(o.id())}),o.unpause()))}};In.default=pv});var Sv=y(An=>{"use strict";var TM=An&&An.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},IM=An&&An.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(An,"__esModule",{value:!0});var EM=IM(sr()),yd=Oe(),O8=IM(_e()),gv=class extends O8.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveVideoInputTask"}checkAndApplyVideoConstraint(t,e,r,n,o){return TM(this,void 0,void 0,function*(){let s=t?this.context.meetingSessionConfiguration.meetingFeatures.contentMaxResolution:this.context.meetingSessionConfiguration.meetingFeatures.videoMaxResolution;if(!t&&r<=s.videoWidth&&n<=s.videoHeight&&o<=s.videoFrameRate)return;let a={resizeMode:{ideal:"none"},width:{max:s.videoWidth},height:{max:s.videoHeight},frameRate:{ideal:o,max:s.videoFrameRate}};try{yield e.applyConstraints(a)}catch{this.context.logger.info(`Could not apply constraint for video track (content = ${t})`)}})}run(){return TM(this,void 0,void 0,function*(){let t=this.context.videoDuplexMode===yd.SdkStreamServiceType.RX||this.context.videoDuplexMode===yd.SdkStreamServiceType.DUPLEX;if(this.context.videoTileController.hasStartedLocalVideoTile()?this.context.videoDuplexMode=t?yd.SdkStreamServiceType.DUPLEX:yd.SdkStreamServiceType.TX:this.context.videoDuplexMode=t?yd.SdkStreamServiceType.RX:0,this.context.videoCaptureAndEncodeParameter=this.context.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters(),!this.context.videoTileController.hasStartedLocalVideoTile()){this.context.logger.info("has not started local video tile"),this.context.activeVideoInput&&(this.context.activeVideoInput=void 0,this.context.videoStreamIndex.integrateUplinkPolicyDecision([]));return}let e=this.context.videoTileController.getLocalVideoTile(),r;try{r=yield this.context.mediaStreamBroker.acquireVideoInputStream()}catch{this.context.logger.warn("could not acquire video input from current device"),this.context.videoTileController.stopLocalVideoTile()}if(this.context.enableSimulcast){let n=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();this.context.videoStreamIndex.integrateUplinkPolicyDecision(Array.from(n.values()))}if(this.context.activeVideoInput=r,r){let n=r.getVideoTracks();if(!n||n.length===0)return;let o=this.context.meetingSessionConfiguration.credentials.attendeeId,s=new EM.default(o).hasModality(EM.default.MODALITY_CONTENT),a=n[0].getSettings();this.checkAndApplyVideoConstraint(s,n[0],a.width,a.height,a.frameRate);let l=this.context.audioVideoController.configuration.credentials.externalUserId;e.bindVideoStream(o,!0,r,a.width,a.height,null,l);for(let c of n)this.logger.info(`Using video device label=${c.label} id=${c.id}`),this.context.videoDeviceInformation.current_camera_name=c.label,this.context.videoDeviceInformation.current_camera_id=c.id}})}};An.default=gv});var bv=y(kn=>{"use strict";var P8=kn&&kn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},vd=kn&&kn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(kn,"__esModule",{value:!0});var R8=vd(Ju()),AM=vd(sr()),D8=vd(sn()),N8=vd(Ge()),yv=Oe(),kM=_t(),L8=vd(_e()),vv=class extends L8.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveVideoStreamIndexTask",this.isIngestionPaused=!1,this.pendingIndex=null}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return P8(this,void 0,void 0,function*(){this.handleIndexFrame(this.context.indexFrame),this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)})}handleSignalingClientEvent(t){if(t.type!==N8.default.ReceivedSignalFrame||t.message.type!==yv.SdkSignalFrame.Type.INDEX)return;let e=t.message.index;this.context.logger.info(`received new index ${JSON.stringify(e)}`),this.handleIndexFrame(e)}pauseIngestion(){this.isIngestionPaused=!0}resumeIngestion(){this.isIngestionPaused&&(this.isIngestionPaused=!1,this.pendingIndex&&(this.context.logger.info("Resuming index ingestion with pending index"),this.handleIndexFrame(this.pendingIndex)))}handleIndexFrame(t){if(!t)return;if(this.isIngestionPaused){this.context.logger.info("Index ingestion is paused, setting most recent index as pending"),this.pendingIndex=t;return}else this.pendingIndex=null;let e=this.context.audioVideoController.configuration.credentials.attendeeId;t.sources=t.sources.filter(l=>{let c=new AM.default(l.attendeeId);return!(c.base()===e&&c.hasModality(AM.default.MODALITY_CONTENT))});let{videoStreamIndex:r,videoDownlinkBandwidthPolicy:n,videoUplinkBandwidthPolicy:o}=this.context,s=r.allVideoSendingSourcesExcludingSelf(e);r.integrateIndexFrame(t),n.updateIndex(r),o.updateIndex(r),this.resubscribe(n,o),this.updateVideoAvailability(t),this.handleIndexVideosPausedAtSource(),t.supportedReceiveCodecIntersection.length>0&&this.handleSupportedVideoReceiveCodecIntersection(t);let a=r.allVideoSendingSourcesExcludingSelf(e);this.areVideoSourcesEqual(s,a)||this.context.audioVideoController.forEachObserver(l=>{kM.Maybe.of(l.remoteVideoSourcesDidChange).map(c=>c.bind(l)(a))})}areVideoSourcesEqual(t,e){if(t.length!==e.length)return!1;let r=(s,a)=>s.attendee.attendeeId.localeCompare(a.attendee.attendeeId),n=[...t].sort(r),o=[...e].sort(r);for(let s=0;s<n.length;s++)if(n[s].attendee.attendeeId!==o[s].attendee.attendeeId)return!1;return!0}resubscribe(t,e){let r=t.wantsResubscribe(),n=(this.context.videoDuplexMode===yv.SdkStreamServiceType.TX||this.context.videoDuplexMode===yv.SdkStreamServiceType.DUPLEX)&&e.wantsResubscribe(),o=r||n;if(this.logger.info(`should resubscribe: ${o} (downlink: ${r} uplink: ${n})`),!o)return;let s=t.chooseSubscriptions();this.context.videosToReceive=s.truncate(this.context.videoSubscriptionLimit),s.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.context.videoCaptureAndEncodeParameter=e.chooseCaptureAndEncodeParameters(),this.logger.info(`trigger resubscribe for up=${n} down=${r}; videosToReceive=[${this.context.videosToReceive.array()}] captureParams=${JSON.stringify(this.context.videoCaptureAndEncodeParameter)}`),this.context.audioVideoController.update({needsRenegotiation:!1})}updateVideoAvailability(t){if(!this.context.videosToReceive){this.logger.error("videosToReceive must be set in the meeting context.");return}let e=new R8.default;e.remoteVideoAvailable=!this.context.videosToReceive.empty(),e.canStartLocalVideo=!t.atCapacity,(!this.context.lastKnownVideoAvailability||!this.context.lastKnownVideoAvailability.equal(e))&&(this.context.lastKnownVideoAvailability=e.clone(),this.context.audioVideoController.forEachObserver(r=>{kM.Maybe.of(r.videoAvailabilityDidChange).map(n=>n.bind(r)(e.clone()))}))}handleSupportedVideoReceiveCodecIntersection(t){if(this.context.videoSendCodecPreferences===void 0)return;let e=[],r=!1;for(let n of this.context.videoSendCodecPreferences){if(this.context.degradedVideoSendCodecs.some(o=>n.equals(o))){this.logger.info(`Skipping ${n.codecName} since the codec has been identfied as degraded`);continue}for(let o of t.supportedReceiveCodecIntersection)if(n.equals(D8.default.fromSignaled(o))){e.push(n);break}}if(e.length>0){let n=e.find(o=>this.context.prioritizedSendVideoCodecCapabilities.some(s=>o.equals(s)));this.context.currentVideoSendCodec!==void 0&&(n===void 0||!this.context.currentVideoSendCodec.equals(n))&&(r=!0),this.context.meetingSupportedVideoSendCodecPreferences=e}else this.logger.warn("Interesection of meeting receive codec support and send codec preferences has no overlap, falling back to just values provided in `setVideoCodecSendPreferences`"),this.context.meetingSupportedVideoSendCodecPreferences=void 0;this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs&&this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs(this.context.meetingSupportedVideoSendCodecPreferences,this.context.videoSendCodecPreferences),r&&this.context.audioVideoController.update({needsRenegotiation:!0})}handleIndexVideosPausedAtSource(){let t=this.context.videoStreamIndex.streamsPausedAtSource();for(let e of this.context.videoTileController.getAllVideoTiles()){let r=e.state();t.contain(r.streamId)?e.markPoorConnection()&&this.logger.info(`marks the tile ${r.tileId} as having a poor connection`):e.unmarkPoorConnection()&&this.logger.info(`unmarks the tile ${r.tileId} as having a poor connection`)}}};kn.default=vv});var _v=y(Mn=>{"use strict";var F8=Mn&&Mn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Cv=Mn&&Mn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Mn,"__esModule",{value:!0});var B8=Cv(OS()),V8=Cv(Ge()),wv=Oe(),U8=Cv(_e()),bd=class i extends U8.default{constructor(t){super(t.logger),this.context=t,this.taskName="SendAndReceiveDataMessagesTask",this.sendDataMessageHandler=(e,r,n)=>{if(this.context.signalingClient.ready()){let o;r instanceof Uint8Array?o=r:typeof r=="string"?o=new TextEncoder().encode(r):o=new TextEncoder().encode(JSON.stringify(r)),this.validateDataMessage(e,o,n);let s=wv.SdkDataMessagePayload.create();s.topic=e,s.lifetimeMs=n,s.data=o;let a=wv.SdkDataMessageFrame.create();a.messages=[s],this.context.signalingClient.sendDataMessage(a)}else this.context.logger.error("Cannot send data message because signaling client is not ready")}}run(){return F8(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToSendDataMessage(this.sendDataMessageHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeFromSendDataMessage(this.sendDataMessageHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(t){if(t.type===V8.default.ReceivedSignalFrame&&t.message.type===wv.SdkSignalFrame.Type.DATA_MESSAGE)for(let e of t.message.dataMessage.messages){let r=new B8.default(e.ingestTimeNs/1e6,e.topic,e.data,e.senderAttendeeId,e.senderExternalUserId,e.ingestTimeNs===0);this.context.realtimeController.realtimeReceiveDataMessage(r)}}validateDataMessage(t,e,r){if(!i.TOPIC_REGEX.test(t))throw new Error("Invalid topic");if(e.length>i.DATA_SIZE)throw new Error("Data size has to be less than 2048 bytes");if(r&&r<0)throw new Error("The life time of the message has to be non negative")}};Mn.default=bd;bd.TOPIC_REGEX=new RegExp(/^[a-zA-Z0-9_-]{1,36}$/);bd.DATA_SIZE=2048});var Ev=y(xn=>{"use strict";var q8=xn&&xn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},MM=xn&&xn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(xn,"__esModule",{value:!0});var H8=MM(_e()),z8=MM(yu()),Tv=class extends H8.default{constructor(t,e,r){super(t),this.taskName=e,this.tasksToRunSerially=r,this.currentTask=null;for(let n of r)n.setParent(this)}cancel(){this.currentTask&&(this.logger.info(`canceling serial group task ${this.name()} subtask ${this.currentTask.name()}`),this.currentTask.cancel())}run(){return q8(this,void 0,void 0,function*(){for(let t of this.tasksToRunSerially){this.getStatus()===z8.default.CANCELED&&this.logAndThrow(`serial group task ${this.name()} was canceled`);try{this.logger.info(`serial group task ${this.name()} running subtask ${t.name()}`),this.currentTask=t,yield t.run(),this.logger.info(`serial group task ${this.name()} completed subtask ${t.name()}`)}catch(e){this.logAndThrow(`serial group task ${this.name()} was canceled due to subtask ${this.currentTask.name()} error: ${e.message}`)}finally{this.currentTask=null}}this.logger.info(`serial group task ${this.name()} completed`)})}};xn.default=Tv});var kv=y(On=>{"use strict";var xM=On&&On.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Av=On&&On.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(On,"__esModule",{value:!0});var $8=Av(We()),gr=Av(an()),j8=Av(_e()),Iv=class extends j8.default{constructor(t){super(t.logger),this.context=t,this.taskName="SetLocalDescriptionTask"}cancel(){if(this.cancelPromise){let t=new Error(`canceling ${this.name()}`);this.cancelPromise(t),delete this.cancelPromise}}run(){return xM(this,void 0,void 0,function*(){let t=this.context.peer,r=this.context.sdpOfferInit.sdp;if(this.context.browserBehavior.supportsVideoLayersAllocationRtpHeaderExtension()&&(r=new gr.default(r).withVideoLayersAllocationRtpHeaderExtension(this.context.previousSdpOffer).sdp),this.context.browserBehavior.supportsDependencyDescriptorRtpHeaderExtension()&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension!==void 0&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension()&&(r=new gr.default(r).withDependencyDescriptorRtpHeaderExtension(this.context.previousSdpOffer).sdp),new $8.default().requiresDisablingH264Encoding()&&(r=new gr.default(r).removeH264SupportFromSendSection().sdp),r=new gr.default(r).withStartingVideoSendBitrate(1e3).sdp,this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(r=new gr.default(r).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.audioProfile&&(r=new gr.default(r).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(r=new gr.default(r).withStereoAudio().sdp),this.context.audioProfile.hasRedundancyEnabled())){let o=new gr.default(r).getAudioPayloadTypes();this.context.transceiverController&&this.context.transceiverController.setAudioPayloadTypes&&this.context.transceiverController.setAudioPayloadTypes(o)}this.logger.debug(()=>`local description is >>>${r}<<<`);let n={type:"offer",sdp:r,toJSON:null};yield new Promise((o,s)=>xM(this,void 0,void 0,function*(){this.cancelPromise=a=>{s(a)};try{yield t.setLocalDescription(n),o()}catch(a){s(a)}finally{delete this.cancelPromise}})),this.context.logger.info("set local description")})}};On.default=Iv});var xv=y(Pn=>{"use strict";var OM=Pn&&Pn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},lf=Pn&&Pn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Pn,"__esModule",{value:!0});var PM=lf(sr()),wd=lf(an()),W8=lf(sn()),G8=lf(_e()),Mv=class extends G8.default{constructor(t){super(t.logger),this.context=t,this.taskName="SetRemoteDescriptionTask"}cancel(){this.cancelICEPromise&&this.cancelICEPromise()}run(){var t;return OM(this,void 0,void 0,function*(){this.context.peer||this.logAndThrow("session does not have peer connection; bypass set remote description");let r=this.context.sdpAnswer;r=new wd.default(r).withoutServerReflexiveCandidates().sdp,this.context.audioProfile&&(r=new wd.default(r).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(r=new wd.default(r).withStereoAudio().sdp)),this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(r=new wd.default(r).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.prioritizedSendVideoCodecCapabilities=new wd.default(r).prioritizedSendVideoCodecCapabilities(),this.context.currentVideoSendCodec=this.context.prioritizedSendVideoCodecCapabilities.length>0?this.context.prioritizedSendVideoCodecCapabilities[0]:void 0;let n=this.context.activeVideoInput;if(n!==void 0){let s=this.context.audioVideoController.configuration.credentials.attendeeId,a=new PM.default(s).hasModality(PM.default.MODALITY_CONTENT),l=n.getVideoTracks()[0];a&&(((t=this.context.currentVideoSendCodec)===null||t===void 0?void 0:t.codecName)===W8.default.av1Main().codecName?(l.contentHint="text",this.logger.info(`Setting content hint to text for AV1, attendee: ${s}`)):this.context.audioVideoController.configuration.enableSVC&&(l.contentHint="motion",this.logger.info(`Setting content hint to motion to enable SVC, attendee: ${s}`)))}this.logger.info(`processed remote description is >>>${r}<<<`);let o={type:"answer",sdp:r,toJSON:null};try{yield this.createICEConnectionCompletedPromise(o)}catch(s){throw s}})}createICEConnectionCompletedPromise(t){return new Promise((e,r)=>OM(this,void 0,void 0,function*(){let n=()=>{(this.context.peer.iceConnectionState==="connected"||this.context.peer.iceConnectionState==="completed")&&(this.context.peer.removeEventListener("iceconnectionstatechange",n),e())};this.cancelICEPromise=()=>{this.context.peer&&this.context.peer.removeEventListener("iceconnectionstatechange",n),r(new Error(`${this.name()} got canceled while waiting for the ICE connection state`))},this.context.peer.addEventListener("iceconnectionstatechange",n);try{yield this.context.peer.setRemoteDescription(t),this.logger.info("set remote description, waiting for ICE connection"),n()}catch(o){r(o)}}))}};Pn.default=Mv});var ZM=y((Mne,bs)=>{"use strict";function vs(i){let t=i.length;for(;--t>=0;)i[t]=0}var K8=0,BM=1,J8=2,Q8=3,X8=258,Fv=29,Ad=256,_d=Ad+1+Fv,ys=30,Bv=19,VM=2*_d+1,Rn=15,Ov=16,Y8=7,Vv=256,UM=16,qM=17,HM=18,Nv=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),uf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Z8=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),zM=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ej=512,Di=new Array((_d+2)*2);vs(Di);var Cd=new Array(ys*2);vs(Cd);var Td=new Array(ej);vs(Td);var Ed=new Array(X8-Q8+1);vs(Ed);var Uv=new Array(Fv);vs(Uv);var ff=new Array(ys);vs(ff);function Pv(i,t,e,r,n){this.static_tree=i,this.extra_bits=t,this.extra_base=e,this.elems=r,this.max_length=n,this.has_stree=i&&i.length}var $M,jM,WM;function Rv(i,t){this.dyn_tree=i,this.max_code=0,this.stat_desc=t}var GM=i=>i<256?Td[i]:Td[256+(i>>>7)],Id=(i,t)=>{i.pending_buf[i.pending++]=t&255,i.pending_buf[i.pending++]=t>>>8&255},dt=(i,t,e)=>{i.bi_valid>Ov-e?(i.bi_buf|=t<<i.bi_valid&65535,Id(i,i.bi_buf),i.bi_buf=t>>Ov-i.bi_valid,i.bi_valid+=e-Ov):(i.bi_buf|=t<<i.bi_valid&65535,i.bi_valid+=e)},fi=(i,t,e)=>{dt(i,e[t*2],e[t*2+1])},KM=(i,t)=>{let e=0;do e|=i&1,i>>>=1,e<<=1;while(--t>0);return e>>>1},tj=i=>{i.bi_valid===16?(Id(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},ij=(i,t)=>{let e=t.dyn_tree,r=t.max_code,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length,c,d,u,f,m,S,T=0;for(f=0;f<=Rn;f++)i.bl_count[f]=0;for(e[i.heap[i.heap_max]*2+1]=0,c=i.heap_max+1;c<VM;c++)d=i.heap[c],f=e[e[d*2+1]*2+1]+1,f>l&&(f=l,T++),e[d*2+1]=f,!(d>r)&&(i.bl_count[f]++,m=0,d>=a&&(m=s[d-a]),S=e[d*2],i.opt_len+=S*(f+m),o&&(i.static_len+=S*(n[d*2+1]+m)));if(T!==0){do{for(f=l-1;i.bl_count[f]===0;)f--;i.bl_count[f]--,i.bl_count[f+1]+=2,i.bl_count[l]--,T-=2}while(T>0);for(f=l;f!==0;f--)for(d=i.bl_count[f];d!==0;)u=i.heap[--c],!(u>r)&&(e[u*2+1]!==f&&(i.opt_len+=(f-e[u*2+1])*e[u*2],e[u*2+1]=f),d--)}},JM=(i,t,e)=>{let r=new Array(Rn+1),n=0,o,s;for(o=1;o<=Rn;o++)n=n+e[o-1]<<1,r[o]=n;for(s=0;s<=t;s++){let a=i[s*2+1];a!==0&&(i[s*2]=KM(r[a]++,a))}},rj=()=>{let i,t,e,r,n,o=new Array(Rn+1);for(e=0,r=0;r<Fv-1;r++)for(Uv[r]=e,i=0;i<1<<Nv[r];i++)Ed[e++]=r;for(Ed[e-1]=r,n=0,r=0;r<16;r++)for(ff[r]=n,i=0;i<1<<uf[r];i++)Td[n++]=r;for(n>>=7;r<ys;r++)for(ff[r]=n<<7,i=0;i<1<<uf[r]-7;i++)Td[256+n++]=r;for(t=0;t<=Rn;t++)o[t]=0;for(i=0;i<=143;)Di[i*2+1]=8,i++,o[8]++;for(;i<=255;)Di[i*2+1]=9,i++,o[9]++;for(;i<=279;)Di[i*2+1]=7,i++,o[7]++;for(;i<=287;)Di[i*2+1]=8,i++,o[8]++;for(JM(Di,_d+1,o),i=0;i<ys;i++)Cd[i*2+1]=5,Cd[i*2]=KM(i,5);$M=new Pv(Di,Nv,Ad+1,_d,Rn),jM=new Pv(Cd,uf,0,ys,Rn),WM=new Pv(new Array(0),Z8,0,Bv,Y8)},QM=i=>{let t;for(t=0;t<_d;t++)i.dyn_ltree[t*2]=0;for(t=0;t<ys;t++)i.dyn_dtree[t*2]=0;for(t=0;t<Bv;t++)i.bl_tree[t*2]=0;i.dyn_ltree[Vv*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},XM=i=>{i.bi_valid>8?Id(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},RM=(i,t,e,r)=>{let n=t*2,o=e*2;return i[n]<i[o]||i[n]===i[o]&&r[t]<=r[e]},Dv=(i,t,e)=>{let r=i.heap[e],n=e<<1;for(;n<=i.heap_len&&(n<i.heap_len&&RM(t,i.heap[n+1],i.heap[n],i.depth)&&n++,!RM(t,r,i.heap[n],i.depth));)i.heap[e]=i.heap[n],e=n,n<<=1;i.heap[e]=r},DM=(i,t,e)=>{let r,n,o=0,s,a;if(i.sym_next!==0)do r=i.pending_buf[i.sym_buf+o++]&255,r+=(i.pending_buf[i.sym_buf+o++]&255)<<8,n=i.pending_buf[i.sym_buf+o++],r===0?fi(i,n,t):(s=Ed[n],fi(i,s+Ad+1,t),a=Nv[s],a!==0&&(n-=Uv[s],dt(i,n,a)),r--,s=GM(r),fi(i,s,e),a=uf[s],a!==0&&(r-=ff[s],dt(i,r,a)));while(o<i.sym_next);fi(i,Vv,t)},Lv=(i,t)=>{let e=t.dyn_tree,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.elems,s,a,l=-1,c;for(i.heap_len=0,i.heap_max=VM,s=0;s<o;s++)e[s*2]!==0?(i.heap[++i.heap_len]=l=s,i.depth[s]=0):e[s*2+1]=0;for(;i.heap_len<2;)c=i.heap[++i.heap_len]=l<2?++l:0,e[c*2]=1,i.depth[c]=0,i.opt_len--,n&&(i.static_len-=r[c*2+1]);for(t.max_code=l,s=i.heap_len>>1;s>=1;s--)Dv(i,e,s);c=o;do s=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Dv(i,e,1),a=i.heap[1],i.heap[--i.heap_max]=s,i.heap[--i.heap_max]=a,e[c*2]=e[s*2]+e[a*2],i.depth[c]=(i.depth[s]>=i.depth[a]?i.depth[s]:i.depth[a])+1,e[s*2+1]=e[a*2+1]=c,i.heap[1]=c++,Dv(i,e,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],ij(i,t),JM(e,l,i.bl_count)},NM=(i,t,e)=>{let r,n=-1,o,s=t[1],a=0,l=7,c=4;for(s===0&&(l=138,c=3),t[(e+1)*2+1]=65535,r=0;r<=e;r++)o=s,s=t[(r+1)*2+1],!(++a<l&&o===s)&&(a<c?i.bl_tree[o*2]+=a:o!==0?(o!==n&&i.bl_tree[o*2]++,i.bl_tree[UM*2]++):a<=10?i.bl_tree[qM*2]++:i.bl_tree[HM*2]++,a=0,n=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4))},LM=(i,t,e)=>{let r,n=-1,o,s=t[1],a=0,l=7,c=4;for(s===0&&(l=138,c=3),r=0;r<=e;r++)if(o=s,s=t[(r+1)*2+1],!(++a<l&&o===s)){if(a<c)do fi(i,o,i.bl_tree);while(--a!==0);else o!==0?(o!==n&&(fi(i,o,i.bl_tree),a--),fi(i,UM,i.bl_tree),dt(i,a-3,2)):a<=10?(fi(i,qM,i.bl_tree),dt(i,a-3,3)):(fi(i,HM,i.bl_tree),dt(i,a-11,7));a=0,n=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4)}},nj=i=>{let t;for(NM(i,i.dyn_ltree,i.l_desc.max_code),NM(i,i.dyn_dtree,i.d_desc.max_code),Lv(i,i.bl_desc),t=Bv-1;t>=3&&i.bl_tree[zM[t]*2+1]===0;t--);return i.opt_len+=3*(t+1)+5+5+4,t},oj=(i,t,e,r)=>{let n;for(dt(i,t-257,5),dt(i,e-1,5),dt(i,r-4,4),n=0;n<r;n++)dt(i,i.bl_tree[zM[n]*2+1],3);LM(i,i.dyn_ltree,t-1),LM(i,i.dyn_dtree,e-1)},sj=i=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&i.dyn_ltree[e*2]!==0)return 0;if(i.dyn_ltree[18]!==0||i.dyn_ltree[20]!==0||i.dyn_ltree[26]!==0)return 1;for(e=32;e<Ad;e++)if(i.dyn_ltree[e*2]!==0)return 1;return 0},FM=!1,aj=i=>{FM||(rj(),FM=!0),i.l_desc=new Rv(i.dyn_ltree,$M),i.d_desc=new Rv(i.dyn_dtree,jM),i.bl_desc=new Rv(i.bl_tree,WM),i.bi_buf=0,i.bi_valid=0,QM(i)},YM=(i,t,e,r)=>{dt(i,(K8<<1)+(r?1:0),3),XM(i),Id(i,e),Id(i,~e),e&&i.pending_buf.set(i.window.subarray(t,t+e),i.pending),i.pending+=e},dj=i=>{dt(i,BM<<1,3),fi(i,Vv,Di),tj(i)},cj=(i,t,e,r)=>{let n,o,s=0;i.level>0?(i.strm.data_type===2&&(i.strm.data_type=sj(i)),Lv(i,i.l_desc),Lv(i,i.d_desc),s=nj(i),n=i.opt_len+3+7>>>3,o=i.static_len+3+7>>>3,o<=n&&(n=o)):n=o=e+5,e+4<=n&&t!==-1?YM(i,t,e,r):i.strategy===4||o===n?(dt(i,(BM<<1)+(r?1:0),3),DM(i,Di,Cd)):(dt(i,(J8<<1)+(r?1:0),3),oj(i,i.l_desc.max_code+1,i.d_desc.max_code+1,s+1),DM(i,i.dyn_ltree,i.dyn_dtree)),QM(i),r&&XM(i)},lj=(i,t,e)=>(i.pending_buf[i.sym_buf+i.sym_next++]=t,i.pending_buf[i.sym_buf+i.sym_next++]=t>>8,i.pending_buf[i.sym_buf+i.sym_next++]=e,t===0?i.dyn_ltree[e*2]++:(i.matches++,t--,i.dyn_ltree[(Ed[e]+Ad+1)*2]++,i.dyn_dtree[GM(t)*2]++),i.sym_next===i.sym_end);bs.exports._tr_init=aj;bs.exports._tr_stored_block=YM;bs.exports._tr_flush_block=cj;bs.exports._tr_tally=lj;bs.exports._tr_align=dj});var qv=y((xne,ex)=>{"use strict";var uj=(i,t,e,r)=>{let n=i&65535|0,o=i>>>16&65535|0,s=0;for(;e!==0;){s=e>2e3?2e3:e,e-=s;do n=n+t[r++]|0,o=o+n|0;while(--s);n%=65521,o%=65521}return n|o<<16|0};ex.exports=uj});var Hv=y((One,tx)=>{"use strict";var fj=()=>{let i,t=[];for(var e=0;e<256;e++){i=e;for(var r=0;r<8;r++)i=i&1?3988292384^i>>>1:i>>>1;t[e]=i}return t},hj=new Uint32Array(fj()),pj=(i,t,e,r)=>{let n=hj,o=r+e;i^=-1;for(let s=r;s<o;s++)i=i>>>8^n[(i^t[s])&255];return i^-1};tx.exports=pj});var hf=y((Pne,ix)=>{"use strict";ix.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}});var Sr=y((Rne,rx)=>{"use strict";rx.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}});var hx=y((Dne,gi)=>{"use strict";var{_tr_init:mj,_tr_stored_block:jv,_tr_flush_block:gj,_tr_tally:wr,_tr_align:Sj}=ZM(),ax=qv(),yr=Hv(),yj=hf(),{Z_NO_FLUSH:Cr,Z_PARTIAL_FLUSH:vj,Z_FULL_FLUSH:bj,Z_FINISH:kt,Z_BLOCK:nx,Z_OK:Ke,Z_STREAM_END:ox,Z_STREAM_ERROR:pi,Z_DATA_ERROR:wj,Z_BUF_ERROR:zv,Z_DEFAULT_COMPRESSION:Cj,Z_FILTERED:_j,Z_HUFFMAN_ONLY:pf,Z_RLE:Tj,Z_FIXED:Ej,Z_DEFAULT_STRATEGY:Ij,Z_UNKNOWN:Aj,Z_DEFLATED:mf}=Sr(),kj=9,Mj=15,xj=8,Oj=29,Pj=256,Wv=Pj+1+Oj,Rj=30,Dj=19,Nj=2*Wv+1,Lj=15,Se=3,br=258,mi=br+Se+1,Fj=32,Cs=42,Yv=57,Gv=69,Kv=73,Jv=91,Qv=103,Dn=113,Md=666,rt=1,Ts=2,Ln=3,Es=4,Bj=3,Nn=(i,t)=>(i.msg=yj[t],t),sx=i=>i*2-(i>4?9:0),vr=i=>{let t=i.length;for(;--t>=0;)i[t]=0},Vj=i=>{let t,e,r,n=i.w_size;t=i.hash_size,r=t;do e=i.head[--r],i.head[r]=e>=n?e-n:0;while(--t);t=n,r=t;do e=i.prev[--r],i.prev[r]=e>=n?e-n:0;while(--t)},Uj=(i,t,e)=>(t<<i.hash_shift^e)&i.hash_mask,_r=Uj,gt=i=>{let t=i.state,e=t.pending;e>i.avail_out&&(e=i.avail_out),e!==0&&(i.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),i.next_out),i.next_out+=e,t.pending_out+=e,i.total_out+=e,i.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},St=(i,t)=>{gj(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,t),i.block_start=i.strstart,gt(i.strm)},be=(i,t)=>{i.pending_buf[i.pending++]=t},kd=(i,t)=>{i.pending_buf[i.pending++]=t>>>8&255,i.pending_buf[i.pending++]=t&255},Xv=(i,t,e,r)=>{let n=i.avail_in;return n>r&&(n=r),n===0?0:(i.avail_in-=n,t.set(i.input.subarray(i.next_in,i.next_in+n),e),i.state.wrap===1?i.adler=ax(i.adler,t,n,e):i.state.wrap===2&&(i.adler=yr(i.adler,t,n,e)),i.next_in+=n,i.total_in+=n,n)},dx=(i,t)=>{let e=i.max_chain_length,r=i.strstart,n,o,s=i.prev_length,a=i.nice_match,l=i.strstart>i.w_size-mi?i.strstart-(i.w_size-mi):0,c=i.window,d=i.w_mask,u=i.prev,f=i.strstart+br,m=c[r+s-1],S=c[r+s];i.prev_length>=i.good_match&&(e>>=2),a>i.lookahead&&(a=i.lookahead);do if(n=t,!(c[n+s]!==S||c[n+s-1]!==m||c[n]!==c[r]||c[++n]!==c[r+1])){r+=2,n++;do;while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<f);if(o=br-(f-r),r=f-br,o>s){if(i.match_start=t,s=o,o>=a)break;m=c[r+s-1],S=c[r+s]}}while((t=u[t&d])>l&&--e!==0);return s<=i.lookahead?s:i.lookahead},_s=i=>{let t=i.w_size,e,r,n;do{if(r=i.window_size-i.lookahead-i.strstart,i.strstart>=t+(t-mi)&&(i.window.set(i.window.subarray(t,t+t-r),0),i.match_start-=t,i.strstart-=t,i.block_start-=t,i.insert>i.strstart&&(i.insert=i.strstart),Vj(i),r+=t),i.strm.avail_in===0)break;if(e=Xv(i.strm,i.window,i.strstart+i.lookahead,r),i.lookahead+=e,i.lookahead+i.insert>=Se)for(n=i.strstart-i.insert,i.ins_h=i.window[n],i.ins_h=_r(i,i.ins_h,i.window[n+1]);i.insert&&(i.ins_h=_r(i,i.ins_h,i.window[n+Se-1]),i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++,i.insert--,!(i.lookahead+i.insert<Se)););}while(i.lookahead<mi&&i.strm.avail_in!==0)},cx=(i,t)=>{let e=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,r,n,o,s=0,a=i.strm.avail_in;do{if(r=65535,o=i.bi_valid+42>>3,i.strm.avail_out<o||(o=i.strm.avail_out-o,n=i.strstart-i.block_start,r>n+i.strm.avail_in&&(r=n+i.strm.avail_in),r>o&&(r=o),r<e&&(r===0&&t!==kt||t===Cr||r!==n+i.strm.avail_in)))break;s=t===kt&&r===n+i.strm.avail_in?1:0,jv(i,0,0,s),i.pending_buf[i.pending-4]=r,i.pending_buf[i.pending-3]=r>>8,i.pending_buf[i.pending-2]=~r,i.pending_buf[i.pending-1]=~r>>8,gt(i.strm),n&&(n>r&&(n=r),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+n),i.strm.next_out),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n,i.block_start+=n,r-=n),r&&(Xv(i.strm,i.strm.output,i.strm.next_out,r),i.strm.next_out+=r,i.strm.avail_out-=r,i.strm.total_out+=r)}while(s===0);return a-=i.strm.avail_in,a&&(a>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=a&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-a,i.strm.next_in),i.strstart),i.strstart+=a,i.insert+=a>i.w_size-i.insert?i.w_size-i.insert:a),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),s?Es:t!==Cr&&t!==kt&&i.strm.avail_in===0&&i.strstart===i.block_start?Ts:(o=i.window_size-i.strstart,i.strm.avail_in>o&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,o+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),o>i.strm.avail_in&&(o=i.strm.avail_in),o&&(Xv(i.strm,i.window,i.strstart,o),i.strstart+=o,i.insert+=o>i.w_size-i.insert?i.w_size-i.insert:o),i.high_water<i.strstart&&(i.high_water=i.strstart),o=i.bi_valid+42>>3,o=i.pending_buf_size-o>65535?65535:i.pending_buf_size-o,e=o>i.w_size?i.w_size:o,n=i.strstart-i.block_start,(n>=e||(n||t===kt)&&t!==Cr&&i.strm.avail_in===0&&n<=o)&&(r=n>o?o:n,s=t===kt&&i.strm.avail_in===0&&r===n?1:0,jv(i,i.block_start,r,s),i.block_start+=r,gt(i.strm)),s?Ln:rt)},$v=(i,t)=>{let e,r;for(;;){if(i.lookahead<mi){if(_s(i),i.lookahead<mi&&t===Cr)return rt;if(i.lookahead===0)break}if(e=0,i.lookahead>=Se&&(i.ins_h=_r(i,i.ins_h,i.window[i.strstart+Se-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),e!==0&&i.strstart-e<=i.w_size-mi&&(i.match_length=dx(i,e)),i.match_length>=Se)if(r=wr(i,i.strstart-i.match_start,i.match_length-Se),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=Se){i.match_length--;do i.strstart++,i.ins_h=_r(i,i.ins_h,i.window[i.strstart+Se-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=_r(i,i.ins_h,i.window[i.strstart+1]);else r=wr(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(r&&(St(i,!1),i.strm.avail_out===0))return rt}return i.insert=i.strstart<Se-1?i.strstart:Se-1,t===kt?(St(i,!0),i.strm.avail_out===0?Ln:Es):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?rt:Ts},ws=(i,t)=>{let e,r,n;for(;;){if(i.lookahead<mi){if(_s(i),i.lookahead<mi&&t===Cr)return rt;if(i.lookahead===0)break}if(e=0,i.lookahead>=Se&&(i.ins_h=_r(i,i.ins_h,i.window[i.strstart+Se-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=Se-1,e!==0&&i.prev_length<i.max_lazy_match&&i.strstart-e<=i.w_size-mi&&(i.match_length=dx(i,e),i.match_length<=5&&(i.strategy===_j||i.match_length===Se&&i.strstart-i.match_start>4096)&&(i.match_length=Se-1)),i.prev_length>=Se&&i.match_length<=i.prev_length){n=i.strstart+i.lookahead-Se,r=wr(i,i.strstart-1-i.prev_match,i.prev_length-Se),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=n&&(i.ins_h=_r(i,i.ins_h,i.window[i.strstart+Se-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=Se-1,i.strstart++,r&&(St(i,!1),i.strm.avail_out===0))return rt}else if(i.match_available){if(r=wr(i,0,i.window[i.strstart-1]),r&&St(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return rt}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(r=wr(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<Se-1?i.strstart:Se-1,t===kt?(St(i,!0),i.strm.avail_out===0?Ln:Es):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?rt:Ts},qj=(i,t)=>{let e,r,n,o,s=i.window;for(;;){if(i.lookahead<=br){if(_s(i),i.lookahead<=br&&t===Cr)return rt;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=Se&&i.strstart>0&&(n=i.strstart-1,r=s[n],r===s[++n]&&r===s[++n]&&r===s[++n])){o=i.strstart+br;do;while(r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&n<o);i.match_length=br-(o-n),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=Se?(e=wr(i,1,i.match_length-Se),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(e=wr(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),e&&(St(i,!1),i.strm.avail_out===0))return rt}return i.insert=0,t===kt?(St(i,!0),i.strm.avail_out===0?Ln:Es):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?rt:Ts},Hj=(i,t)=>{let e;for(;;){if(i.lookahead===0&&(_s(i),i.lookahead===0)){if(t===Cr)return rt;break}if(i.match_length=0,e=wr(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,e&&(St(i,!1),i.strm.avail_out===0))return rt}return i.insert=0,t===kt?(St(i,!0),i.strm.avail_out===0?Ln:Es):i.sym_next&&(St(i,!1),i.strm.avail_out===0)?rt:Ts};function hi(i,t,e,r,n){this.good_length=i,this.max_lazy=t,this.nice_length=e,this.max_chain=r,this.func=n}var xd=[new hi(0,0,0,0,cx),new hi(4,4,8,4,$v),new hi(4,5,16,8,$v),new hi(4,6,32,32,$v),new hi(4,4,16,16,ws),new hi(8,16,32,32,ws),new hi(8,16,128,128,ws),new hi(8,32,128,256,ws),new hi(32,128,258,1024,ws),new hi(32,258,258,4096,ws)],zj=i=>{i.window_size=2*i.w_size,vr(i.head),i.max_lazy_match=xd[i.level].max_lazy,i.good_match=xd[i.level].good_length,i.nice_match=xd[i.level].nice_length,i.max_chain_length=xd[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=Se-1,i.match_available=0,i.ins_h=0};function $j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=mf,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Nj*2),this.dyn_dtree=new Uint16Array((2*Rj+1)*2),this.bl_tree=new Uint16Array((2*Dj+1)*2),vr(this.dyn_ltree),vr(this.dyn_dtree),vr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Lj+1),this.heap=new Uint16Array(2*Wv+1),vr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Wv+1),vr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Od=i=>{if(!i)return 1;let t=i.state;return!t||t.strm!==i||t.status!==Cs&&t.status!==Yv&&t.status!==Gv&&t.status!==Kv&&t.status!==Jv&&t.status!==Qv&&t.status!==Dn&&t.status!==Md?1:0},lx=i=>{if(Od(i))return Nn(i,pi);i.total_in=i.total_out=0,i.data_type=Aj;let t=i.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?Yv:t.wrap?Cs:Dn,i.adler=t.wrap===2?0:1,t.last_flush=-2,mj(t),Ke},ux=i=>{let t=lx(i);return t===Ke&&zj(i.state),t},jj=(i,t)=>Od(i)||i.state.wrap!==2?pi:(i.state.gzhead=t,Ke),fx=(i,t,e,r,n,o)=>{if(!i)return pi;let s=1;if(t===Cj&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),n<1||n>kj||e!==mf||r<8||r>15||t<0||t>9||o<0||o>Ej||r===8&&s!==1)return Nn(i,pi);r===8&&(r=9);let a=new $j;return i.state=a,a.strm=i,a.status=Cs,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Se-1)/Se),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=t,a.strategy=o,a.method=e,ux(i)},Wj=(i,t)=>fx(i,t,mf,Mj,xj,Ij),Gj=(i,t)=>{if(Od(i)||t>nx||t<0)return i?Nn(i,pi):pi;let e=i.state;if(!i.output||i.avail_in!==0&&!i.input||e.status===Md&&t!==kt)return Nn(i,i.avail_out===0?zv:pi);let r=e.last_flush;if(e.last_flush=t,e.pending!==0){if(gt(i),i.avail_out===0)return e.last_flush=-1,Ke}else if(i.avail_in===0&&sx(t)<=sx(r)&&t!==kt)return Nn(i,zv);if(e.status===Md&&i.avail_in!==0)return Nn(i,zv);if(e.status===Cs&&e.wrap===0&&(e.status=Dn),e.status===Cs){let n=mf+(e.w_bits-8<<4)<<8,o=-1;if(e.strategy>=pf||e.level<2?o=0:e.level<6?o=1:e.level===6?o=2:o=3,n|=o<<6,e.strstart!==0&&(n|=Fj),n+=31-n%31,kd(e,n),e.strstart!==0&&(kd(e,i.adler>>>16),kd(e,i.adler&65535)),i.adler=1,e.status=Dn,gt(i),e.pending!==0)return e.last_flush=-1,Ke}if(e.status===Yv){if(i.adler=0,be(e,31),be(e,139),be(e,8),e.gzhead)be(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),be(e,e.gzhead.time&255),be(e,e.gzhead.time>>8&255),be(e,e.gzhead.time>>16&255),be(e,e.gzhead.time>>24&255),be(e,e.level===9?2:e.strategy>=pf||e.level<2?4:0),be(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(be(e,e.gzhead.extra.length&255),be(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(i.adler=yr(i.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Gv;else if(be(e,0),be(e,0),be(e,0),be(e,0),be(e,0),be(e,e.level===9?2:e.strategy>=pf||e.level<2?4:0),be(e,Bj),e.status=Dn,gt(i),e.pending!==0)return e.last_flush=-1,Ke}if(e.status===Gv){if(e.gzhead.extra){let n=e.pending,o=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+o>e.pending_buf_size;){let a=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>n&&(i.adler=yr(i.adler,e.pending_buf,e.pending-n,n)),e.gzindex+=a,gt(i),e.pending!==0)return e.last_flush=-1,Ke;n=0,o-=a}let s=new Uint8Array(e.gzhead.extra);e.pending_buf.set(s.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending+=o,e.gzhead.hcrc&&e.pending>n&&(i.adler=yr(i.adler,e.pending_buf,e.pending-n,n)),e.gzindex=0}e.status=Kv}if(e.status===Kv){if(e.gzhead.name){let n=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>n&&(i.adler=yr(i.adler,e.pending_buf,e.pending-n,n)),gt(i),e.pending!==0)return e.last_flush=-1,Ke;n=0}e.gzindex<e.gzhead.name.length?o=e.gzhead.name.charCodeAt(e.gzindex++)&255:o=0,be(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>n&&(i.adler=yr(i.adler,e.pending_buf,e.pending-n,n)),e.gzindex=0}e.status=Jv}if(e.status===Jv){if(e.gzhead.comment){let n=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>n&&(i.adler=yr(i.adler,e.pending_buf,e.pending-n,n)),gt(i),e.pending!==0)return e.last_flush=-1,Ke;n=0}e.gzindex<e.gzhead.comment.length?o=e.gzhead.comment.charCodeAt(e.gzindex++)&255:o=0,be(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>n&&(i.adler=yr(i.adler,e.pending_buf,e.pending-n,n))}e.status=Qv}if(e.status===Qv){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(gt(i),e.pending!==0))return e.last_flush=-1,Ke;be(e,i.adler&255),be(e,i.adler>>8&255),i.adler=0}if(e.status=Dn,gt(i),e.pending!==0)return e.last_flush=-1,Ke}if(i.avail_in!==0||e.lookahead!==0||t!==Cr&&e.status!==Md){let n=e.level===0?cx(e,t):e.strategy===pf?Hj(e,t):e.strategy===Tj?qj(e,t):xd[e.level].func(e,t);if((n===Ln||n===Es)&&(e.status=Md),n===rt||n===Ln)return i.avail_out===0&&(e.last_flush=-1),Ke;if(n===Ts&&(t===vj?Sj(e):t!==nx&&(jv(e,0,0,!1),t===bj&&(vr(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),gt(i),i.avail_out===0))return e.last_flush=-1,Ke}return t!==kt?Ke:e.wrap<=0?ox:(e.wrap===2?(be(e,i.adler&255),be(e,i.adler>>8&255),be(e,i.adler>>16&255),be(e,i.adler>>24&255),be(e,i.total_in&255),be(e,i.total_in>>8&255),be(e,i.total_in>>16&255),be(e,i.total_in>>24&255)):(kd(e,i.adler>>>16),kd(e,i.adler&65535)),gt(i),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Ke:ox)},Kj=i=>{if(Od(i))return pi;let t=i.state.status;return i.state=null,t===Dn?Nn(i,wj):Ke},Jj=(i,t)=>{let e=t.length;if(Od(i))return pi;let r=i.state,n=r.wrap;if(n===2||n===1&&r.status!==Cs||r.lookahead)return pi;if(n===1&&(i.adler=ax(i.adler,t,e,0)),r.wrap=0,e>=r.w_size){n===0&&(vr(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(t.subarray(e-r.w_size,e),0),t=l,e=r.w_size}let o=i.avail_in,s=i.next_in,a=i.input;for(i.avail_in=e,i.next_in=0,i.input=t,_s(r);r.lookahead>=Se;){let l=r.strstart,c=r.lookahead-(Se-1);do r.ins_h=_r(r,r.ins_h,r.window[l+Se-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--c);r.strstart=l,r.lookahead=Se-1,_s(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Se-1,r.match_available=0,i.next_in=s,i.input=a,i.avail_in=o,r.wrap=n,Ke};gi.exports.deflateInit=Wj;gi.exports.deflateInit2=fx;gi.exports.deflateReset=ux;gi.exports.deflateResetKeep=lx;gi.exports.deflateSetHeader=jj;gi.exports.deflate=Gj;gi.exports.deflateEnd=Kj;gi.exports.deflateSetDictionary=Jj;gi.exports.deflateInfo="pako deflate (from Nodeca project)"});var eb=y((Nne,Zv)=>{"use strict";var Qj=(i,t)=>Object.prototype.hasOwnProperty.call(i,t);Zv.exports.assign=function(i){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let r in e)Qj(e,r)&&(i[r]=e[r])}}return i};Zv.exports.flattenChunks=i=>{let t=0;for(let r=0,n=i.length;r<n;r++)t+=i[r].length;let e=new Uint8Array(t);for(let r=0,n=0,o=i.length;r<o;r++){let s=i[r];e.set(s,n),n+=s.length}return e}});var tb=y((Lne,gf)=>{"use strict";var px=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{px=!1}var Pd=new Uint8Array(256);for(let i=0;i<256;i++)Pd[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;Pd[254]=Pd[254]=1;gf.exports.string2buf=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let t,e,r,n,o,s=i.length,a=0;for(n=0;n<s;n++)e=i.charCodeAt(n),(e&64512)===55296&&n+1<s&&(r=i.charCodeAt(n+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),n++)),a+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(a),o=0,n=0;o<a;n++)e=i.charCodeAt(n),(e&64512)===55296&&n+1<s&&(r=i.charCodeAt(n+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),n++)),e<128?t[o++]=e:e<2048?(t[o++]=192|e>>>6,t[o++]=128|e&63):e<65536?(t[o++]=224|e>>>12,t[o++]=128|e>>>6&63,t[o++]=128|e&63):(t[o++]=240|e>>>18,t[o++]=128|e>>>12&63,t[o++]=128|e>>>6&63,t[o++]=128|e&63);return t};var Xj=(i,t)=>{if(t<65534&&i.subarray&&px)return String.fromCharCode.apply(null,i.length===t?i:i.subarray(0,t));let e="";for(let r=0;r<t;r++)e+=String.fromCharCode(i[r]);return e};gf.exports.buf2string=(i,t)=>{let e=t||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,t));let r,n,o=new Array(e*2);for(n=0,r=0;r<e;){let s=i[r++];if(s<128){o[n++]=s;continue}let a=Pd[s];if(a>4){o[n++]=65533,r+=a-1;continue}for(s&=a===2?31:a===3?15:7;a>1&&r<e;)s=s<<6|i[r++]&63,a--;if(a>1){o[n++]=65533;continue}s<65536?o[n++]=s:(s-=65536,o[n++]=55296|s>>10&1023,o[n++]=56320|s&1023)}return Xj(o,n)};gf.exports.utf8border=(i,t)=>{t=t||i.length,t>i.length&&(t=i.length);let e=t-1;for(;e>=0&&(i[e]&192)===128;)e--;return e<0||e===0?t:e+Pd[i[e]]>t?e:t}});var ib=y((Fne,mx)=>{"use strict";function Yj(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}mx.exports=Yj});var vx=y((Bne,Is)=>{"use strict";var Rd=hx(),gx=eb(),Sx=tb(),rb=hf(),Zj=ib(),yx=Object.prototype.toString,{Z_NO_FLUSH:eW,Z_SYNC_FLUSH:tW,Z_FULL_FLUSH:iW,Z_FINISH:rW,Z_OK:Sf,Z_STREAM_END:nW,Z_DEFAULT_COMPRESSION:oW,Z_DEFAULT_STRATEGY:sW,Z_DEFLATED:aW}=Sr();function Dd(i){this.options=gx.assign({level:oW,method:aW,chunkSize:16384,windowBits:15,memLevel:8,strategy:sW},i||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Zj,this.strm.avail_out=0;let e=Rd.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Sf)throw new Error(rb[e]);if(t.header&&Rd.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(typeof t.dictionary=="string"?r=Sx.string2buf(t.dictionary):yx.call(t.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(t.dictionary):r=t.dictionary,e=Rd.deflateSetDictionary(this.strm,r),e!==Sf)throw new Error(rb[e]);this._dict_set=!0}}Dd.prototype.push=function(i,t){let e=this.strm,r=this.options.chunkSize,n,o;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?rW:eW,typeof i=="string"?e.input=Sx.string2buf(i):yx.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),(o===tW||o===iW)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(n=Rd.deflate(e,o),n===nW)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),n=Rd.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Sf;if(e.avail_out===0){this.onData(e.output);continue}if(o>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Dd.prototype.onData=function(i){this.chunks.push(i)};Dd.prototype.onEnd=function(i){i===Sf&&(this.result=gx.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function nb(i,t){let e=new Dd(t);if(e.push(i,!0),e.err)throw e.msg||rb[e.err];return e.result}function dW(i,t){return t=t||{},t.raw=!0,nb(i,t)}function cW(i,t){return t=t||{},t.gzip=!0,nb(i,t)}Is.exports.Deflate=Dd;Is.exports.deflate=nb;Is.exports.deflateRaw=dW;Is.exports.gzip=cW;Is.exports.constants=Sr()});var wx=y((Vne,bx)=>{"use strict";bx.exports=function(t,e){let r,n,o,s,a,l,c,d,u,f,m,S,T,_,C,I,A,E,V,W,D,N,F,G,oe=t.state;r=t.next_in,F=t.input,n=r+(t.avail_in-5),o=t.next_out,G=t.output,s=o-(e-t.avail_out),a=o+(t.avail_out-257),l=oe.dmax,c=oe.wsize,d=oe.whave,u=oe.wnext,f=oe.window,m=oe.hold,S=oe.bits,T=oe.lencode,_=oe.distcode,C=(1<<oe.lenbits)-1,I=(1<<oe.distbits)-1;e:do{S<15&&(m+=F[r++]<<S,S+=8,m+=F[r++]<<S,S+=8),A=T[m&C];t:for(;;){if(E=A>>>24,m>>>=E,S-=E,E=A>>>16&255,E===0)G[o++]=A&65535;else if(E&16){V=A&65535,E&=15,E&&(S<E&&(m+=F[r++]<<S,S+=8),V+=m&(1<<E)-1,m>>>=E,S-=E),S<15&&(m+=F[r++]<<S,S+=8,m+=F[r++]<<S,S+=8),A=_[m&I];i:for(;;){if(E=A>>>24,m>>>=E,S-=E,E=A>>>16&255,E&16){if(W=A&65535,E&=15,S<E&&(m+=F[r++]<<S,S+=8,S<E&&(m+=F[r++]<<S,S+=8)),W+=m&(1<<E)-1,W>l){t.msg="invalid distance too far back",oe.mode=16209;break e}if(m>>>=E,S-=E,E=o-s,W>E){if(E=W-E,E>d&&oe.sane){t.msg="invalid distance too far back",oe.mode=16209;break e}if(D=0,N=f,u===0){if(D+=c-E,E<V){V-=E;do G[o++]=f[D++];while(--E);D=o-W,N=G}}else if(u<E){if(D+=c+u-E,E-=u,E<V){V-=E;do G[o++]=f[D++];while(--E);if(D=0,u<V){E=u,V-=E;do G[o++]=f[D++];while(--E);D=o-W,N=G}}}else if(D+=u-E,E<V){V-=E;do G[o++]=f[D++];while(--E);D=o-W,N=G}for(;V>2;)G[o++]=N[D++],G[o++]=N[D++],G[o++]=N[D++],V-=3;V&&(G[o++]=N[D++],V>1&&(G[o++]=N[D++]))}else{D=o-W;do G[o++]=G[D++],G[o++]=G[D++],G[o++]=G[D++],V-=3;while(V>2);V&&(G[o++]=G[D++],V>1&&(G[o++]=G[D++]))}}else if((E&64)===0){A=_[(A&65535)+(m&(1<<E)-1)];continue i}else{t.msg="invalid distance code",oe.mode=16209;break e}break}}else if((E&64)===0){A=T[(A&65535)+(m&(1<<E)-1)];continue t}else if(E&32){oe.mode=16191;break e}else{t.msg="invalid literal/length code",oe.mode=16209;break e}break}}while(r<n&&o<a);V=S>>3,r-=V,S-=V<<3,m&=(1<<S)-1,t.next_in=r,t.next_out=o,t.avail_in=r<n?5+(n-r):5-(r-n),t.avail_out=o<a?257+(a-o):257-(o-a),oe.hold=m,oe.bits=S}});var _x=y((Une,Cx)=>{"use strict";var lW=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),uW=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fW=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),hW=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),pW=(i,t,e,r,n,o,s,a)=>{let l=a.bits,c=0,d=0,u=0,f=0,m=0,S=0,T=0,_=0,C=0,I=0,A,E,V,W,D,N=null,F,G=new Uint16Array(16),oe=new Uint16Array(16),ze=null,oi,Ai,ki;for(c=0;c<=15;c++)G[c]=0;for(d=0;d<r;d++)G[t[e+d]]++;for(m=l,f=15;f>=1&&G[f]===0;f--);if(m>f&&(m=f),f===0)return n[o++]=1<<24|64<<16|0,n[o++]=1<<24|64<<16|0,a.bits=1,0;for(u=1;u<f&&G[u]===0;u++);for(m<u&&(m=u),_=1,c=1;c<=15;c++)if(_<<=1,_-=G[c],_<0)return-1;if(_>0&&(i===0||f!==1))return-1;for(oe[1]=0,c=1;c<15;c++)oe[c+1]=oe[c]+G[c];for(d=0;d<r;d++)t[e+d]!==0&&(s[oe[t[e+d]]++]=d);if(i===0?(N=ze=s,F=20):i===1?(N=lW,ze=uW,F=257):(N=fW,ze=hW,F=0),I=0,d=0,c=u,D=o,S=m,T=0,V=-1,C=1<<m,W=C-1,i===1&&C>852||i===2&&C>592)return 1;for(;;){oi=c-T,s[d]+1<F?(Ai=0,ki=s[d]):s[d]>=F?(Ai=ze[s[d]-F],ki=N[s[d]-F]):(Ai=96,ki=0),A=1<<c-T,E=1<<S,u=E;do E-=A,n[D+(I>>T)+E]=oi<<24|Ai<<16|ki|0;while(E!==0);for(A=1<<c-1;I&A;)A>>=1;if(A!==0?(I&=A-1,I+=A):I=0,d++,--G[c]===0){if(c===f)break;c=t[e+s[d]]}if(c>m&&(I&W)!==V){for(T===0&&(T=m),D+=u,S=c-T,_=1<<S;S+T<f&&(_-=G[S+T],!(_<=0));)S++,_<<=1;if(C+=1<<S,i===1&&C>852||i===2&&C>592)return 1;V=I&W,n[V]=m<<24|S<<16|D-o|0}}return I!==0&&(n[D+I]=c-T<<24|64<<16|0),a.bits=m,0};Cx.exports=pW});var nO=y((qne,Wt)=>{"use strict";var lb=qv(),Si=Hv(),mW=wx(),Nd=_x(),gW=0,Jx=1,Qx=2,{Z_FINISH:Tx,Z_BLOCK:SW,Z_TREES:yf,Z_OK:Fn,Z_STREAM_END:yW,Z_NEED_DICT:vW,Z_STREAM_ERROR:Mt,Z_DATA_ERROR:Xx,Z_MEM_ERROR:ub,Z_BUF_ERROR:bW,Z_DEFLATED:Ex}=Sr(),Cf=16180,Ix=16181,Ax=16182,kx=16183,Mx=16184,xx=16185,Ox=16186,Px=16187,Rx=16188,Dx=16189,wf=16190,Ni=16191,ob=16192,Nx=16193,sb=16194,Lx=16195,Fx=16196,Bx=16197,Vx=16198,vf=16199,bf=16200,Ux=16201,qx=16202,Hx=16203,zx=16204,$x=16205,ab=16206,jx=16207,Wx=16208,xe=16209,fb=16210,Yx=16211,wW=852,CW=592,_W=15,TW=_W,Gx=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function EW(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Bn=i=>{if(!i)return 1;let t=i.state;return!t||t.strm!==i||t.mode<Cf||t.mode>Yx?1:0},Zx=i=>{if(Bn(i))return Mt;let t=i.state;return i.total_in=i.total_out=t.total=0,i.msg="",t.wrap&&(i.adler=t.wrap&1),t.mode=Cf,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(wW),t.distcode=t.distdyn=new Int32Array(CW),t.sane=1,t.back=-1,Fn},eO=i=>{if(Bn(i))return Mt;let t=i.state;return t.wsize=0,t.whave=0,t.wnext=0,Zx(i)},tO=(i,t)=>{let e;if(Bn(i))return Mt;let r=i.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Mt:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=e,r.wbits=t,eO(i))},iO=(i,t)=>{if(!i)return Mt;let e=new EW;i.state=e,e.strm=i,e.window=null,e.mode=Cf;let r=tO(i,t);return r!==Fn&&(i.state=null),r},IW=i=>iO(i,TW),Kx=!0,db,cb,AW=i=>{if(Kx){db=new Int32Array(512),cb=new Int32Array(32);let t=0;for(;t<144;)i.lens[t++]=8;for(;t<256;)i.lens[t++]=9;for(;t<280;)i.lens[t++]=7;for(;t<288;)i.lens[t++]=8;for(Nd(Jx,i.lens,0,288,db,0,i.work,{bits:9}),t=0;t<32;)i.lens[t++]=5;Nd(Qx,i.lens,0,32,cb,0,i.work,{bits:5}),Kx=!1}i.lencode=db,i.lenbits=9,i.distcode=cb,i.distbits=5},rO=(i,t,e,r)=>{let n,o=i.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(e-o.wsize,e),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>r&&(n=r),o.window.set(t.subarray(e-r,e-r+n),o.wnext),r-=n,r?(o.window.set(t.subarray(e-r,e),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0},kW=(i,t)=>{let e,r,n,o,s,a,l,c,d,u,f,m,S,T,_=0,C,I,A,E,V,W,D,N,F=new Uint8Array(4),G,oe,ze=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Bn(i)||!i.output||!i.input&&i.avail_in!==0)return Mt;e=i.state,e.mode===Ni&&(e.mode=ob),s=i.next_out,n=i.output,l=i.avail_out,o=i.next_in,r=i.input,a=i.avail_in,c=e.hold,d=e.bits,u=a,f=l,N=Fn;e:for(;;)switch(e.mode){case Cf:if(e.wrap===0){e.mode=ob;break}for(;d<16;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(e.wrap&2&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,F[0]=c&255,F[1]=c>>>8&255,e.check=Si(e.check,F,2,0),c=0,d=0,e.mode=Ix;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((c&255)<<8)+(c>>8))%31){i.msg="incorrect header check",e.mode=xe;break}if((c&15)!==Ex){i.msg="unknown compression method",e.mode=xe;break}if(c>>>=4,d-=4,D=(c&15)+8,e.wbits===0&&(e.wbits=D),D>15||D>e.wbits){i.msg="invalid window size",e.mode=xe;break}e.dmax=1<<e.wbits,e.flags=0,i.adler=e.check=1,e.mode=c&512?Dx:Ni,c=0,d=0;break;case Ix:for(;d<16;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(e.flags=c,(e.flags&255)!==Ex){i.msg="unknown compression method",e.mode=xe;break}if(e.flags&57344){i.msg="unknown header flags set",e.mode=xe;break}e.head&&(e.head.text=c>>8&1),e.flags&512&&e.wrap&4&&(F[0]=c&255,F[1]=c>>>8&255,e.check=Si(e.check,F,2,0)),c=0,d=0,e.mode=Ax;case Ax:for(;d<32;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}e.head&&(e.head.time=c),e.flags&512&&e.wrap&4&&(F[0]=c&255,F[1]=c>>>8&255,F[2]=c>>>16&255,F[3]=c>>>24&255,e.check=Si(e.check,F,4,0)),c=0,d=0,e.mode=kx;case kx:for(;d<16;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}e.head&&(e.head.xflags=c&255,e.head.os=c>>8),e.flags&512&&e.wrap&4&&(F[0]=c&255,F[1]=c>>>8&255,e.check=Si(e.check,F,2,0)),c=0,d=0,e.mode=Mx;case Mx:if(e.flags&1024){for(;d<16;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}e.length=c,e.head&&(e.head.extra_len=c),e.flags&512&&e.wrap&4&&(F[0]=c&255,F[1]=c>>>8&255,e.check=Si(e.check,F,2,0)),c=0,d=0}else e.head&&(e.head.extra=null);e.mode=xx;case xx:if(e.flags&1024&&(m=e.length,m>a&&(m=a),m&&(e.head&&(D=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(o,o+m),D)),e.flags&512&&e.wrap&4&&(e.check=Si(e.check,r,m,o)),a-=m,o+=m,e.length-=m),e.length))break e;e.length=0,e.mode=Ox;case Ox:if(e.flags&2048){if(a===0)break e;m=0;do D=r[o+m++],e.head&&D&&e.length<65536&&(e.head.name+=String.fromCharCode(D));while(D&&m<a);if(e.flags&512&&e.wrap&4&&(e.check=Si(e.check,r,m,o)),a-=m,o+=m,D)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Px;case Px:if(e.flags&4096){if(a===0)break e;m=0;do D=r[o+m++],e.head&&D&&e.length<65536&&(e.head.comment+=String.fromCharCode(D));while(D&&m<a);if(e.flags&512&&e.wrap&4&&(e.check=Si(e.check,r,m,o)),a-=m,o+=m,D)break e}else e.head&&(e.head.comment=null);e.mode=Rx;case Rx:if(e.flags&512){for(;d<16;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(e.wrap&4&&c!==(e.check&65535)){i.msg="header crc mismatch",e.mode=xe;break}c=0,d=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),i.adler=e.check=0,e.mode=Ni;break;case Dx:for(;d<32;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}i.adler=e.check=Gx(c),c=0,d=0,e.mode=wf;case wf:if(e.havedict===0)return i.next_out=s,i.avail_out=l,i.next_in=o,i.avail_in=a,e.hold=c,e.bits=d,vW;i.adler=e.check=1,e.mode=Ni;case Ni:if(t===SW||t===yf)break e;case ob:if(e.last){c>>>=d&7,d-=d&7,e.mode=ab;break}for(;d<3;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}switch(e.last=c&1,c>>>=1,d-=1,c&3){case 0:e.mode=Nx;break;case 1:if(AW(e),e.mode=vf,t===yf){c>>>=2,d-=2;break e}break;case 2:e.mode=Fx;break;case 3:i.msg="invalid block type",e.mode=xe}c>>>=2,d-=2;break;case Nx:for(c>>>=d&7,d-=d&7;d<32;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if((c&65535)!==(c>>>16^65535)){i.msg="invalid stored block lengths",e.mode=xe;break}if(e.length=c&65535,c=0,d=0,e.mode=sb,t===yf)break e;case sb:e.mode=Lx;case Lx:if(m=e.length,m){if(m>a&&(m=a),m>l&&(m=l),m===0)break e;n.set(r.subarray(o,o+m),s),a-=m,o+=m,l-=m,s+=m,e.length-=m;break}e.mode=Ni;break;case Fx:for(;d<14;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(e.nlen=(c&31)+257,c>>>=5,d-=5,e.ndist=(c&31)+1,c>>>=5,d-=5,e.ncode=(c&15)+4,c>>>=4,d-=4,e.nlen>286||e.ndist>30){i.msg="too many length or distance symbols",e.mode=xe;break}e.have=0,e.mode=Bx;case Bx:for(;e.have<e.ncode;){for(;d<3;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}e.lens[ze[e.have++]]=c&7,c>>>=3,d-=3}for(;e.have<19;)e.lens[ze[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,G={bits:e.lenbits},N=Nd(gW,e.lens,0,19,e.lencode,0,e.work,G),e.lenbits=G.bits,N){i.msg="invalid code lengths set",e.mode=xe;break}e.have=0,e.mode=Vx;case Vx:for(;e.have<e.nlen+e.ndist;){for(;_=e.lencode[c&(1<<e.lenbits)-1],C=_>>>24,I=_>>>16&255,A=_&65535,!(C<=d);){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(A<16)c>>>=C,d-=C,e.lens[e.have++]=A;else{if(A===16){for(oe=C+2;d<oe;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(c>>>=C,d-=C,e.have===0){i.msg="invalid bit length repeat",e.mode=xe;break}D=e.lens[e.have-1],m=3+(c&3),c>>>=2,d-=2}else if(A===17){for(oe=C+3;d<oe;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}c>>>=C,d-=C,D=0,m=3+(c&7),c>>>=3,d-=3}else{for(oe=C+7;d<oe;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}c>>>=C,d-=C,D=0,m=11+(c&127),c>>>=7,d-=7}if(e.have+m>e.nlen+e.ndist){i.msg="invalid bit length repeat",e.mode=xe;break}for(;m--;)e.lens[e.have++]=D}}if(e.mode===xe)break;if(e.lens[256]===0){i.msg="invalid code -- missing end-of-block",e.mode=xe;break}if(e.lenbits=9,G={bits:e.lenbits},N=Nd(Jx,e.lens,0,e.nlen,e.lencode,0,e.work,G),e.lenbits=G.bits,N){i.msg="invalid literal/lengths set",e.mode=xe;break}if(e.distbits=6,e.distcode=e.distdyn,G={bits:e.distbits},N=Nd(Qx,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,G),e.distbits=G.bits,N){i.msg="invalid distances set",e.mode=xe;break}if(e.mode=vf,t===yf)break e;case vf:e.mode=bf;case bf:if(a>=6&&l>=258){i.next_out=s,i.avail_out=l,i.next_in=o,i.avail_in=a,e.hold=c,e.bits=d,mW(i,f),s=i.next_out,n=i.output,l=i.avail_out,o=i.next_in,r=i.input,a=i.avail_in,c=e.hold,d=e.bits,e.mode===Ni&&(e.back=-1);break}for(e.back=0;_=e.lencode[c&(1<<e.lenbits)-1],C=_>>>24,I=_>>>16&255,A=_&65535,!(C<=d);){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(I&&(I&240)===0){for(E=C,V=I,W=A;_=e.lencode[W+((c&(1<<E+V)-1)>>E)],C=_>>>24,I=_>>>16&255,A=_&65535,!(E+C<=d);){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}c>>>=E,d-=E,e.back+=E}if(c>>>=C,d-=C,e.back+=C,e.length=A,I===0){e.mode=$x;break}if(I&32){e.back=-1,e.mode=Ni;break}if(I&64){i.msg="invalid literal/length code",e.mode=xe;break}e.extra=I&15,e.mode=Ux;case Ux:if(e.extra){for(oe=e.extra;d<oe;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,d-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=qx;case qx:for(;_=e.distcode[c&(1<<e.distbits)-1],C=_>>>24,I=_>>>16&255,A=_&65535,!(C<=d);){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if((I&240)===0){for(E=C,V=I,W=A;_=e.distcode[W+((c&(1<<E+V)-1)>>E)],C=_>>>24,I=_>>>16&255,A=_&65535,!(E+C<=d);){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}c>>>=E,d-=E,e.back+=E}if(c>>>=C,d-=C,e.back+=C,I&64){i.msg="invalid distance code",e.mode=xe;break}e.offset=A,e.extra=I&15,e.mode=Hx;case Hx:if(e.extra){for(oe=e.extra;d<oe;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,d-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){i.msg="invalid distance too far back",e.mode=xe;break}e.mode=zx;case zx:if(l===0)break e;if(m=f-l,e.offset>m){if(m=e.offset-m,m>e.whave&&e.sane){i.msg="invalid distance too far back",e.mode=xe;break}m>e.wnext?(m-=e.wnext,S=e.wsize-m):S=e.wnext-m,m>e.length&&(m=e.length),T=e.window}else T=n,S=s-e.offset,m=e.length;m>l&&(m=l),l-=m,e.length-=m;do n[s++]=T[S++];while(--m);e.length===0&&(e.mode=bf);break;case $x:if(l===0)break e;n[s++]=e.length,l--,e.mode=bf;break;case ab:if(e.wrap){for(;d<32;){if(a===0)break e;a--,c|=r[o++]<<d,d+=8}if(f-=l,i.total_out+=f,e.total+=f,e.wrap&4&&f&&(i.adler=e.check=e.flags?Si(e.check,n,f,s-f):lb(e.check,n,f,s-f)),f=l,e.wrap&4&&(e.flags?c:Gx(c))!==e.check){i.msg="incorrect data check",e.mode=xe;break}c=0,d=0}e.mode=jx;case jx:if(e.wrap&&e.flags){for(;d<32;){if(a===0)break e;a--,c+=r[o++]<<d,d+=8}if(e.wrap&4&&c!==(e.total&4294967295)){i.msg="incorrect length check",e.mode=xe;break}c=0,d=0}e.mode=Wx;case Wx:N=yW;break e;case xe:N=Xx;break e;case fb:return ub;case Yx:default:return Mt}return i.next_out=s,i.avail_out=l,i.next_in=o,i.avail_in=a,e.hold=c,e.bits=d,(e.wsize||f!==i.avail_out&&e.mode<xe&&(e.mode<ab||t!==Tx))&&rO(i,i.output,i.next_out,f-i.avail_out)?(e.mode=fb,ub):(u-=i.avail_in,f-=i.avail_out,i.total_in+=u,i.total_out+=f,e.total+=f,e.wrap&4&&f&&(i.adler=e.check=e.flags?Si(e.check,n,f,i.next_out-f):lb(e.check,n,f,i.next_out-f)),i.data_type=e.bits+(e.last?64:0)+(e.mode===Ni?128:0)+(e.mode===vf||e.mode===sb?256:0),(u===0&&f===0||t===Tx)&&N===Fn&&(N=bW),N)},MW=i=>{if(Bn(i))return Mt;let t=i.state;return t.window&&(t.window=null),i.state=null,Fn},xW=(i,t)=>{if(Bn(i))return Mt;let e=i.state;return(e.wrap&2)===0?Mt:(e.head=t,t.done=!1,Fn)},OW=(i,t)=>{let e=t.length,r,n,o;return Bn(i)||(r=i.state,r.wrap!==0&&r.mode!==wf)?Mt:r.mode===wf&&(n=1,n=lb(n,t,e,0),n!==r.check)?Xx:(o=rO(i,t,e,e),o?(r.mode=fb,ub):(r.havedict=1,Fn))};Wt.exports.inflateReset=eO;Wt.exports.inflateReset2=tO;Wt.exports.inflateResetKeep=Zx;Wt.exports.inflateInit=IW;Wt.exports.inflateInit2=iO;Wt.exports.inflate=kW;Wt.exports.inflateEnd=MW;Wt.exports.inflateGetHeader=xW;Wt.exports.inflateSetDictionary=OW;Wt.exports.inflateInfo="pako inflate (from Nodeca project)"});var sO=y((Hne,oO)=>{"use strict";function PW(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}oO.exports=PW});var lO=y((zne,As)=>{"use strict";var Li=nO(),dO=eb(),mb=tb(),gb=hf(),RW=ib(),DW=sO(),cO=Object.prototype.toString,{Z_NO_FLUSH:NW,Z_FINISH:LW,Z_OK:Ld,Z_STREAM_END:hb,Z_NEED_DICT:pb,Z_STREAM_ERROR:FW,Z_DATA_ERROR:aO,Z_MEM_ERROR:BW}=Sr();function Fd(i){this.options=dO.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(i&&i.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new RW,this.strm.avail_out=0;let e=Li.inflateInit2(this.strm,t.windowBits);if(e!==Ld)throw new Error(gb[e]);if(this.header=new DW,Li.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=mb.string2buf(t.dictionary):cO.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=Li.inflateSetDictionary(this.strm,t.dictionary),e!==Ld)))throw new Error(gb[e])}Fd.prototype.push=function(i,t){let e=this.strm,r=this.options.chunkSize,n=this.options.dictionary,o,s,a;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?LW:NW,cO.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),o=Li.inflate(e,s),o===pb&&n&&(o=Li.inflateSetDictionary(e,n),o===Ld?o=Li.inflate(e,s):o===aO&&(o=pb));e.avail_in>0&&o===hb&&e.state.wrap>0&&i[e.next_in]!==0;)Li.inflateReset(e),o=Li.inflate(e,s);switch(o){case FW:case aO:case pb:case BW:return this.onEnd(o),this.ended=!0,!1}if(a=e.avail_out,e.next_out&&(e.avail_out===0||o===hb))if(this.options.to==="string"){let l=mb.utf8border(e.output,e.next_out),c=e.next_out-l,d=mb.buf2string(e.output,l);e.next_out=c,e.avail_out=r-c,c&&e.output.set(e.output.subarray(l,l+c),0),this.onData(d)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(o===Ld&&a===0)){if(o===hb)return o=Li.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Fd.prototype.onData=function(i){this.chunks.push(i)};Fd.prototype.onEnd=function(i){i===Ld&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=dO.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Sb(i,t){let e=new Fd(t);if(e.push(i),e.err)throw e.msg||gb[e.err];return e.result}function VW(i,t){return t=t||{},t.raw=!0,Sb(i,t)}As.exports.Inflate=Fd;As.exports.inflate=Sb;As.exports.inflateRaw=VW;As.exports.ungzip=Sb;As.exports.constants=Sr()});var uO=y(($ne,yi)=>{"use strict";var{Deflate:UW,deflate:qW,deflateRaw:HW,gzip:zW}=vx(),{Inflate:$W,inflate:jW,inflateRaw:WW,ungzip:GW}=lO(),KW=Sr();yi.exports.Deflate=UW;yi.exports.deflate=qW;yi.exports.deflateRaw=HW;yi.exports.gzip=zW;yi.exports.Inflate=$W;yi.exports.inflate=jW;yi.exports.inflateRaw=WW;yi.exports.ungzip=GW;yi.exports.constants=KW});var vb=y(yb=>{"use strict";Object.defineProperty(yb,"__esModule",{value:!0});var fO=uO(),Bd=class i{constructor(t){this.logger=t}compress(t,e){if(e.length>0){let o=Math.min(e.length,i.MAX_DICTIONARY_SIZE);e=e.slice(0,o)}let r={memLevel:i.Z_MEM_LEVEL,dictionary:e};return fO.deflateRaw(t,r)}decompress(t,e){if(e.length>0){let o=Math.min(e.length,i.MAX_DICTIONARY_SIZE);e=e.slice(0,o)}let r={to:"string",dictionary:e,chunkSize:4096},n="";try{n=fO.inflateRaw(t,r)}catch(o){this.logger.error(`failed to decompress the string with error: [${o}]`)}return n}};yb.default=Bd;Bd.Z_MEM_LEVEL=9;Bd.MAX_DICTIONARY_SIZE=31744});var Cb=y(wb=>{"use strict";Object.defineProperty(wb,"__esModule",{value:!0});var bb=class{constructor(t,e,r,n,o,s,a,l,c,d){this.attendeeId=t,this.sdpOffer=e,this.audioHost=r,this.audioMuted=n,this.audioCheckin=o,this.receiveStreamIds=s,this.localVideoEnabled=a,this.videoStreamDescriptions=l,this.connectionTypeHasVideo=c,this.compressedSdpOffer=d,this.videoSubscriptionConfiguration=[]}};wb.default=bb});var Vn=y(Gt=>{"use strict";var JW=Gt&&Gt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.VideoPreferences=Gt.MutableVideoPreferences=Gt.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=void 0;var QW=JW(rf());function XW(i,t,e){if(i.transceiverController.getMidForGroupId===void 0||i.videoStreamIndex.attendeeIdForGroupId===void 0||e===void 0)return[];let r=new Array,n=new Map,o=new Map;for(let s of t){let a=i.transceiverController.getMidForGroupId(s);if(a===void 0)continue;let l=i.videoStreamIndex.attendeeIdForGroupId(s);n.set(l,a),o.set(l,s)}for(let s of e){let a=new QW.default,l=n.get(s.attendeeId);l!==void 0&&(a.mid=l,a.attendeeId=s.attendeeId,a.groupId=o.get(s.attendeeId),a.priority=Number.MAX_SAFE_INTEGER-s.priority,a.targetBitrateKbps=s.targetSizeToBitrateKbps(s.targetSize),a.qualityAdaptationPreference=s.degradationPreference,r.push(a))}return r}Gt.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=XW;var _f=class i{constructor(t=[]){this.items=t}static default(){return new i([])}[Symbol.iterator](){let t=0,e=this.items;return{next(){return t<e.length?{done:!1,value:e[t++]}:{done:!0,value:null}}}}first(){return this.items[0]}add(t){this.items.push(t)}replaceFirst(t,e){let r=this.items.findIndex(e);r===-1?this.items.push(t):this.has(t)?this.items.splice(r,1):this.items[r]=t}remove(t){this.items=this.items.filter(e=>!e.equals(t))}clear(){this.items=[]}isEmpty(){return this.items.length===0}equals(t){if(t===this)return!0;if(t.items.length!==this.items.length)return!1;for(let e of this.items)if(!t.items.some(r=>r.equals(e)))return!1;return!0}has(t){return this.items.some(e=>e.equals(t))}some(t){return this.items.some(t)}clone(){return new i([...this.items])}sort(){this.items.sort((t,e)=>t.partialCompare(e))}modify(){return new Tf(this)}},Tf=class{constructor(t=new _f){this.items=t,this.copied=!1}cow(){this.copied||(this.items=this.items.clone(),this.copied=!0)}add(t){this.items.has(t)||(this.cow(),this.items.add(t))}replaceFirst(t,e){this.items.has(t)&&!this.items.some(e)||(this.cow(),this.items.replaceFirst(t,e))}remove(t){this.items.has(t)&&(this.cow(),this.items.remove(t))}some(t){return this.items.some(t)}clear(){this.items.isEmpty()||(this.cow(),this.items.clear())}build(){return this.copied&&this.items.sort(),this.copied=!1,this.items}},Vd=class{constructor(t){this.builder=t}add(t){this.builder.add(t)}replaceFirst(t,e){this.builder.replaceFirst(t,e)}remove(t){this.builder.remove(t)}some(t){return this.builder.some(t)}clear(){this.builder.clear()}build(){return new Ud(this.builder.build())}};Gt.MutableVideoPreferences=Vd;var Ud=class i{constructor(t){this.items=t}static prepare(){return new Vd(new Tf)}static default(){return new i(_f.default())}[Symbol.iterator](){return this.items[Symbol.iterator]()}highestPriority(){var t;return(t=this.items.first())===null||t===void 0?void 0:t.priority}sorted(){return this.items[Symbol.iterator]()}equals(t){return t===this||this.items.equals(t.items)}modify(){return new Vd(this.items.modify())}some(t){return this.items.some(t)}isEmpty(){return this.items.isEmpty()}clone(){let t=i.prepare();for(let e of this.items)t.add(e.clone());return t.build()}};Gt.VideoPreferences=Ud;Gt.default=Ud});var Eb=y(Un=>{"use strict";var YW=Un&&Un.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},qn=Un&&Un.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Un,"__esModule",{value:!0});var ZW=qn(un()),hO=qn(jt()),Ef=qn(an()),e5=qn(vb()),t5=li(),i5=qn(Ge()),r5=qn(Cb()),_b=Oe(),n5=Vn(),o5=qn(_e()),Tb=class extends o5.default{constructor(t){super(t.logger),this.context=t,this.taskName="SubscribeAndReceiveSubscribeAckTask",this.taskCanceler=null,this.textCompressor=new e5.default(t.logger)}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return YW(this,void 0,void 0,function*(){let t="";if(this.context.peer&&this.context.peer.localDescription&&(t=new Ef.default(this.context.peer.localDescription.sdp).withUnifiedPlanFormat().sdp),!this.context.enableSimulcast){let c=0,d=0;this.context.videoCaptureAndEncodeParameter&&(c=this.context.videoCaptureAndEncodeParameter.captureFrameRate(),d=this.context.videoCaptureAndEncodeParameter.encodeBitrates()[0]);let u={rid:"hi",maxBitrate:d*1e3,maxFramerate:c,active:!0};this.context.videoStreamIndex.integrateUplinkPolicyDecision([u])}let e=this.fixUpSubscriptionOrder(t,this.context.videoSubscriptions),r=this.context.videoDuplexMode===_b.SdkStreamServiceType.TX||this.context.videoDuplexMode===_b.SdkStreamServiceType.DUPLEX,n,o=t;if((this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension===void 0||!this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension())&&(o=new Ef.default(o).withoutDependencyDescriptorRtpHeaderExtension().sdp),this.context.serverSupportsCompression){let c=this.context.previousSdpOffer?this.context.previousSdpOffer.sdp:"";n=this.textCompressor.compress(o,c),this.context.logger.info(`Compressed the SDP message from ${o.length} to ${n.length} bytes.`),t=""}this.context.previousSdpOffer=new Ef.default(t);let s=new r5.default(this.context.meetingSessionConfiguration.credentials.attendeeId,t,this.context.meetingSessionConfiguration.urls.audioHostURL,this.context.realtimeController.realtimeIsLocalAudioMuted(),!1,e,r,this.context.videoStreamIndex.localStreamDescriptions(),!0,n);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&!t5.serverSideNetworkAdaptionIsNoneOrDefault(this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())&&this.context.videoDownlinkBandwidthPolicy.getVideoPreferences!==void 0&&(s.videoSubscriptionConfiguration=n5.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(this.context,e.map(c=>c===0?0:this.context.videoStreamIndex.groupIdForStreamId(c)),this.context.videoDownlinkBandwidthPolicy.getVideoPreferences())),this.context.logger.info(`sending subscribe: ${JSON.stringify(s)}`),this.context.signalingClient.subscribe(s);let a=yield this.receiveSubscribeAck();this.context.logger.info(`got subscribe ack: ${JSON.stringify(a)}`);let l="";a.compressedSdpAnswer&&a.compressedSdpAnswer.length?(l=this.textCompressor.decompress(a.compressedSdpAnswer,this.context.previousSdpAnswerAsString),l.length===0&&(this.context.sdpAnswer="",this.context.previousSdpAnswerAsString="",this.logAndThrow("Error occurred while trying to decompress the SDP answer.")),this.context.logger.info(`Decompressed the SDP message from ${a.compressedSdpAnswer.length} to ${l.length} bytes.`),this.context.sdpAnswer=l):this.context.sdpAnswer=a.sdpAnswer,this.context.previousSdpAnswerAsString=this.context.sdpAnswer,this.context.videoStreamIndex.integrateSubscribeAckFrame(a)})}fixUpSubscriptionOrder(t,e){if(this.context.transceiverController.getMidForStreamId===void 0)return e;let r=new Map;for(let s of e){let a=this.context.transceiverController.getMidForStreamId(s);if(a===void 0){s!==0&&this.logger.warn(`Could not find MID for stream ID: ${s}`);continue}r.set(a,s)}let n=new Ef.default(t).mediaSections(),o=[];for(let s of n)if(s.mediaType==="video")if(s.direction==="recvonly"){let a=r.get(s.mid);if(a===void 0){this.logger.warn(`Could not find stream ID for MID: ${s.mid}`);continue}o.push(a)}else o.push(0);return this.logger.info(`Fixed up ${JSON.stringify(e)} to ${JSON.stringify(o)} (may be same))}`),o}receiveSubscribeAck(){return new Promise((t,e)=>{let r=this.context;class n{constructor(a){this.signalingClient=a}cancel(){this.signalingClient.removeObserver(this),e(new Error("SubscribeAndReceiveSubscribeAckTask got canceled while waiting for SdkSubscribeAckFrame"))}handleSignalingClientEvent(a){if(a.isConnectionTerminated()){let c=`SubscribeAndReceiveSubscribeAckTask connection was terminated with code ${a.closeCode} and reason: ${a.closeReason}`;r.logger.warn(c);let d=hO.default.TaskFailed;a.closeCode>=4500&&a.closeCode<4600&&(d=hO.default.SignalingInternalServerError),r.audioVideoController.handleMeetingSessionStatus(new ZW.default(d),new Error(c));return}if(a.type!==i5.default.ReceivedSignalFrame||a.message.type!==_b.SdkSignalFrame.Type.SUBSCRIBE_ACK)return;this.signalingClient.removeObserver(this);let l=a.message.suback;t(l)}}let o=new n(this.context.signalingClient);this.context.signalingClient.registerObserver(o),this.taskCanceler=o})}};Un.default=Tb});var If=y(Hn=>{"use strict";var s5=Hn&&Hn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},pO=Hn&&Hn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Hn,"__esModule",{value:!0});var a5=pO(Ro()),d5=pO(_e()),Ib=class extends d5.default{constructor(t,e,r){super(t),this.taskToRunBeforeTimeout=e,this.timeoutMs=r,this.taskName=`Timeout${this.timeoutMs}ms`,e.setParent(this)}cancel(){this.logger.info(`canceling timeout task ${this.name()} subtask ${this.taskToRunBeforeTimeout}`),this.taskToRunBeforeTimeout.cancel()}run(){return s5(this,void 0,void 0,function*(){let t=new a5.default(this.timeoutMs);t.start(()=>{this.logger.info(`timeout reached for task ${this.name()}`),this.taskToRunBeforeTimeout.cancel()});try{yield this.taskToRunBeforeTimeout.run()}finally{t.stop()}this.logger.info(`timeout task ${this.name()} completed`)})}};Hn.default=Ib});var kb=y(zn=>{"use strict";var c5=zn&&zn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},mO=zn&&zn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(zn,"__esModule",{value:!0});var l5=mO(jt()),u5=mO(_e()),Ab=class extends u5.default{constructor(t){super(t.logger),this.context=t,this.taskName="WaitForAttendeePresenceTask"}cancel(){if(this.cancelPromise){let t=new Error(`canceling ${this.name()} due to the meeting status code: ${l5.default.NoAttendeePresent}`);this.cancelPromise(t),delete this.cancelPromise}}run(){return c5(this,void 0,void 0,function*(){let t=this.context.meetingSessionConfiguration.credentials.attendeeId;return new Promise((e,r)=>{let n=(o,s,a,l,c)=>{t===o&&s&&(this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(n),e(),delete this.cancelPromise)};this.cancelPromise=o=>{this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(n),r(o)},this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(n)})})}};zn.default=Ab});var xb=y(Mb=>{"use strict";Object.defineProperty(Mb,"__esModule",{value:!0});var qd=class i{constructor(){this.maxRedPacketSizeBytes=1024,this.maxAudioPayloadSizeBytes=1e3,this.maxRedTimestampOffset=16384,this.redHeaderSizeBytes=4,this.redLastHeaderSizeBytes=1,this.redPacketizationTime=960,this.redPacketDistance=2,this.maxRedEncodings=2,this.redMaxRecoveryDistance=this.redPacketDistance*this.maxRedEncodings+1,this.maxEncodingHistorySize=10,this.numRedundantEncodings=0,this.redundancyEnabled=!0,this.lossReportInterval=48e3*5,this.maxOutOfOrderPacketDistance=16,this.OPUS_BAD_ARG=-1,this.OPUS_INVALID_PACKET=-4,this.OPUS_MAX_OPUS_FRAMES=48,this.OPUS_MAX_FRAME_SIZE_BYTES=1275,this.encodingHistory=new Array,this.opusPayloadType=0,this.redPayloadType=0,this.initializePacketLogs()}static initializeWorker(){i.log("Initializing RedundantAudioEncoder");let t=new i;self.RTCRtpScriptTransformer&&(self.onrtctransform=e=>{e.transformer.options.type==="SenderTransform"?t.setupSenderTransform(e.transformer.readable,e.transformer.writable):e.transformer.options.type==="ReceiverTransform"?t.setupReceiverTransform(e.transformer.readable,e.transformer.writable):e.transformer.options.type==="PassthroughTransform"&&t.setupPassthroughTransform(e.transformer.readable,e.transformer.writable)}),self.onmessage=e=>{e.data.msgType==="StartRedWorker"?(t.setupSenderTransform(e.data.send.readable,e.data.send.writable),t.setupReceiverTransform(e.data.receive.readable,e.data.receive.writable)):e.data.msgType==="PassthroughTransform"?(t.setupPassthroughTransform(e.data.send.readable,e.data.send.writable),t.setupPassthroughTransform(e.data.receive.readable,e.data.receive.writable)):e.data.msgType==="RedPayloadType"?t.setRedPayloadType(e.data.payloadType):e.data.msgType==="OpusPayloadType"?t.setOpusPayloadType(e.data.payloadType):e.data.msgType==="UpdateNumRedundantEncodings"?t.setNumRedundantEncodings(e.data.numRedundantEncodings):e.data.msgType==="Enable"?t.setRedundancyEnabled(!0):e.data.msgType==="Disable"&&t.setRedundancyEnabled(!1)}}static log(t){i.shouldLog&&self.postMessage({type:"REDWorkerLog",log:`[AudioRed] ${t}`})}static getNumRedundantEncodingsForPacketLoss(t){let e=0,r=!1;return t<=8?e=0:t<=18?e=1:t<=75?e=2:(e=0,r=!0),[e,r]}setupPassthroughTransform(t,e){i.log("Setting up passthrough transform"),t.pipeTo(e)}setupSenderTransform(t,e){i.log("Setting up sender RED transform");let r=new TransformStream({transform:this.senderTransform.bind(this)});t.pipeThrough(r).pipeTo(e)}setupReceiverTransform(t,e){i.log("Setting up receiver RED transform");let r=new TransformStream({transform:this.receivePacketLogTransform.bind(this)});t.pipeThrough(r).pipeTo(e)}setRedPayloadType(t){this.redPayloadType=t,i.log(`red payload type set to ${this.redPayloadType}`)}setOpusPayloadType(t){this.opusPayloadType=t,i.log(`opus payload type set to ${this.opusPayloadType}`)}setNumRedundantEncodings(t){this.numRedundantEncodings=t,this.numRedundantEncodings>this.maxRedEncodings&&(this.numRedundantEncodings=this.maxRedEncodings),i.log(`Updated numRedundantEncodings to ${this.numRedundantEncodings}`)}setRedundancyEnabled(t){this.redundancyEnabled=t,i.log(`redundancy ${this.redundancyEnabled?"enabled":"disabled"}`)}enqueueAudioFrameIfPayloadSizeIsValid(t,e){t.data.byteLength>this.maxAudioPayloadSizeBytes||e.enqueue(t)}senderTransform(t,e){if(t.getMetadata().payloadType!==this.redPayloadType){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}let n=this.getPrimaryPayload(t.timestamp,t.data);if(!n){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}let o=this.encode(t.timestamp,n);if(!o){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}t.data=o,this.enqueueAudioFrameIfPayloadSizeIsValid(t,e)}getPrimaryPayload(t,e){let r=this.splitEncodings(t,e);return!r||r.length<1?null:r[r.length-1].payload}splitEncodings(t,e,r=!1,n=void 0){let o=new DataView(e),s=o.byteLength,a=0,l=0,c=0,d=0,u=!1,f=new Array,m=new Array,S=new Array;for(;s>0;)if(u=(o.getUint8(d)&128)===0,u){if((o.getUint8(d)&127)!==this.opusPayloadType||(a+=this.redLastHeaderSizeBytes,l+=this.redLastHeaderSizeBytes,a>=o.byteLength))return null;c=o.byteLength-a;break}else{if(s<this.redHeaderSizeBytes)return null;let E=((o.getUint8(d+2)&3)<<8)+o.getUint8(d+3);m.push(E);let V=o.getUint16(d+1)>>2,W=t-V;S.push(W),a+=E+this.redHeaderSizeBytes,l+=this.redHeaderSizeBytes,d+=this.redHeaderSizeBytes,s-=this.redHeaderSizeBytes}if(!u)return n!==void 0?(f.push({payload:e,isRedundant:!1,seq:n}),f):null;let T=l;for(let E=0;E<S.length;E++){let V=new ArrayBuffer(m[E]);new Uint8Array(V).set(new Uint8Array(o.buffer,T,m[E]),0);let D={timestamp:S[E],payload:V,isRedundant:!0};r&&(D.hasFec=this.opusPacketHasFec(new DataView(V),V.byteLength)),f.push(D),T+=m[E]}let _=o.byteLength-c,C=new ArrayBuffer(c);new Uint8Array(C).set(new Uint8Array(o.buffer,_,c),0);let A={timestamp:t,payload:C,isRedundant:!1,seq:n};return r&&(A.hasFec=this.opusPacketHasFec(new DataView(C),C.byteLength)),f.push(A),f}encode(t,e){let r=e.byteLength;if(r===0||r>=this.maxRedPacketSizeBytes||r>=this.maxAudioPayloadSizeBytes)return null;let n=this.numRedundantEncodings,o=this.redLastHeaderSizeBytes,s=r,a=this.maxAudioPayloadSizeBytes-r-o,l=new Array,c=new Array;if(this.redundancyEnabled){let S=this.uint32WrapAround(t-this.redPacketizationTime*this.redPacketDistance);for(let T=0;T<n&&!(this.uint32WrapAround(t-S)>=this.maxRedTimestampOffset);T++){let _=S,C=this.encodingHistory.find(I=>I.timestamp===_);if(C||(_=this.uint32WrapAround(S-this.redPacketizationTime),C=this.encodingHistory.find(I=>I.timestamp===_)),C){let I=C.payload.byteLength;if(a<this.redHeaderSizeBytes+I)break;a-=this.redHeaderSizeBytes+I,o+=this.redHeaderSizeBytes,s+=I,l.unshift(C.timestamp),c.unshift(C.payload)}S-=this.redPacketizationTime*this.redPacketDistance,S=this.uint32WrapAround(S)}}let d=new ArrayBuffer(o+s),u=new DataView(d),f=0;for(let S=0;S<l.length;S++){let T=t-l[S];u.setUint8(f,this.opusPayloadType|128),u.setUint16(f+1,T<<2|c[S].byteLength>>8),u.setUint8(f+3,c[S].byteLength&255),f+=this.redHeaderSizeBytes}u.setUint8(f,this.opusPayloadType),f+=this.redLastHeaderSizeBytes;let m=new Uint8Array(d);for(let S=0;S<c.length;S++)m.set(new Uint8Array(c[S]),f),f+=c[S].byteLength;return m.set(new Uint8Array(e),f),f+=e.byteLength,f!==o+s?null:(this.updateEncodingHistory(t,e),d)}updateEncodingHistory(t,e){for(let n of this.encodingHistory){let o=this.redPacketizationTime*this.redMaxRecoveryDistance;if(t-n.timestamp>=o)this.encodingHistory.shift();else break}let r=new DataView(e);(this.opusPacketIsCeltOnly(r)||this.opusPacketHasVoiceActivity(r,r.byteLength)>0)&&(this.encodingHistory.length+1>this.maxEncodingHistorySize&&(this.encodingHistory.length=0),this.encodingHistory.push({timestamp:t,payload:e}))}initializePacketLogs(){let t=this.maxOutOfOrderPacketDistance+this.redMaxRecoveryDistance;this.primaryPacketLog={window:new Array(t),index:0,windowSize:t},this.redRecoveryLog={window:new Array(t),index:0,windowSize:t},this.fecRecoveryLog={window:new Array(t),index:0,windowSize:t},this.totalAudioPacketsExpected=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}receivePacketLogTransform(t,e){let r=t.getMetadata();if(r.payloadType!==this.redPayloadType){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}let n=this.splitEncodings(t.timestamp,t.data,!0,r.sequenceNumber);if(!n){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}for(let o=n.length-1;o>=0;o--)this.updateLossStats(n[o])&&(this.updateRedStats(n[o]),this.updateFecStats(n[o]));this.maybeReportLossStats(r.synchronizationSource,n[n.length-1].timestamp),this.enqueueAudioFrameIfPayloadSizeIsValid(t,e)}updateLossStats(t){if(t.isRedundant)return!0;let e=t.timestamp,r=t.seq;if(this.totalAudioPacketsExpected===0)return this.totalAudioPacketsExpected=1,this.newestSequenceNumber=r,this.addTimestamp(this.primaryPacketLog,e),!0;let n=this.int16(r-this.newestSequenceNumber);return n<-this.maxOutOfOrderPacketDistance?!1:(n<0?this.hasTimestamp(this.primaryPacketLog,e)||(this.totalAudioPacketsLost>0&&this.totalAudioPacketsLost--,this.addTimestamp(this.primaryPacketLog,e),this.removeFromRecoveryWindows(e)):n>1&&(this.totalAudioPacketsLost+=n-1),n>0&&(this.totalAudioPacketsExpected+=n,this.newestSequenceNumber=t.seq,this.addTimestamp(this.primaryPacketLog,e)),!0)}updateRedStats(t){if(!t.isRedundant||this.totalAudioPacketsLost===0)return;let e=t.timestamp;this.hasTimestamp(this.primaryPacketLog,e)||(this.hasTimestamp(this.redRecoveryLog,e)||(this.totalAudioPacketsRecoveredRed++,this.addTimestamp(this.redRecoveryLog,e)),this.removeTimestamp(this.fecRecoveryLog,e)&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--)}updateFecStats(t){if(!t.hasFec||this.totalAudioPacketsLost===0)return;let e=t.timestamp-this.redPacketizationTime;this.hasTimestamp(this.primaryPacketLog,e)||this.hasTimestamp(this.redRecoveryLog,e)||this.hasTimestamp(this.fecRecoveryLog,e)||(this.totalAudioPacketsRecoveredFec++,this.addTimestamp(this.fecRecoveryLog,e))}maybeReportLossStats(t,e){e===void 0||e-this.lastLossReportTimestamp<this.lossReportInterval||(i.shouldReportStats&&self.postMessage({type:"RedundantAudioEncoderStats",ssrc:t,totalAudioPacketsLost:this.totalAudioPacketsLost,totalAudioPacketsExpected:this.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.totalAudioPacketsRecoveredFec}),this.lastLossReportTimestamp=e)}addTimestamp(t,e){e!==void 0&&(t.window[t.index]=e,t.index=(t.index+1)%t.windowSize)}hasTimestamp(t,e){return!!t.window.find(n=>n===e)}removeTimestamp(t,e){let r=t.window.indexOf(e);return r>=0?(t.window[r]=void 0,!0):!1}removeFromRecoveryWindows(t){let e=this.removeTimestamp(this.redRecoveryLog,t);e&&this.totalAudioPacketsRecoveredRed>0&&this.totalAudioPacketsRecoveredRed--,e=this.removeTimestamp(this.fecRecoveryLog,t),e&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--}uint32WrapAround(t){let r=t;return t>=4294967296?r=t-4294967296:t<0&&(r=4294967296+t),r}int16(t){return t<<16>>16}opusPacketIsCeltOnly(t){return!!(t.getUint8(0)&128)}opusPacketGetSamplesPerFrame(t,e){e=Math.round(e),e=Math.min(Math.max(e,-Math.pow(2,32)),Math.pow(2,32)-1);let r,n;return this.opusPacketIsCeltOnly(t)?(n=t.getUint8(0)>>3&3,r=(e<<n)/400):(t.getUint8(0)&96)===96?r=t.getUint8(0)&8?e/50:e/100:(n=t.getUint8(0)>>3&3,n===3?r=e*60/1e3:r=(e<<n)/100),r}opusNumSilkFrames(t){let e=this.opusPacketGetSamplesPerFrame(t,48e3)/48;switch(e<10&&(e=10),e){case 10:case 20:return 1;case 40:return 2;case 60:return 3;default:return 0}}opusPacketGetNumChannels(t){return t.getUint8(0)&4?2:1}opusParseSize(t,e,r,n){return r<1?(n[0]=-1,-1):t.getUint8(e)<252?(n[0]=t.getUint8(e),1):r<2?(n[0]=-1,-1):(n[0]=4*t.getUint8(e+1)+t.getUint8(e),2)}opusPacketParseImpl(t,e,r,n,o,s,a,l){if(!s||e<0)return this.OPUS_BAD_ARG;if(e===0)return this.OPUS_INVALID_PACKET;let c,d,u=0,f=!1,m=t.getUint8(0);n&&(n[0]=m);let S=e-1,T=1,_=S;switch(m&3){case 0:c=1;break;case 1:if(c=2,f=!0,!r){if(S&1)return this.OPUS_INVALID_PACKET;_=S/2,s[0][0]=_}break;case 2:if(c=2,d=this.opusParseSize(t,T,S,s[0]),S-=d,s[0][0]<0||s[0][0]>S)return this.OPUS_INVALID_PACKET;T+=d,_=S-s[0][0];break;default:if(S<1)return this.OPUS_INVALID_PACKET;let C=t.getUint8(T++);if(--S,c=C&63,c<=0)return this.OPUS_INVALID_PACKET;if(this.opusPacketGetSamplesPerFrame(t,48e3)*c>5760)return this.OPUS_INVALID_PACKET;if(C&64){let A,E;do{if(S<=0)return this.OPUS_INVALID_PACKET;A=t.getUint8(T++),--S,E=A===255?254:A,S-=E,u+=E}while(A===255)}if(S<0)return this.OPUS_INVALID_PACKET;if(f=!(C&128),f){if(!r){if(_=Math.trunc(S/c),_*c!==S)return this.OPUS_INVALID_PACKET;for(let A=0;A<c-1;++A)s[A][0]=_}}else{_=S;for(let A=0;A<c-1;++A){if(d=this.opusParseSize(t,T,S,s[A]),S-=d,s[A][0]<0||s[A][0]>S)return this.OPUS_INVALID_PACKET;T+=d,_-=d+s[A][0]}if(_<0)return this.OPUS_INVALID_PACKET}}if(r){if(d=this.opusParseSize(t,T,S,s[c-1]),S-=d,s[c-1][0]<0||s[c-1][0]>S)return this.OPUS_INVALID_PACKET;if(T+=d,f){if(s[c-1][0]*c>S)return this.OPUS_INVALID_PACKET;for(let C=0;C<c-1;++C)s[C][0]=s[c-1][0]}else if(!(d+s[c-1][0]<=_))return this.OPUS_INVALID_PACKET}else{if(_>this.OPUS_MAX_FRAME_SIZE_BYTES)return this.OPUS_INVALID_PACKET;s[c-1][0]=_}a&&(a[0]=T);for(let C=0;C<c;++C)o&&(o[C][0]=T),T+=s[C][0];return l&&(l[0]=T+u),c}opusPacketParse(t,e,r,n,o,s){return this.opusPacketParseImpl(t,e,!1,r,n,o,s,null)}opusPacketHasVoiceActivity(t,e){if(!t||e<=0)return 0;if(this.opusPacketIsCeltOnly(t))return-1;let r=this.opusNumSilkFrames(t);if(r===0)return-1;let n=new Array(this.OPUS_MAX_OPUS_FRAMES),o=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let a=0;a<this.OPUS_MAX_OPUS_FRAMES;++a)n[a]=[void 0],o[a]=[void 0];let s=this.opusPacketParse(t,e,null,n,o,null);if(s<0)return-1;for(let a=0;a<s;++a){if(o[a][0]<1)continue;if(t.getUint8(n[a][0])>>8-r||this.opusPacketGetNumChannels(t)===2&&t.getUint8(n[a][0])<<r+1>>8-r)return 1}return 0}opusPacketHasFec(t,e){if(!t||e<=0||this.opusPacketIsCeltOnly(t))return!1;let r=new Array(this.OPUS_MAX_OPUS_FRAMES),n=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let l=0;l<this.OPUS_MAX_OPUS_FRAMES;++l)r[l]=[void 0],n[l]=[void 0];if(this.opusPacketParse(t,e,null,r,n,null)<0||n[0][0]<=1)return!1;let s=this.opusNumSilkFrames(t);if(s===0)return!1;let a=this.opusPacketGetNumChannels(t);if(a!==1&&a!==2)return!1;for(let l=0;l<a;l++)if(t.getUint8(r[0][0])&128>>(l+1)*(s+1)-1)return!0;return!1}};Mb.default=qd;qd.shouldLog=!1;qd.shouldReportStats=!1});var Pb=y(Ob=>{"use strict";Object.defineProperty(Ob,"__esModule",{value:!0});var f5=`class RedundantAudioEncoder {
    constructor() {
        // Each payload must be less than 1024 bytes to fit the 10 bit block length
        this.maxRedPacketSizeBytes = 1 << 10;
        // Limit payload to 1000 bytes to handle small MTU. 1000 is chosen because in Chromium-based browsers, writing audio
        // payloads larger than 1000 bytes using the WebRTC Insertable Streams API (which is used to enable dynamic audio
        // redundancy) will cause an error to be thrown and cause audio flow to permanently stop. See
        // https://crbug.com/1248479.
        this.maxAudioPayloadSizeBytes = 1000;
        // Each payload can encode a timestamp delta of 14 bits
        this.maxRedTimestampOffset = 1 << 14;
        // 4 byte RED header
        this.redHeaderSizeBytes = 4;
        // reduced size for last RED header
        this.redLastHeaderSizeBytes = 1;
        // P-Time for Opus 20 msec packets
        // We do not support other p-times or clock rates
        this.redPacketizationTime = 960;
        // distance between redundant payloads, Opus FEC handles a distance of 1
        // TODO(https://issues.amazon.com/issues/ChimeSDKAudio-55):
        // Consider making this dynamic
        this.redPacketDistance = 2;
        // maximum number of redundant payloads per RTP packet
        this.maxRedEncodings = 2;
        // Maximum number of encodings that can be recovered with a single RED packet, assuming the primary and redundant
        // payloads have FEC.
        this.redMaxRecoveryDistance = this.redPacketDistance * this.maxRedEncodings + 1;
        // maximum history of prior payloads to keep
        // generally we will expire old entries based on timestamp
        // this limit is in place just to make sure the history does not
        // grow too large in the case of erroneous timestamp inputs
        this.maxEncodingHistorySize = 10;
        // Current number of encodings we want to send
        // to the remote end. This will be dynamically
        // updated through the setNumEncodingsFromPacketloss API
        this.numRedundantEncodings = 0;
        // Used to enable or disable redundancy
        // in response to very high packet loss events
        this.redundancyEnabled = true;
        // Loss stats are reported to the main thread every 5 seconds.
        // Since timestamp differences between 2 consecutive packets
        // give us the number of samples in each channel, 1 second
        // is equivalent to 48000 samples:
        // P-time * (1000ms/1s)
        // = (960 samples/20ms) * (1000ms/1s)
        // = 48000 samples/s
        this.lossReportInterval = 48000 * 5;
        // Maximum distance of a packet from the most recent packet timestamp
        // that we will consider for recovery.
        this.maxOutOfOrderPacketDistance = 16;
        /**
         * Below are Opus helper methods and constants.
         */
        this.OPUS_BAD_ARG = -1;
        this.OPUS_INVALID_PACKET = -4;
        // Max number of Opus frames in an Opus packet is 48 (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5).
        this.OPUS_MAX_OPUS_FRAMES = 48;
        // Max number of bytes that any individual Opus frame can have.
        this.OPUS_MAX_FRAME_SIZE_BYTES = 1275;
        this.encodingHistory = new Array();
        this.opusPayloadType = 0;
        this.redPayloadType = 0;
        this.initializePacketLogs();
    }
    /**
     * Creates an instance of RedundantAudioEncoder and sets up callbacks.
     */
    static initializeWorker() {
        RedundantAudioEncoder.log('Initializing RedundantAudioEncoder');
        const encoder = new RedundantAudioEncoder();
        // RED encoding is done using WebRTC Encoded Transform
        // https://github.com/w3c/webrtc-encoded-transform/blob/main/explainer.md
        // Check the DedicatedWorkerGlobalScope for existence of
        // RTCRtpScriptTransformer interface. If exists, then
        // RTCRtpScriptTransform is supported by this browser.
        // @ts-ignore
        if (self.RTCRtpScriptTransformer) {
            // @ts-ignore
            self.onrtctransform = (event) => {
                if (event.transformer.options.type === 'SenderTransform') {
                    encoder.setupSenderTransform(event.transformer.readable, event.transformer.writable);
                }
                else if (event.transformer.options.type === 'ReceiverTransform') {
                    encoder.setupReceiverTransform(event.transformer.readable, event.transformer.writable);
                }
                else if (event.transformer.options.type === 'PassthroughTransform') {
                    encoder.setupPassthroughTransform(event.transformer.readable, event.transformer.writable);
                }
            };
        }
        self.onmessage = (event) => {
            if (event.data.msgType === 'StartRedWorker') {
                encoder.setupSenderTransform(event.data.send.readable, event.data.send.writable);
                encoder.setupReceiverTransform(event.data.receive.readable, event.data.receive.writable);
            }
            else if (event.data.msgType === 'PassthroughTransform') {
                encoder.setupPassthroughTransform(event.data.send.readable, event.data.send.writable);
                encoder.setupPassthroughTransform(event.data.receive.readable, event.data.receive.writable);
            }
            else if (event.data.msgType === 'RedPayloadType') {
                encoder.setRedPayloadType(event.data.payloadType);
            }
            else if (event.data.msgType === 'OpusPayloadType') {
                encoder.setOpusPayloadType(event.data.payloadType);
            }
            else if (event.data.msgType === 'UpdateNumRedundantEncodings') {
                encoder.setNumRedundantEncodings(event.data.numRedundantEncodings);
            }
            else if (event.data.msgType === 'Enable') {
                encoder.setRedundancyEnabled(true);
            }
            else if (event.data.msgType === 'Disable') {
                encoder.setRedundancyEnabled(false);
            }
        };
    }
    /**
     * Post logs to the main thread
     */
    static log(msg) {
        if (RedundantAudioEncoder.shouldLog) {
            // @ts-ignore
            self.postMessage({
                type: 'REDWorkerLog',
                log: \`[AudioRed] \${msg}\`,
            });
        }
    }
    /**
     * Returns the number of encodings based on packetLoss value. This is used by \`DefaultTransceiverController\` to
     * determine when to alert the encoder to update the number of encodings. It also determines if we need to
     * turn off red in cases of very high packet loss to avoid congestion collapse.
     */
    static getNumRedundantEncodingsForPacketLoss(packetLoss) {
        let recommendedRedundantEncodings = 0;
        let shouldTurnOffRed = false;
        if (packetLoss <= 8) {
            recommendedRedundantEncodings = 0;
        }
        else if (packetLoss <= 18) {
            recommendedRedundantEncodings = 1;
        }
        else if (packetLoss <= 75) {
            recommendedRedundantEncodings = 2;
        }
        else {
            recommendedRedundantEncodings = 0;
            shouldTurnOffRed = true;
        }
        return [recommendedRedundantEncodings, shouldTurnOffRed];
    }
    /**
     * Sets up a passthrough (no-op) transform for the given streams.
     */
    setupPassthroughTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up passthrough transform');
        readable.pipeTo(writable);
    }
    /**
     * Sets up the transform stream and pipes the outgoing encoded audio frames through the transform function.
     */
    setupSenderTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up sender RED transform');
        const transformStream = new TransformStream({
            transform: this.senderTransform.bind(this),
        });
        readable.pipeThrough(transformStream).pipeTo(writable);
        return;
    }
    /**
     * Sets up the transform stream and pipes the received encoded audio frames through the transform function.
     */
    setupReceiverTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up receiver RED transform');
        const transformStream = new TransformStream({
            transform: this.receivePacketLogTransform.bind(this),
        });
        readable.pipeThrough(transformStream).pipeTo(writable);
        return;
    }
    /**
     * Set the RED payload type ideally obtained from local offer.
     */
    setRedPayloadType(payloadType) {
        this.redPayloadType = payloadType;
        RedundantAudioEncoder.log(\`red payload type set to \${this.redPayloadType}\`);
    }
    /**
     * Set the opus payload type ideally obtained from local offer.
     */
    setOpusPayloadType(payloadType) {
        this.opusPayloadType = payloadType;
        RedundantAudioEncoder.log(\`opus payload type set to \${this.opusPayloadType}\`);
    }
    /**
     * Set the number of redundant encodings
     */
    setNumRedundantEncodings(numRedundantEncodings) {
        this.numRedundantEncodings = numRedundantEncodings;
        if (this.numRedundantEncodings > this.maxRedEncodings) {
            this.numRedundantEncodings = this.maxRedEncodings;
        }
        RedundantAudioEncoder.log(\`Updated numRedundantEncodings to \${this.numRedundantEncodings}\`);
    }
    /**
     * Enable or disable redundancy in response to
     * high packet loss event.
     */
    setRedundancyEnabled(enabled) {
        this.redundancyEnabled = enabled;
        RedundantAudioEncoder.log(\`redundancy \${this.redundancyEnabled ? 'enabled' : 'disabled'}\`);
    }
    /**
     * Helper function to only enqueue audio frames if they do not exceed the audio payload byte limit imposed by
     * Chromium-based browsers. Chromium will throw an error (https://crbug.com/1248479) if an audio payload larger than
     * 1000 bytes is enqueued. Any controller that attempts to enqueue an audio payload larger than 1000 bytes will
     * encounter this error and will permanently stop sending or receiving audio.
     */
    enqueueAudioFrameIfPayloadSizeIsValid(
    // @ts-ignore
    frame, controller) {
        if (frame.data.byteLength > this.maxAudioPayloadSizeBytes)
            return;
        controller.enqueue(frame);
    }
    /**
     * Receives encoded frames and modifies as needed before sending to transport.
     */
    senderTransform(
    // @ts-ignore
    frame, controller) {
        const frameMetadata = frame.getMetadata();
        // @ts-ignore
        if (frameMetadata.payloadType !== this.redPayloadType) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        const primaryPayloadBuffer = this.getPrimaryPayload(frame.timestamp, frame.data);
        if (!primaryPayloadBuffer) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        const encodedBuffer = this.encode(frame.timestamp, primaryPayloadBuffer);
        /* istanbul ignore next */
        if (!encodedBuffer) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        frame.data = encodedBuffer;
        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
        return;
    }
    /**
     * Get the primary payload from encoding
     */
    getPrimaryPayload(primaryTimestamp, frame) {
        const encodings = this.splitEncodings(primaryTimestamp, frame);
        if (!encodings || encodings.length < 1)
            return null;
        return encodings[encodings.length - 1].payload;
    }
    /**
     * Split up the encoding received into primary and redundant encodings
     * These will be ordered oldest to newest which is the same ordering
     * in the RTP red payload.
     */
    splitEncodings(primaryTimestamp, frame, getFecInfo = false, primarySequenceNumber = undefined) {
        // process RED headers (according to RFC 2198)
        //   0                   1                   2                   3
        //   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        //  |F|   block PT  |  timestamp offset         |   block length    |
        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        //
        // last header
        //   0 1 2 3 4 5 6 7
        //  +-+-+-+-+-+-+-+-+
        //  |0|   Block PT  |
        //  +-+-+-+-+-+-+-+-+
        const payload = new DataView(frame);
        let payloadSizeBytes = payload.byteLength;
        let totalPayloadSizeBytes = 0;
        let totalHeaderSizeBytes = 0;
        let primaryPayloadSizeBytes = 0;
        let payloadOffset = 0;
        let gotLastBlock = false;
        const encodings = new Array();
        const redundantEncodingBlockLengths = new Array();
        const redundantEncodingTimestamps = new Array();
        while (payloadSizeBytes > 0) {
            gotLastBlock = (payload.getUint8(payloadOffset) & 0x80) === 0;
            if (gotLastBlock) {
                // Bits 1 through 7 are payload type
                const payloadType = payload.getUint8(payloadOffset) & 0x7f;
                // Unexpected payload type. This is a bad packet.
                if (payloadType !== this.opusPayloadType) {
                    return null;
                }
                totalPayloadSizeBytes += this.redLastHeaderSizeBytes;
                totalHeaderSizeBytes += this.redLastHeaderSizeBytes;
                // Accumulated block lengths are equal to or larger than the buffer, which means there is no primary block. This
                // is a bad packet.
                if (totalPayloadSizeBytes >= payload.byteLength) {
                    return null;
                }
                primaryPayloadSizeBytes = payload.byteLength - totalPayloadSizeBytes;
                break;
            }
            else {
                if (payloadSizeBytes < this.redHeaderSizeBytes) {
                    return null;
                }
                // Bits 22 through 31 are payload length
                const blockLength = ((payload.getUint8(payloadOffset + 2) & 0x03) << 8) + payload.getUint8(payloadOffset + 3);
                redundantEncodingBlockLengths.push(blockLength);
                const timestampOffset = payload.getUint16(payloadOffset + 1) >> 2;
                const timestamp = primaryTimestamp - timestampOffset;
                redundantEncodingTimestamps.push(timestamp);
                totalPayloadSizeBytes += blockLength + this.redHeaderSizeBytes;
                totalHeaderSizeBytes += this.redHeaderSizeBytes;
                payloadOffset += this.redHeaderSizeBytes;
                payloadSizeBytes -= this.redHeaderSizeBytes;
            }
        }
        // The last block was never found. The packet we received
        // does not have a good RED payload.
        if (!gotLastBlock) {
            // Note that sequence numbers only exist for
            // incoming audio frames.
            if (primarySequenceNumber !== undefined) {
                // This could be a possible padding packet used
                // for BWE with a good sequence number.
                // Create a dummy encoding to make sure loss values
                // are calculated correctly by consuming sequence number.
                // Note that for the receive side, we process packets only
                // for loss/recovery calculations and forward the original
                // packet without changing it even in the error case.
                encodings.push({
                    payload: frame,
                    isRedundant: false,
                    seq: primarySequenceNumber,
                });
                return encodings;
            }
            // This is a bad packet.
            return null;
        }
        let redundantPayloadOffset = totalHeaderSizeBytes;
        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {
            const redundantPayloadBuffer = new ArrayBuffer(redundantEncodingBlockLengths[i]);
            const redundantPayloadArray = new Uint8Array(redundantPayloadBuffer);
            redundantPayloadArray.set(new Uint8Array(payload.buffer, redundantPayloadOffset, redundantEncodingBlockLengths[i]), 0);
            const encoding = {
                timestamp: redundantEncodingTimestamps[i],
                payload: redundantPayloadBuffer,
                isRedundant: true,
            };
            if (getFecInfo) {
                encoding.hasFec = this.opusPacketHasFec(new DataView(redundantPayloadBuffer), redundantPayloadBuffer.byteLength);
            }
            encodings.push(encoding);
            redundantPayloadOffset += redundantEncodingBlockLengths[i];
        }
        const primaryPayloadOffset = payload.byteLength - primaryPayloadSizeBytes;
        const primaryPayloadBuffer = new ArrayBuffer(primaryPayloadSizeBytes);
        const primaryArray = new Uint8Array(primaryPayloadBuffer);
        primaryArray.set(new Uint8Array(payload.buffer, primaryPayloadOffset, primaryPayloadSizeBytes), 0);
        const encoding = {
            timestamp: primaryTimestamp,
            payload: primaryPayloadBuffer,
            isRedundant: false,
            seq: primarySequenceNumber,
        };
        if (getFecInfo) {
            encoding.hasFec = this.opusPacketHasFec(new DataView(primaryPayloadBuffer), primaryPayloadBuffer.byteLength);
        }
        encodings.push(encoding);
        return encodings;
    }
    /**
     * Create a new encoding with current primary payload and the older payloads of choice.
     */
    encode(primaryTimestamp, primaryPayload) {
        const primaryPayloadSize = primaryPayload.byteLength;
        // Payload size needs to be valid.
        if (primaryPayloadSize === 0 ||
            primaryPayloadSize >= this.maxRedPacketSizeBytes ||
            primaryPayloadSize >= this.maxAudioPayloadSizeBytes) {
            return null;
        }
        const numRedundantEncodings = this.numRedundantEncodings;
        let headerSizeBytes = this.redLastHeaderSizeBytes;
        let payloadSizeBytes = primaryPayloadSize;
        let bytesAvailable = this.maxAudioPayloadSizeBytes - primaryPayloadSize - headerSizeBytes;
        const redundantEncodingTimestamps = new Array();
        const redundantEncodingPayloads = new Array();
        // If redundancy is disabled then only send the primary payload
        if (this.redundancyEnabled) {
            // Determine how much redundancy we can fit into our packet
            let redundantTimestamp = this.uint32WrapAround(primaryTimestamp - this.redPacketizationTime * this.redPacketDistance);
            for (let i = 0; i < numRedundantEncodings; i++) {
                // Do not add redundant encodings that are beyond the maximum timestamp offset.
                if (this.uint32WrapAround(primaryTimestamp - redundantTimestamp) >= this.maxRedTimestampOffset) {
                    break;
                }
                let findTimestamp = redundantTimestamp;
                let encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);
                if (!encoding) {
                    // If not found or not important then look for the previous packet.
                    // The current packet may have included FEC for the previous, so just
                    // use the previous packet instead provided that it has voice activity.
                    findTimestamp = this.uint32WrapAround(redundantTimestamp - this.redPacketizationTime);
                    encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);
                }
                if (encoding) {
                    const redundantEncodingSizeBytes = encoding.payload.byteLength;
                    // Only add redundancy if there are enough bytes available.
                    if (bytesAvailable < this.redHeaderSizeBytes + redundantEncodingSizeBytes)
                        break;
                    bytesAvailable -= this.redHeaderSizeBytes + redundantEncodingSizeBytes;
                    headerSizeBytes += this.redHeaderSizeBytes;
                    payloadSizeBytes += redundantEncodingSizeBytes;
                    redundantEncodingTimestamps.unshift(encoding.timestamp);
                    redundantEncodingPayloads.unshift(encoding.payload);
                }
                redundantTimestamp -= this.redPacketizationTime * this.redPacketDistance;
                redundantTimestamp = this.uint32WrapAround(redundantTimestamp);
            }
        }
        const redPayloadBuffer = new ArrayBuffer(headerSizeBytes + payloadSizeBytes);
        const redPayloadView = new DataView(redPayloadBuffer);
        // Add redundant encoding header(s) to new buffer
        let redPayloadOffset = 0;
        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {
            const timestampDelta = primaryTimestamp - redundantEncodingTimestamps[i];
            redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType | 0x80);
            redPayloadView.setUint16(redPayloadOffset + 1, (timestampDelta << 2) | (redundantEncodingPayloads[i].byteLength >> 8));
            redPayloadView.setUint8(redPayloadOffset + 3, redundantEncodingPayloads[i].byteLength & 0xff);
            redPayloadOffset += this.redHeaderSizeBytes;
        }
        // Add primary encoding header to new buffer
        redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType);
        redPayloadOffset += this.redLastHeaderSizeBytes;
        // Add redundant payload(s) to new buffer
        const redPayloadArray = new Uint8Array(redPayloadBuffer);
        for (let i = 0; i < redundantEncodingPayloads.length; i++) {
            redPayloadArray.set(new Uint8Array(redundantEncodingPayloads[i]), redPayloadOffset);
            redPayloadOffset += redundantEncodingPayloads[i].byteLength;
        }
        // Add primary payload to new buffer
        redPayloadArray.set(new Uint8Array(primaryPayload), redPayloadOffset);
        redPayloadOffset += primaryPayload.byteLength;
        /* istanbul ignore next */
        // Sanity check that we got the expected total payload size.
        if (redPayloadOffset !== headerSizeBytes + payloadSizeBytes)
            return null;
        this.updateEncodingHistory(primaryTimestamp, primaryPayload);
        return redPayloadBuffer;
    }
    /**
     * Update the encoding history with the latest primary encoding
     */
    updateEncodingHistory(primaryTimestamp, primaryPayload) {
        // Remove encodings from the history if they are too old.
        for (const encoding of this.encodingHistory) {
            const maxTimestampDelta = this.redPacketizationTime * this.redMaxRecoveryDistance;
            if (primaryTimestamp - encoding.timestamp >= maxTimestampDelta) {
                this.encodingHistory.shift();
            }
            else {
                break;
            }
        }
        // Only add an encoding to the history if the encoding is deemed to be important. An encoding is important if it is
        // a CELT-only packet or contains voice activity.
        const packet = new DataView(primaryPayload);
        if (this.opusPacketIsCeltOnly(packet) ||
            this.opusPacketHasVoiceActivity(packet, packet.byteLength) > 0) {
            // Check if adding an encoding will cause the length of the encoding history to exceed the maximum history size.
            // This is not expected to happen but could occur if we get incorrect timestamps. We want to make sure our memory
            // usage is bounded. In this case, just clear the history and start over from empty.
            if (this.encodingHistory.length + 1 > this.maxEncodingHistorySize)
                this.encodingHistory.length = 0;
            this.encodingHistory.push({ timestamp: primaryTimestamp, payload: primaryPayload });
        }
    }
    /**
     * Initialize packet logs and metric values.
     */
    initializePacketLogs() {
        // The extra space from the max RED recovery distance is to ensure that we do not incorrectly count recovery for
        // packets that have already been received but are outside of the max out-of-order distance.
        const packetLogSize = this.maxOutOfOrderPacketDistance + this.redMaxRecoveryDistance;
        this.primaryPacketLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.redRecoveryLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.fecRecoveryLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.totalAudioPacketsExpected = 0;
        this.totalAudioPacketsLost = 0;
        this.totalAudioPacketsRecoveredRed = 0;
        this.totalAudioPacketsRecoveredFec = 0;
    }
    /**
     * Receives encoded frames from the server
     * and adds the timestamps to a packet log
     * to calculate an approximate recovery metric.
     */
    receivePacketLogTransform(
    // @ts-ignore
    frame, controller) {
        const frameMetadata = frame.getMetadata();
        // @ts-ignore
        if (frameMetadata.payloadType !== this.redPayloadType) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        // @ts-ignore
        const encodings = this.splitEncodings(frame.timestamp, frame.data, 
        /*getFecInfo*/ true, frameMetadata.sequenceNumber);
        if (!encodings) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        for (let i = encodings.length - 1; i >= 0; i--) {
            if (this.updateLossStats(encodings[i])) {
                this.updateRedStats(encodings[i]);
                this.updateFecStats(encodings[i]);
            }
        }
        this.maybeReportLossStats(frameMetadata.synchronizationSource, encodings[encodings.length - 1].timestamp);
        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
    }
    /**
     * Adds a timestamp to the primary packet log.
     * This also updates totalAudioPacketsLost and totalAudioPacketsExpected by looking
     * at the difference between timestamps.
     *
     * @param encoding : The encoding to be analyzed
     * @returns false if sequence number was greater than max out of order distance
     *          true otherwise
     */
    updateLossStats(encoding) {
        if (encoding.isRedundant)
            return true;
        const timestamp = encoding.timestamp;
        const seq = encoding.seq;
        if (this.totalAudioPacketsExpected === 0) {
            this.totalAudioPacketsExpected = 1;
            this.newestSequenceNumber = seq;
            this.addTimestamp(this.primaryPacketLog, timestamp);
            return true;
        }
        const diff = this.int16(seq - this.newestSequenceNumber);
        if (diff < -this.maxOutOfOrderPacketDistance)
            return false;
        if (diff < 0) {
            if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {
                if (this.totalAudioPacketsLost > 0)
                    this.totalAudioPacketsLost--;
                this.addTimestamp(this.primaryPacketLog, timestamp);
                this.removeFromRecoveryWindows(timestamp);
            }
        }
        else if (diff > 1) {
            this.totalAudioPacketsLost += diff - 1;
        }
        if (diff > 0) {
            this.totalAudioPacketsExpected += diff;
            this.newestSequenceNumber = encoding.seq;
            this.addTimestamp(this.primaryPacketLog, timestamp);
        }
        return true;
    }
    /**
     * Adds a timestamp to the red recovery log if it is not present in
     * the primary packet log and if it's not too old.
     *
     * @param encoding : The encoding to be analyzed
     */
    updateRedStats(encoding) {
        if (!encoding.isRedundant || this.totalAudioPacketsLost === 0)
            return;
        const timestamp = encoding.timestamp;
        if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {
            if (!this.hasTimestamp(this.redRecoveryLog, timestamp)) {
                this.totalAudioPacketsRecoveredRed++;
                this.addTimestamp(this.redRecoveryLog, timestamp);
            }
            if (this.removeTimestamp(this.fecRecoveryLog, timestamp)) {
                /* istanbul ignore else */
                if (this.totalAudioPacketsRecoveredFec > 0)
                    this.totalAudioPacketsRecoveredFec--;
            }
        }
    }
    /**
     * Adds a timestamp to the fec recovery log if it is not present in
     * the primary packet log and red recovery log and if it is not too old.
     *
     * @param encoding : The encoding to be analyzed
     */
    updateFecStats(encoding) {
        if (!encoding.hasFec || this.totalAudioPacketsLost === 0)
            return;
        const fecTimestamp = encoding.timestamp - this.redPacketizationTime;
        if (this.hasTimestamp(this.primaryPacketLog, fecTimestamp) ||
            this.hasTimestamp(this.redRecoveryLog, fecTimestamp) ||
            this.hasTimestamp(this.fecRecoveryLog, fecTimestamp)) {
            return;
        }
        this.totalAudioPacketsRecoveredFec++;
        this.addTimestamp(this.fecRecoveryLog, fecTimestamp);
    }
    /**
     * Reports loss metrics to DefaultTransceiverController
     *
     * @param timestamp : Timestamp of most recent primary packet
     */
    maybeReportLossStats(ssrc, timestamp) {
        if (timestamp === undefined ||
            timestamp - this.lastLossReportTimestamp < this.lossReportInterval)
            return;
        /* istanbul ignore next */
        if (RedundantAudioEncoder.shouldReportStats) {
            // @ts-ignore
            self.postMessage({
                type: 'RedundantAudioEncoderStats',
                ssrc,
                totalAudioPacketsLost: this.totalAudioPacketsLost,
                totalAudioPacketsExpected: this.totalAudioPacketsExpected,
                totalAudioPacketsRecoveredRed: this.totalAudioPacketsRecoveredRed,
                totalAudioPacketsRecoveredFec: this.totalAudioPacketsRecoveredFec,
            });
        }
        this.lastLossReportTimestamp = timestamp;
    }
    /**
     * Adds a timestamp to a packet log
     *
     * @param packetLog : The packetlog to add the timestamp to
     * @param timestamp : The timestamp that should be added
     */
    addTimestamp(packetLog, timestamp) {
        if (timestamp === undefined) {
            return;
        }
        packetLog.window[packetLog.index] = timestamp;
        packetLog.index = (packetLog.index + 1) % packetLog.windowSize;
    }
    /**
     * Checks if a timestamp is in a packetlog
     *
     * @param packetLog : The packetlog to search
     * @param timestamp : The timestamp to search for
     * @returns true if timestamp is present, false otherwise
     */
    hasTimestamp(packetLog, timestamp) {
        const element = packetLog.window.find(t => t === timestamp);
        return !!element;
    }
    /**
     * Removes a timestamp from a packet log
     *
     * @param packetLog : The packetlog from which the timestamp should be removed
     * @param timestamp : The timestamp to be removed
     * @returns true if timestamp was present in the log and removed, false otherwise
     */
    removeTimestamp(packetLog, timestamp) {
        const index = packetLog.window.indexOf(timestamp);
        if (index >= 0) {
            packetLog.window[index] = undefined;
            return true;
        }
        return false;
    }
    /**
     * Removes a timestamp from red and fec recovery windows.
     *
     * @param timestamp : The timestamp to be removed
     */
    removeFromRecoveryWindows(timestamp) {
        let removed = this.removeTimestamp(this.redRecoveryLog, timestamp);
        if (removed) {
            if (this.totalAudioPacketsRecoveredRed > 0)
                this.totalAudioPacketsRecoveredRed--;
        }
        removed = this.removeTimestamp(this.fecRecoveryLog, timestamp);
        if (removed) {
            if (this.totalAudioPacketsRecoveredFec > 0)
                this.totalAudioPacketsRecoveredFec--;
        }
    }
    /**
     * Converts the supplied argument to 32-bit unsigned integer
     */
    uint32WrapAround(num) {
        const mod = 4294967296; // 2^32
        let res = num;
        if (num >= mod) {
            res = num - mod;
        }
        else if (num < 0) {
            res = mod + num;
        }
        return res;
    }
    /**
     * Converts the supplied argument to 16-bit signed integer
     */
    int16(num) {
        return (num << 16) >> 16;
    }
    /**
     * Determines if an Opus packet is in CELT-only mode.
     *
     * @param packet Opus packet.
     * @returns \`true\` if the packet is in CELT-only mode.
     */
    opusPacketIsCeltOnly(packet) {
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        // Since CELT-only packets are represented using configurations 16 to 31, the highest 'config' bit will always be 1
        // for CELT-only packets.
        return !!(packet.getUint8(0) & 0x80);
    }
    /**
     * Gets the number of samples per frame from an Opus packet.
     *
     * @param packet Opus packet. This must contain at least one byte of data.
     * @param sampleRateHz 32-bit integer sampling rate in Hz. This must be a multiple of 400 or inaccurate results will
     *                     be returned.
     * @returns Number of samples per frame.
     */
    opusPacketGetSamplesPerFrame(packet, sampleRateHz) {
        // Sample rate must be a 32-bit integer.
        sampleRateHz = Math.round(sampleRateHz);
        sampleRateHz = Math.min(Math.max(sampleRateHz, -(Math.pow(2, 32))), Math.pow(2, 32) - 1);
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        let numSamples;
        let frameSizeOption;
        // Case for CELT-only packet.
        if (this.opusPacketIsCeltOnly(packet)) {
            // The lower 3 'config' bits indicate the frame size option.
            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;
            // The frame size options 0, 1, 2, 3 correspond to frame sizes of 2.5, 5, 10, 20 ms. Notice that the frame sizes
            // can be represented as (2.5 * 2^0), (2.5 * 2^1), (2.5 * 2^2), (2.5 * 2^3) ms. So, the number of samples can be
            // calculated as follows:
            // (sample/s) * (1s/1000ms) * (2.5ms) * 2^(frameSizeOption)
            // = (sample/s) * (1s/400) * 2^(frameSizeOption)
            // = (sample/s) * 2^(frameSizeOption) * (1s/400)
            numSamples = (sampleRateHz << frameSizeOption) / 400;
        }
        // Case for Hybrid packet. Since Hybrid packets are represented using configurations 12 to 15, bits 1 and 2 in the
        // above TOC byte diagram will both be 1.
        else if ((packet.getUint8(0) & 0x60) === 0x60) {
            // In the case of configuration 13 or 15, bit 4 in the above TOC byte diagram will be 1. Configurations 13 and 15
            // correspond to a 20ms frame size, so the number of samples is calculated as follows:
            // (sample/s) * (1s/1000ms) * (20ms)
            // = (sample/s) * (1s/50)
            //
            // In the case of configuration 12 or 14, bit 4 in the above TOC byte diagram will be 0. Configurations 12 and 14
            // correspond to a 10ms frame size, so the number of samples is calculated as follows:
            // (sample/s) * (1s/1000ms) * (10ms)
            // = (sample/s) * (1s/100)
            numSamples = packet.getUint8(0) & 0x08 ? sampleRateHz / 50 : sampleRateHz / 100;
        }
        // Case for SILK-only packet.
        else {
            // The lower 3 'config' bits indicate the frame size option for SILK-only packets.
            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;
            if (frameSizeOption === 3) {
                // Frame size option 3 corresponds to a frame size of 60ms, so the number of samples is calculated as follows:
                // (sample/s) * (1s/1000ms) * (60ms)
                // = (sample/s) * (60ms) * (1s/1000ms)
                numSamples = (sampleRateHz * 60) / 1000;
            }
            else {
                // The frame size options 0, 1, 2 correspond to frame sizes of 10, 20, 40 ms. Notice that the frame sizes can be
                // represented as (10 * 2^0), (10 * 2^1), (10 * 2^2) ms. So, the number of samples can be calculated as follows:
                // (sample/s) * (1s/1000ms) * (10ms) * 2^(frameSizeOption)
                // = (sample/s) * (1s/100) * 2^(frameSizeOption)
                // = (sample/s) * 2^(frameSizeOption) * (1s/100)
                numSamples = (sampleRateHz << frameSizeOption) / 100;
            }
        }
        return numSamples;
    }
    /**
     * Gets the number of SILK frames per Opus frame.
     *
     * @param packet Opus packet.
     * @returns Number of SILK frames per Opus frame.
     */
    opusNumSilkFrames(packet) {
        // For computing the frame length in ms, the sample rate is not important since it cancels out. We use 48 kHz, but
        // any valid sample rate would work.
        //
        // To calculate the length of a frame (with a 48kHz sample rate) in ms:
        // (samples/frame) * (1s/48000 samples) * (1000ms/s)
        // = (samples/frame) * (1000ms/48000 samples)
        // = (samples/frame) * (1ms/48 samples)
        let frameLengthMs = this.opusPacketGetSamplesPerFrame(packet, 48000) / 48;
        if (frameLengthMs < 10)
            frameLengthMs = 10;
        // The number of SILK frames per Opus frame is described in https://www.rfc-editor.org/rfc/rfc6716#section-4.2.2.
        switch (frameLengthMs) {
            case 10:
            case 20:
                return 1;
            case 40:
                return 2;
            case 60:
                return 3;
            // It is not possible to reach the default case since an Opus packet can only encode sizes of 2.5, 5, 10, 20, 40,
            // or 60 ms, so we ignore the default case for test coverage.
            /* istanbul ignore next */
            default:
                return 0;
        }
    }
    /**
     * Gets the number of channels from an Opus packet.
     *
     * @param packet Opus packet.
     * @returns Number of channels.
     */
    opusPacketGetNumChannels(packet) {
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        // The 's' bit indicates mono or stereo audio, with 0 indicating mono and 1 indicating stereo.
        return packet.getUint8(0) & 0x4 ? 2 : 1;
    }
    /**
     * Determine the size (in bytes) of an Opus frame.
     *
     * @param packet Opus packet.
     * @param byteOffset Offset (from the start of the packet) to the byte containing the size information.
     * @param remainingBytes Remaining number of bytes to parse from the Opus packet.
     * @param sizeBytes Variable to store the parsed frame size (in bytes).
     * @returns Number of bytes that were parsed to determine the frame size.
     */
    opusParseSize(packet, byteOffset, remainingBytes, sizeBytes) {
        // See https://www.rfc-editor.org/rfc/rfc6716#section-3.2.1 for an explanation of how frame size is represented.
        // If there are no remaining bytes to parse the size from, then the size cannot be determined.
        if (remainingBytes < 1) {
            sizeBytes[0] = -1;
            return -1;
        }
        // If the first byte is in the range 0...251, then this value is the size of the frame.
        else if (packet.getUint8(byteOffset) < 252) {
            sizeBytes[0] = packet.getUint8(byteOffset);
            return 1;
        }
        // If the first byte is in the range 252...255, a second byte is needed. If there is no second byte, then the size
        // cannot be determined.
        else if (remainingBytes < 2) {
            sizeBytes[0] = -1;
            return -1;
        }
        // The total size of the frame given two size bytes is:
        // (4 * secondSizeByte) + firstSizeByte
        else {
            sizeBytes[0] = 4 * packet.getUint8(byteOffset + 1) + packet.getUint8(byteOffset);
            return 2;
        }
    }
    /**
     * Parse binary data containing an Opus packet into one or more Opus frames.
     *
     * @param data Binary data containing an Opus packet to be parsed. The data should begin with the first byte (i.e the
     *             TOC byte) of an Opus packet. Note that the size of the data does not have to equal the size of the
     *             contained Opus packet.
     * @param lenBytes Size of the data (in bytes).
     * @param selfDelimited Indicates if the Opus packet is self-delimiting
     *                      (https://www.rfc-editor.org/rfc/rfc6716#appendix-B).
     * @param tocByte Optional variable to store the TOC (table of contents) byte.
     * @param frameOffsets Optional variable to store the offsets (from the start of the data) to the first bytes of each
     *                     Opus frame.
     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.
     * @param payloadOffset Optional variable to store the offset (from the start of the data) to the first byte of the
     *                      payload.
     * @param packetLenBytes Optional variable to store the length of the Opus packet (in bytes).
     * @returns Number of Opus frames.
     */
    opusPacketParseImpl(data, lenBytes, selfDelimited, tocByte, frameOffsets, frameSizes, payloadOffset, packetLenBytes) {
        if (!frameSizes || lenBytes < 0)
            return this.OPUS_BAD_ARG;
        if (lenBytes === 0)
            return this.OPUS_INVALID_PACKET;
        // The number of Opus frames in the packet.
        let numFrames;
        // Intermediate storage for the number of bytes parsed to determine the size of a frame.
        let numBytesParsed;
        // The number of the padding bytes (excluding the padding count bytes) in the packet.
        let paddingBytes = 0;
        // Indicates whether CBR (constant bitrate) framing is used.
        let cbr = false;
        // The TOC (table of contents) byte (https://www.rfc-editor.org/rfc/rfc6716#section-3.1).
        const toc = data.getUint8(0);
        // Store the TOC byte.
        if (tocByte)
            tocByte[0] = toc;
        // The remaining number of bytes to parse from the packet. Note that the TOC byte has already been parsed, hence the
        // minus 1.
        let remainingBytes = lenBytes - 1;
        // This keeps track of where we are in the packet. This starts at 1 since the TOC byte has already been read.
        let byteOffset = 1;
        // The size of the last Opus frame in bytes.
        let lastSizeBytes = remainingBytes;
        // Read the \`c\` bits (i.e. code bits) from the TOC byte.
        switch (toc & 0x3) {
            // A code 0 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.2) has one frame.
            case 0:
                numFrames = 1;
                break;
            // A code 1 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.3) has two CBR (constant bitrate) frames.
            case 1:
                numFrames = 2;
                cbr = true;
                if (!selfDelimited) {
                    // Undelimited code 1 packets must be an even number of data bytes, otherwise the packet is invalid.
                    if (remainingBytes & 0x1)
                        return this.OPUS_INVALID_PACKET;
                    // The sizes of both frames are equal (i.e. half of the number of data bytes).
                    lastSizeBytes = remainingBytes / 2;
                    // If \`lastSizeBytes\` is too large, we will catch it later.
                    frameSizes[0][0] = lastSizeBytes;
                }
                break;
            // A code 2 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.4) has two VBR (variable bitrate) frames.
            case 2:
                numFrames = 2;
                numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[0]);
                remainingBytes -= numBytesParsed;
                // The parsed size of the first frame cannot be larger than the number of remaining bytes in the packet.
                if (frameSizes[0][0] < 0 || frameSizes[0][0] > remainingBytes) {
                    return this.OPUS_INVALID_PACKET;
                }
                byteOffset += numBytesParsed;
                // The size of the second frame is the remaining number of bytes after the first frame.
                lastSizeBytes = remainingBytes - frameSizes[0][0];
                break;
            // A code 3 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5) has multiple CBR/VBR frames (from 0 to
            // 120 ms).
            default:
                // Code 3 packets must have at least 2 bytes (i.e. at least 1 byte after the TOC byte).
                if (remainingBytes < 1)
                    return this.OPUS_INVALID_PACKET;
                // Frame count byte format:
                //  0
                //  0 1 2 3 4 5 6 7
                // +-+-+-+-+-+-+-+-+
                // |v|p|     M     |
                // +-+-+-+-+-+-+-+-+
                //
                // Read the frame count byte, which immediately follows the TOC byte.
                const frameCountByte = data.getUint8(byteOffset++);
                --remainingBytes;
                // Read the 'M' bits of the frame count byte, which encode the number of frames.
                numFrames = frameCountByte & 0x3f;
                // The number of frames in a code 3 packet must not be 0.
                if (numFrames <= 0)
                    return this.OPUS_INVALID_PACKET;
                const samplesPerFrame = this.opusPacketGetSamplesPerFrame(data, 48000);
                // A single frame can have at most 2880 samples, which happens in the case where 60ms of 48kHz audio is encoded
                // per frame. A code 3 packet cannot contain more than 120ms of audio, so the total number of samples cannot
                // exceed 2880 * 2 = 5760.
                if (samplesPerFrame * numFrames > 5760)
                    return this.OPUS_INVALID_PACKET;
                // Parse padding bytes if the 'p' bit is 1.
                if (frameCountByte & 0x40) {
                    let paddingCountByte;
                    let numPaddingBytes;
                    // Remove padding bytes (including padding count bytes) from the remaining byte count.
                    do {
                        // Sanity check that there are enough bytes to parse and remove the padding.
                        if (remainingBytes <= 0)
                            return this.OPUS_INVALID_PACKET;
                        // Get the next padding count byte.
                        paddingCountByte = data.getUint8(byteOffset++);
                        --remainingBytes;
                        // If the padding count byte has a value in the range 0...254, then the total size of the padding is the
                        // value in the padding count byte.
                        //
                        // If the padding count byte has value 255, then the total size of the padding is 254 plus the value in the
                        // next padding count byte. Therefore, keep reading padding count bytes while the value is 255.
                        numPaddingBytes = paddingCountByte === 255 ? 254 : paddingCountByte;
                        remainingBytes -= numPaddingBytes;
                        paddingBytes += numPaddingBytes;
                    } while (paddingCountByte === 255);
                }
                // Sanity check that the remaining number of bytes is not negative after removing the padding.
                if (remainingBytes < 0)
                    return this.OPUS_INVALID_PACKET;
                // Read the 'v' bit (i.e. VBR bit).
                cbr = !(frameCountByte & 0x80);
                // VBR case
                if (!cbr) {
                    lastSizeBytes = remainingBytes;
                    // Let M be the number of frames. There will be M - 1 frame length indicators (which can be 1 or 2 bytes)
                    // corresponding to the lengths of frames 0 to M - 2. The size of the last frame (i.e. frame M - 1) is the
                    // number of data bytes after the end of frame M - 2 and before the start of the padding bytes.
                    for (let i = 0; i < numFrames - 1; ++i) {
                        numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[i]);
                        remainingBytes -= numBytesParsed;
                        // The remaining number of data bytes must be enough to contain each frame.
                        if (frameSizes[i][0] < 0 || frameSizes[i][0] > remainingBytes) {
                            return this.OPUS_INVALID_PACKET;
                        }
                        byteOffset += numBytesParsed;
                        lastSizeBytes -= numBytesParsed + frameSizes[i][0];
                    }
                    // Sanity check that the size of the last frame is not negative.
                    if (lastSizeBytes < 0)
                        return this.OPUS_INVALID_PACKET;
                }
                // CBR case
                else if (!selfDelimited) {
                    // The size of each frame is the number of data bytes divided by the number of frames.
                    lastSizeBytes = Math.trunc(remainingBytes / numFrames);
                    // The number of data bytes must be a non-negative integer multiple of the number of frames.
                    if (lastSizeBytes * numFrames !== remainingBytes)
                        return this.OPUS_INVALID_PACKET;
                    // All frames have equal size in the undelimited CBR case.
                    for (let i = 0; i < numFrames - 1; ++i) {
                        frameSizes[i][0] = lastSizeBytes;
                    }
                }
        }
        // Self-delimited framing uses an extra 1 or 2 bytes, immediately preceding the data bytes, to indicate either the
        // size of the last frame (for code 0, code 2, and VBR code 3 packets) or the size of all the frames (for code 1 and
        // CBR code 3 packets). See https://www.rfc-editor.org/rfc/rfc6716#appendix-B.
        if (selfDelimited) {
            // The extra frame size byte(s) will always indicate the size of the last frame.
            numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[numFrames - 1]);
            remainingBytes -= numBytesParsed;
            // There must be enough data bytes for the last frame.
            if (frameSizes[numFrames - 1][0] < 0 || frameSizes[numFrames - 1][0] > remainingBytes) {
                return this.OPUS_INVALID_PACKET;
            }
            byteOffset += numBytesParsed;
            // For CBR packets, the sizes of all the frames are equal.
            if (cbr) {
                // There must be enough data bytes for all the frames.
                if (frameSizes[numFrames - 1][0] * numFrames > remainingBytes) {
                    return this.OPUS_INVALID_PACKET;
                }
                for (let i = 0; i < numFrames - 1; ++i) {
                    frameSizes[i][0] = frameSizes[numFrames - 1][0];
                }
            }
            // At this point, \`lastSizeBytes\` contains the size of the last frame plus the size of the extra frame size
            // byte(s), so sanity check that \`lastSizeBytes\` is the upper bound for the size of the last frame.
            else if (!(numBytesParsed + frameSizes[numFrames - 1][0] <= lastSizeBytes)) {
                return this.OPUS_INVALID_PACKET;
            }
        }
        // Undelimited case
        else {
            // Because the size of the last packet is not encoded explicitly, it is possible that the size of the last packet
            // (or of all the packets, for the CBR case) is larger than maximum frame size.
            if (lastSizeBytes > this.OPUS_MAX_FRAME_SIZE_BYTES)
                return this.OPUS_INVALID_PACKET;
            frameSizes[numFrames - 1][0] = lastSizeBytes;
        }
        // Store the offset to the start of the payload.
        if (payloadOffset)
            payloadOffset[0] = byteOffset;
        // Store the offsets to the start of each frame.
        for (let i = 0; i < numFrames; ++i) {
            if (frameOffsets)
                frameOffsets[i][0] = byteOffset;
            byteOffset += frameSizes[i][0];
        }
        // Store the length of the Opus packet.
        if (packetLenBytes)
            packetLenBytes[0] = byteOffset + paddingBytes;
        return numFrames;
    }
    /**
     * Parse a single undelimited Opus packet into one or more Opus frames.
     *
     * @param packet Opus packet to be parsed.
     * @param lenBytes Size of the packet (in bytes).
     * @param tocByte Optional variable to store the TOC (table of contents) byte.
     * @param frameOffsets Optional variable to store the offsets (from the start of the packet) to the first bytes of
     *                     each Opus frame.
     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.
     * @param payloadOffset Optional variable to store the offset (from the start of the packet) to the first byte of the
     *                      payload.
     * @returns Number of Opus frames.
     */
    opusPacketParse(packet, lenBytes, tocByte, frameOffsets, frameSizes, payloadOffset) {
        return this.opusPacketParseImpl(packet, lenBytes, 
        /* selfDelimited */ false, tocByte, frameOffsets, frameSizes, payloadOffset, null);
    }
    /**
     * This function returns the SILK VAD (voice activity detection) information encoded in the Opus packet. For CELT-only
     * packets that do not have VAD information, it returns -1.
     *
     * @param packet Opus packet.
     * @param lenBytes Size of the packet (in bytes).
     * @returns  0: no frame had the VAD flag set.
     *           1: at least one frame had the VAD flag set.
     *          -1: VAD status could not be determined.
     */
    opusPacketHasVoiceActivity(packet, lenBytes) {
        if (!packet || lenBytes <= 0)
            return 0;
        // In CELT-only mode, we can not determine whether there is VAD.
        if (this.opusPacketIsCeltOnly(packet))
            return -1;
        const numSilkFrames = this.opusNumSilkFrames(packet);
        // It is not possible for \`opusNumSilkFrames()\` to return 0, so we ignore the next sanity check for test coverage.
        /* istanbul ignore next */
        if (numSilkFrames === 0)
            return -1;
        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);
        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);
        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {
            opusFrameOffsets[i] = [undefined];
            opusFrameSizes[i] = [undefined];
        }
        // Parse packet to get the Opus frames.
        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);
        // VAD status cannot be determined for invalid packets.
        if (numOpusFrames < 0)
            return -1;
        // Iterate over all Opus frames, which may contain multiple SILK frames, to determine the VAD status.
        for (let i = 0; i < numOpusFrames; ++i) {
            if (opusFrameSizes[i][0] < 1)
                continue;
            // LP layer header bits format (https://www.rfc-editor.org/rfc/rfc6716#section-4.2.3):
            //
            // Mono case:
            // +-----------------+----------+
            // | 1 to 3 VAD bits | LBRR bit |
            // +-----------------+----------+
            //
            // Stereo case:
            // +---------------------+--------------+----------------------+---------------+
            // | 1 to 3 mid VAD bits | mid LBRR bit | 1 to 3 side VAD bits | side LBRR bit |
            // +---------------------+--------------+----------------------+---------------+
            // The upper 1 to 3 bits (dependent on the number of SILK frames) of the LP layer contain VAD bits. If any of
            // these VAD bits are 1, then voice activity is present.
            if (packet.getUint8(opusFrameOffsets[i][0]) >> (8 - numSilkFrames))
                return 1;
            // In the stereo case, there is a second set of 1 to 3 VAD bits, so also check these VAD bits.
            const channels = this.opusPacketGetNumChannels(packet);
            if (channels === 2 &&
                (packet.getUint8(opusFrameOffsets[i][0]) << (numSilkFrames + 1)) >> (8 - numSilkFrames)) {
                return 1;
            }
        }
        // No voice activity was detected.
        return 0;
    }
    /**
     * This method is based on Definition of the Opus Audio Codec
     * (https://tools.ietf.org/html/rfc6716). Basically, this method is based on
     * parsing the LP layer of an Opus packet, particularly the LBRR flag.
     *
     * @param packet Opus packet.
     * @param lenBytes Size of the packet (in bytes).
     * @returns  true: packet has fec encoding about previous packet.
     *           false: no fec encoding present.
     */
    opusPacketHasFec(packet, lenBytes) {
        if (!packet || lenBytes <= 0)
            return false;
        // In CELT-only mode, packets should not have FEC.
        if (this.opusPacketIsCeltOnly(packet))
            return false;
        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);
        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);
        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {
            opusFrameOffsets[i] = [undefined];
            opusFrameSizes[i] = [undefined];
        }
        // Parse packet to get the Opus frames.
        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);
        if (numOpusFrames < 0)
            return false;
        /* istanbul ignore next */
        if (opusFrameSizes[0][0] <= 1)
            return false;
        const numSilkFrames = this.opusNumSilkFrames(packet);
        /* istanbul ignore next */
        if (numSilkFrames === 0)
            return false;
        const channels = this.opusPacketGetNumChannels(packet);
        /* istanbul ignore next */
        if (channels !== 1 && channels !== 2)
            return false;
        // A frame starts with the LP layer. The LP layer begins with two to eight
        // header bits.These consist of one VAD bit per SILK frame (up to 3),
        // followed by a single flag indicating the presence of LBRR frames.
        // For a stereo packet, these first flags correspond to the mid channel, and
        // a second set of flags is included for the side channel. Because these are
        // the first symbols decoded by the range coder and because they are coded
        // as binary values with uniform probability, they can be extracted directly
        // from the most significant bits of the first byte of compressed data.
        for (let i = 0; i < channels; i++) {
            if (packet.getUint8(opusFrameOffsets[0][0]) & (0x80 >> ((i + 1) * (numSilkFrames + 1) - 1)))
                return true;
        }
        return false;
    }
}
RedundantAudioEncoder.shouldLog = true;
RedundantAudioEncoder.shouldReportStats = true;
RedundantAudioEncoder.initializeWorker();
`;Ob.default=f5});var zd=y($n=>{"use strict";var ks=$n&&$n.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Hd=$n&&$n.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty($n,"__esModule",{value:!0});var h5=Hd(Cu()),p5=Hd(nf()),m5=Hd(xb()),g5=Hd(Pb()),S5=Hd(wt()),Rb=class{constructor(t,e,r){this.logger=t,this.browserBehavior=e,this.meetingSessionContext=r,this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null,this.streamIdToTransceiver=new Map,this.groupIdToTransceiver=new Map,this.audioRedWorker=null,this.audioRedWorkerURL=null,this.audioMetricsHistory=new Array,this.redMetricsObservers=new Set,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.maxAudioMetricsHistory=20,this.audioRedPacketLossShortEvalPeriodMs=5*1e3,this.audioRedPacketLossLongEvalPeriodMs=15*1e3,this.audioRedHoldDownTimeMs=300*1e3,this.redRecoveryTimeMs=60*1e3}setEncodingParameters(t){return ks(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender;if(!t||t.size===0)return;let r=Array.from(t.values()),n=e.getParameters();if(!n.encodings||n.encodings.length===0)n.encodings=r;else for(let o of n.encodings)for(let s of r){if((o.rid||s.rid)&&o.rid!==s.rid)continue;let a;for(a in s)a==="rid"||a==="codecPayloadType"||s.hasOwnProperty(a)&&(o[a]=s[a])}yield e.setParameters(n)})}localAudioTransceiver(){return this._localAudioTransceiver}localVideoTransceiver(){return this._localCameraTransceiver}setVideoSendingBitrateKbps(t){return ks(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender;if(!e||t<=0)return;let r=e.getParameters();r.encodings||(r.encodings=[{}]);for(let n of r.encodings)n.maxBitrate=t*1e3;yield e.setParameters(r)})}setPeer(t){this.peer=t}reset(){this.destroyAudioRedWorkerAndStates(),this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null}useTransceivers(){return!!this.peer&&typeof this.peer.getTransceivers<"u"}hasVideoInput(){return!(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")}trackIsVideoInput(t){return this._localCameraTransceiver?t===this._localCameraTransceiver.sender.track||t===this._localCameraTransceiver.receiver.track:!1}setupLocalTransceivers(){var t,e;this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),!((e=(t=this.meetingSessionContext)===null||t===void 0?void 0:t.audioProfile)===null||e===void 0)&&e.hasRedundancyEnabled()&&this.setupAudioRedWorker()),this._localCameraTransceiver||(this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}replaceAudioTrack(t){return ks(this,void 0,void 0,function*(){return!this._localAudioTransceiver||this._localAudioTransceiver.direction!=="sendrecv"?(this.logger.info("audio transceiver direction is not set up or not activated"),!1):(yield this._localAudioTransceiver.sender.replaceTrack(t),!0)})}setAudioInput(t){return ks(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localAudioTransceiver,t)})}setVideoInput(t){return ks(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localCameraTransceiver,t)})}updateVideoTransceivers(t,e){if(!this.useTransceivers())return e.array();let r=this.peer.getTransceivers();return this.videoSubscriptions=[0],e=e.clone(),this.updateTransceivers(r,t,e),this.logger.debug(()=>this.debugDumpTransceivers()),this.videoSubscriptions}updateTransceivers(t,e,r){let n=r.array();t.length!==0&&!t[0].stop?(this.logger.info("Updating transceivers without `stop` function"),this.updateTransceiverWithoutStop(t,e,n)):t.length!==0&&this.updateTransceiverWithStop(t,e,n);for(let o of n){let s=this.addTransceiver("video",{direction:"recvonly",streams:[new MediaStream]});this.streamIdToTransceiver.set(o,s),this.groupIdToTransceiver.set(e.groupIdForStreamId(o),s),this.videoSubscriptions.push(o),this.logger.info(`adding transceiver mid: ${s.mid} subscription: ${o} direction: recvonly`)}}updateTransceiverWithStop(t,e,r){let n=1;this.videoSubscriptions=[0];for(let o of t){if(o===this._localCameraTransceiver||!this.transceiverIsVideo(o)||!o.mid)continue;let s=!1,a=e.streamIdForTrack("v_"+o.mid);if(o.direction!=="inactive"&&a!==void 0){for(let[l,c]of r.entries())if(e.StreamIdsInSameGroup(a,c)){o.direction="recvonly",this.videoSubscriptions[n]=c,s=!0,this.streamIdToTransceiver.delete(a),this.streamIdToTransceiver.set(c,o),r.splice(l,1);break}}if(!s){this.videoSubscriptions[n]=0,this.logger.info(`Stopping MID: ${o.mid}, direction: ${o.direction}, current direction: ${o.currentDirection}`),o.stop();for(let[l,c]of this.streamIdToTransceiver.entries())o.mid===c.mid&&(this.streamIdToTransceiver.delete(l),this.groupIdToTransceiver.delete(e.groupIdForStreamId(l)))}n+=1}}updateTransceiverWithoutStop(t,e,r){let n=1;for(let o of t)if(!(o===this._localCameraTransceiver||!this.transceiverIsVideo(o))){if(this.videoSubscriptions[n]=0,o.direction!=="inactive"){let s=e.streamIdForTrack("v_"+o.mid);if(s!==void 0){for(let[a,l]of r.entries())if(e.StreamIdsInSameGroup(s,l)){o.direction="recvonly",this.videoSubscriptions[n]=l,this.streamIdToTransceiver.delete(s),this.streamIdToTransceiver.set(l,o),r.splice(a,1);break}}}n+=1}n=1;for(let o of t)if(!(o===this._localCameraTransceiver||!this.transceiverIsVideo(o))){if(o.direction==="inactive"&&r.length>0){o.direction="recvonly";let s=r.shift();this.videoSubscriptions[n]=s,this.streamIdToTransceiver.set(s,o),this.groupIdToTransceiver.set(e.groupIdForStreamId(s),o)}else if(this.videoSubscriptions[n]===0){o.direction="inactive";for(let[s,a]of this.streamIdToTransceiver.entries())o===a&&(this.streamIdToTransceiver.delete(s),this.groupIdToTransceiver.delete(e.groupIdForStreamId(s)))}n+=1}}getMidForStreamId(t){var e;return(e=this.streamIdToTransceiver.get(t))===null||e===void 0?void 0:e.mid}setStreamIdForMid(t,e){for(let[r,n]of this.streamIdToTransceiver.entries())if(n.mid===t){this.streamIdToTransceiver.delete(r),this.streamIdToTransceiver.set(e,n);return}}getMidForGroupId(t){var e,r;return(r=(e=this.groupIdToTransceiver.get(t))===null||e===void 0?void 0:e.mid)!==null&&r!==void 0?r:void 0}transceiverIsVideo(t){return t.receiver&&t.receiver.track&&t.receiver.track.kind==="video"||t.sender&&t.sender.track&&t.sender.track.kind==="video"}debugDumpTransceivers(){let t="",e=0;for(let r of this.peer.getTransceivers())this.transceiverIsVideo(r)&&(t+=`transceiver index=${e} mid=${r.mid} subscription=${this.videoSubscriptions[e]} direction=${r.direction}
`,e+=1);return t}setTransceiverInput(t,e){return ks(this,void 0,void 0,function*(){t&&(e?t.direction="sendrecv":t.direction="inactive",yield t.sender.replaceTrack(e))})}forEachRedMetricsObserver(t){for(let e of this.redMetricsObservers)S5.default.nextTick(()=>{this.redMetricsObservers.has(e)&&e.recoveryMetricsDidReceive(t)})}disableAudioRedundancy(){this.meetingSessionContext.audioProfile=new h5.default(this.meetingSessionContext.audioProfile.audioBitrateBps,!1),this.meetingSessionContext.audioVideoController.setAudioProfile(this.meetingSessionContext.audioProfile)}setupAudioRedWorker(){var t,e;let r=!!window.RTCRtpScriptTransform,n=!!RTCRtpSender.prototype.createEncodedStreams;if(r)this.logger.info("[AudioRed] Supports encoded insertable streams using RTCRtpScriptTransform");else if(n)this.logger.info("[AudioRed] Supports encoded insertable streams using TransformStream");else throw this.disableAudioRedundancy(),new Error("[AudioRed] Encoded insertable streams not supported. Recreating peer connection with audio redundancy disabled.");try{this.audioRedWorkerURL=URL.createObjectURL(new Blob([g5.default],{type:"application/javascript"})),this.logger.info(`[AudioRed] Redundant audio worker URL ${this.audioRedWorkerURL}`),this.audioRedWorker=new Worker(this.audioRedWorkerURL)}catch(o){throw this.logger.error(`[AudioRed] Unable to create audio red worker due to ${o}`),URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker=null,this.disableAudioRedundancy(),this.logger.info("[AudioRed] Recreating peer connection with audio redundancy disabled"),o}if(this.audioRedEnabled=!0,this.audioRedWorker.onmessage=o=>{if(o.data.type==="REDWorkerLog")this.logger.info(o.data.log);else if(o.data.type==="RedundantAudioEncoderStats"){let s=new p5.default;s.currentTimestampMs=Date.now(),s.ssrc=o.data.ssrc,s.totalAudioPacketsLost=o.data.totalAudioPacketsLost,s.totalAudioPacketsExpected=o.data.totalAudioPacketsExpected,s.totalAudioPacketsRecoveredRed=o.data.totalAudioPacketsRecoveredRed,s.totalAudioPacketsRecoveredFec=o.data.totalAudioPacketsRecoveredFec,this.forEachRedMetricsObserver(s)}},r)this._localAudioTransceiver.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"SenderTransform"}),this._localAudioTransceiver.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"ReceiverTransform"});else if(n){let o=this._localAudioTransceiver.sender.createEncodedStreams(),s=this._localAudioTransceiver.receiver.createEncodedStreams();this.audioRedWorker.postMessage({msgType:"StartRedWorker",send:o,receive:s},[o.readable,o.writable,s.readable,s.writable])}(t=this.meetingSessionContext)===null||t===void 0||t.audioVideoController.addObserver(this),this.addRedundantAudioRecoveryMetricsObserver((e=this.meetingSessionContext)===null||e===void 0?void 0:e.statsCollector)}addTransceiver(t,e){var r;let n=this.peer.addTransceiver(t,e);if(!(!((r=this.peer.getConfiguration())===null||r===void 0)&&r.encodedInsertableStreams)||!this.audioRedWorker)return n;let o=!!window.RTCRtpScriptTransform,s=!!RTCRtpSender.prototype.createEncodedStreams;if(o)n.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"}),n.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"});else if(s){let a=n.sender.createEncodedStreams(),l=n.receiver.createEncodedStreams();this.audioRedWorker.postMessage({msgType:"PassthroughTransform",send:a,receive:l},[a.readable,a.writable,l.readable,l.writable])}return n}destroyAudioRedWorkerAndStates(){var t,e;this.audioRedWorker&&(URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker.terminate(),this.audioRedWorker=null,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.audioRedEnabled=!0,(t=this.meetingSessionContext)===null||t===void 0||t.audioVideoController.removeObserver(this),this.removeRedundantAudioRecoveryMetricsObserver((e=this.meetingSessionContext)===null||e===void 0?void 0:e.statsCollector))}setAudioPayloadTypes(t){this.audioRedWorker&&(this.audioRedWorker.postMessage({msgType:"RedPayloadType",payloadType:t.get("red")}),this.audioRedWorker.postMessage({msgType:"OpusPayloadType",payloadType:t.get("opus")}))}metricsDidReceive(t){let{currentTimestampMs:e}=t,r=t.getRTCStatsReport(),n=0,o=0,s=0;r.forEach(f=>{f.kind==="audio"&&(f.type==="outbound-rtp"?o=f.packetsSent:f.type==="remote-inbound-rtp"&&(n=f.timestamp,s=f.packetsLost))}),(this.audioMetricsHistory.length===0||n>this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs&&o>this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent)&&this.audioMetricsHistory.push({timestampMs:n,totalPacketsSent:o,totalPacketsLost:s}),this.audioMetricsHistory.length>this.maxAudioMetricsHistory&&this.audioMetricsHistory.shift();let a=this.lossPercent(this.audioRedPacketLossShortEvalPeriodMs),l=this.lossPercent(this.audioRedPacketLossLongEvalPeriodMs),c=Math.max(a,l),[d,u]=m5.default.getNumRedundantEncodingsForPacketLoss(c);if(u){this.lastHighPacketLossEventTimestampMs=e,this.audioRedEnabled&&(this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Disable"}),this.audioRedEnabled=!1,this.lastAudioRedTurnOffTimestampMs=e);return}else if(!this.audioRedEnabled){let f=e-this.lastAudioRedTurnOffTimestampMs,m=e-this.lastHighPacketLossEventTimestampMs;if(f>=this.audioRedPacketLossLongEvalPeriodMs&&m<this.redRecoveryTimeMs)return;this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Enable"}),this.audioRedEnabled=!0,this.maybeResetHoldDownTimer(e)}this.shouldUpdateAudioRedWorkerEncodings(e,d)&&this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"UpdateNumRedundantEncodings",numRedundantEncodings:d})}maybeResetHoldDownTimer(t){this.currentNumRedundantEncodings>0&&(this.lastRedHolddownTimerStartTimestampMs=t)}lossPercent(t){if(this.audioMetricsHistory.length<2)return 0;let e=this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs,r=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent,n=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsLost;for(let o=this.audioMetricsHistory.length-2;o>=0;o--)if(e-this.audioMetricsHistory[o].timestampMs>=t){let s=n-this.audioMetricsHistory[o].totalPacketsLost,a=r-this.audioMetricsHistory[o].totalPacketsSent,l=100*(s/a);return Math.max(0,Math.min(l,100))}return 0}shouldUpdateAudioRedWorkerEncodings(t,e){return this.currentNumRedundantEncodings===e?(this.maybeResetHoldDownTimer(t),!1):e<this.currentNumRedundantEncodings&&t-this.lastRedHolddownTimerStartTimestampMs<this.audioRedHoldDownTimeMs?!1:(this.currentNumRedundantEncodings=e,this.maybeResetHoldDownTimer(t),!0)}addRedundantAudioRecoveryMetricsObserver(t){this.redMetricsObservers.add(t)}removeRedundantAudioRecoveryMetricsObserver(t){this.redMetricsObservers.delete(t)}};$n.default=Rb});var $d=y(jn=>{"use strict";var gO=jn&&jn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},y5=jn&&jn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(jn,"__esModule",{value:!0});var v5=y5(zd()),Tr=class i extends v5.default{constructor(t,e,r){super(t,e,r),this.videoQualityControlParameterMap=new Map;let n=4;for(let o=0;o<i.NAME_ARR_ASCENDING.length;o++){let s=i.NAME_ARR_ASCENDING[o];this.videoQualityControlParameterMap.set(s,{rid:s,scaleResolutionDownBy:n,maxBitrate:i.BITRATE_ARR_ASCENDING[o]*1e3}),n=n/2}}setEncodingParameters(t){return gO(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender,r=Array.from(t.values());if(r.length<=0)return;let n=e.getParameters();if(!n.encodings)n.encodings=r;else for(let o of n.encodings)o.rid===i.LOW_LEVEL_NAME&&this.copyEncodingParams(t.get(i.LOW_LEVEL_NAME),o),o.rid===i.MID_LEVEL_NAME&&this.copyEncodingParams(t.get(i.MID_LEVEL_NAME),o),o.rid===i.HIGH_LEVEL_NAME&&this.copyEncodingParams(t.get(i.HIGH_LEVEL_NAME),o);yield e.setParameters(n),this.logVideoTransceiverParameters()})}setVideoSendingBitrateKbps(t){return gO(this,void 0,void 0,function*(){})}setupLocalTransceivers(){var t,e;if(this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),!((e=(t=this.meetingSessionContext)===null||t===void 0?void 0:t.audioProfile)===null||e===void 0)&&e.hasRedundancyEnabled()&&this.setupAudioRedWorker()),!this._localCameraTransceiver)){let r=Array.from(this.videoQualityControlParameterMap.values());this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream],sendEncodings:r})}}logVideoTransceiverParameters(){let e=this._localCameraTransceiver.sender.getParameters().encodings,r=`simulcast: current encoding parameters 
`;for(let n of e)r+=`rid=${n.rid} maxBitrate=${n.maxBitrate} active=${n.active} scaleDownBy=${n.scaleResolutionDownBy} maxFrameRate = ${n.maxFramerate} 
`;this.logger.info(r)}copyEncodingParams(t,e){e.active=t.active,e.maxBitrate=t.maxBitrate,e.scaleResolutionDownBy=t.scaleResolutionDownBy,e.maxFramerate=t.maxFramerate}};jn.default=Tr;Tr.LOW_LEVEL_NAME="low";Tr.MID_LEVEL_NAME="mid";Tr.HIGH_LEVEL_NAME="hi";Tr.NAME_ARR_ASCENDING=["low","mid","hi"];Tr.BITRATE_ARR_ASCENDING=[200,400,1100]});var Af=y(Wn=>{"use strict";var b5=Wn&&Wn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},w5=Wn&&Wn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Wn,"__esModule",{value:!0});var jd=w5($d()),Wd=class i extends jd.default{constructor(t,e,r){super(t,e,r);let n=2;this.videoQualityControlParameterMap=new Map;for(let o=0;o<i.NAME_ARR_ASCENDING.length;o++){let s=i.NAME_ARR_ASCENDING[o];this.videoQualityControlParameterMap.set(s,{rid:s,scaleResolutionDownBy:n,maxBitrate:i.BITRATE_ARR_ASCENDING[o]*1e3}),n=n/2}}setEncodingParameters(t){return b5(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender,r=Array.from(t.values());if(r.length<=0)return;let n=e.getParameters();if(!n.encodings)n.encodings=r;else for(let o=0;o<n.encodings.length;o++)n.encodings[o].rid===jd.default.LOW_LEVEL_NAME&&this.copyEncodingParams(t.get(jd.default.LOW_LEVEL_NAME),n.encodings[o]),n.encodings[o].rid===jd.default.HIGH_LEVEL_NAME&&this.copyEncodingParams(t.get(jd.default.HIGH_LEVEL_NAME),n.encodings[o]);yield e.setParameters(n),this.logVideoTransceiverParameters()})}};Wn.default=Wd;Wd.NAME_ARR_ASCENDING=["low","hi"];Wd.BITRATE_ARR_ASCENDING=[300,1200]});var Nb=y(Gd=>{"use strict";var C5=Gd&&Gd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Gd,"__esModule",{value:!0});var _5=C5(zd()),Db=class extends _5.default{constructor(t,e,r){super(t,e,r)}setupLocalTransceivers(){this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localCameraTransceiver||(this._localCameraTransceiver=this.peer.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}};Gd.default=Db});var Ms=y(Fb=>{"use strict";Object.defineProperty(Fb,"__esModule",{value:!0});var Lb=class i{constructor(t,e,r,n,o,s=1,a=!1){this.cameraWidth=t,this.cameraHeight=e,this.cameraFrameRate=r,this.maxEncodeBitrateKbps=n,this.isSimulcast=o,this.scaleResolutionDownBy=s,this.isSVC=a}equal(t){let e=t.captureWidth()===this.cameraWidth&&t.captureHeight()===this.cameraHeight&&t.captureFrameRate()===this.cameraFrameRate&&t.encodeBitrates().length===this.encodeBitrates().length&&t.encodeScaleResolutionDownBy().length===this.encodeScaleResolutionDownBy().length&&t.encodeWidths().length===this.encodeWidths().length&&t.encodeHeights().length===this.encodeHeights().length&&t.isSVCEncoding()===this.isSVC;if(e){for(let r=0;r<t.encodeWidths().length;r++)if(t.encodeWidths()[r]!==this.encodeWidths()[r]||t.encodeHeights()[r]!==this.encodeHeights()[r]||t.encodeBitrates()[r]!==this.encodeBitrates()[r]||t.encodeScaleResolutionDownBy()[r]!==this.encodeScaleResolutionDownBy()[r])return e=!1,e}return e}clone(){return new i(this.cameraWidth,this.cameraHeight,this.cameraFrameRate,this.maxEncodeBitrateKbps,this.isSimulcast,this.scaleResolutionDownBy,this.isSVC)}captureWidth(){return this.cameraWidth}captureHeight(){return this.cameraHeight}captureFrameRate(){return this.cameraFrameRate}encodeBitrates(){return[this.maxEncodeBitrateKbps]}encodeScaleResolutionDownBy(){return[this.scaleResolutionDownBy]}encodeWidths(){return[this.cameraWidth]}encodeHeights(){return[this.cameraHeight]}isSVCEncoding(){return this.isSVC}};Fb.default=Lb});var kf=y(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});xs.TargetDisplaySize=void 0;var SO;(function(i){i[i.Low=0]="Low",i[i.Medium=1]="Medium",i[i.High=2]="High",i[i.Maximum=3]="Maximum"})(SO=xs.TargetDisplaySize||(xs.TargetDisplaySize={}));xs.default=SO});var Mf=y(Jd=>{"use strict";var yO=Jd&&Jd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Jd,"__esModule",{value:!0});var Kd=yO(kf()),T5=yO(od()),Gn=class i{constructor(t,e,r,n){this.attendeeId=t,this.priority=e,this.targetSize=r!==void 0?r:Kd.default.Maximum,this.degradationPreference=n!==void 0?n:T5.default.Balanced}partialCompare(t){return this.priority-t.priority}equals(t){return this.attendeeId===t.attendeeId&&this.targetSize===t.targetSize&&this.priority===t.priority&&this.degradationPreference===t.degradationPreference}clone(){return new i(this.attendeeId,this.priority,this.targetSize,this.degradationPreference)}targetSizeToBitrateKbps(t){switch(t){case Kd.default.Maximum:return i.MAXIMUM_BITRATE_KBPS;case Kd.default.High:return i.HIGH_BITRATE_KBPS;case Kd.default.Medium:return i.MID_BITRATE_KBPS;case Kd.default.Low:return i.LOW_BITRATE_KBPS}}};Jd.default=Gn;Gn.LOW_BITRATE_KBPS=300;Gn.MID_BITRATE_KBPS=600;Gn.HIGH_BITRATE_KBPS=1500;Gn.MAXIMUM_BITRATE_KBPS=1e4});var Ub=y(Vb=>{"use strict";Object.defineProperty(Vb,"__esModule",{value:!0});var Bb=class{};Vb.default=Bb});var xf=y(Qd=>{"use strict";var E5=Qd&&Qd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Qd,"__esModule",{value:!0});var I5=E5(li()),Kt=class i{constructor(t=0,e=0){this.networkIssueResponseDelayFactor=t,this.networkIssueRecoveryDelayFactor=e,this.currentNetworkEvent=0,this.bandwidthDecreaseTimestamp=0,this.referenceBitrate=0,this.serverSideNetworkAdaption=I5.default.BandwidthProbingAndRemoteVideoQualityAdaption,t<0?t=0:t>1&&(t=1),this.networkIssueResponseDelayFactor=t,e<0?e=0:e>1&&(e=1),this.networkIssueRecoveryDelayFactor=e}allowSubscribe(t,e){let r=0,n=this.currentNetworkEvent;if(e>this.referenceBitrate)return this.currentNetworkEvent=2,this.referenceBitrate=e,!0;if(e<this.referenceBitrate){if(this.currentNetworkEvent=1,r=this.getSubscribeDelay(this.currentNetworkEvent,t),n!==1)this.bandwidthDecreaseTimestamp=Date.now();else if(Date.now()-this.bandwidthDecreaseTimestamp>r)return this.referenceBitrate=e,!0;return!1}else return this.currentNetworkEvent=0,!1}getSubscribeDelay(t,e){let r=i.MINIMUM_DELAY_MS,n=i.MAXIMUM_DELAY_MS-i.MINIMUM_DELAY_MS,o=this.networkIssueResponseDelayFactor;switch(t){case 1:r+=n*o*(1+e/10),r=Math.min(i.MAXIMUM_DELAY_MS,r);break}return r}};Qd.default=Kt;Kt.MINIMUM_DELAY_MS=2e3;Kt.MAXIMUM_DELAY_MS=8e3;Kt.Default=new Kt(0,0);Kt.UnstableNetworkPreset=new Kt(0,1);Kt.StableNetworkPreset=new Kt(1,0)});var qb=y(Jt=>{"use strict";var A5=Jt&&Jt.__createBinding||(Object.create?(function(i,t,e,r){r===void 0&&(r=e),Object.defineProperty(i,r,{enumerable:!0,get:function(){return t[e]}})}):(function(i,t,e,r){r===void 0&&(r=e),i[r]=t[e]})),k5=Jt&&Jt.__setModuleDefault||(Object.create?(function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}):function(i,t){i.default=t}),M5=Jt&&Jt.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var e in i)e!=="default"&&Object.prototype.hasOwnProperty.call(i,e)&&A5(t,i,e);return k5(t,i),t},Qt=Jt&&Jt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Jt,"__esModule",{value:!0});var x5=Qt(Yp()),O5=Qt(Jo()),P5=Qt(Xo()),vO=Qt(es()),R5=Bt(),yt=M5(li()),D5=Qt(Ub()),Xd=Qt(Fr()),N5=Qt(gu()),Yd=Qt(kf()),L5=Qt(Mf()),bO=Vn(),F5=Qt(xf()),wO=Qt(od()),Zd=class{constructor(){this.bandwidthEstimateKbps=0,this.usedBandwidthKbps=0,this.packetsLost=0,this.nackCount=0,this.rttMs=0}},ct=class i{constructor(t,e=F5.default.Default){this.logger=t,this.videoPriorityBasedPolicyConfig=e,this.shouldPauseTiles=!0,this.observerQueue=new Set,this.pausedBwAttendeeIds=new Set,this.wantsResubscribeObserver=void 0,this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption===yt.default.Default&&(this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption=yt.default.BandwidthProbingAndRemoteVideoQualityAdaption),this.reset()}reset(){this.allHighestPolicy=new N5.default(""),this.optimalReceiveSet=new Xd.default,this.optimalReceiveStreams=[],this.optimalNonPausedReceiveStreams=[],this.subscribedReceiveSet=new Xd.default,this.subscribedReceiveStreams=[],this.videoPreferences=void 0,this.defaultVideoPreferences=void 0,this.shouldPauseTiles=!0,this.pausedStreamIds=new Xd.default,this.pausedBwAttendeeIds=new Set,this.videoPreferencesUpdated=!1,this.logCount=0,this.startupPeriod=!0,this.usingPrevTargetRate=!1,this.rateProbeState="Not Probing",this.firstEstimateTimestamp=0,this.lastUpgradeRateKbps=0,this.timeBeforeAllowSubscribeMs=i.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.lastProbeTimestamp=Date.now(),this.timeBeforeAllowProbeMs=i.MIN_TIME_BETWEEN_PROBE_MS,this.downlinkStats=new Zd,this.prevDownlinkStats=new Zd,this.probeFailed=!1,this.serverSideNetworkAdaption=this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption,this.pendingActionAfterUpdatedPreferences=!1}bindToTileController(t){this.tileController=t,this.logger.info("tileController bound")}setWantsResubscribeObserver(t){this.wantsResubscribeObserver=t}chooseRemoteVideoSources(t){var e;if(!(!((e=this.videoPreferences)===null||e===void 0)&&e.equals(t))){if(this.videoPreferences=t?.clone(),!yt.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(this.pendingActionAfterUpdatedPreferences=!0,this.wantsResubscribeObserver!==void 0&&(this.wantsResubscribeObserver(),this.pendingActionAfterUpdatedPreferences=!1),this.serverSideNetworkAdaption===yt.default.BandwidthProbingAndRemoteVideoQualityAdaption)){let r=new Array;for(let n of this.videoPreferences){let o=new D5.default;o.attendee=new x5.default,o.attendee.attendeeId=n.attendeeId,r.push(o)}this.allHighestPolicy.chooseRemoteVideoSources(r);return}this.videoPreferencesUpdated=!0,this.logger.info(`bwe: setVideoPreferences bwe: new preferences: ${JSON.stringify(t)}`)}}updateIndex(t){this.videoIndex=t,this.serverSideNetworkAdaption===yt.default.BandwidthProbingAndRemoteVideoQualityAdaption&&this.allHighestPolicy.updateIndex(t),this.videoPreferences||this.updateDefaultVideoPreferences()}updateDefaultVideoPreferences(){let t=new Set;for(let o of this.videoIndex.remoteStreamDescriptions())t.add(o.attendeeId);let e=bO.VideoPreferences.prepare(),r=t.size,n=Yd.default.Maximum;r>8?n=Yd.default.Low:r>4&&(n=Yd.default.Medium);for(let o of t)e.add(new L5.default(o,1,n));this.defaultVideoPreferences=e.build()}updateMetrics(t){if(!this.videoIndex||this.videoIndex.allStreams().empty())return;this.prevDownlinkStats=this.downlinkStats,this.downlinkStats=new Zd;let e=t.getObservableMetrics();this.downlinkStats.bandwidthEstimateKbps=e.availableIncomingBitrate/1e3;for(let r in t.streamMetricReports){let n=Number.parseInt(r,10),o=t.streamMetricReports[n];o.direction===O5.default.DOWNSTREAM&&o.mediaType===P5.default.VIDEO&&(o.currentMetrics.hasOwnProperty("nackCount")&&(this.downlinkStats.nackCount+=t.countPerSecond("nackCount",n)),o.currentMetrics.hasOwnProperty("packetsLost")&&(this.downlinkStats.packetsLost+=t.countPerSecond("packetsLost",n)),o.currentMetrics.hasOwnProperty("bytesReceived")&&(this.downlinkStats.usedBandwidthKbps+=t.bitsPerSecond("bytesReceived",n)/1e3))}}wantsResubscribe(){let t=!1;return!yt.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(t||(t=this.pendingActionAfterUpdatedPreferences),this.serverSideNetworkAdaption===yt.default.BandwidthProbingAndRemoteVideoQualityAdaption)?t||this.allHighestPolicy.wantsResubscribe():(this.calculateOptimalReceiveSet(),t||(t=!this.subscribedReceiveSet.equal(this.optimalReceiveSet)),t)}chooseSubscriptions(){return!yt.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(this.pendingActionAfterUpdatedPreferences=!1,this.serverSideNetworkAdaption===yt.default.BandwidthProbingAndRemoteVideoQualityAdaption)?this.allHighestPolicy.chooseSubscriptions():(this.subscribedReceiveSet.equal(this.optimalReceiveSet)||(this.lastSubscribeTimestamp=Date.now()),this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveStreams=this.optimalReceiveStreams.slice(),this.subscribedReceiveSet.clone())}addObserver(t){this.observerQueue.add(t)}removeObserver(t){this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)t(e)}setVideoPriorityBasedPolicyConfigs(t){this.videoPriorityBasedPolicyConfig=t}calculateOptimalReceiveStreams(){var t;let e=[],r=this.videoIndex.remoteStreamDescriptions();if(r.length===0||!((t=this.videoPreferences)===null||t===void 0)&&t.isEmpty()){this.optimalReceiveStreams=[];return}let n=this.rateProbeState;this.cleanBwPausedTiles(r),this.handleAppPausedStreams(e,r);let o=new Map;for(let A of this.getCurrentVideoPreferences())o.set(A.attendeeId,A);let s=r.filter(A=>o.has(A.attendeeId)),a=!this.streamsWithPreferenceDidChange(s),l=!this.startupPeriod&&a;if(l&&Date.now()-this.lastSubscribeTimestamp<this.timeBeforeAllowSubscribeMs)return;s.sort((A,E)=>A.maxBitrateKbps===E.maxBitrateKbps?A.streamId-E.streamId:A.maxBitrateKbps-E.maxBitrateKbps);for(let A of s)(A.avgBitrateKbps===0||A.avgBitrateKbps>A.maxBitrateKbps)&&(A.attendeeId.endsWith(vO.default.Modality)&&A.maxBitrateKbps<100?A.maxBitrateKbps=A.avgBitrateKbps:A.avgBitrateKbps=A.maxBitrateKbps);let c=new Set;for(let A of this.getCurrentVideoPreferences()){let E=s.filter(N=>N.attendeeId===A.attendeeId);if(E.length<3)continue;let V=15,W=320*480;E.forEach(N=>{V=Math.max(V,N.maxFrameRate),W=Math.max(W,N.totalPixels())}),E.sort((N,F)=>{if(A.degradationPreference===wO.default.MaintainResolution)return Math.abs(N.maxFrameRate-F.maxFrameRate)<2?N.totalPixels()-F.totalPixels():N.maxFrameRate-F.maxFrameRate;if(A.degradationPreference===wO.default.MaintainFramerate)return N.totalPixels()===F.totalPixels()?N.maxFrameRate-F.maxFrameRate:N.totalPixels()-F.totalPixels();{let ze=oi=>oi.avgBitrateKbps*Math.pow(2,5*oi.maxFrameRate/V*Math.pow(4,oi.totalPixels()/W));return ze(N)-ze(F)}});let D;for(let N of E){if(D!==void 0&&(N.maxFrameRate<D.maxFrameRate&&Math.abs(D.maxFrameRate-N.maxFrameRate)>2||N.totalPixels()<D.totalPixels())){c.add(N.streamId);continue}D=N}}let d=s.filter(A=>!c.has(A.streamId));this.logger.info(`Filtered to ${JSON.stringify(d)}`);let u={targetDownlinkBitrate:0,chosenTotalBitrate:0,deltaToNextUpgrade:0};u.targetDownlinkBitrate=this.determineTargetRate();let f=this.subscribedReceiveSet.size(),m=this.downlinkStats.bandwidthEstimateKbps,S=!this.videoPriorityBasedPolicyConfig.allowSubscribe(f,m);if(this.probeFailed&&(this.probeFailed=!1,this.timeBeforeAllowSubscribeMs=i.MIN_TIME_BETWEEN_SUBSCRIBE_MS,l&&S))return;let T=this.priorityPolicy(u,d,e),_=!yt.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption),C=0;if(!_&&!this.startupPeriod&&a?this.rateProbeState==="Probing"?C=this.handleProbe(e,u.targetDownlinkBitrate):u.deltaToNextUpgrade!==0&&(C=this.maybeOverrideOrProbe(e,u,T)):(this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0),this.previousStreamsWithPreference=s,this.videoPreferencesUpdated=!1,C===1){this.logger.info(`bwe: keepSameSubscriptions stats:${JSON.stringify(this.downlinkStats)}`),this.prevTargetRateKbps=u.targetDownlinkBitrate;return}if(C===2){let A=this.calculateSubscribeRate(this.preProbeNonPausedReceiveStreams);this.optimalReceiveStreams=this.preProbeReceiveStreams.slice(),this.processBwPausedStreams(s,this.preProbeNonPausedReceiveStreams),this.logger.info("bwe: Use Pre-Probe subscription subscribedRate:"+A);return}this.optimalNonPausedReceiveStreams=e.slice();let I=this.pausedBwAttendeeIds.size;this.processBwPausedStreams(s,e),this.logger.getLogLevel()<=R5.LogLevel.INFO&&(this.logCount%15===0||this.rateProbeState!==n||this.optimalReceiveStreams.length!==e.length||I!==this.pausedBwAttendeeIds.size)&&(this.logger.info(this.policyStateLogStr(r,u.targetDownlinkBitrate)),this.logCount=0),this.logCount++,this.prevTargetRateKbps=u.targetDownlinkBitrate,this.optimalReceiveStreams=e.slice()}calculateOptimalReceiveSet(){let t=new Xd.default;this.calculateOptimalReceiveStreams();for(let e of this.optimalReceiveStreams)t.add(e.streamId);if(!this.optimalReceiveSet.equal(t)){let e=this.calculateSubscribeRate(this.optimalReceiveStreams);this.logger.info(`bwe: new streamSelection: ${JSON.stringify(t)} subscribedRate:${e}`)}this.optimalReceiveSet=t}determineTargetRate(){let t=0,e=Date.now();return this.downlinkStats.bandwidthEstimateKbps!==0?(this.firstEstimateTimestamp===0&&(this.firstEstimateTimestamp=e),this.startupPeriod&&(this.downlinkStats.bandwidthEstimateKbps>i.DEFAULT_BANDWIDTH_KBPS||this.downlinkStats.packetsLost>0||e-this.firstEstimateTimestamp>i.STARTUP_PERIOD_MS&&this.downlinkStats.bandwidthEstimateKbps<=this.prevDownlinkStats.bandwidthEstimateKbps)&&(this.startupPeriod=!1,this.prevTargetRateKbps=this.downlinkStats.bandwidthEstimateKbps),this.startupPeriod?t=i.DEFAULT_BANDWIDTH_KBPS:this.rateProbeState==="Probing"&&this.downlinkStats.usedBandwidthKbps>this.downlinkStats.bandwidthEstimateKbps&&this.downlinkStats.packetsLost<i.SPURIOUS_PACKET_LOST_THRESHOLD?(this.logger.info(`bwe: In probe state, overriding estimate ${this.downlinkStats.bandwidthEstimateKbps} with actual receive bitrate ${this.downlinkStats.usedBandwidthKbps}`),t=this.downlinkStats.usedBandwidthKbps+i.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS):t=this.downlinkStats.bandwidthEstimateKbps):this.firstEstimateTimestamp===0?t=i.DEFAULT_BANDWIDTH_KBPS:t=this.prevTargetRateKbps,!this.startupPeriod&&(this.usingPrevTargetRate&&this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps||this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps*(100-i.LARGE_RATE_CHANGE_TRIGGER_PERCENT)/100||this.downlinkStats.bandwidthEstimateKbps<this.downlinkStats.usedBandwidthKbps*i.LARGE_RATE_CHANGE_TRIGGER_PERCENT/100)&&this.downlinkStats.packetsLost===0?(this.logger.debug(()=>"bwe: ValidateRate: Using Previous rate "+this.prevTargetRateKbps),this.usingPrevTargetRate=!0,t=this.prevTargetRateKbps):this.usingPrevTargetRate=!1,t>15e3&&this.logger.warn("bwe: "+t+" exceeds maximum limit (15000). Limit TargetDisplaySize with VideoPreferences to avoid this."),Math.min(t,15e3)}setProbeState(t){if(this.rateProbeState===t)return!1;let e=Date.now();switch(t){case"Not Probing":this.probePendingStartTimestamp=0;break;case"Probe Pending":if(this.lastProbeTimestamp===0||e-this.lastProbeTimestamp>i.MIN_TIME_BETWEEN_PROBE_MS)this.probePendingStartTimestamp=e;else return!1;break;case"Probing":if(e-this.probePendingStartTimestamp>this.timeBeforeAllowProbeMs)this.lastProbeTimestamp=e,this.preProbeReceiveStreams=this.subscribedReceiveStreams.slice(),this.preProbeNonPausedReceiveStreams=this.optimalNonPausedReceiveStreams,this.timeBeforeAllowProbeMs=Math.min(this.timeBeforeAllowProbeMs*2,i.MAX_HOLD_BEFORE_PROBE_MS);else return!1;break}return this.logger.info("bwe: setProbeState to "+t+" from "+this.rateProbeState),this.rateProbeState=t,!0}upgradeToStream(t,e){for(let r=0;r<t.length;r++)if(t[r].groupId===e.groupId){let n=e.avgBitrateKbps-t[r].avgBitrateKbps;return this.logger.info("bwe: upgradeStream from "+JSON.stringify(t[r])+" to "+e),this.lastUpgradeRateKbps=n,t[r]=e,n}return t.push(e),this.lastUpgradeRateKbps=e.avgBitrateKbps,this.lastUpgradeRateKbps}handleProbe(t,e){if(Date.now()-this.lastProbeTimestamp>i.MAX_ALLOWED_PROBE_TIME_MS)return this.logger.info("bwe: Canceling probe due to timeout"),this.setProbeState("Not Probing"),0;if(this.downlinkStats.packetsLost>0&&(this.logger.info(`bwe: Probe encountering packets lost:${this.downlinkStats.packetsLost}`),this.downlinkStats.packetsLost>i.SPURIOUS_PACKET_LOST_THRESHOLD))return this.setProbeState("Not Probing"),this.logger.info(`bwe: Canceling probe due to packets lost:${this.downlinkStats.packetsLost}`),this.probeFailed=!0,this.timeBeforeAllowSubscribeMs=Math.max(i.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.timeBeforeAllowSubscribeMs)*3,2;let r=this.calculateSubscribeRate(this.optimalReceiveStreams);return this.chosenStreamsSameAsLast(t)||e>r?(this.logger.info("bwe: Probe successful"),this.setProbeState("Not Probing"),this.timeBeforeAllowProbeMs=i.MIN_TIME_BETWEEN_PROBE_MS,0):1}maybeOverrideOrProbe(t,e,r){let n=this.chosenStreamsSameAsLast(t),o=0,s=e.targetDownlinkBitrate>i.LOW_BITRATE_THRESHOLD_KBPS?i.TARGET_RATE_CHANGE_TRIGGER_PERCENT:i.TARGET_RATE_CHANGE_TRIGGER_PERCENT*2,a=e.targetDownlinkBitrate*s/100;if(this.targetRateBaselineForDeltaCheckKbps=this.targetRateBaselineForDeltaCheckKbps!==void 0?this.targetRateBaselineForDeltaCheckKbps:this.prevTargetRateKbps,!n&&Math.abs(e.targetDownlinkBitrate-this.targetRateBaselineForDeltaCheckKbps)<a?(this.logger.info("bwe: MaybeOverrideOrProbe: Reuse last decision based on delta rate. {"+JSON.stringify(this.subscribedReceiveSet)+"}"),o=1):this.targetRateBaselineForDeltaCheckKbps=e.targetDownlinkBitrate,this.downlinkStats.packetsLost>this.prevDownlinkStats.packetsLost)return this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0,o;if(n||o===1)switch(this.rateProbeState){case"Not Probing":this.setProbeState("Probe Pending");break;case"Probe Pending":this.setProbeState("Probing")&&(this.upgradeToStream(t,r),o=0);break}else this.setProbeState("Not Probing");return o}calculateSubscribeRate(t){let e=0;for(let r of t)!this.pausedStreamIds.contain(r.streamId)&&!this.pausedBwAttendeeIds.has(r.attendeeId)&&(e+=r.maxBitrateKbps);return e}handleAppPausedStreams(t,e){if(!this.tileController){this.logger.warn("tileController not found!");return}this.pausedStreamIds=new Xd.default;let r=this.tileController.getAllRemoteVideoTiles();for(let n of r){let o=n.state();if(o.paused&&!this.pausedBwAttendeeIds.has(o.boundAttendeeId)){let s=e.length;for(;s--;)e[s].attendeeId===o.boundAttendeeId&&(this.logger.info("bwe: removed paused attendee "+o.boundAttendeeId+" streamId: "+e[s].streamId),this.pausedStreamIds.add(e[s].streamId),this.subscribedReceiveSet.contain(e[s].streamId)&&t.push(e[s]),e.splice(s,1))}}}processBwPausedStreams(t,e){if(!this.tileController){this.logger.warn("tileController not found!");return}let r=this.getCurrentVideoPreferences();if(r&&this.shouldPauseTiles){let n=this.tileController.getAllVideoTiles();for(let o of r){let s=this.getVideoTileForAttendeeId(o.attendeeId,n),a=s?.state().paused||!1;if(e.some(l=>l.attendeeId===o.attendeeId))a&&this.pausedBwAttendeeIds.has(o.attendeeId)&&(this.logger.info(`bwe: unpausing attendee ${o.attendeeId} due to bandwidth`),this.forEachObserver(l=>{l.tileWillBeUnpausedByDownlinkPolicy(s.id())}),this.tileController.unpauseVideoTile(s.id()),this.pausedBwAttendeeIds.delete(o.attendeeId));else{let l=t.some(c=>c.attendeeId===o.attendeeId);if(s&&l){let c=this.optimalReceiveStreams.find(d=>d.attendeeId===o.attendeeId);c!==void 0&&(a||(this.logger.info(`bwe: pausing streamId ${c.streamId} attendee ${o.attendeeId} due to bandwidth`),this.forEachObserver(d=>{d.tileWillBePausedByDownlinkPolicy(s.id())}),this.tileController.pauseVideoTile(s.id())),e.push(c)),this.pausedBwAttendeeIds.add(o.attendeeId)}else if(l){let c=this.tileController.addVideoTile();c.bindVideoStream(o.attendeeId,!1,null,0,0,0,null),this.forEachObserver(d=>{d.tileWillBePausedByDownlinkPolicy(c.id())}),c.pause(),this.logger.info(`bwe: Created video tile ${c.id()} for bw paused attendee ${o.attendeeId}`),this.pausedBwAttendeeIds.add(o.attendeeId)}}}}}cleanBwPausedTiles(t){if(!this.tileController){this.logger.warn("tileController not found!");return}let e=this.tileController.getAllRemoteVideoTiles(),r=this.getCurrentVideoPreferences();for(let n of e){let o=n.state();o.boundVideoStream||(t.some(s=>s.attendeeId===o.boundAttendeeId)?r!==void 0&&!r.some(s=>s.attendeeId===o.boundAttendeeId)&&this.tileController.removeVideoTile(o.tileId):(this.tileController.removeVideoTile(o.tileId),this.logger.info(`bwe: Removed video tile ${o.tileId} for bw paused attendee ${o.boundAttendeeId}`)))}}priorityPolicy(t,e,r){let n,o=this.getCurrentVideoPreferences(),s=o.highestPriority(),a,l=s;for(;l!==-1;){a=-1;for(let c of o)if(c.priority===l)for(let d of e)d.attendeeId===c.attendeeId&&(r.some(u=>u.groupId===d.groupId)||(t.chosenTotalBitrate+d.avgBitrateKbps<=t.targetDownlinkBitrate?(r.push(d),t.chosenTotalBitrate+=d.avgBitrateKbps):t.deltaToNextUpgrade===0&&(t.deltaToNextUpgrade=d.avgBitrateKbps,n=d)));else if(c.priority>l){a=c.priority;break}for(let c of o)if(c.priority===l){for(let d of e)if(d.attendeeId===c.attendeeId){let u=r.findIndex(f=>f.groupId===d.groupId&&f.maxBitrateKbps<=d.maxBitrateKbps&&f.avgBitrateKbps<d.avgBitrateKbps);if(u!==-1){let f=d.avgBitrateKbps-r[u].avgBitrateKbps;this.hasSimulcastStreams(e,d.attendeeId,d.groupId)&&this.canUpgrade(d.avgBitrateKbps,c.targetSize,c.targetSizeToBitrateKbps(c.targetSize),d.attendeeId.endsWith(vO.default.Modality))?(this.logger.info(`bwe: attendee: ${d.attendeeId} group: ${d.groupId} has simulcast and can upgrade avgBitrate: ${d.avgBitrateKbps} target: ${c.targetSizeToBitrateKbps(c.targetSize)} targetTotalBitrate: ${t.targetDownlinkBitrate}`),t.chosenTotalBitrate+f<=t.targetDownlinkBitrate?(t.chosenTotalBitrate+=f,r[u]=d):t.deltaToNextUpgrade===0&&(t.deltaToNextUpgrade=f,n=d)):this.logger.info("bwe: cannot upgrade stream quality beyond target size")}}}else if(c.priority>l)break;if(l===s&&t.deltaToNextUpgrade!==0)break;l=a}return n}getVideoTileForAttendeeId(t,e){for(let r of e)if(r.state().boundAttendeeId===t)return r;return null}canUpgrade(t,e,r,n){let o=!1;return(e===Yd.default.High||!n&&t<=r||n&&e===Yd.default.Medium&&t<=r)&&(o=!0),o?(this.logger.info(`bwe: canUpgrade: bitrateKbps: ${t} targetBitrateKbps: ${r}`),!0):(this.logger.info(`bwe: cannot Upgrade: bitrateKbps: ${t} targetBitrateKbps: ${r}`),!1)}hasSimulcastStreams(t,e,r){let n=0;for(let o of t)o.attendeeId===e&&o.groupId===r&&n++;return this.logger.info(`bwe: attendeeId: ${e} groupId: ${r} hasSimulcastStreams: streamCount: ${n}`),n>1}streamsWithPreferenceDidChange(t){if(this.previousStreamsWithPreference===void 0||t.length!==this.previousStreamsWithPreference.length||this.videoPreferencesUpdated===!0)return!0;for(let e of t)if(this.previousStreamsWithPreference.find(n=>n.groupId===e.groupId&&n.streamId===e.streamId&&n.maxBitrateKbps===e.maxBitrateKbps)===void 0)return!0;return!1}chosenStreamsSameAsLast(t){if(this.optimalNonPausedReceiveStreams.length!==t.length)return!1;for(let e of this.optimalNonPausedReceiveStreams)if(!t.some(r=>r.streamId===e.streamId))return!1;return!0}policyStateLogStr(t,e){let r=this.calculateSubscribeRate(this.optimalReceiveStreams),n={targetBitrate:e,subscribedRate:r,probeState:this.rateProbeState,startupPeriod:this.startupPeriod},o="remoteInfos: [";for(let a of t)o+=`{grpId:${a.groupId} strId:${a.streamId} maxBr:${a.maxBitrateKbps} avgBr:${a.avgBitrateKbps}}, `;o+="]";let s=`bwe: optimalReceiveSet ${JSON.stringify(n)}
bwe:   prev ${JSON.stringify(this.prevDownlinkStats)}
bwe:   now  ${JSON.stringify(this.downlinkStats)}
bwe:   ${o}
`;return(this.pausedStreamIds.size()>0||this.pausedBwAttendeeIds.size>0)&&(s+=`bwe:   paused: app stream ids ${JSON.stringify(this.pausedStreamIds)}  bw attendees { ${Array.from(this.pausedBwAttendeeIds).join(" ")} }
`),this.videoPreferences?s+=`bwe:   preferences: ${JSON.stringify(this.videoPreferences)}`:s+=`bwe:   default preferences: ${JSON.stringify(this.defaultVideoPreferences)}`,s}getCurrentVideoPreferences(){return this.videoPreferences||this.defaultVideoPreferences}getServerSideNetworkAdaption(){return this.serverSideNetworkAdaption}setServerSideNetworkAdaption(t){this.serverSideNetworkAdaption=t,this.setProbeState("Not Probing")}supportedServerSideNetworkAdaptions(){return[yt.default.None,yt.default.BandwidthProbing,yt.default.BandwidthProbingAndRemoteVideoQualityAdaption]}getVideoPreferences(){let t=this.getCurrentVideoPreferences();return t||(t=bO.VideoPreferences.prepare().build()),t}wantsAllTemporalLayersInIndex(){return!0}};Jt.default=ct;ct.DEFAULT_BANDWIDTH_KBPS=2800;ct.STARTUP_PERIOD_MS=6e3;ct.LARGE_RATE_CHANGE_TRIGGER_PERCENT=20;ct.TARGET_RATE_CHANGE_TRIGGER_PERCENT=15;ct.LOW_BITRATE_THRESHOLD_KBPS=300;ct.MIN_TIME_BETWEEN_PROBE_MS=5e3;ct.MIN_TIME_BETWEEN_SUBSCRIBE_MS=2e3;ct.MAX_HOLD_BEFORE_PROBE_MS=3e4;ct.MAX_ALLOWED_PROBE_TIME_MS=6e4;ct.SPURIOUS_PACKET_LOST_THRESHOLD=2;ct.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS=100});var zb=y(ec=>{"use strict";var tc=ec&&ec.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ec,"__esModule",{value:!0});var B5=tc(es()),V5=tc(li()),CO=tc(Mf()),U5=Vn(),q5=tc(qb()),H5=tc(xf()),Hb=class i extends q5.default{constructor(t){super(t,i.createConfig()),this.logger=t,super.shouldPauseTiles=!1,this.videoPreferences=void 0}static createConfig(){let t=new H5.default;return t.serverSideNetworkAdaption=V5.default.None,t}reset(){super.reset(),super.shouldPauseTiles=!1,this.videoPreferences=void 0}updateIndex(t){super.updateIndex(t);let e=U5.VideoPreferences.prepare(),r=!1,n=t.remoteStreamDescriptions();for(let o of n)e.some(s=>s.attendeeId===o.attendeeId)||(o.attendeeId.endsWith(B5.default.Modality)?(e.add(new CO.default(o.attendeeId,1)),r=!0):e.add(new CO.default(o.attendeeId,2)));r?(this.videoPreferences=e.build(),this.videoPreferencesUpdated=!0):this.videoPreferences=void 0}chooseRemoteVideoSources(t){this.logger.error("chooseRemoteVideoSources should not be called by VideoAdaptiveProbePolicy")}};ec.default=Hb});var Of=y(jb=>{"use strict";Object.defineProperty(jb,"__esModule",{value:!0});var _O=Oe(),$b=class i{constructor(t,e,r,n,o){this.attendeeId="",this.groupId=0,this.streamId=0,this.ssrc=0,this.trackLabel="",this.maxBitrateKbps=0,this.avgBitrateKbps=0,this.maxFrameRate=0,this.width=0,this.height=0,this.timeEnabled=0,this.disabledByWebRTC=!1,this.disabledByUplinkPolicy=!1,this.rid="",this.attendeeId=t,this.groupId=e,this.streamId=r,this.maxBitrateKbps=n,this.avgBitrateKbps=o}clone(){let t=new i;return t.attendeeId=this.attendeeId,t.groupId=this.groupId,t.streamId=this.streamId,t.ssrc=this.ssrc,t.trackLabel=this.trackLabel,t.maxBitrateKbps=this.maxBitrateKbps,t.avgBitrateKbps=this.avgBitrateKbps,t.maxFrameRate=this.maxFrameRate,t.timeEnabled=this.timeEnabled,t.disabledByUplinkPolicy=this.disabledByUplinkPolicy,t.width=this.width,t.height=this.height,t}toStreamDescriptor(){let t=_O.SdkStreamDescriptor.create();return t.mediaType=_O.SdkStreamMediaType.VIDEO,t.trackLabel=this.trackLabel,t.attendeeId=this.attendeeId,t.streamId=this.streamId,t.groupId=this.groupId,t.framerate=this.maxFrameRate,t.maxBitrateKbps=this.disabledByUplinkPolicy?0:this.maxBitrateKbps,t.avgBitrateBps=this.avgBitrateKbps,t}totalPixels(){return this.width*this.height}};jb.default=$b});var Df=y(ic=>{"use strict";var EO=ic&&ic.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ic,"__esModule",{value:!0});var Pf=Oe(),Rf=EO(Fr()),TO=EO(Of()),Wb=class{constructor(t){this.logger=t,this.currentIndex=null,this.indexForSubscribe=null,this.indexForLastRemoteVideoUpdate=null,this.currentSubscribeAck=null,this.subscribeTrackToStreamMap=null,this.subscribeStreamToAttendeeMap=null,this.subscribeStreamToExternalUserIdMap=null,this.subscribeSsrcToStreamMap=null,this.subscribeSsrcToGroupMap=null,this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null,this.videoStreamDescription=new TO.default,this.sendVideoStreamId=0,this.videoStreamDescription.trackLabel="AmazonChimeExpressVideo",this.videoStreamDescription.streamId=2,this.videoStreamDescription.groupId=2}localStreamDescriptions(){return[this.videoStreamDescription.clone()]}convertBpsToKbps(t){return t>0&&t<1e3?1:Math.trunc(t/1e3)}remoteStreamDescriptions(){if(!this.currentIndex||!this.currentIndex.sources)return[];let t=[];return this.currentIndex.sources.forEach(e=>{let r=new TO.default;r.attendeeId=e.attendeeId,r.groupId=e.groupId,r.streamId=e.streamId,r.maxBitrateKbps=e.maxBitrateKbps,r.avgBitrateKbps=this.convertBpsToKbps(e.avgBitrateBps),r.width=e.width,r.height=e.height,r.maxFrameRate=e.framerate,t.push(r)}),t}integrateUplinkPolicyDecision(t){if(t&&t.length){let e=t[0];this.videoStreamDescription.maxBitrateKbps=e.maxBitrate/1e3,this.videoStreamDescription.maxFrameRate=e.maxFramerate}}integrateIndexFrame(t){if(this.currentIndex=t,!t)return;let e=new Map,r=!1;for(let n of t.sources){if(!e.has(n.attendeeId)){e.set(n.attendeeId,n.groupId);continue}let o=e.get(n.attendeeId);o<n.groupId&&(this.logger.warn(`Old group ID ${o} found for attendee ID ${n.attendeeId}, replacing with newer group ID ${n.groupId}`),e.set(n.attendeeId,n.groupId)),r=!0}r&&(this.currentIndex.sources=this.currentIndex.sources.filter(n=>e.get(n.attendeeId)===n.groupId)),this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null}subscribeFrameSent(){this.indexForSubscribe=this.currentIndex}remoteVideoUpdateSent(){this.indexForLastRemoteVideoUpdate=this.currentIndex}integrateSubscribeAckFrame(t){this.currentSubscribeAck=t,this.subscribeTrackToStreamMap=this.buildTrackToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToStreamMap=this.buildSSRCToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToGroupMap=this.buildSSRCToGroupMap(this.currentSubscribeAck),this.subscribeStreamToAttendeeMap=this.buildStreamToAttendeeMap(this.indexForSubscribe),this.subscribeStreamToExternalUserIdMap=this.buildStreamExternalUserIdMap(this.indexForSubscribe),this.sendVideoStreamId=0,t.allocations&&t.allocations!==void 0&&t.allocations.length>0&&(this.sendVideoStreamId=t.allocations[0].streamId)}integrateBitratesFrame(t){if(this.currentIndex)for(let e of t.bitrates){let r=this.currentIndex.sources.find(n=>n.streamId===e.sourceStreamId);r!==void 0&&(r.avgBitrateBps=e.avgBitrateBps)}}allStreams(){let t=new Rf.default;if(this.currentIndex)for(let e of this.currentIndex.sources)t.add(e.streamId);return t}allVideoSendingSourcesExcludingSelf(t){let e=[],r=new Set;if(this.currentIndex&&this.currentIndex.sources&&this.currentIndex.sources.length)for(let n of this.currentIndex.sources){let{attendeeId:o,externalUserId:s,mediaType:a}=n;o!==t&&a===Pf.SdkStreamMediaType.VIDEO&&(r.has(o)||(e.push({attendee:{attendeeId:o,externalUserId:s}}),r.add(o)))}return e}streamSelectionUnderBandwidthConstraint(t,e,r,n){let o=new Set;if(this.currentIndex)for(let d of this.currentIndex.sources)d.attendeeId===t||d.mediaType!==Pf.SdkStreamMediaType.VIDEO||!e.has(d.attendeeId)&&!r.has(d.attendeeId)&&o.add(d.attendeeId);let s=this.buildAttendeeToSortedStreamDescriptorMapExcludingSelf(t),a=new Map,l=0;s.forEach((d,u)=>{a.set(u,d[0]),l+=d[0].maxBitrateKbps}),l=this.trySelectHighBitrateForAttendees(s,e,l,n,a),this.trySelectHighBitrateForAttendees(s,o,l,n,a);let c=new Rf.default;for(let d of a.values())c.add(d.streamId);return c}highestQualityStreamFromEachGroupExcludingSelf(t){let e=new Rf.default;if(this.currentIndex){let r=new Map;for(let n of this.currentIndex.sources)n.attendeeId===t||n.mediaType!==Pf.SdkStreamMediaType.VIDEO||(!r.has(n.groupId)||n.maxBitrateKbps>r.get(n.groupId).maxBitrateKbps)&&r.set(n.groupId,n);for(let n of r.values())e.add(n.streamId)}return e}numberOfVideoPublishingParticipantsExcludingSelf(t){return this.highestQualityStreamFromEachGroupExcludingSelf(t).array().length}numberOfParticipants(){return this.currentIndex.numParticipants?this.currentIndex.numParticipants:-1}attendeeIdForTrack(t){let e=this.streamIdForTrack(t);if(e===void 0||!this.subscribeStreamToAttendeeMap)return this.logger.warn(`no attendee found for track ${t}`),"";let r=this.subscribeStreamToAttendeeMap.get(e);return r||(this.logger.info(`track ${t} (stream ${e}) does not correspond to a known attendee`),"")}externalUserIdForTrack(t){let e=this.streamIdForTrack(t);if(e===void 0||!this.subscribeStreamToExternalUserIdMap)return this.logger.warn(`no external user id found for track ${t}`),"";let r=this.subscribeStreamToExternalUserIdMap.get(e);return r||(this.logger.info(`track ${t} (stream ${e}) does not correspond to a known externalUserId`),"")}attendeeIdForStreamId(t){if(!this.streamToAttendeeMap)if(this.currentIndex)this.streamToAttendeeMap=this.buildStreamToAttendeeMap(this.currentIndex);else return"";let e=this.streamToAttendeeMap.get(t);return e||(this.logger.info(`stream ID ${t} does not correspond to a known attendee`),"")}attendeeIdForGroupId(t){if(!this.groupIdToAttendeeMap)if(this.currentIndex)this.groupIdToAttendeeMap=this.buildGroupIdToAttendeeMap(this.currentIndex);else return"";let e=this.groupIdToAttendeeMap.get(t);return e||(this.logger.info(`group ID ${t} does not correspond to a known attendee`),"")}groupIdForStreamId(t){if(!(!this.currentIndex||!this.currentIndex.sources)){for(let e of this.currentIndex.sources)if(e.streamId===t)return e.groupId;if(this.indexForSubscribe){for(let e of this.indexForSubscribe.sources)if(e.streamId===t)return e.groupId}if(this.indexForLastRemoteVideoUpdate){for(let e of this.indexForLastRemoteVideoUpdate.sources)if(e.streamId===t)return e.groupId}}}StreamIdsInSameGroup(t,e){return this.groupIdForStreamId(t)===this.groupIdForStreamId(e)}streamIdForTrack(t){if(this.subscribeTrackToStreamMap)return this.subscribeTrackToStreamMap.get(t)}streamIdForSSRC(t){if(this.subscribeSsrcToStreamMap)return this.subscribeSsrcToStreamMap.get(t)}overrideStreamIdMappings(t,e){if(this.subscribeTrackToStreamMap){for(let[r,n]of this.subscribeTrackToStreamMap.entries())if(t===n){this.subscribeTrackToStreamMap.set(r,e);break}}if(this.subscribeSsrcToStreamMap){for(let[r,n]of this.subscribeSsrcToStreamMap.entries())if(t===n){this.subscribeSsrcToStreamMap.set(r,e);break}}}groupIdForSSRC(t){if(this.subscribeSsrcToGroupMap)return this.subscribeSsrcToGroupMap.get(t)}streamsPausedAtSource(){let t=new Rf.default;if(this.currentIndex)for(let e of this.currentIndex.pausedAtSourceIds)t.add(e);return t}sendVideoStreamIdFromRid(t){return this.sendVideoStreamId}buildTrackToStreamMap(t){let e=new Map;this.logger.debug(()=>`trackMap ${JSON.stringify(t.tracks)}`);for(let r of t.tracks)r.trackLabel.length>0&&r.streamId>0&&e.set(r.trackLabel,r.streamId);return e}buildSSRCToStreamMap(t){let e=new Map;this.logger.debug(()=>`ssrcMap ${JSON.stringify(t.tracks)}`);for(let r of t.tracks)r.trackLabel.length>0&&r.streamId>0&&e.set(r.ssrc,r.streamId);return e}buildSSRCToGroupMap(t){let e=new Map;for(let r of t.tracks)r.trackLabel.length>0&&r.streamId>0&&e.set(r.ssrc,this.groupIdForStreamId(r.streamId));return e}buildStreamToAttendeeMap(t){let e=new Map;if(t)for(let r of t.sources)e.set(r.streamId,r.attendeeId);return e}buildGroupIdToAttendeeMap(t){let e=new Map;for(let r of t.sources)e.set(r.groupId,r.attendeeId);return e}buildStreamExternalUserIdMap(t){let e=new Map;if(t)for(let r of t.sources)r.externalUserId&&e.set(r.streamId,r.externalUserId);return e}trySelectHighBitrateForAttendees(t,e,r,n,o){for(let s of e){if(r>=n)break;if(t.has(s)){let a=t.get(s);for(let l of a.reverse())if(r-o.get(s).maxBitrateKbps+l.maxBitrateKbps<n){r=r-o.get(s).maxBitrateKbps+l.maxBitrateKbps,o.set(s,l);break}}}return r}buildAttendeeToSortedStreamDescriptorMapExcludingSelf(t){let e=new Map;if(this.currentIndex)for(let r of this.currentIndex.sources)r.attendeeId===t||r.mediaType!==Pf.SdkStreamMediaType.VIDEO||(e.has(r.attendeeId)?e.get(r.attendeeId).push(r):e.set(r.attendeeId,[r]));return e.forEach((r,n)=>{r.sort((o,s)=>o.maxBitrateKbps>s.maxBitrateKbps?1:o.maxBitrateKbps<s.maxBitrateKbps?-1:0)}),e}};ic.default=Wb});var Gb=y(rc=>{"use strict";var IO=rc&&rc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(rc,"__esModule",{value:!0});var z5=Oe(),$5=IO(Df()),j5=IO(Of()),Kn=class i extends $5.default{constructor(){super(...arguments),this.streamIdToBitrateKbpsMap=new Map,this._localStreamInfos=[],this._sendRidToVideoStreamIdMap=new Map}localStreamDescriptions(){let t=[];return this._localStreamInfos.forEach(e=>{t.push(e.clone())}),t}integrateUplinkPolicyDecision(t){let e=!0,r=0;for(let n=0;n<t.length;n++){let o=t[n].maxBitrate/1e3,s=t[n].maxFramerate;if(!e||n===this._localStreamInfos.length){e=!1;let a=new j5.default;a.maxBitrateKbps=o,a.maxFrameRate=s,a.disabledByUplinkPolicy=o===0,a.rid=t[n].rid,o!==0&&(a.timeEnabled=Date.now()),this._localStreamInfos.push(a),r++;continue}this._localStreamInfos[r].maxBitrateKbps===0&&o>0&&(this._localStreamInfos[r].timeEnabled=Date.now()),this._localStreamInfos[r].maxBitrateKbps=o,this._localStreamInfos[r].maxFrameRate=s,this._localStreamInfos[r].disabledByUplinkPolicy=o===0,r++}e&&this._localStreamInfos.splice(r)}integrateBitratesFrame(t){super.integrateBitratesFrame(t);let e=new Set,r=new Set(this.streamIdToBitrateKbpsMap.keys());for(let n of t.bitrates)e.add(n.sourceStreamId),this.streamIdToBitrateKbpsMap.set(n.sourceStreamId,this.convertBpsToKbps(n.avgBitrateBps));for(let n of r)e.has(n)||(this.streamIdToBitrateKbpsMap.get(n)===i.UNSEEN_STREAM_BITRATE?this.streamIdToBitrateKbpsMap.set(n,i.RECENTLY_INACTIVE_STREAM_BITRATE):this.streamIdToBitrateKbpsMap.set(n,i.NOT_SENDING_STREAM_BITRATE));this.logLocalStreamDescriptions()}logLocalStreamDescriptions(){let t="";for(let e of this._localStreamInfos)t+=`streamId=${e.streamId} maxBitrate=${e.maxBitrateKbps} disabledByUplink=${e.disabledByUplinkPolicy}
`;this.logger.debug(()=>t)}integrateIndexFrame(t){super.integrateIndexFrame(t);let e=new Set,r=new Set(this.streamIdToBitrateKbpsMap.keys());for(let n of this.currentIndex.sources)n.mediaType===z5.SdkStreamMediaType.VIDEO&&(e.add(n.streamId),this.streamIdToBitrateKbpsMap.has(n.streamId)||this.streamIdToBitrateKbpsMap.set(n.streamId,i.UNSEEN_STREAM_BITRATE));for(let n of r)e.has(n)||this.streamIdToBitrateKbpsMap.delete(n)}integrateSubscribeAckFrame(t){if(super.integrateSubscribeAckFrame(t),!t.allocations||t.allocations===void 0)return;let e=0;this._sendRidToVideoStreamIdMap.clear();for(let r of t.allocations){if(this._localStreamInfos.length<e+1){this.logger.info("simulcast: allocation has more than number of local streams");break}this._localStreamInfos[e].groupId=r.groupId,this._localStreamInfos[e].streamId=r.streamId,this.streamIdToBitrateKbpsMap.has(r.streamId)||this.streamIdToBitrateKbpsMap.set(r.streamId,i.UNSEEN_STREAM_BITRATE),this._sendRidToVideoStreamIdMap.set(this._localStreamInfos[e].rid,r.streamId),e++}}sendVideoStreamIdFromRid(t){let e=0;return this._sendRidToVideoStreamIdMap.has(t)&&(e=this._sendRidToVideoStreamIdMap.get(t)),e}};rc.default=Kn;Kn.UNSEEN_STREAM_BITRATE=-2;Kn.RECENTLY_INACTIVE_STREAM_BITRATE=-1;Kn.NOT_SENDING_STREAM_BITRATE=0;Kn.BitratesMsgFrequencyMs=4e3});var Jb=y(nc=>{"use strict";var W5=nc&&nc.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(nc,"__esModule",{value:!0});var Kb=class{constructor(t,e){if(this.devicePixelRatioSource=t,this.observerQueue=new Set,this.mediaQueryListener=()=>{this.observerQueue.forEach(n=>{n.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())})},typeof window>"u")return;let r=matchMedia(`(resolution: ${this.devicePixelRatioSource.devicePixelRatio()}dppx)`);typeof r.addEventListener=="function"?(r.addEventListener("change",this.mediaQueryListener),this.mediaQueryList=r):typeof r.addListener=="function"?(r.addListener(this.mediaQueryListener),this.mediaQueryList=r):e.warn("ignoring DefaultDevicePixelRatioMonitor")}destroy(){return W5(this,void 0,void 0,function*(){this.mediaQueryList&&(typeof this.mediaQueryList.addEventListener=="function"?this.mediaQueryList.removeEventListener("change",this.mediaQueryListener):this.mediaQueryList.removeListener(this.mediaQueryListener)),delete this.mediaQueryListener,this.observerQueue.clear()})}registerObserver(t){this.observerQueue.add(t),t.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}removeObserver(t){this.observerQueue.delete(t)}};nc.default=Kb});var Yb=y(Xb=>{"use strict";Object.defineProperty(Xb,"__esModule",{value:!0});var Qb=class{devicePixelRatio(){return typeof window>"u"||!window||!window.devicePixelRatio?1:window.devicePixelRatio}};Xb.default=Qb});var tw=y(ew=>{"use strict";Object.defineProperty(ew,"__esModule",{value:!0});var Zb=class{constructor(){this.observerQueue=new Set,this.element=null,this.resizeObserver=new ResizeObserver(t=>{for(let e of t){let{width:r,height:n}=e.contentRect;this.notifyObservers(r,n)}})}notifyObservers(t,e){for(let r of this.observerQueue)r.videoElementResolutionChanged(t,e)}registerObserver(t){this.observerQueue.add(t)}removeObserver(t){this.observerQueue.delete(t)}bindVideoElement(t){this.element!==t&&(this.element&&this.resizeObserver.unobserve(this.element),this.element=t,this.element&&this.resizeObserver.observe(this.element))}};ew.default=Zb});var rw=y(Jn=>{"use strict";var G5=Jn&&Jn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},oc=Jn&&Jn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Jn,"__esModule",{value:!0});var K5=oc(Pi()),J5=oc(Jb()),Q5=oc(Yb()),AO=_t(),X5=oc(tw()),Y5=oc(Wa()),iw=class{constructor(t,e,r){this.tileFactory=t,this.audioVideoController=e,this.logger=r,this.tileMap=new Map,this.nextTileId=1,this.currentLocalTile=null,this.currentPausedTilesByIds=new Set,this.resolutionObservers=new Set,this.keepLastFrameWhenPaused=!1,this.keepLastFrameWhenPaused=e.configuration.keepLastFrameWhenPaused}createDevicePixelRatioMonitorIfNeeded(){this.devicePixelRatioMonitor||(this.devicePixelRatioMonitor=new J5.default(new Q5.default,this.logger))}discardDevicePixelRatioMonitorIfNotNeeded(){return G5(this,void 0,void 0,function*(){if(this.tileMap.size||!this.devicePixelRatioMonitor)return;let t=this.devicePixelRatioMonitor;return this.devicePixelRatioMonitor=void 0,t.destroy()})}bindVideoElement(t,e){let r=this.getVideoTile(t);if(r===null){this.logger.warn(`Ignoring video element binding for unknown tile id ${t}`);return}r.bindVideoElement(e)}unbindVideoElement(t,e=!0){let r=this.getVideoTile(t);if(r===null){this.logger.warn(`Ignoring video element unbinding for unknown tile id ${t}`);return}this.logger.info("Unbinding the video element"),this.notifyRemoteObserversOfUnbound(r.state().boundAttendeeId);let n=r.stateRef().boundVideoElement;r.bindVideoElement(null),e&&(this.logger.info("Cleaning up the video element"),Y5.default.disconnectVideoStreamFromVideoElement(n,!1))}startLocalVideoTile(){if(this.audioVideoController.configuration.meetingFeatures.videoMaxResolution===K5.default.VideoDisabled)return this.logger.warn("Could not start camera video because max video resolution was set to None"),-1;let t=this.findOrCreateLocalVideoTile();return this.currentLocalTile.stateRef().localTileStarted=!0,this.audioVideoController.update({needsRenegotiation:!0}),t.id()}stopLocalVideoTile(){this.currentLocalTile&&(this.currentLocalTile.stateRef().localTileStarted=!1,this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.audioVideoController.update({needsRenegotiation:!0}))}hasStartedLocalVideoTile(){return!!(this.currentLocalTile&&this.currentLocalTile.stateRef().localTileStarted)}removeLocalVideoTile(){this.currentLocalTile&&this.removeVideoTile(this.currentLocalTile.id())}getLocalVideoTile(){return this.currentLocalTile}pauseVideoTile(t){let e=this.getVideoTile(t);e&&(this.currentPausedTilesByIds.has(t)||(this.audioVideoController.pauseReceivingStream(e.stateRef().streamId),this.currentPausedTilesByIds.add(t)),e.pause())}unpauseVideoTile(t){let e=this.getVideoTile(t);e&&(this.currentPausedTilesByIds.has(t)&&(this.audioVideoController.resumeReceivingStream(e.stateRef().streamId),this.currentPausedTilesByIds.delete(t)),e.unpause())}getVideoTile(t){return this.tileMap.has(t)?this.tileMap.get(t):null}getVideoTileArea(t){let e=t.state(),r=0,n=0;return e.boundVideoElement&&(r=e.boundVideoElement.clientHeight*e.devicePixelRatio,n=e.boundVideoElement.clientWidth*e.devicePixelRatio),r*n}getAllRemoteVideoTiles(){let t=new Array;return this.tileMap.forEach((e,r)=>{(!this.currentLocalTile||r!==this.currentLocalTile.id())&&t.push(e)}),t}getAllVideoTiles(){return Array.from(this.tileMap.values())}addVideoTile(t=!1){let e=this.nextTileId;this.nextTileId+=1,this.createDevicePixelRatioMonitorIfNeeded();let r=this.tileFactory.makeTile(e,t,this,this.devicePixelRatioMonitor,this.createResolutionMonitor(e));return this.tileMap.set(e,r),r}removeVideoTile(t){if(!this.tileMap.has(t))return;let e=this.tileMap.get(t);this.currentLocalTile===e&&(this.currentLocalTile=null),e.destroy(),this.tileMap.delete(t),this.audioVideoController.forEachObserver(r=>{AO.Maybe.of(r.videoTileWasRemoved).map(n=>n.bind(r)(t))}),this.discardDevicePixelRatioMonitorIfNotNeeded()}removeVideoTilesByAttendeeId(t){let e=[];for(let r of this.getAllVideoTiles()){let n=r.state();n.boundAttendeeId===t&&(this.removeVideoTile(n.tileId),e.push(n.tileId))}return e}removeAllVideoTiles(){let t=Array.from(this.tileMap.keys());for(let e of t)this.removeVideoTile(e)}sendTileStateUpdate(t){this.audioVideoController.forEachObserver(e=>{AO.Maybe.of(e.videoTileDidUpdate).map(r=>r.bind(e)(t))})}haveVideoTilesWithStreams(){for(let t of this.getAllVideoTiles())if(t.state().boundVideoStream)return!0;return!1}haveVideoTileForAttendeeId(t){return!!this.getVideoTileForAttendeeId(t)}getVideoTileForAttendeeId(t){for(let e of this.getAllVideoTiles())if(e.state().boundAttendeeId===t)return e}captureVideoTile(t){let e=this.getVideoTile(t);return e?e.capture():null}registerVideoTileResolutionObserver(t){this.resolutionObservers.add(t)}removeVideoTileResolutionObserver(t){this.resolutionObservers.delete(t)}notifyResolutionObserversOfChange(t,e,r){for(let n of this.resolutionObservers)n.videoTileResolutionDidChange(t,e,r)}notifyRemoteObserversOfUnbound(t){for(let e of this.resolutionObservers)e.videoTileUnbound(t)}createResolutionMonitor(t){let e=new class{constructor(n,o){this.controller=n,this.tileId=o}videoElementResolutionChanged(n,o){let s=this.controller.getVideoTile(this.tileId);if(s){let a=s.state().boundAttendeeId;this.controller.notifyResolutionObserversOfChange(a,n,o)}}}(this,t),r=new X5.default;return r.registerObserver(e),r}findOrCreateLocalVideoTile(){return this.currentLocalTile?this.currentLocalTile:(this.currentLocalTile=this.addVideoTile(!0),this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.currentLocalTile)}};Jn.default=iw});var ow=y(sc=>{"use strict";var Z5=sc&&sc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(sc,"__esModule",{value:!0});var eG=Z5(Wa()),nw=class{makeTile(t,e,r,n,o){return new eG.default(t,e,r,n,o)}};sc.default=nw});var sw=y(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.SimulcastLayers=void 0;var kO;(function(i){i[i.Low=0]="Low",i[i.LowAndMedium=1]="LowAndMedium",i[i.LowAndHigh=2]="LowAndHigh",i[i.Medium=3]="Medium",i[i.MediumAndHigh=4]="MediumAndHigh",i[i.High=5]="High"})(kO=Os.SimulcastLayers||(Os.SimulcastLayers={}));Os.default=kO});var lw=y(ac=>{"use strict";var Nf=ac&&ac.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ac,"__esModule",{value:!0});var aw=Nf(sw()),MO=Nf($d()),tG=_t(),dw=Nf(Ms()),cw=Nf(Bm()),Fi=class i{constructor(t,e){this.selfAttendeeId=t,this.logger=e,this.numSenders=0,this.shouldDisableSimulcast=!1,this.newQualityMap=new Map,this.currentQualityMap=new Map,this.newActiveStreams=1,this.videoIndex=null,this.observerQueue=new Set,this.hiTargetBitrateKbps=i.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=i.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=i.kLowTargetBitrateKbpsHd,this.enableFhdVideo=!1,this.optimalParameters=new dw.default(0,0,0,0,!0),this.parametersInEffect=new dw.default(0,0,0,0,!0),this.currentQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps]),this.newQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps])}updateConnectionMetric(t){}calculateEncodingParameters(){let t=[new cw.default,new cw.default,new cw.default];this.shouldDisableSimulcast?(this.newActiveStreams=0,t[0].maxBitrateKbps=0,t[1].maxBitrateKbps=this.hiTargetBitrateKbps,t[2].maxBitrateKbps=0):this.numSenders<=4?(this.newActiveStreams=1,t[0].maxBitrateKbps=this.lowTargetBitrateKbps,t[1].maxBitrateKbps=0,t[2].maxBitrateKbps=this.hiTargetBitrateKbps):(this.newActiveStreams=2,t[0].maxBitrateKbps=this.lowTargetBitrateKbps*2/3,t[1].maxBitrateKbps=this.numSenders<=6?this.midTargetBitrateKbps:this.midTargetBitrateKbps*.6,t[2].maxBitrateKbps=0);let e=t.map((r,n,o)=>r.maxBitrateKbps);return this.newQualityMap=this.fillEncodingParamWithBitrates(e),this.encodingParametersEqual()||this.logger.info(`simulcast: policy:calculateEncodingParameters numSources:${this.numSenders} shouldDisableSimulcast:${this.shouldDisableSimulcast} newQualityMap: ${this.getQualityMapString(this.newQualityMap)}`),this.newQualityMap}chooseMediaTrackConstraints(){}chooseEncodingParameters(){return this.currentQualityMap=this.newQualityMap,this.activeStreamsToPublish!==this.newActiveStreams&&(this.activeStreamsToPublish=this.newActiveStreams,this.publishEncodingSimulcastLayer()),this.currentQualityMap}updateIndex(t){let e=t.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+1,r=e!==this.numSenders,n=t.numberOfParticipants(),o=n>=0&&n<=2,s=this.shouldDisableSimulcast!==o;this.numSenders=e,this.shouldDisableSimulcast=o,this.optimalParameters=new dw.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1),this.videoIndex=t,(r||s)&&(this.newQualityMap=this.calculateEncodingParameters())}wantsResubscribe(){return!this.encodingParametersEqual()}compareEncodingParameter(t,e){return JSON.stringify(t)===JSON.stringify(e)}encodingParametersEqual(){let t=!1;for(let e of MO.default.NAME_ARR_ASCENDING)if(t=t||!this.compareEncodingParameter(this.newQualityMap.get(e),this.currentQualityMap.get(e)),t)break;return!t}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}captureWidth(){return this.enableFhdVideo?1920:1280}captureHeight(){return this.enableFhdVideo?1080:768}captureFrameRate(){return 15}maxBandwidthKbps(){return this.enableFhdVideo?2500:1400}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}setHighResolutionFeatureEnabled(t){this.enableFhdVideo=t,this.hiTargetBitrateKbps=t?i.kHiTargetBitrateKbpsFhd:i.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=t?i.kMidTargetBitrateKbpsFhd:i.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=t?i.kLowTargetBitrateKbpsFhd:i.kLowTargetBitrateKbpsHd}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!0}fillEncodingParamWithBitrates(t){let e=new Map,r=1e3,n=MO.default.NAME_ARR_ASCENDING,o=t,s=this.shouldDisableSimulcast?1:4;for(let a=0;a<n.length;a++){let l=n[a];e.set(l,{rid:l,active:o[a]>0,scaleResolutionDownBy:Math.max(s,1),maxBitrate:o[a]*r}),s=s/2}return e}getQualityMapString(t){let e="";return this.videoIndex.localStreamDescriptions().length===3&&t.forEach(n=>{e+=`{ rid: ${n.rid} active:${n.active} maxBitrate:${n.maxBitrate}}`}),e}getEncodingSimulcastLayer(t){switch(t){case 0:return aw.default.High;case 1:return aw.default.LowAndHigh;case 2:return aw.default.LowAndMedium}}publishEncodingSimulcastLayer(){let t=this.getEncodingSimulcastLayer(this.activeStreamsToPublish);this.forEachObserver(e=>{tG.Maybe.of(e.encodingSimulcastLayersDidChange).map(r=>r.bind(e)(t))})}addObserver(t){this.logger.info("adding simulcast uplink observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing simulcast uplink observer"),this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)t(e)}};ac.default=Fi;Fi.kHiTargetBitrateKbpsHd=1200;Fi.kMidTargetBitrateKbpsHd=600;Fi.kLowTargetBitrateKbpsHd=300;Fi.kHiTargetBitrateKbpsFhd=2e3;Fi.kMidTargetBitrateKbpsFhd=1e3;Fi.kLowTargetBitrateKbpsFhd=500});var fw=y(Qn=>{"use strict";var iG=Qn&&Qn.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},rG=Qn&&Qn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Qn,"__esModule",{value:!0});var uw=rG(Ms()),Ps=class i{constructor(t,e=!0,r=void 0,n=void 0){this.selfAttendeeId=t,this.scaleResolution=e,this.logger=r,this.browserBehavior=n,this.numberOfPublishedVideoSources=void 0,this.idealMaxBandwidthKbps=1500,this.hasBandwidthPriority=!1,this.encodingParamMap=new Map,this.enableHighResolutionFeature=!1,this.enableSVC=!1,this.isUsingSVCCodec=!0,this.numParticipants=0,this.reset()}reset(){this.numberOfPublishedVideoSources=void 0,this.optimalParameters=new uw.default(0,0,0,0,!1),this.parametersInEffect=new uw.default(0,0,0,0,!1),this.encodingParamMap.set(i.encodingMapKey,{maxBitrate:0})}updateConnectionMetric(t){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(t){var e;let r=!0;this.transceiverController&&(r=this.transceiverController.hasVideoInput());let n=t.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+(r?1:0),o=t.numberOfParticipants();if(this.numParticipants===o&&this.numberOfPublishedVideoSources===n){(e=this.logger)===null||e===void 0||e.debug("Skipping update index; Number of participants has not changed");return}this.numberOfPublishedVideoSources=n,this.numParticipants=o,this.updateOptimalParameters()}wantsResubscribe(){return!this.parametersInEffect.equal(this.optimalParameters)}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}updateOptimalParameters(){let t=1;if(this.transceiverController){let e=this.getStreamCaptureSetting();e&&(t=this.calculateEncodingParameters(e).scaleResolutionDownBy)}this.optimalParameters=new uw.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1,t,this.enableSVC&&this.numParticipants>2&&this.isUsingSVCCodec)}captureWidth(){let t=640;return this.getNumberOfPublishedVideoSources()>4&&(t=320),t}captureHeight(){let t=384;return this.getNumberOfPublishedVideoSources()>4&&(t=192),t}captureFrameRate(){return 15}maxBandwidthKbps(){if(this.hasBandwidthPriority)return Math.trunc(this.idealMaxBandwidthKbps);let t=0;return this.getNumberOfPublishedVideoSources()<=2?t=this.idealMaxBandwidthKbps:this.getNumberOfPublishedVideoSources()<=4?t=this.idealMaxBandwidthKbps*2/3:t=(544/11+14880/(11*this.getNumberOfPublishedVideoSources()))/600*this.idealMaxBandwidthKbps,Math.trunc(t)}setIdealMaxBandwidthKbps(t){this.idealMaxBandwidthKbps=t}setHasBandwidthPriority(t){this.hasBandwidthPriority=t}setTransceiverController(t){this.transceiverController=t}setSVCEnabled(t){var e;this.enableSVC=t,(e=this.logger)===null||e===void 0||e.info(`setSVCEnabled, enable: ${t}}`)}setHighResolutionFeatureEnabled(t){this.enableHighResolutionFeature=t}updateTransceiverController(){return iG(this,void 0,void 0,function*(){let t=this.getStreamCaptureSetting();if(!t)return;let e=this.calculateEncodingParameters(t);this.shouldUpdateEndcodingParameters(e)&&(this.encodingParamMap.set(i.encodingMapKey,e),this.transceiverController.setEncodingParameters(this.encodingParamMap))})}shouldUpdateEndcodingParameters(t){var e,r;let n=(r=(e=this.transceiverController.localVideoTransceiver().sender.getParameters())===null||e===void 0?void 0:e.encodings)===null||r===void 0?void 0:r[0];return t.maxBitrate!==n?.maxBitrate||t.scaleResolutionDownBy!==n?.scaleResolutionDownBy||t?.scalabilityMode!==n?.scalabilityMode}calculateEncodingParameters(t){var e,r,n;let o=this.maxBandwidthKbps()*1e3,s=1,a=720;if(t.height!==void 0&&t.width!==void 0&&this.scaleResolution&&!this.hasBandwidthPriority&&this.getNumberOfPublishedVideoSources()>2&&(a=i.targetHeightArray[Math.min(this.getNumberOfPublishedVideoSources(),i.targetHeightArray.length-1)][this.enableHighResolutionFeature?1:0],a===480&&(!((e=this.browserBehavior)===null||e===void 0)&&e.disable480pResolutionScaleDown())&&(a=360),s=Math.max(Math.min(t.height,t.width)/a,1),(r=this.logger)===null||r===void 0||r.info(`Resolution scale factor is ${s} for capture resolution ${t.width}x${t.height}. New dimension is ${t.width/s}x${t.height/s}`)),this.enableSVC){let l;return this.numParticipants>=0&&this.numParticipants<3||!this.isUsingSVCCodec?l="L1T1":l="L3T3",(n=this.logger)===null||n===void 0||n.info(`calculateEncodingParameters: SVC: ${this.enableSVC}    participants: ${this.numParticipants}     publishers: ${this.getNumberOfPublishedVideoSources()}     bitrate: ${o}  targetHeight: ${a}  scalabilityMode: ${l}   isUsingSVCCodec: ${this.isUsingSVCCodec}`),{scaleResolutionDownBy:s,maxBitrate:o,scalabilityMode:l}}else return{scaleResolutionDownBy:s,maxBitrate:o}}getStreamCaptureSetting(){var t,e,r,n;return(n=(r=(e=(t=this.transceiverController)===null||t===void 0?void 0:t.localVideoTransceiver())===null||e===void 0?void 0:e.sender)===null||r===void 0?void 0:r.track)===null||n===void 0?void 0:n.getSettings()}getNumberOfPublishedVideoSources(){var t;return(t=this.numberOfPublishedVideoSources)!==null&&t!==void 0?t:0}wantsVideoDependencyDescriptorRtpHeaderExtension(){return this.enableSVC}setMeetingSupportedVideoSendCodecs(t,e){let r=t??e,n=r.length>0&&i.SVCCodecNames.includes(r[0].codecName);n!==this.isUsingSVCCodec&&(this.isUsingSVCCodec=n,this.updateOptimalParameters())}};Qn.default=Ps;Ps.encodingMapKey="video";Ps.targetHeightArray=[[0,0],[0,0],[0,0],[540,720],[540,720],[480,540],[480,540],[480,540],[480,540],[360,480],[360,480],[360,480],[360,480],[270,360],[270,360],[270,360],[270,360],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270]];Ps.SVCCodecNames=["VP9"]});var pw=y(hw=>{"use strict";Object.defineProperty(hw,"__esModule",{value:!0});var Rs=class i{constructor(t,e,r,n,o){this.logger=t,this.realtimeController=e,this.minVolumeDecibels=r,this.maxVolumeDecibels=n,this.selfAttendeeId=o,this.streamIdToAttendeeId={},this.streamIdToExternalUserId={},this.warnedAboutMissingStreamIdMapping={},this.attendeeIdToStreamId={},this.sessionReconnected=!1}onReconnect(){this.sessionReconnected=!0}sendRealtimeUpdatesForAudioStreamIdInfo(t){let e=0;for(let r of t.streams){let n=!!r.attendeeId,o=!!r.externalUserId,s=r.hasOwnProperty("muted"),a=!!r.dropped;if(n){this.attendeeIdToStreamId[r.attendeeId]&&this.attendeeIdToStreamId[r.attendeeId]<r.audioStreamId&&delete this.attendeeIdToStreamId[r.attendeeId],this.streamIdToAttendeeId[r.audioStreamId]=r.attendeeId;let l=o?r.externalUserId:r.attendeeId;this.streamIdToExternalUserId[r.audioStreamId]=l,this.attendeeIdToStreamId[r.attendeeId]=r.audioStreamId,this.realtimeController.realtimeSetAttendeeIdPresence(r.attendeeId,!0,l,!1,{attendeeIndex:e++,attendeesInFrame:t.streams.length})}if(s){let l=this.streamIdToAttendeeId[r.audioStreamId],c=this.streamIdToExternalUserId[r.audioStreamId];this.realtimeController.realtimeUpdateVolumeIndicator(l,null,r.muted,null,c)}if(!n&&!s){let l=this.streamIdToAttendeeId[r.audioStreamId];if(l){let c=this.streamIdToExternalUserId[r.audioStreamId];delete this.streamIdToAttendeeId[r.audioStreamId],delete this.streamIdToExternalUserId[r.audioStreamId],delete this.warnedAboutMissingStreamIdMapping[r.audioStreamId],this.attendeeIdToStreamId[l]===r.audioStreamId&&delete this.attendeeIdToStreamId[l];let d=!1;for(let u of Object.keys(this.streamIdToAttendeeId)){let f=parseInt(u);if(f>r.audioStreamId&&this.streamIdToAttendeeId[f]===l){d=!0;break}}d||this.realtimeController.realtimeSetAttendeeIdPresence(l,!1,c,a,{attendeeIndex:e++,attendeesInFrame:t.streams.length})}}}this.sessionReconnected&&(this.cleanUpState(t),this.sessionReconnected=!1)}cleanUpState(t){let e=Object.values(this.streamIdToAttendeeId),r=t.streams.map(o=>o.attendeeId),n=e.filter(o=>!r.includes(o));for(let[o,s]of n.entries()){let a=this.attendeeIdToStreamId[s],l=this.streamIdToExternalUserId[a];if(delete this.streamIdToAttendeeId[a],delete this.streamIdToExternalUserId[a],delete this.warnedAboutMissingStreamIdMapping[a],delete this.attendeeIdToStreamId[s],s===this.selfAttendeeId){this.logger.warn("the volume indicator adapter cleans up the current attendee (presence = false) after reconnection");continue}this.realtimeController.realtimeSetAttendeeIdPresence(s,!1,l,!1,{attendeeIndex:o,attendeesInFrame:s.length})}}sendRealtimeUpdatesForAudioMetadata(t){let e=null,r=null;for(let n of t.attendeeStates){let o=this.attendeeIdForStreamId(n.audioStreamId);n.hasOwnProperty("volume")&&(e===null&&(e={}),o!==null&&(e[o]=this.normalizedVolume(n))),n.hasOwnProperty("signalStrength")&&(r===null&&(r={}),o!==null&&(r[o]=this.normalizedSignalStrength(n)))}this.applyRealtimeUpdatesForAudioMetadata(e,r)}normalizedVolume(t){let r=1-(-t.volume-this.maxVolumeDecibels)/(this.minVolumeDecibels-this.maxVolumeDecibels);return Math.min(Math.max(r,0),1)}normalizedSignalStrength(t){let e=t.signalStrength/i.MAX_SIGNAL_STRENGTH_LEVELS;return Math.min(Math.max(e,0),1)}applyRealtimeUpdatesForAudioMetadata(t,e){for(let r in this.streamIdToAttendeeId){let n=this.streamIdToAttendeeId[r],o=this.streamIdToExternalUserId[r],s=null,a=null;t!==null&&(t.hasOwnProperty(n)?s=t[n]:s=i.IMPLICIT_VOLUME),e!==null&&(e.hasOwnProperty(n)?a=e[n]:a=i.IMPLICIT_SIGNAL_STRENGTH),(s!==null||a!==null)&&this.realtimeController.realtimeUpdateVolumeIndicator(n,s,null,a,o)}}attendeeIdForStreamId(t){if(t===0)return null;let e=this.streamIdToAttendeeId[t];return e||(this.warnedAboutMissingStreamIdMapping[t]||(this.warnedAboutMissingStreamIdMapping[t]=!0,this.logger.warn(`volume indicator stream id ${t} seen before being defined`)),null)}};hw.default=Rs;Rs.MAX_SIGNAL_STRENGTH_LEVELS=2;Rs.IMPLICIT_VOLUME=0;Rs.IMPLICIT_SIGNAL_STRENGTH=1});var Uf=y(vt=>{"use strict";var nG=vt&&vt.__createBinding||(Object.create?(function(i,t,e,r){r===void 0&&(r=e),Object.defineProperty(i,r,{enumerable:!0,get:function(){return t[e]}})}):(function(i,t,e,r){r===void 0&&(r=e),i[r]=t[e]})),oG=vt&&vt.__setModuleDefault||(Object.create?(function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}):function(i,t){i.default=t}),sG=vt&&vt.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var e in i)e!=="default"&&Object.prototype.hasOwnProperty.call(i,e)&&nG(t,i,e);return oG(t,i),t},et=vt&&vt.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},z=vt&&vt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(vt,"__esModule",{value:!0});var aG=z(RS()),dG=z(Ku()),cG=z(Cu()),Lf=z(We()),lG=z(Cg()),uG=z(VS()),xO=z(Pi()),Xn=z(un()),Je=z(jt()),fG=z(Ju()),Er=z(sr()),hG=z(jS()),pG=z(gy()),mG=z(wt()),Yn=z(sn()),gG=z(by()),lt=z(Yu()),Ff=z(Zu()),Bf=z(ef()),SG=z(Ty()),OO=sG(li()),yG=z(Ge()),vG=z(rf()),bG=Oe(),wG=z(lM()),mw=z(Jp()),CG=z(Qm()),_G=z(Ym()),PO=z(yS()),gw=z(kS()),Sw=z(Ny()),RO=z(Hy()),TG=z($y()),EG=z(Wy()),IG=z(tv()),DO=z(av()),AG=z(cv()),kG=z(uv()),MG=z(hv()),NO=z(mv()),LO=z(Sv()),xG=z(bv()),OG=z(_v()),xt=z(Ev()),yw=z(kv()),Vf=z(xv()),vw=z(Eb()),Bi=z(If()),PG=z(kb()),RG=z(zd()),DG=z(Af()),NG=z($d()),LG=z(Nb()),Vi=_t(),FG=z(Ms()),BG=z(gu()),VG=z(zb()),UG=Vn(),FO=z(Fr()),qG=z(Df()),HG=z(Gb()),zG=z(rw()),$G=z(ow()),jG=z(lw()),WG=z(fw()),GG=z(pw()),BO=z(im()),Ds=class i{constructor(t,e,r,n,o,s){this._audioProfile=new cG.default,this.connectionHealthData=new lG.default,this.observerQueue=new Set,this.meetingSessionContext=new BO.default,this.enableSimulcast=!1,this.enableSVC=!1,this.useUpdateTransceiverControllerForUplink=!1,this.totalRetryCount=0,this.startAudioVideoTimestamp=0,this.mayNeedRenegotiationForSimulcastLayerChange=!1,this.promotedToPrimaryMeeting=!1,this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!1,this.receiveIndexTask=void 0,this.monitorTask=void 0,this.receiveRemotePauseResumeTask=void 0,this.destroyed=!1,this._logger=e,this.sessionStateController=new gG.default(this._logger),this._configuration=t,this._webSocketAdapter=r,this._realtimeController=new pG.default(n),this._realtimeController.realtimeSetLocalAttendeeId(t.credentials.attendeeId,t.credentials.externalUserId),this._mediaStreamBroker=n,this._reconnectController=o,this._videoTileController=new zG.default(new $G.default,this,this._logger),this._audioMixController=new dG.default(this._logger),this._mediaStreamBroker.addMediaStreamBrokerObserver(this._audioMixController),this.meetingSessionContext.logger=this._logger,this._eventController=s,this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers||(new Er.default(this.configuration.credentials.attendeeId).hasModality(Er.default.MODALITY_CONTENT)&&new Lf.default().hasChromiumWebRTC()?this.videoSendCodecPreferences=[Yn.default.av1Main(),Yn.default.vp9Profile0(),Yn.default.h264ConstrainedBaselineProfile(),Yn.default.vp8()]:this.videoSendCodecPreferences=[Yn.default.vp9Profile0(),Yn.default.h264ConstrainedBaselineProfile(),Yn.default.vp8()])}destroy(){return et(this,void 0,void 0,function*(){this.observerQueue.clear(),this._mediaStreamBroker.removeMediaStreamBrokerObserver(this._audioMixController),this.destroyed=!0})}get configuration(){return this._configuration}get realtimeController(){return this._realtimeController}get activeSpeakerDetector(){return this._activeSpeakerDetector||(this._activeSpeakerDetector=new aG.default(this._realtimeController,this._configuration.credentials.attendeeId,this.handleHasBandwidthPriority.bind(this))),this._activeSpeakerDetector}get videoTileController(){return this._videoTileController}get audioMixController(){return this._audioMixController}get logger(){return this._logger}get rtcPeerConnection(){return this.meetingSessionContext&&this.meetingSessionContext.peer||null}get mediaStreamBroker(){return this._mediaStreamBroker}get eventController(){return this._eventController}getRTCPeerConnectionStats(t){return this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent||(this.logger.warn("The `getRTCPeerConnectionStats()` is on its way to be deprecated. It makes an additional call to the `getStats` API and therefore may cause slight performance degradation. Please use the new API `clientMetricReport.getRTCStatsReport()` returned by `metricsDidReceive(clientMetricReport)` callback instead."),this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!0),this.rtcPeerConnection?this.rtcPeerConnection.getStats(t):null}setAudioProfile(t){this._audioProfile=t}addObserver(t){this.logger.info("adding meeting observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing meeting observer"),this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)mG.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}initSignalingClient(){this.connectionHealthData.reset(),!this.meetingSessionContext.signalingClient&&(this.meetingSessionContext=new BO.default,this.meetingSessionContext.logger=this.logger,this.meetingSessionContext.eventController=this.eventController,this.meetingSessionContext.browserBehavior=new Lf.default,this.meetingSessionContext.videoSendCodecPreferences=this.videoSendCodecPreferences,this.meetingSessionContext.audioProfile=this._audioProfile,this.meetingSessionContext.meetingSessionConfiguration=this.configuration,this.meetingSessionContext.signalingClient=new SG.default(this._webSocketAdapter,this.logger))}uninstallPreStartObserver(){this.meetingSessionContext.signalingClient.removeObserver(this.preStartObserver),this.preStartObserver=void 0}prestart(){return this.logger.info("Pre-connecting signaling connection."),this.createOrReuseSignalingTask().run().then(()=>{let t=()=>et(this,void 0,void 0,function*(){this.logger.info("Early connection closed; discarding signaling task."),this.signalingTask=void 0,this.uninstallPreStartObserver()});this.preStartObserver={handleSignalingClientEvent(e){e.type===yG.default.WebSocketClosed&&t()}},this.meetingSessionContext.signalingClient.registerObserver(this.preStartObserver)}).catch(t=>{this.logger.error(`Signaling task pre-start failed: ${t}`),this.signalingTask=void 0})}start(t){this.startReturningPromise(t).then(()=>{this.logger.info("start completed")}).catch(e=>{this.logger.error(`start failed: ${e}`)})}startReturningPromise(t){return t?.signalingOnly===!0?this.prestart():(this.activeSpeakerDetector,new Promise((e,r)=>{this.sessionStateController.perform(lt.default.Connect,()=>{this.actionConnect(!1).then(e).catch(r)})}))}connectWithPromises(t){let e=this.meetingSessionContext,r=(m,S)=>new Bi.default(this.logger,S,m);this.monitorTask=new IG.default(e,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData);let n=this.monitorTask.once(),o=new MG.default(e).once();this.receiveIndexTask=new xG.default(e),this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();let s=new xt.default(this.logger,"Signaling",[this.createOrReuseSignalingTask(),new EG.default(e),new OG.default(e),new RO.default(e),this.receiveIndexTask]).once(),a=new PO.default(e).once(s),l=new mw.default(e).once(a,o),c=new gw.default(e).once(l),d=new yw.default(e).once(c),u=new Sw.default(e).once(d),f=new vw.default(e).once(u);return this.receiveRemotePauseResumeTask=new NO.default(e),this.receiveRemotePauseResumeTask.once(f),new xt.default(this.logger,this.wrapTaskName("AudioVideoStart"),[n,r(this.configuration.connectionTimeoutMs,new xt.default(this.logger,"Peer",[f,this.receiveRemotePauseResumeTask,t?new Bi.default(this.logger,new AG.default(this.logger,"FinalizeConnection",[new PG.default(e),new Vf.default(e)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new Vf.default(e)]))])}actionConnect(t){var e;return et(this,void 0,void 0,function*(){this.initSignalingClient(),this.uninstallPreStartObserver(),this.meetingSessionContext.mediaStreamBroker=this._mediaStreamBroker,this.meetingSessionContext.realtimeController=this._realtimeController,this.meetingSessionContext.audioMixController=this._audioMixController,this.meetingSessionContext.audioVideoController=this,this.enableSimulcast=this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&new Lf.default().hasChromiumWebRTC(),this.enableSimulcast&&this.configuration.enableSVC&&this.logger.warn("SVC cannot be enabled at the same time as simulcast. Disabling SVC, using simulcast."),this.enableSVC=!this.enableSimulcast&&this.configuration.enableSVC&&new Lf.default().supportsScalableVideoCoding();let r=!!this.configuration.urls.audioHostURL;if(r?this.enableSimulcast?(this.logger.info("Using transceiver controller with simulcast support"),new Er.default(this.configuration.credentials.attendeeId).hasModality(Er.default.MODALITY_CONTENT)?this.meetingSessionContext.transceiverController=new DG.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext):this.meetingSessionContext.transceiverController=new NG.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using default transceiver controller"),this.meetingSessionContext.transceiverController=new RG.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using video only transceiver controller"),this.meetingSessionContext.transceiverController=new LG.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)),this.meetingSessionContext.volumeIndicatorAdapter=new GG.default(this.logger,this._realtimeController,i.MIN_VOLUME_DECIBELS,i.MAX_VOLUME_DECIBELS,this.configuration.credentials.attendeeId),this.meetingSessionContext.videoTileController=this._videoTileController,this.meetingSessionContext.videoDownlinkBandwidthPolicy=this.configuration.videoDownlinkBandwidthPolicy,this.meetingSessionContext.videoUplinkBandwidthPolicy=this.configuration.videoUplinkBandwidthPolicy,this.meetingSessionContext.enableSimulcast=this.enableSimulcast,this.meetingSessionContext.enableSVC=this.enableSVC,this.enableSimulcast){let s=this.meetingSessionContext.videoUplinkBandwidthPolicy;s||(s=new jG.default(this.configuration.credentials.attendeeId,this.meetingSessionContext.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy=s),s.addObserver(this),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new VG.default(this.meetingSessionContext.logger)),this.meetingSessionContext.videoStreamIndex=new HG.default(this.logger)}else this.meetingSessionContext.enableSimulcast=!1,this.meetingSessionContext.videoStreamIndex=new qG.default(this.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy||(this.meetingSessionContext.videoUplinkBandwidthPolicy=new WG.default(this.configuration.credentials.attendeeId,!this.meetingSessionContext.browserBehavior.disableResolutionScaleDown(),this.meetingSessionContext.logger,this.meetingSessionContext.browserBehavior),this.meetingSessionContext.videoUplinkBandwidthPolicy.setSVCEnabled(this.enableSVC)),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new BG.default(this.configuration.credentials.attendeeId)),this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController&&this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController&&(this.useUpdateTransceiverControllerForUplink=!0,this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController(this.meetingSessionContext.transceiverController)),this.meetingSessionContext.audioProfile=this._audioProfile;if(new Er.default(this.configuration.credentials.attendeeId).hasModality(Er.default.MODALITY_CONTENT)){let s=this.configuration.meetingFeatures.contentMaxResolution===xO.default.VideoResolutionUHD;s&&this.setVideoMaxBandwidthKbps(2500),this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(s)}else{let s=this.configuration.meetingFeatures.videoMaxResolution===xO.default.VideoResolutionFHD;this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(s)}this.meetingSessionContext.videoUplinkBandwidthPolicy&&this.maxUplinkBandwidthKbps&&this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(this.maxUplinkBandwidthKbps),this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController(this._videoTileController),this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver(()=>this.update({needsRenegotiation:!1})),this.meetingSessionContext.lastKnownVideoAvailability=new fG.default,this.meetingSessionContext.videoCaptureAndEncodeParameter=new FG.default(0,0,0,0,!1),this.meetingSessionContext.videosToReceive=new FO.default,this.meetingSessionContext.videosPaused=new FO.default,this.meetingSessionContext.statsCollector=new wG.default(this,this.logger),this.meetingSessionContext.connectionMonitor=new uG.default(this,this._realtimeController,this.connectionHealthData,new hG.default(this.meetingSessionContext.signalingClient,i.PING_PONG_INTERVAL_MS,this.logger),this.meetingSessionContext.statsCollector),this.meetingSessionContext.reconnectController=this._reconnectController,this.meetingSessionContext.videoDeviceInformation={},this._videoTileController.registerVideoTileResolutionObserver(this.meetingSessionContext.statsCollector),t||(this.totalRetryCount=0,this._reconnectController.reset(),this.startAudioVideoTimestamp=Date.now(),this.forEachObserver(s=>{Vi.Maybe.of(s.audioVideoDidStartConnecting).map(a=>a.bind(s)(!1))}),(e=this.eventController)===null||e===void 0||e.publishEvent("meetingStartRequested")),this.meetingSessionContext.startAudioVideoTimestamp=this.startAudioVideoTimestamp,this._reconnectController.hasStartedConnectionAttempt()?this._reconnectController.startedConnectionAttempt(!1):this._reconnectController.startedConnectionAttempt(!0);let n=r&&this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs>0;this.logger.info("Needs to wait for attendee presence? "+n);let o=this.connectWithPromises(n);try{yield o.run(),this.connectionHealthData.setConnectionStartTime();let s=new Er.default(this.configuration.credentials.attendeeId).hasModality(Er.default.MODALITY_CONTENT);this.connectionHealthData.setIsContentShare(s),this._mediaStreamBroker.addMediaStreamBrokerObserver(this),this.sessionStateController.perform(lt.default.FinishConnecting,()=>{this.eventController&&(this.meetingSessionContext.meetingStartDurationMs=Date.now()-this.startAudioVideoTimestamp,this.eventController.publishEvent("meetingStartSucceeded",{maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,poorConnectionCount:this.meetingSessionContext.poorConnectionCount,retryCount:this.totalRetryCount,signalingOpenDurationMs:this.meetingSessionContext.signalingOpenDurationMs,iceGatheringDurationMs:this.meetingSessionContext.iceGatheringDurationMs,meetingStartDurationMs:this.meetingSessionContext.meetingStartDurationMs})),this.meetingSessionContext.startTimeMs=Date.now(),this.actionFinishConnecting()})}catch(s){this.signalingTask=void 0;let a=new Xn.default(this.getMeetingStatusCode(s)||Je.default.TaskFailed);if(this.logger.info(`Start failed: ${a} due to error ${s}.`),this.sessionStateController.state()===Ff.default.NotConnected){this.logger.info("Start failed and not connected. Not cleaning up.");return}this.sessionStateController.perform(lt.default.Fail,()=>et(this,void 0,void 0,function*(){yield this.actionDisconnect(a,!0,s),this.handleMeetingSessionStatus(a,s)||this.notifyStop(a,s)}))}})}createOrReuseSignalingTask(){return this.signalingTask||(this.initSignalingClient(),this.signalingTask=new Bi.default(this.logger,new DO.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs).once()),this.signalingTask}actionFinishConnecting(){this.signalingTask=void 0,this.meetingSessionContext.videoDuplexMode=bG.SdkStreamServiceType.RX,this.meetingSessionContext.enableSimulcast||(this.useUpdateTransceiverControllerForUplink?this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController():this.enforceBandwidthLimitationForSender(this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0])),this.meetingSessionContext.isSessionConnected=!0,this.forEachObserver(t=>{Vi.Maybe.of(t.audioVideoDidStart).map(e=>e.bind(t)())}),this._reconnectController.reset(),this.receiveIndexTask.resumeIngestion(),this.monitorTask.resumeResubscribeCheck()}stopReturningPromise(){var t;return this._reconnectController.disableReconnect(),this.sessionStateController.state()===Ff.default.NotConnected?((t=this.meetingSessionContext.signalingClient)===null||t===void 0||t.closeConnection(),this.cleanUpMediaStreamsAfterStop(),Promise.resolve()):new Promise((e,r)=>{this.sessionStateController.perform(lt.default.Disconnect,()=>{this.logger.info("attendee left meeting, session will not be reconnected"),this.actionDisconnect(new Xn.default(Je.default.Left),!1,null).then(e).catch(r)})})}stop(){this.stopReturningPromise()}actionDisconnect(t,e,r){return et(this,void 0,void 0,function*(){try{yield new xt.default(this.logger,this.wrapTaskName("AudioVideoStop"),[new Bi.default(this.logger,new TG.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)]).run()}catch{this.logger.info("fail to stop")}try{let n=[new Bi.default(this.logger,new _G.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)];this.cleanUpMediaStreamsAfterStop(),yield new xt.default(this.logger,this.wrapTaskName("AudioVideoClean"),n).run()}catch{this.logger.info("fail to clean")}this.sessionStateController.perform(lt.default.FinishDisconnecting,()=>{e||this.notifyStop(t,r)}),this._videoTileController.removeVideoTileResolutionObserver(this.meetingSessionContext.statsCollector)})}update(t={needsRenegotiation:!0}){let e=t.needsRenegotiation;if(e||(e=this.meetingSessionContext.peer===void 0),e||(e=!this.updateRemoteVideosFromPolicy()),e||(e=!this.updateLocalVideoFromPolicy()),this.meetingSessionContext.lastVideosToReceive=this.meetingSessionContext.videosToReceive,!e)return this.logger.info("Update request does not require resubscribe"),this.actionFinishUpdating(),!0;this.logger.info("Update request requires resubscribe"),this.updateNumberOfPublishedVideoSources();let r=this.sessionStateController.perform(lt.default.Update,()=>{this.actionUpdateWithRenegotiation(!0)});return r===Bf.default.Transitioned||r===Bf.default.DeferredTransition}updateNumberOfPublishedVideoSources(){let t=this.configuration.credentials.attendeeId,e=this._videoTileController.hasStartedLocalVideoTile();if(this.meetingSessionContext.videoStreamIndex!==null){let r=this.meetingSessionContext.videoStreamIndex.numberOfVideoPublishingParticipantsExcludingSelf(t)+(e?1:0);this.connectionHealthData.setNumberOfPublishedVideoSources(r)}}updateRemoteVideosFromPolicy(){if(this.meetingSessionContext.videoDownlinkBandwidthPolicy&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.getVideoPreferences!==void 0&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&!OO.serverSideNetworkAdaptionIsNoneOrDefault(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())){if(!this.sendRemoteVideoUpdate())return!1;if(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption()===OO.default.BandwidthProbingAndRemoteVideoQualityAdaption)return this.isNotAddingOrRemovingStreams()}return this.updateRemoteVideosIfNotAddingOrRemovingStreams()}updateRemoteVideosIfNotAddingOrRemovingStreams(){let t=this.detectChangesInVideosToReceive();if(t===void 0)return!1;let e=t.added,r=t.simulcastStreamUpdates,n=t.removed,o=this.meetingSessionContext,s=[];for(let[a,l]of r.entries()){let c=new vG.default;if(c.streamId=l,c.attendeeId=o.videoStreamIndex.attendeeIdForStreamId(l),c.mid=o.transceiverController.getMidForStreamId(a),c.mid===void 0)return this.logger.info(`No MID found for stream ID ${a}, cannot update stream without renegotiation`),!1;if(s.push(c),o.transceiverController.setStreamIdForMid(c.mid,l),o.videoStreamIndex.overrideStreamIdMappings(a,l),o.videoTileController.haveVideoTileForAttendeeId(c.attendeeId)){let d=o.videoTileController.getVideoTileForAttendeeId(c.attendeeId);if(!d.setStreamId)return!1;d.setStreamId(l)}}return s.length!==0&&o.signalingClient.remoteVideoUpdate(s,[]),e.length!==0||n.length!==0?!1:(o.videoStreamIndex.remoteVideoUpdateSent(),!0)}detectChangesInVideosToReceive(){let t=this.meetingSessionContext;if(t.videosToReceive===null||!t.transceiverController||!t.transceiverController.getMidForStreamId||!t.transceiverController.setStreamIdForMid||!t.videosToReceive.forEach||!t.signalingClient.remoteVideoUpdate||!t.videoStreamIndex.overrideStreamIdMappings)return;let e=[],r=new Map,n=[];if(t.lastVideosToReceive===null)e=t.videosToReceive.array();else{let o=t.videoStreamIndex;t.videosToReceive.forEach(s=>{if(t.lastVideosToReceive.contain(s))return;let a=!1;t.lastVideosToReceive.forEach(l=>{a||o.StreamIdsInSameGroup(l,s)&&(r.set(l,s),a=!0)}),a||e.push(s)}),n=t.lastVideosToReceive.array().filter(s=>{let a=t.videosToReceive.contain(s),l=r.has(s);return!a&&!l})}return this.logger.info(`Request to update remote videos with added: [${e}], updated: [${Array.from(r.entries()).map(([o,s])=>`${o}->${s}`).join(",")}], removed: [${n}]`),{added:e,removed:n,simulcastStreamUpdates:r}}isNotAddingOrRemovingStreams(){let t=this.detectChangesInVideosToReceive();if(t===void 0)return!1;let e=t.added,r=t.removed;return e.length!==0||r.length!==0?!1:(this.meetingSessionContext.videoStreamIndex.remoteVideoUpdateSent(),!0)}sendRemoteVideoUpdate(){let t=this.meetingSessionContext;if(t.videosToReceive===null)return!1;let e=t.videosToReceive.array().map(a=>t.videoStreamIndex.groupIdForStreamId(a));this.receiveRemotePauseResumeTask.updateSubscribedGroupdIds(new Set(e));let r=UG.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(t,e,t.videoDownlinkBandwidthPolicy.getVideoPreferences()),n=new Map,o=[];for(let a of r){let l=!1;if(!t.lastVideoSubscriptionConfiguration.has(a.groupId))l=!0;else{let c=t.lastVideoSubscriptionConfiguration.get(a.groupId);a.equals(c)||(this.logger.debug(`${JSON.stringify(a)} does not equal ${JSON.stringify(c)}, sending update`),l=!0)}n.set(a.groupId,a),l&&o.push(a)}t.lastVideoSubscriptionConfiguration=n;let s=[];if(t.lastVideosToReceive!==null){let a=new Set(e);for(let l of t.lastVideosToReceive.array()){let c=t.videoStreamIndex.groupIdForStreamId(l);if(!a.has(c)){let d=t.transceiverController.getMidForGroupId(c);if(d===void 0){t.logger.warn(`Could not find MID for group ID to remove: ${c}`);continue}s.push(d)}}}return(o.length!==0||s.length!==0)&&t.signalingClient.remoteVideoUpdate(o,s),!0}updateLocalVideoFromPolicy(){if(this.meetingSessionContext.enableSimulcast){let t=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseEncodingParameters();if(this.mayNeedRenegotiationForSimulcastLayerChange&&this.meetingSessionContext.transceiverController.hasVideoInput()&&!this.negotiatedBitrateLayersAllocationRtpHeaderExtension())return this.logger.info("Needs regenotiation for local video simulcast layer change"),this.mayNeedRenegotiationForSimulcastLayerChange=!1,!1;this.meetingSessionContext.transceiverController.setEncodingParameters(t)}else this.meetingSessionContext.videoCaptureAndEncodeParameter=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters();return this.logger.info("Updated local video from policy without renegotiation"),!0}negotiatedBitrateLayersAllocationRtpHeaderExtension(){if(!this.meetingSessionContext.transceiverController.localVideoTransceiver())return!1;let t=this.meetingSessionContext.transceiverController.localVideoTransceiver().sender.getParameters();return!t||!t.headerExtensions?!1:t.headerExtensions.some(e=>e.uri==="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00")}restartLocalVideo(t){let e=()=>et(this,void 0,void 0,function*(){this._videoTileController.hasStartedLocalVideoTile()&&(this.logger.info("stopping local video tile prior to local video restart"),this._videoTileController.stopLocalVideoTile(),this.logger.info("preparing local video restart update"),yield this.actionUpdateWithRenegotiation(!1),this.logger.info("starting local video tile for local video restart"),this._videoTileController.startLocalVideoTile()),this.logger.info("finalizing local video restart update"),yield this.actionUpdateWithRenegotiation(!0),t()}),r=this.sessionStateController.perform(lt.default.Update,()=>{e()});return r===Bf.default.Transitioned||r===Bf.default.DeferredTransition}replaceLocalVideo(t){return et(this,void 0,void 0,function*(){if(!t||t.getVideoTracks().length<1)throw new Error("could not acquire video track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");let e=this.meetingSessionContext.videoTileController.getLocalVideoTile();if(e){let r=e.state(),n=t.getVideoTracks()[0].getSettings();e.bindVideoStream(r.boundAttendeeId,!0,t,n.width,n.height,r.streamId,r.boundExternalUserId)}yield this.meetingSessionContext.transceiverController.setVideoInput(t.getVideoTracks()[0]),this.meetingSessionContext.activeVideoInput=t,this.logger.info("Local video input is updated")})}replaceLocalAudio(t){return et(this,void 0,void 0,function*(){if(!t||t.getAudioTracks().length<1)throw new Error("could not acquire audio track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");if(this.connectionHealthData.reset(),this.connectionHealthData.setConnectionStartTime(),!(yield this.meetingSessionContext.transceiverController.replaceAudioTrack(t.getAudioTracks()[0])))throw new Error("Failed to replace audio track");this.meetingSessionContext.activeAudioInput=t,this.logger.info("Local audio input is updated")})}actionUpdateWithRenegotiation(t){return et(this,void 0,void 0,function*(){this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();try{yield new xt.default(this.logger,this.wrapTaskName("AudioVideoUpdate"),[new LO.default(this.meetingSessionContext),new Bi.default(this.logger,new xt.default(this.logger,"UpdateSession",[new mw.default(this.meetingSessionContext),new gw.default(this.meetingSessionContext),new yw.default(this.meetingSessionContext),new Sw.default(this.meetingSessionContext),new vw.default(this.meetingSessionContext),new Vf.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),t&&this.sessionStateController.perform(lt.default.FinishUpdating,()=>{this.actionFinishUpdating()})}catch(e){this.sessionStateController.perform(lt.default.FinishUpdating,()=>{let r=new Xn.default(this.getMeetingStatusCode(e)||Je.default.TaskFailed);r.statusCode()!==Je.default.IncompatibleSDP&&this.logger.info("failed to update audio-video session"),this.handleMeetingSessionStatus(r,e)})}})}notifyStop(t,e){var r;if(this.forEachObserver(n=>{Vi.Maybe.of(n.audioVideoDidStop).map(o=>o.bind(n)(t))}),this.eventController){let{signalingOpenDurationMs:n,poorConnectionCount:o,startTimeMs:s,iceGatheringDurationMs:a,attendeePresenceDurationMs:l,meetingStartDurationMs:c}=this.meetingSessionContext,d={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:s===null?0:Math.round(Date.now()-s),meetingStatus:Je.default[t.statusCode()],signalingOpenDurationMs:n,iceGatheringDurationMs:a,attendeePresenceDurationMs:l,poorConnectionCount:o,meetingStartDurationMs:c,retryCount:this.totalRetryCount},u=e&&e.message||((r=t.toString)===null||r===void 0?void 0:r.call(t))||"";d.meetingDurationMs===0?(d.meetingErrorMessage=u,delete d.meetingDurationMs,delete d.attendeePresenceDurationMs,delete d.meetingStartDurationMs,this.eventController.publishEvent("meetingStartFailed",d)):t.isFailure()||t.isAudioConnectionFailure()?(d.meetingErrorMessage=u,this.eventController.publishEvent("meetingFailed",d)):this.eventController.publishEvent("meetingEnded",d)}}actionFinishUpdating(){if(!this.meetingSessionContext.enableSimulcast)if(this.useUpdateTransceiverControllerForUplink)this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();else{let t=this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0];this.enforceBandwidthLimitationForSender(t)}this.monitorTask.resumeResubscribeCheck(),this.receiveIndexTask.resumeIngestion(),this.logger.info("updated audio-video session")}reconnect(t,e){this.promotedToPrimaryMeeting&&(this.promotedToPrimaryMeeting=!1,this.forEachObserver(n=>{Vi.Maybe.of(n.audioVideoWasDemotedFromPrimaryMeeting).map(o=>o.bind(n)(new Xn.default(Je.default.AudioVideoDisconnectedWhilePromoted)))}));let r=this._reconnectController.retryWithBackoff(()=>et(this,void 0,void 0,function*(){this.sessionStateController.state()===Ff.default.NotConnected?this.sessionStateController.perform(lt.default.Connect,()=>{this.actionConnect(!0)}):this.sessionStateController.perform(lt.default.Reconnect,()=>{this.actionReconnect(t)}),this.totalRetryCount+=1}),()=>{this.logger.info("canceled retry")});return r||this.sessionStateController.perform(lt.default.Fail,()=>{this.actionDisconnect(t,!1,e)}),r}actionReconnect(t){return et(this,void 0,void 0,function*(){this._reconnectController.hasStartedConnectionAttempt()||(this._reconnectController.startedConnectionAttempt(!1),this.forEachObserver(e=>{Vi.Maybe.of(e.audioVideoDidStartConnecting).map(r=>r.bind(e)(!0))})),this.meetingSessionContext.volumeIndicatorAdapter.onReconnect(),this.connectionHealthData.reset(),this.receiveRemotePauseResumeTask=new NO.default(this.meetingSessionContext);try{yield new xt.default(this.logger,this.wrapTaskName("AudioVideoReconnect"),[new Bi.default(this.logger,new xt.default(this.logger,"Media",[new CG.default(this.meetingSessionContext),new xt.default(this.logger,"Signaling",[new DO.default(this.meetingSessionContext),new RO.default(this.meetingSessionContext)]),new PO.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs),new LO.default(this.meetingSessionContext),new Bi.default(this.logger,new xt.default(this.logger,"UpdateSession",[new mw.default(this.meetingSessionContext),new gw.default(this.meetingSessionContext),new yw.default(this.meetingSessionContext),new Sw.default(this.meetingSessionContext),new vw.default(this.meetingSessionContext),new Vf.default(this.meetingSessionContext),this.receiveRemotePauseResumeTask]),this.configuration.connectionTimeoutMs)]).run(),this.sessionStateController.perform(lt.default.FinishConnecting,()=>{if(this.eventController){let{signalingOpenDurationMs:e,poorConnectionCount:r,startTimeMs:n,iceGatheringDurationMs:o,attendeePresenceDurationMs:s,meetingStartDurationMs:a}=this.meetingSessionContext,l={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:Math.round(Date.now()-n),meetingStatus:Je.default[t.statusCode()],signalingOpenDurationMs:e,iceGatheringDurationMs:o,attendeePresenceDurationMs:s,poorConnectionCount:r,meetingStartDurationMs:a,retryCount:this.totalRetryCount};this.eventController.publishEvent("meetingReconnected",l)}this.actionFinishConnecting()})}catch(e){this.sessionStateController.perform(lt.default.FinishConnecting,()=>{this.logger.info("failed to reconnect audio-video session");let r=new Xn.default(this.getMeetingStatusCode(e)||Je.default.TaskFailed);this.handleMeetingSessionStatus(r,e)})}this.connectionHealthData.setConnectionStartTime()})}wrapTaskName(t){return`${t}/${this.configuration.meetingId}/${this.configuration.credentials.attendeeId}`}cleanUpMediaStreamsAfterStop(){this._mediaStreamBroker.removeMediaStreamBrokerObserver(this),this.meetingSessionContext.activeAudioInput=void 0,this.meetingSessionContext.activeVideoInput=void 0}getMeetingStatusCode(t){let e=/the meeting status code: (\d+)/.exec(t&&t.message);return e&&e.length>1?Number.parseInt(e[1],10):null}enforceBandwidthLimitationForSender(t){return et(this,void 0,void 0,function*(){yield this.meetingSessionContext.transceiverController.setVideoSendingBitrateKbps(t)})}handleMeetingSessionStatus(t,e){if(this.logger.info(`handling status: ${Je.default[t.statusCode()]}`),t.isTerminal()||this.meetingSessionContext.statsCollector&&this.meetingSessionContext.statsCollector.logMeetingSessionStatus(t),t.statusCode()===Je.default.IncompatibleSDP)return this.restartLocalVideo(()=>{this.logger.info("handled incompatible SDP by attempting to restart video")}),!0;if(t.statusCode()===Je.default.VideoCallSwitchToViewOnly)return this._videoTileController.removeLocalVideoTile(),this.forEachObserver(r=>{Vi.Maybe.of(r.videoSendDidBecomeUnavailable).map(n=>n.bind(r)())}),!1;if(t.statusCode()===Je.default.AudioVideoWasRemovedFromPrimaryMeeting)return this.forEachObserver(r=>{Vi.Maybe.of(r.audioVideoWasDemotedFromPrimaryMeeting).map(n=>n.bind(r)(t))}),!1;if(t.isTerminal()&&(this.logger.error("session will not be reconnected"),this.meetingSessionContext.reconnectController&&this.meetingSessionContext.reconnectController.disableReconnect()),(t.isFailure()||t.isTerminal())&&this.meetingSessionContext.reconnectController){let r=this.reconnect(t,e);return r?this.logger.warn(`The audio video controller will reconnect due to status code ${Je.default[t.statusCode()]}${e?` and error: ${e.message}`:""}`):this.logger.error(`The audio video controller failed with status code ${Je.default[t.statusCode()]}${e?` and error: ${e.message}`:""}`),r}return!1}setVideoMaxBandwidthKbps(t){if(t<=0)throw new Error("Max bandwidth kbps has to be greater than 0");this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&(this.logger.info(`video send has ideal max bandwidth ${t} kbps`),this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(t)),this.maxUplinkBandwidthKbps=t}handleHasBandwidthPriority(t){return et(this,void 0,void 0,function*(){if(this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&!this.meetingSessionContext.enableSimulcast){if(this.useUpdateTransceiverControllerForUplink){this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(t),yield this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();return}let e=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(t);let r=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();e!==r&&(this.logger.info(`video send bandwidth priority ${t} max has changed from ${e} kbps to ${r} kbps`),yield this.enforceBandwidthLimitationForSender(r))}})}pauseReceivingStream(t){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.pause([t])}resumeReceivingStream(t){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.resume([t])}setVideoCodecSendPreferences(t){this.videoSendCodecPreferences=t,this.meetingSessionContext.videoSendCodecPreferences=t,this.sessionStateController.state()!==Ff.default.NotConnected&&this.update({needsRenegotiation:!0})}getRemoteVideoSources(){let{videoStreamIndex:t}=this.meetingSessionContext;if(!t)return this.logger.info("meeting has not started"),[];let e=this.configuration.credentials.attendeeId;return t.allVideoSendingSourcesExcludingSelf(e)}encodingSimulcastLayersDidChange(t){this.mayNeedRenegotiationForSimulcastLayerChange=!0,this.forEachObserver(e=>{Vi.Maybe.of(e.encodingSimulcastLayersDidChange).map(r=>r.bind(e)(t))})}promoteToPrimaryMeeting(t){return this.actionPromoteToPrimaryMeeting(t)}actionPromoteToPrimaryMeeting(t){return et(this,void 0,void 0,function*(){let e=new Xn.default(Je.default.SignalingRequestFailed);return yield new xt.default(this.logger,this.wrapTaskName("PromoteToPrimaryMeeting"),[new Bi.default(this.logger,new kG.default(this.meetingSessionContext,t,r=>{e=r}),this.configuration.connectionTimeoutMs)]).run(),this.promotedToPrimaryMeeting=e.statusCode()===Je.default.OK,e})}demoteFromPrimaryMeeting(){this.meetingSessionContext.signalingClient.demoteFromPrimaryMeeting(),this.forEachObserver(t=>{Vi.Maybe.of(t.audioVideoWasDemotedFromPrimaryMeeting).map(e=>e.bind(t)(new Xn.default(Je.default.OK)))})}videoInputDidChange(t){return et(this,void 0,void 0,function*(){if(this.logger.info("Receive a video input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating video input because there is no active meeting and peer connection");return}this._videoTileController.hasStartedLocalVideoTile()&&(t?yield this.replaceLocalVideo(t):this._videoTileController.stopLocalVideoTile())})}audioInputDidChange(t){return et(this,void 0,void 0,function*(){if(this.logger.info("Receive an audio input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating audio input because there is no active meeting and peer connection");return}if(!t)try{t=yield this.mediaStreamBroker.acquireAudioInputStream()}catch{this.logger.error("Could not acquire audio track from mediaStreamBroker");return}yield this.replaceLocalAudio(t)})}};vt.default=Ds;Ds.MIN_VOLUME_DECIBELS=-42;Ds.MAX_VOLUME_DECIBELS=-14;Ds.PING_PONG_INTERVAL_MS=1e4});var ww=y(dc=>{"use strict";var Zn=dc&&dc.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(dc,"__esModule",{value:!0});var KG=Hu(),bw=class{constructor(t,e,r,n,o,s){this.audioVideoController=t,this.videoTileController=e,this.realtimeController=r,this.audioMixController=n,this.deviceController=o,this.contentShareController=s}addObserver(t){this.audioVideoController.addObserver(t),this.trace("addObserver")}removeObserver(t){this.audioVideoController.removeObserver(t),this.trace("removeObserver")}setAudioProfile(t){this.trace("setAudioProfile",t),this.audioVideoController.setAudioProfile(t)}start(t){this.audioVideoController.start(t),this.trace("start")}stop(){this.audioVideoController.stop(),this.trace("stop")}getRTCPeerConnectionStats(t){return this.trace("getRTCPeerConnectionStats",t?t.id:null),this.audioVideoController.getRTCPeerConnectionStats(t)}bindAudioElement(t){let e=this.audioMixController.bindAudioElement(t);return this.trace("bindAudioElement",t.id,e),e}unbindAudioElement(){this.audioMixController.unbindAudioElement(),this.trace("unbindAudioElement")}getCurrentMeetingAudioStream(){return this.trace("getCurrentConferenceStream"),this.audioMixController.getCurrentMeetingAudioStream()}addAudioMixObserver(t){this.trace("addAudioMixObserver"),this.audioMixController.addAudioMixObserver(t)}removeAudioMixObserver(t){this.trace("removeAudioMixObserver"),this.audioMixController.removeAudioMixObserver(t)}bindVideoElement(t,e){this.videoTileController.bindVideoElement(t,e),this.trace("bindVideoElement",{tileId:t,videoElementId:e.id})}unbindVideoElement(t,e=!0){this.videoTileController.unbindVideoElement(t,e),this.trace("unbindVideoElement",{tileId:t,cleanUpVideoElement:e})}startLocalVideoTile(){let t=this.videoTileController.startLocalVideoTile();return this.trace("startLocalVideoTile",null,t),t}stopLocalVideoTile(){this.videoTileController.stopLocalVideoTile(),this.trace("stopLocalVideoTile")}hasStartedLocalVideoTile(){let t=this.videoTileController.hasStartedLocalVideoTile();return this.trace("hasStartedLocalVideoTile",null,t),t}removeLocalVideoTile(){this.videoTileController.removeLocalVideoTile(),this.trace("removeLocalVideoTile")}getLocalVideoTile(){let t=this.videoTileController.getLocalVideoTile();return this.trace("getLocalVideoTile"),t}pauseVideoTile(t){this.videoTileController.pauseVideoTile(t),this.trace("pauseVideoTile",t)}unpauseVideoTile(t){this.videoTileController.unpauseVideoTile(t),this.trace("unpauseVideoTile",t)}getVideoTile(t){let e=this.videoTileController.getVideoTile(t);return this.trace("getVideoTile",t),e}getAllRemoteVideoTiles(){let t=this.videoTileController.getAllRemoteVideoTiles();return this.trace("getAllRemoteVideoTiles"),t}getAllVideoTiles(){let t=this.videoTileController.getAllVideoTiles();return this.trace("getAllVideoTiles"),t}addVideoTile(){let t=this.videoTileController.addVideoTile();return this.trace("addVideoTile",null,t.state()),t}removeVideoTile(t){this.videoTileController.removeVideoTile(t),this.trace("removeVideoTile",t)}removeVideoTilesByAttendeeId(t){let e=this.videoTileController.removeVideoTilesByAttendeeId(t);return this.trace("removeVideoTilesByAttendeeId",t,e),e}removeAllVideoTiles(){this.videoTileController.removeAllVideoTiles(),this.trace("removeAllVideoTiles")}captureVideoTile(t){let e=this.videoTileController.captureVideoTile(t);return this.trace("captureVideoTile",t),e}realtimeSubscribeToAttendeeIdPresence(t){this.realtimeController.realtimeSubscribeToAttendeeIdPresence(t),this.trace("realtimeSubscribeToAttendeeIdPresence")}realtimeUnsubscribeToAttendeeIdPresence(t){this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t),this.trace("realtimeUnsubscribeToAttendeeIdPresence")}realtimeSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeSetCanUnmuteLocalAudio(t),this.trace("realtimeSetCanUnmuteLocalAudio",t)}realtimeSubscribeToSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeSubscribeToSetCanUnmuteLocalAudio(t),this.trace("realtimeSubscribeToSetCanUnmuteLocalAudio")}realtimeUnsubscribeToSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeUnsubscribeToSetCanUnmuteLocalAudio(t),this.trace("realtimeUnsubscribeToSetCanUnmuteLocalAudio")}realtimeCanUnmuteLocalAudio(){let t=this.realtimeController.realtimeCanUnmuteLocalAudio();return this.trace("realtimeCanUnmuteLocalAudio",null,t),t}realtimeMuteLocalAudio(){this.realtimeController.realtimeMuteLocalAudio(),this.trace("realtimeMuteLocalAudio")}realtimeUnmuteLocalAudio(){let t=this.realtimeController.realtimeUnmuteLocalAudio();return this.trace("realtimeUnmuteLocalAudio"),t}realtimeSubscribeToMuteAndUnmuteLocalAudio(t){this.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(t),this.trace("realtimeSubscribeToMuteAndUnmuteLocalAudio")}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t){this.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t),this.trace("realtimeUnsubscribeToMuteAndUnmuteLocalAudio")}realtimeIsLocalAudioMuted(){let t=this.realtimeController.realtimeIsLocalAudioMuted();return this.trace("realtimeIsLocalAudioMuted"),t}realtimeSubscribeToVolumeIndicator(t,e){this.realtimeController.realtimeSubscribeToVolumeIndicator(t,e),this.trace("realtimeSubscribeToVolumeIndicator",t)}realtimeUnsubscribeFromVolumeIndicator(t,e){this.realtimeController.realtimeUnsubscribeFromVolumeIndicator(t,e),this.trace("realtimeUnsubscribeFromVolumeIndicator",t,e)}realtimeSubscribeToLocalSignalStrengthChange(t){this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(t),this.trace("realtimeSubscribeToLocalSignalStrengthChange")}realtimeUnsubscribeToLocalSignalStrengthChange(t){this.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(t),this.trace("realtimeUnsubscribeToLocalSignalStrengthChange")}realtimeSendDataMessage(t,e,r){this.realtimeController.realtimeSendDataMessage(t,e,r),this.trace("realtimeSendDataMessage")}realtimeSubscribeToReceiveDataMessage(t,e){this.realtimeController.realtimeSubscribeToReceiveDataMessage(t,e),this.trace("realtimeSubscribeToReceiveDataMessage")}realtimeUnsubscribeFromReceiveDataMessage(t){this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(t),this.trace("realtimeUnsubscribeFromReceiveDataMessage")}realtimeSubscribeToFatalError(t){this.realtimeController.realtimeSubscribeToFatalError(t),this.trace("realtimeSubscribeToFatalError")}realtimeUnsubscribeToFatalError(t){this.realtimeController.realtimeUnsubscribeToFatalError(t),this.trace("realtimeUnsubscribeToFatalError")}subscribeToActiveSpeakerDetector(t,e,r,n){this.audioVideoController.activeSpeakerDetector.subscribe(t,e,r,n),this.trace("subscribeToActiveSpeakerDetector")}unsubscribeFromActiveSpeakerDetector(t){this.audioVideoController.activeSpeakerDetector.unsubscribe(t),this.trace("unsubscribeFromActiveSpeakerDetector")}listAudioInputDevices(t=!1){return Zn(this,void 0,void 0,function*(){let e=yield this.deviceController.listAudioInputDevices(t);return this.trace("listAudioInputDevices",t,e),e})}listVideoInputDevices(t=!1){return Zn(this,void 0,void 0,function*(){let e=yield this.deviceController.listVideoInputDevices(t);return this.trace("listVideoInputDevices",t,e),e})}listAudioOutputDevices(t=!1){return Zn(this,void 0,void 0,function*(){let e=yield this.deviceController.listAudioOutputDevices(t);return this.trace("listAudioOutputDevices",t,e),e})}startAudioInput(t){return Zn(this,void 0,void 0,function*(){return this.trace("startAudioInput",t),this.deviceController.startAudioInput(t)})}stopAudioInput(){return Zn(this,void 0,void 0,function*(){return this.trace("stopAudioInput"),this.deviceController.stopAudioInput()})}startVideoInput(t){return Zn(this,void 0,void 0,function*(){return KG.isVideoTransformDevice(t)?this.trace("startVideoInput with transform device"):this.trace("startVideoInput",t),this.deviceController.startVideoInput(t)})}stopVideoInput(){return Zn(this,void 0,void 0,function*(){return this.trace("stopVideoInput"),this.deviceController.stopVideoInput()})}chooseAudioOutput(t){let e=this.deviceController.chooseAudioOutput(t);return this.trace("chooseAudioOutput",t),e}addDeviceChangeObserver(t){this.deviceController.addDeviceChangeObserver(t),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(t){this.deviceController.removeDeviceChangeObserver(t),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){let t=this.deviceController.createAnalyserNodeForAudioInput();return this.trace("createAnalyserNodeForAudioInput"),t}startVideoPreviewForVideoInput(t){this.deviceController.startVideoPreviewForVideoInput(t),this.trace("startVideoPreviewForVideoInput",t.id)}stopVideoPreviewForVideoInput(t){this.deviceController.stopVideoPreviewForVideoInput(t),this.trace("stopVideoPreviewForVideoInput",t.id)}setDeviceLabelTrigger(t){this.deviceController.setDeviceLabelTrigger(t),this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(t){let e=this.deviceController.mixIntoAudioInput(t);return this.trace("mixIntoAudioInput",t.id),e}chooseVideoInputQuality(t,e,r){this.deviceController.chooseVideoInputQuality(t,e,r),this.trace("chooseVideoInputQuality",{width:t,height:e,frameRate:r})}setVideoMaxBandwidthKbps(t){this.audioVideoController.setVideoMaxBandwidthKbps(t),this.trace("setVideoMaxBandwidthKbps",t)}setVideoCodecSendPreferences(t){this.audioVideoController.setVideoCodecSendPreferences(t),this.trace("setVideoCodecSendPreferences",t)}getVideoInputQualitySettings(){let t=this.deviceController.getVideoInputQualitySettings();return this.trace("getVideoInputQualitySettings"),t}setContentAudioProfile(t){this.trace("setContentAudioProfile",t),this.contentShareController.setContentAudioProfile(t)}enableSimulcastForContentShare(t,e){this.trace("enableSimulcastForContentShare"),this.contentShareController.enableSimulcastForContentShare(t,e)}enableSVCForContentShare(t){this.trace("enableSVCForContentShare"),this.contentShareController.enableSVCForContentShare(t)}startContentShare(t){let e=this.contentShareController.startContentShare(t);return this.trace("startContentShare"),e}startContentShareFromScreenCapture(t,e){let r=this.contentShareController.startContentShareFromScreenCapture(t,e);return this.trace("startContentShareFromScreenCapture"),r}pauseContentShare(){this.contentShareController.pauseContentShare(),this.trace("pauseContentShare")}unpauseContentShare(){this.contentShareController.unpauseContentShare(),this.trace("unpauseContentShare")}stopContentShare(){this.contentShareController.stopContentShare(),this.trace("stopContentShare")}addContentShareObserver(t){this.contentShareController.addContentShareObserver(t),this.trace("addContentShareObserver")}removeContentShareObserver(t){this.contentShareController.removeContentShareObserver(t),this.trace("removeContentShareObserver")}setContentShareVideoCodecPreferences(t){this.contentShareController.setContentShareVideoCodecPreferences(t),this.trace("setContentShareVideoCodecPreferences")}trace(t,e,r){let n=this.audioVideoController.configuration.meetingId,o=this.audioVideoController.configuration.credentials.attendeeId,s=`API/DefaultAudioVideoFacade/${n}/${o}/${t}`;typeof e<"u"&&(s+=` ${JSON.stringify(e)}`),typeof r<"u"&&(s+=` -> ${JSON.stringify(r)}`),this.audioVideoController.logger.info(s)}getRemoteVideoSources(){let t=this.audioVideoController.getRemoteVideoSources();return this.trace("getRemoteVideoSources",null,t),t}get transcriptionController(){return this.realtimeController.transcriptionController}promoteToPrimaryMeeting(t){this.audioVideoController.removeObserver(this),this.audioVideoController.addObserver(this);let e=this.audioVideoController.promoteToPrimaryMeeting(t);return this.trace("promoteToPrimaryMeeting",null,e),e}demoteFromPrimaryMeeting(){this.trace("demoteFromPrimaryMeeting"),this.audioVideoController.demoteFromPrimaryMeeting()}audioVideoWasDemotedFromPrimaryMeeting(t){this.contentShareController.stopContentShare(),this.audioVideoController.removeObserver(this)}};dc.default=bw});var _w=y(cc=>{"use strict";var JG=cc&&cc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(cc,"__esModule",{value:!0});var VO=JG(Pi()),Cw=class i{constructor(t=VO.default.VideoResolutionHD,e=VO.default.VideoResolutionFHD){this.videoMaxResolution=t,this.contentMaxResolution=e}clone(){return new i(this.videoMaxResolution,this.contentMaxResolution)}};cc.default=Cw});var lc=y(Ew=>{"use strict";Object.defineProperty(Ew,"__esModule",{value:!0});var Tw=class{constructor(){this.attendeeId=null,this.externalUserId=null,this.joinToken=null}toJSON(){return{attendeeId:this.attendeeId,joinToken:this.joinToken===null?null:"<redacted>"}}};Ew.default=Tw});var qf=y(Aw=>{"use strict";Object.defineProperty(Aw,"__esModule",{value:!0});var Iw=class{constructor(){this._audioHostURL=null,this._signalingURL=null,this._turnControlURL=null,this._eventIngestionURL=null,this.urlRewriter=t=>t}get audioHostURL(){return this.urlRewriter(this._audioHostURL)}set audioHostURL(t){this._audioHostURL=t}get signalingURL(){return this.urlRewriter(this._signalingURL)}set signalingURL(t){this._signalingURL=t}get turnControlURL(){return this.urlRewriter(this._turnControlURL)}set turnControlURL(t){this._turnControlURL=t}get eventIngestionURL(){return this.urlRewriter(this._eventIngestionURL)}set eventIngestionURL(t){this._eventIngestionURL=t}};Aw.default=Iw});var Hf=y(uc=>{"use strict";var fc=uc&&uc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(uc,"__esModule",{value:!0});var QG=fc(Og()),Ns=fc(Pi()),UO=hr(),qO=fc(_w()),XG=fc(lc()),YG=fc(qf()),kw=class{constructor(t,e){var r,n;if(this.meetingId=null,this.externalMeetingId=null,this.credentials=null,this.urls=null,this.connectionTimeoutMs=15e3,this.attendeePresenceTimeoutMs=0,this.connectionHealthPolicyConfiguration=new QG.default,this.reconnectTimeoutMs=120*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackOffMs=1*1e3,this.reconnectLongBackOffMs=5*1e3,this.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.enableSVC=!1,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.keepLastFrameWhenPaused=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1,this.meetingFeatures=new qO.default,t){t=UO.toLowerCasePropertyNames(t),t.meeting&&(t=t.meeting),this.meetingId=t.meetingid,this.externalMeetingId=t.externalmeetingid,this.urls=new YG.default,this.urls.audioHostURL=t.mediaplacement.audiohosturl,this.urls.signalingURL=t.mediaplacement.signalingurl,this.urls.turnControlURL=t.mediaplacement.turncontrolurl,t.mediaplacement.eventingestionurl&&(this.urls.eventIngestionURL=t.mediaplacement.eventingestionurl);let o=(s,a)=>{switch(s){case"None":return Ns.default.VideoDisabled;case"HD":return Ns.default.VideoResolutionHD;case"FHD":return Ns.default.VideoResolutionFHD;case"UHD":return Ns.default.VideoResolutionUHD;default:return a}};if(((r=t.meetingfeatures)===null||r===void 0?void 0:r.video)!==void 0||((n=t.meetingfeatures)===null||n===void 0?void 0:n.content)!==void 0){let s=t.meetingfeatures.video===void 0?"HD":t.meetingfeatures.video.maxresolution,a=t.meetingfeatures.content===void 0?"FHD":t.meetingfeatures.content.maxresolution;this.meetingFeatures=new qO.default(o(s,Ns.default.VideoResolutionHD),o(a,Ns.default.VideoResolutionFHD))}}e&&(e=UO.toLowerCasePropertyNames(e),e.attendee&&(e=e.attendee),this.credentials=new XG.default,this.credentials.attendeeId=e.attendeeid,this.credentials.externalUserId=e.externaluserid,this.credentials.joinToken=e.jointoken)}};uc.default=kw});var xw=y(hc=>{"use strict";var ZG=hc&&hc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(hc,"__esModule",{value:!0});var eK=ZG(Fr()),Mw=class{reset(){}updateIndex(t){}updateMetrics(t){}wantsResubscribe(){return!1}chooseSubscriptions(){return new eK.default}};hc.default=Mw});var Pw=y(pc=>{"use strict";var tK=pc&&pc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(pc,"__esModule",{value:!0});var iK=tK(Af()),Ow=class{constructor(t,e){this.encodingParams=e,this.enableUhdContent=!1,this.defaultHiTargetBitrateKbps=1200,this.defaultLowTargetBitrateKbps=300}updateConnectionMetric(t){}chooseMediaTrackConstraints(){}chooseEncodingParameters(){var t,e,r,n,o,s,a,l,c,d,u,f;let m=new Map,S=1e3,T=iK.default.NAME_ARR_ASCENDING;return m.set(T[0],{rid:T[0],active:!0,scaleResolutionDownBy:((e=(t=this.encodingParams)===null||t===void 0?void 0:t.low)===null||e===void 0?void 0:e.scaleResolutionDownBy)||2,maxBitrate:(((n=(r=this.encodingParams)===null||r===void 0?void 0:r.low)===null||n===void 0?void 0:n.maxBitrateKbps)||this.defaultLowTargetBitrateKbps)*S,maxFramerate:((s=(o=this.encodingParams)===null||o===void 0?void 0:o.low)===null||s===void 0?void 0:s.maxFramerate)||5}),m.set(T[1],{rid:T[1],active:!0,scaleResolutionDownBy:((l=(a=this.encodingParams)===null||a===void 0?void 0:a.high)===null||l===void 0?void 0:l.scaleResolutionDownBy)||1,maxBitrate:(((d=(c=this.encodingParams)===null||c===void 0?void 0:c.high)===null||d===void 0?void 0:d.maxBitrateKbps)||this.defaultHiTargetBitrateKbps)*S,maxFramerate:(f=(u=this.encodingParams)===null||u===void 0?void 0:u.high)===null||f===void 0?void 0:f.maxFramerate}),m}updateIndex(t){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){}maxBandwidthKbps(){return this.enableUhdContent?2e3:1200}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}setHighResolutionFeatureEnabled(t){this.enableUhdContent=t,this.defaultHiTargetBitrateKbps=t?2e3:1200,this.defaultLowTargetBitrateKbps=t?500:300}addObserver(t){}removeObserver(t){}forEachObserver(t){}};pc.default=Ow});var Lw=y(eo=>{"use strict";var Rw=eo&&eo.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Ir=eo&&eo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(eo,"__esModule",{value:!0});var rK=Ir(Pi()),nK=Ir(Hf()),oK=Ir(lc()),Dw=Ir(sr()),sK=Ir(wt()),zf=_t(),aK=Ir(xw()),dK=Ir(Pw()),HO=Ir(es()),Nw=class{constructor(t,e,r){this.mediaStreamBroker=t,this.contentAudioVideo=e,this.attendeeAudioVideo=r,this.observerQueue=new Set,this.destroyed=!1,this.contentAudioVideo.addObserver(this),this.setupContentShareEvents()}static createContentShareMeetingSessionConfigure(t){let e=new nK.default;return e.meetingId=t.meetingId,e.externalMeetingId=t.externalMeetingId,e.urls=t.urls,e.disablePeriodicKeyframeRequestOnContentSender=t.disablePeriodicKeyframeRequestOnContentSender,e.credentials=new oK.default,e.credentials.attendeeId=t.credentials.attendeeId+HO.default.Modality,e.credentials.externalUserId=t.credentials.externalUserId,e.credentials.joinToken=t.credentials.joinToken+HO.default.Modality,e.meetingFeatures=t.meetingFeatures.clone(),e.videoDownlinkBandwidthPolicy=new aK.default,e}setContentAudioProfile(t){this.contentAudioVideo.setAudioProfile(t)}enableSimulcastForContentShare(t,e){t?(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=new dK.default(this.contentAudioVideo.logger,e)):(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=void 0)}enableSVCForContentShare(t){t?this.contentAudioVideo.configuration.enableSVC=!0:this.contentAudioVideo.configuration.enableSVC=!1}startContentShare(t){return Rw(this,void 0,void 0,function*(){if(t){if(this.contentAudioVideo.configuration.meetingFeatures.contentMaxResolution===rK.default.VideoDisabled){this.contentAudioVideo.logger.info("Could not start content because max content resolution was set to None");return}this.mediaStreamBroker.mediaStream=t;for(let e=0;e<this.mediaStreamBroker.mediaStream.getTracks().length;e++)this.mediaStreamBroker.mediaStream.getTracks()[e].addEventListener("ended",()=>{this.stopContentShare()});this.contentAudioVideo.start()}})}startContentShareFromScreenCapture(t,e){return Rw(this,void 0,void 0,function*(){let r=yield this.mediaStreamBroker.acquireScreenCaptureDisplayInputStream(t,e);return yield this.startContentShare(r),r})}pauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!1)&&this.forEachContentShareObserver(t=>{zf.Maybe.of(t.contentShareDidPause).map(e=>e.call(t))})}unpauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!0)&&this.forEachContentShareObserver(t=>{zf.Maybe.of(t.contentShareDidUnpause).map(e=>e.call(t))})}setContentShareVideoCodecPreferences(t){this.contentAudioVideo.setVideoCodecSendPreferences(t)}destroy(){return Rw(this,void 0,void 0,function*(){this.contentAudioVideo&&(this.destroyed=!0,this.contentAudioVideo.removeObserver(this),this.stopContentShare(),this.observerQueue.clear(),this.contentAudioVideo=void 0,this.attendeeAudioVideo=void 0,this.mediaStreamBroker=void 0)})}stopContentShare(){this.contentAudioVideo.stop(),this.mediaStreamBroker.cleanup()}addContentShareObserver(t){this.observerQueue.add(t)}removeContentShareObserver(t){this.observerQueue.delete(t)}forEachContentShareObserver(t){for(let e of this.observerQueue)sK.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}audioVideoDidStart(){var t;((t=this.mediaStreamBroker.mediaStream)===null||t===void 0?void 0:t.getVideoTracks().length)>0&&this.contentAudioVideo.videoTileController.startLocalVideoTile()}audioVideoDidStop(t){this.mediaStreamBroker.cleanup(),this.contentShareTile&&(this.attendeeAudioVideo.videoTileController.removeVideoTile(this.contentShareTile.id()),this.contentShareTile=null),this.forEachContentShareObserver(e=>{zf.Maybe.of(e.contentShareDidStop).map(r=>r.call(e))})}setupContentShareEvents(){this.attendeeAudioVideo.realtimeController.realtimeSubscribeToAttendeeIdPresence((t,e,r,n)=>{let o=new Dw.default(t).hasModality(Dw.default.MODALITY_CONTENT),s=new Dw.default(t).base()===this.attendeeAudioVideo.configuration.credentials.attendeeId;if(!o||!s||!e||this.contentShareTile)return;let a=this.mediaStreamBroker.mediaStream;if(a?.getVideoTracks().length){this.contentShareTile=this.attendeeAudioVideo.videoTileController.addVideoTile();let l=a.getVideoTracks()[0],c,d;if(l.getSettings){let u=l.getSettings();c=u.width,d=u.height}else{let u=l.getCapabilities();c=u.width,d=u.height}this.contentShareTile.bindVideoStream(this.contentAudioVideo.configuration.credentials.attendeeId,!1,a,c,d,null,this.contentAudioVideo.configuration.credentials.externalUserId)}this.forEachContentShareObserver(l=>{zf.Maybe.of(l.contentShareDidStart).map(c=>c.call(l))})})}};eo.default=Nw});var mc=y($f=>{"use strict";Object.defineProperty($f,"__esModule",{value:!0});$f.isDestroyable=void 0;function cK(i){return i&&"destroy"in i}$f.isDestroyable=cK});var Vw=y(Bw=>{"use strict";Object.defineProperty(Bw,"__esModule",{value:!0});var Fw=class{constructor(t=5e3,e=2,r=64,n=100,o=15){this.flushIntervalMs=t,this.flushSize=e,this.maxBufferCapacityKb=r,this.totalBufferItems=n,this.retryCountLimit=o}};Bw.default=Fw});var qw=y(gc=>{"use strict";var lK=gc&&gc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(gc,"__esModule",{value:!0});var uK=lK(Vw()),Uw=class{constructor(t,e,r=new uK.default){this.eventsClientConfiguration=t,this.ingestionURL=e,this.eventBufferConfiguration=r}};gc.default=Uw});var Ar=y(zw=>{"use strict";Object.defineProperty(zw,"__esModule",{value:!0});var Hw=class{constructor(t,e,r){this.fixedWaitMs=t,this.shortBackoffMs=e,this.longBackoffMs=r,this.currentRetry=0,this.fixedWaitMs<0&&(this.fixedWaitMs=0),this.shortBackoffMs<0&&(this.shortBackoffMs=0),this.longBackoffMs<0&&(this.longBackoffMs=0),this.reset()}reset(){this.currentRetry=0}nextBackoffAmountMs(){let t=Math.random()*Math.min(this.longBackoffMs,this.shortBackoffMs*Math.pow(2,this.currentRetry))+this.fixedWaitMs;return this.currentRetry+=1,t}};zw.default=Hw});var $w=y(Sc=>{"use strict";var fK=Sc&&Sc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Sc,"__esModule",{value:!0});var hK=wu(),zO=fK(Vt()),jf=class i{constructor(t){var e,r,n,o,s,a,l;try{this.parserResult=navigator&&navigator.userAgent?new hK.UAParser(navigator.userAgent).getResult():void 0}catch(c){t.error(c.message)}this.browserMajorVersion=((n=(r=(e=this.parserResult)===null||e===void 0?void 0:e.browser)===null||r===void 0?void 0:r.version)===null||n===void 0?void 0:n.split(".")[0])||i.UNAVAILABLE,this.browserName=((o=this.parserResult)===null||o===void 0?void 0:o.browser.name)||i.UNAVAILABLE,this.browserVersion=((s=this.parserResult)===null||s===void 0?void 0:s.browser.version)||i.UNAVAILABLE,this.deviceName=[((a=this.parserResult)===null||a===void 0?void 0:a.device.vendor)||"",((l=this.parserResult)===null||l===void 0?void 0:l.device.model)||""].join(" ").trim()||i.UNAVAILABLE}getParserResult(){var t,e;return{browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,osName:((t=this.parserResult)===null||t===void 0?void 0:t.os.name)||i.UNAVAILABLE,osVersion:((e=this.parserResult)===null||e===void 0?void 0:e.os.version)||i.UNAVAILABLE,sdkVersion:zO.default.sdkVersion,sdkName:zO.default.sdkName}}};Sc.default=jf;jf.UNAVAILABLE="Unavailable"});var Ww=y(qi=>{"use strict";var Ls=qi&&qi.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},$O=qi&&qi.__rest||function(i,t){var e={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&t.indexOf(r)<0&&(e[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(e[r[n]]=i[r[n]]);return e},jw=qi&&qi.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qi,"__esModule",{value:!0});var pK=jw(Ar()),mK=jw(nr()),gK=jw($w()),SK=hr(),Ui=class i{constructor(t,e,r,n,o){this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.retryCountLimit=15,this.lock=!1,this.cancellableEvents=new Map,this.attributesToFilter=["externalUserId","externalMeetingId","timestampMs"],this.deepCopyCurrentIngestionEvent=I=>({type:I.type,v:I.v,payloads:[...I.payloads]}),this.sendEvents=()=>Ls(this,void 0,void 0,function*(){if(this.lock)return;let I=this.getItems(this.flushSize);if(I.length===0)return;this.lock=!0;let A=this.makeRequestBody(I),E=!1,V=Date.now();this.metadata.browserName.toLowerCase()==="firefox"&&this.cancellableEvents.set(V,I);try{this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - sending body ${A}`);let W=yield this.send(A);if(this.cancellableEvents.delete(V),!W.ok)this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Failed to send events ${A} with response status ${W.status}`),E=!0;else try{let D=yield W.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - send successful events: ${A} message: ${JSON.stringify(D)}`)}catch(D){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents error reading OK response ${D} for events ${A}`)}}catch(W){E=!0,this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Error in sending events ${A} to the ingestion endpoint ${W}`)}finally{this.lock=!1}E&&(this.cancellableEvents.delete(V),this.failedIngestionEvents.push(...I))});let s=new gK.default(o).getParserResult(),{browserMajorVersion:a}=s,l=$O(s,["browserMajorVersion"]),c=e.toJSON(),{type:d,v:u}=c,f=$O(c,["type","v"]);this.authenticationToken=e.getAuthenticationToken(),this.metadata=Object.assign(Object.assign({},l),f),Object.keys(this.metadata).forEach(I=>this.attributesToFilter.push(I)),this.type=d,this.v=u,this.ingestionURL=r,this.logger=o,this.importantEvents=new Set(n);let{maxBufferCapacityKb:m,totalBufferItems:S,flushSize:T,flushIntervalMs:_,retryCountLimit:C}=t;this.maxBufferCapacityBytes=m*1024,this.totalBufferItems=S,this.maxBufferItemCapacityBytes=Math.round(this.maxBufferCapacityBytes/S),this.flushIntervalMs=_,this.flushSize=T,this.retryCountLimit=C,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.beaconEventListener=I=>this.beaconEventHandler(I),this.addEventListeners()}addEventListeners(){!this.beaconEventListener||!("window"in window)||!window.addEventListener||!("document"in window)||!document.addEventListener||(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - addEventListeners - adding pagehide and visibility change event listeners"),window.addEventListener("pagehide",this.beaconEventListener),document.addEventListener("visibilitychange",this.beaconEventListener))}beaconEventHandler(t){(t.type==="visibilitychange"&&document.visibilityState==="hidden"||t.type==="pagehide")&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - beaconEventHandler is triggered calling sendBeacon"),this.sendBeacon())}removeEventListeners(){!this.beaconEventListener||!("window"in window)||!window.removeEventListener||!("document"in window)||!document.removeEventListener||(window.removeEventListener("pagehide",this.beaconEventListener),document.removeEventListener("visibilitychange",this.beaconEventListener),this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - removeEventListeners - removing pagehide and visibility change event listeners"))}start(){var t;this.removeEventListeners(),this.addEventListeners(),(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=new mK.default(this.flushIntervalMs),this.intervalScheduler.start(()=>this.sendEvents())}stop(){var t;(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=void 0,this.sendBeacon(),this.removeEventListeners()}addItem(t){return Ls(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - received event ${JSON.stringify(t)}`);let{name:e,ts:r,attributes:n}=t,o=n&&this.filterAttributes(n,this.attributesToFilter),s=Object.assign({name:e,ts:r},o);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - event after filtering attributes ${JSON.stringify(s)}`);let a=this.getSize(s);if(a>i.MAX_ITEM_SIZE_BYTES_ALLOWED)throw new Error(`Event Reporting - Item to be added has size ${a} bytes. Item cannot exceed max item size allowed of ${i.MAX_ITEM_SIZE_BYTES_ALLOWED} bytes.`);if(this.importantEvents.has(e)){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - sending important event ${JSON.stringify(s)}`),this.sendEventImmediately({name:e,ts:r,attributes:o});return}if(this.isFull())throw this.logger.warn("Event Reporting - Event buffer is full"),new Error("Buffer full");if(this.currentIngestionEvent.payloads.push(s),this.ingestionEventSize+=a,this.bufferItemThresholdReached(a)){let l=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);this.buffer.push(l),this.bufferSize+=this.ingestionEventSize,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - buffer item threshold reached updated buffer ${JSON.stringify(this.buffer)}`)}})}filterAttributes(t,e){let r=new Set(e);return Object.keys(t).filter(o=>r.has(o)).forEach(o=>delete t[o]),t}initializeAndGetCurrentIngestionEvent(){let t={type:this.type,v:this.v,payloads:[]};return this.ingestionEventSize=this.getSize(t),t}bufferItemThresholdReached(t){return t+this.ingestionEventSize>=this.maxBufferItemCapacityBytes||this.currentIngestionEvent.payloads.length===i.MAX_PAYLOAD_ITEMS}getSize(t){let e=0;if(typeof t=="object")for(let[r,n]of Object.entries(t))e+=this.getPrimitiveSize(r),e+=this.getSize(n);else e+=this.getPrimitiveSize(t);return e}getPrimitiveSize(t){let e=0;return typeof t=="string"?e+=t.length*2:typeof t=="number"&&(e+=8),e}isFull(){return this.bufferSize===this.maxBufferCapacityBytes||this.buffer.length===this.totalBufferItems}isEmpty(){return this.buffer.length===0||this.bufferSize===0}getItems(t,e=0){return this.isEmpty()?[]:(t=Math.min(this.buffer.length,t+1),this.buffer.splice(e,t))}makeBeaconRequestBody(t){let e={metadata:this.metadata,events:t,authorization:this.authenticationToken};return JSON.stringify(e)}makeRequestBody(t){let e={metadata:this.metadata,events:t};return JSON.stringify(e)}sendEventImmediately(t){return Ls(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - important event received ${JSON.stringify(t)}`);let{name:e,ts:r,attributes:n}=t,o={type:this.type,v:this.v,payloads:[Object.assign({name:e,ts:r},n)]},s=!1,a=null,l=this.makeRequestBody([o]);try{if(a=yield this.send(l),a.ok){try{let c=yield a.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - send successful event: ${l}, message: ${JSON.stringify(c)}`)}catch(c){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Error reading OK response ${c} for event ${l}`)}return}else this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Failed to send an important event ${l} with response status ${a.status}`),s=!0}catch(c){this.logger.warn(`Event Reporting - There may be a failure in sending an important event ${l} to the ingestion endpoint ${c}.`),s=!0;try{if(this.metadata.browserName.toLowerCase()==="firefox"){let d=this.makeBeaconRequestBody([o]);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - beaconing data out ${d}`),navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,d)?s=!1:s=!0}}catch{this.logger.warn(`Event Reporting - Error sending beacon for an important event ${l}`),s=!0}}s&&(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - pushing to failed events ${l}`),this.failedIngestionEvents.push(o))})}send(t){return Ls(this,void 0,void 0,function*(){let e=new pK.default(i.RETRY_FIXED_BACKOFF_WAIT_MS,i.RETRY_SHORT_BACKOFF_MS,i.RETRY_LONG_BACKOFF_MS);try{let r=0;for(;r<this.retryCountLimit;){let n=yield fetch(this.ingestionURL,{method:"POST",headers:{Authorization:`Bearer ${this.authenticationToken}`},body:t});if(n.ok||!i.SENDING_FAILURE_CODES.has(n.status))return n;if(this.logger.warn(`Will retry sending failure for ${t} due to status code ${n.status}.`),r++,r<this.retryCountLimit){let o=e.nextBackoffAmountMs();yield SK.wait(o)}}if(r===this.retryCountLimit)throw new Error(`Retry count limit reached for ${t}`)}catch(r){throw r}})}sendBeacon(){return Ls(this,void 0,void 0,function*(){let t=this.buffer;if(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out buffer events ${JSON.stringify(t)}`),this.buffer=[],this.currentIngestionEvent.payloads.length>0){let r=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);t.push(r),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out current ingestion event ${JSON.stringify(r)}`),this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent()}if(this.failedIngestionEvents.length>0){let r=this.failedIngestionEvents.map(n=>this.deepCopyCurrentIngestionEvent(n));t.push(...r),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out any failed ingestion event ${JSON.stringify(r)}`),this.failedIngestionEvents=[]}if(this.cancellableEvents.size>0&&(this.cancellableEvents.forEach(r=>{t.push(...r),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out each cancellable event ${JSON.stringify(r)}`)}),this.cancellableEvents.clear()),t.length===0)return;let e=this.makeBeaconRequestBody(t);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - beacon data to send ${e}`);try{navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,e)||this.logger.warn(`Event Reporting - Browser failed to queue beacon data ${e}`)}catch(r){this.logger.warn(`Event Reporting - Sending beacon data ${e} failed with error ${r}`)}})}reset(){this.maxBufferCapacityBytes=0,this.totalBufferItems=0,this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.lock=!1,this.beaconEventListener=void 0,this.cancellableEvents.clear()}destroy(){return Ls(this,void 0,void 0,function*(){this.stop(),this.reset()})}};qi.default=Ui;Ui.SENDING_FAILURE_CODES=new Set([408,429,500,502,503,504]);Ui.RETRY_FIXED_BACKOFF_WAIT_MS=0;Ui.RETRY_SHORT_BACKOFF_MS=1e3;Ui.RETRY_LONG_BACKOFF_MS=15e3;Ui.MAX_PAYLOAD_ITEMS=2;Ui.MAX_ITEM_SIZE_BYTES_ALLOWED=3e3});var Kw=y(to=>{"use strict";var jO=to&&to.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},yK=to&&to.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(to,"__esModule",{value:!0});var vK=mc(),bK=yK(Ww()),Gw=class{constructor(t,e){this.reportingEvents=!1,this.importantEvents=["meetingEnded","meetingFailed","meetingStartFailed","audioInputFailed","videoInputFailed","meetingStartSucceeded","deviceLabelTriggerFailed"],this.destroyed=!1;let{eventsClientConfiguration:r,ingestionURL:n,eventBufferConfiguration:o}=t,{eventsToIgnore:s}=r;this.eventBuffer=new bK.default(o,r,n,this.importantEvents,e),this.logger=e,this.eventsToIgnore=s,this.start()}start(){if(!this.reportingEvents)try{this.eventBuffer.start(),this.logger.info("Event reporting started"),this.reportingEvents=!0}catch(t){this.logger.error(`Event Reporting - Error starting the event buffer ${t}`)}}stop(){if(this.reportingEvents)try{this.eventBuffer.stop(),this.logger.info("Event reporting stopped"),this.reportingEvents=!1}catch(t){this.logger.error(`Event Reporting - Error stopping the event buffer ${t}`)}}reportEvent(t,e,r){return jO(this,void 0,void 0,function*(){if(this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - event received in reportEvent ${t}, ${e}, ${JSON.stringify(r)}`),this.eventsToIgnore.includes(e)){this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - ${e} event will be ignored as it is in events to ignore`);return}try{this.logger.debug("Event Reporting - DefaultMeetingEventReporter - adding item to event buffer"),yield this.eventBuffer.addItem({ts:t,name:e,attributes:r})}catch(n){this.logger.error(`Event Reporting - Error adding event to buffer ${n}`)}})}destroy(){return jO(this,void 0,void 0,function*(){this.destroyed=!0,this.stop(),vK.isDestroyable(this.eventBuffer)&&this.eventBuffer.destroy(),this.eventBuffer=void 0})}};to.default=Gw});var Xw=y(Qw=>{"use strict";Object.defineProperty(Qw,"__esModule",{value:!0});var Jw=class{constructor(t,e,r,n=[]){this.type="Meet",this.v=1,this.meetingId=t,this.attendeeId=e,this.eventsToIgnore=n,this.authenticationToken=r}getAuthenticationToken(){return this.authenticationToken}toJSON(){let t={};return t.type=this.type,t.v=this.v,t.meetingId=this.meetingId,t.attendeeId=this.attendeeId,t}};Qw.default=Jw});var WO=y(Yw=>{"use strict";Object.defineProperty(Yw,"__esModule",{value:!0});var wK=i=>{let t={};for(let[e,r]of Object.entries(i))if(!(r==null||r===""))if(typeof r=="number"||typeof r=="string")t[e]=r;else throw new TypeError("Unhandled type received while flattening attributes.");return t};Yw.default=wK});var Gf=y(io=>{"use strict";var Zw=io&&io.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Fs=io&&io.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(io,"__esModule",{value:!0});var CK=wu(),_K=mc(),TK=Fs(qw()),EK=Fs(Kw()),IK=Fs(Xw()),AK=Fs(wt()),GO=Fs(Vt()),kK=Fs(WO()),Wf=class i{constructor(t,e,r){var n,o,s,a,l,c,d;this.meetingHistoryStates=[],this.observerSet=new Set,this.destroyed=!1,this.logger=e,this.configuration=t,this.setupEventReporter(t,e,r);try{this.parserResult=navigator&&navigator.userAgent?new CK.UAParser(navigator.userAgent).getResult():null}catch(u){this.logger.error(u.message)}this.browserMajorVersion=((s=(o=(n=this.parserResult)===null||n===void 0?void 0:n.browser)===null||o===void 0?void 0:o.version)===null||s===void 0?void 0:s.split(".")[0])||i.UNAVAILABLE,this.browserName=((a=this.parserResult)===null||a===void 0?void 0:a.browser.name)||i.UNAVAILABLE,this.browserVersion=((l=this.parserResult)===null||l===void 0?void 0:l.browser.version)||i.UNAVAILABLE,this.deviceName=[((c=this.parserResult)===null||c===void 0?void 0:c.device.vendor)||"",((d=this.parserResult)===null||d===void 0?void 0:d.device.model)||""].join(" ").trim()||i.UNAVAILABLE}addObserver(t){this.observerSet.add(t)}removeObserver(t){this.observerSet.delete(t)}forEachObserver(t){for(let e of this.observerSet)AK.default.nextTick(()=>{this.observerSet.has(e)&&t(e)})}publishEvent(t,e){return Zw(this,void 0,void 0,function*(){let r=Date.now();this.meetingHistoryStates.push({name:t,timestampMs:r});let n=Object.freeze(Object.assign(this.getAttributes(r),e));this.forEachObserver(o=>{o.eventDidReceive(t,n)}),this.reportEvent(t,r,e)})}reportEvent(t,e,r){var n;return Zw(this,void 0,void 0,function*(){let o;try{r&&(o=kK.default(r)),yield(n=this.eventReporter)===null||n===void 0?void 0:n.reportEvent(e,t,o)}catch(s){this.logger.error(`Error reporting event ${s}`)}})}setupEventReporter(t,e,r){if(r)this._eventReporter=r;else if(t.urls){let n=t.urls.eventIngestionURL;if(n){this.logger.info("Event ingestion URL is present in the configuration");let{meetingId:o,credentials:{attendeeId:s,joinToken:a}}=t,l=new IK.default(o,s,a),c=new TK.default(l,n);this._eventReporter=new EK.default(c,e)}}}getAttributes(t){var e,r;return{attendeeId:this.configuration.credentials.attendeeId,browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,externalMeetingId:typeof this.configuration.externalMeetingId=="string"?this.configuration.externalMeetingId:"",externalUserId:this.configuration.credentials.externalUserId,meetingHistory:this.meetingHistoryStates,meetingId:this.configuration.meetingId,osName:((e=this.parserResult)===null||e===void 0?void 0:e.os.name)||i.UNAVAILABLE,osVersion:((r=this.parserResult)===null||r===void 0?void 0:r.os.version)||i.UNAVAILABLE,sdkVersion:GO.default.sdkVersion,sdkName:GO.default.sdkName,timestampMs:t}}get eventReporter(){return this._eventReporter}destroy(){return Zw(this,void 0,void 0,function*(){_K.isDestroyable(this.eventReporter)&&(yield this.eventReporter.destroy()),this.logger=void 0,this.configuration=void 0,this._eventReporter=void 0,this.destroyed=!0})}};io.default=Wf;Wf.UNAVAILABLE="Unavailable"});var iC=y(tC=>{"use strict";Object.defineProperty(tC,"__esModule",{value:!0});var eC=class{constructor(){this.timeoutMs=1e4,this.waitDurationMs=3e3,this.audioOutputFrequency=440,this.audioOutputGain=.1}};tC.default=eC});var KO=y(ro=>{"use strict";var Re=ro&&ro.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},tt=ro&&ro.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ro,"__esModule",{value:!0});var MK=tt(Ku()),xK=tt(We()),rC=tt($u()),Kf=tt(Uu()),OK=tt(_e()),PK=tt(If()),yc=tt(Um()),nC=tt(qm()),oC=tt(Hm()),Jf=tt(zm()),vc=tt($m()),Qf=tt(jm()),Xf=tt(Wm()),bc=tt(Gm()),sC=tt(Km()),RK=tt(iC()),aC=class i{constructor(t,e,r=new RK.default){this.logger=t,this.meetingSession=e,this.configuration=r,this.browserBehavior=new xK.default}static delay(t){return Re(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,t))})}checkAudioInput(t){return Re(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startAudioInput(t),yield this.meetingSession.audioVideo.stopAudioInput(),nC.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Audio input check failed with error ${e}`),e instanceof Kf.default?nC.default.PermissionDenied:nC.default.Failed}})}checkAudioOutput(t,e,r=null){return Re(this,void 0,void 0,function*(){try{let n=t?rC.default.getIntrinsicDeviceId(t):"";return yield this.playTone(n,this.configuration.audioOutputFrequency,r),(yield e())?oC.default.Succeeded:oC.default.Failed}catch(n){return this.logger.error(`MeetingReadinessChecker: Audio output check failed with error: ${n}`),oC.default.Failed}finally{this.stopTone()}})}playTone(t,e,r){return Re(this,void 0,void 0,function*(){let o=this.configuration.audioOutputGain;this.oscillatorNode&&this.stopTone(),this.audioContext=rC.default.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.oscillatorNode=this.audioContext.createOscillator(),this.oscillatorNode.frequency.value=e,this.oscillatorNode.connect(this.gainNode),this.destinationStream=this.audioContext.createMediaStreamDestination(),this.gainNode.connect(this.destinationStream);let a=this.audioContext.currentTime+.1;this.gainNode.gain.linearRampToValueAtTime(0,a),this.gainNode.gain.linearRampToValueAtTime(o,a+.1),this.oscillatorNode.start();let l=new MK.default(this.logger);try{this.browserBehavior.supportsSetSinkId()&&(yield l.bindAudioDevice({deviceId:t}))}catch(c){this.logger.error(`Failed to bind audio device: ${c}`)}try{yield l.bindAudioElement(r||new Audio)}catch(c){this.logger.error(`Failed to bind audio element: ${c}`)}yield l.bindAudioStream(this.destinationStream.stream)})}stopTone(){if(!this.audioContext||!this.gainNode||!this.oscillatorNode||!this.destinationStream)return;let t=1,e=.1,r=this.configuration.audioOutputGain,n=this.audioContext.currentTime;this.gainNode.gain.linearRampToValueAtTime(r,n+e+t),this.gainNode.gain.linearRampToValueAtTime(0,n+e*2+t),this.oscillatorNode.stop(),this.oscillatorNode.disconnect(this.gainNode),this.gainNode.disconnect(this.destinationStream),this.oscillatorNode=null,this.gainNode=null,this.destinationStream=null}checkVideoInput(t){return Re(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startVideoInput(t),yield this.meetingSession.audioVideo.stopVideoInput(),sC.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Video check failed with error ${e}`),e instanceof Kf.default?sC.default.PermissionDenied:sC.default.Failed}})}checkCameraResolution(t,e,r){return Re(this,void 0,void 0,function*(){let n;try{let o=rC.default.getIntrinsicDeviceId(t),s={video:this.calculateVideoConstraint(o,e,r)};n=yield navigator.mediaDevices.getUserMedia(s)}catch(o){return this.logger.error(`MeetingReadinessChecker: Camera resolution check with width: ${e} height ${r} failed with error ${o}`),o&&o.name==="OverconstrainedError"?Jf.default.ResolutionNotSupported:o&&o.name==="NotAllowedError"?Jf.default.PermissionDenied:Jf.default.Failed}finally{n&&n.getTracks().forEach(function(o){o.stop()})}return Jf.default.Succeeded})}calculateVideoConstraint(t,e,r){let n=this.browserBehavior.requiresResolutionAlignment(e,r),o={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?(o.deviceId=t,o.width=e,o.height=r):(o.deviceId={exact:t},o.width={exact:n[0]},o.height={exact:n[1]}),o}checkContentShareConnectivity(t){return Re(this,void 0,void 0,function*(){let e=!1,r=!1,n={contentShareDidStart:()=>{e=!0}},o={audioVideoDidStart:()=>{r=!0}};try{return this.meetingSession.audioVideo.addObserver(o),this.meetingSession.audioVideo.start(),this.meetingSession.audioVideo.addContentShareObserver(n),yield this.meetingSession.audioVideo.startContentShareFromScreenCapture(t),yield this.executeTimeoutTask(()=>Re(this,void 0,void 0,function*(){return r&&e})),r?(yield this.stopMeeting(),e?vc.default.Succeeded:vc.default.TimedOut):vc.default.ConnectionFailed}catch(s){return this.logger.error(`MeetingReadinessChecker: Content share check failed with error ${s}`),s.name==="NotAllowedError"?vc.default.PermissionDenied:vc.default.Failed}finally{this.meetingSession.audioVideo.removeObserver(o),this.meetingSession.audioVideo.stopContentShare(),this.meetingSession.audioVideo.removeContentShareObserver(n)}})}checkAudioConnectivity(t){return Re(this,void 0,void 0,function*(){let e=!1,r={packetsReceived:0},n=this.meetingSession.audioVideo,o={metricsDidReceive(a){a.getRTCStatsReport().forEach(l=>{l.type==="inbound-rtp"&&(l.mediaType==="audio"||l.kind==="audio")&&(r.packetsReceived=l.packetsReceived)})}},s=(a,l,c,d)=>{a===this.meetingSession.configuration.credentials.attendeeId&&l&&(e=!0)};try{yield n.startAudioInput(t)}catch(a){return this.logger.error(`MeetingReadinessChecker: Failed to get audio input device with error ${a}`),a instanceof Kf.default?yc.default.AudioInputPermissionDenied:yc.default.AudioInputRequestFailed}return n.realtimeSubscribeToAttendeeIdPresence(s),n.addObserver(o),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>Re(this,void 0,void 0,function*(){return this.isAudioConnectionSuccessful(e,r)})),n.removeObserver(o),n.realtimeUnsubscribeToAttendeeIdPresence(s),yield this.stopMeeting(),yield this.meetingSession.audioVideo.stopAudioInput(),this.isAudioConnectionSuccessful(e,r)?yc.default.Succeeded:yc.default.AudioNotReceived):(n.removeObserver(o),n.realtimeUnsubscribeToAttendeeIdPresence(s),yield this.meetingSession.audioVideo.stopAudioInput(),yc.default.ConnectionFailed)})}checkVideoConnectivity(t){return Re(this,void 0,void 0,function*(){let e=this.meetingSession.audioVideo,r=0,n={metricsDidReceive(o){o.getRTCStatsReport().forEach(a=>{a.type==="outbound-rtp"&&(a.mediaType==="video"||a.kind==="video")&&(r=a.packetsSent)})}};try{yield e.startVideoInput(t)}catch(o){return this.logger.error(`MeetingReadinessChecker: Failed to get video input device with error ${o}`),o instanceof Kf.default?bc.default.VideoInputPermissionDenied:bc.default.VideoInputRequestFailed}return e.addObserver(n),(yield this.startMeeting())?(e.startLocalVideoTile(),yield this.executeTimeoutTask(()=>Re(this,void 0,void 0,function*(){return r>0})),yield e.stopVideoInput(),yield this.stopMeeting(),e.removeObserver(n),r<=0?bc.default.VideoNotSent:bc.default.Succeeded):bc.default.ConnectionFailed})}checkNetworkUDPConnectivity(){return Re(this,void 0,void 0,function*(){let t=!1,e={metricsDidReceive(n){n.getRTCStatsReport().forEach(s=>{s.type==="candidate-pair"&&s.state==="succeeded"&&(t=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(n){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${n}`),Xf.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=n=>{let o=this.originalURLRewriter(n);return o.includes("transport=tcp")?"":o};let r=this.meetingSession.audioVideo;return r.addObserver(e),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>Re(this,void 0,void 0,function*(){return t})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),r.removeObserver(e),t?Xf.default.Succeeded:Xf.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,Xf.default.ConnectionFailed)})}checkNetworkTCPConnectivity(){return Re(this,void 0,void 0,function*(){let t=!1,e={metricsDidReceive(n){n.getRTCStatsReport().forEach(s=>{s.type==="candidate-pair"&&s.state==="succeeded"&&(t=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(n){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${n}`),Qf.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=n=>{let o=this.originalURLRewriter(n);return o.includes("transport=udp")?"":o};let r=this.meetingSession.audioVideo;return r.addObserver(e),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>Re(this,void 0,void 0,function*(){return t})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),r.removeObserver(e),t?Qf.default.Succeeded:Qf.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,Qf.default.ConnectionFailed)})}startMeeting(){return Re(this,void 0,void 0,function*(){let t=!1,e={audioVideoDidStart:()=>{t=!0}};return this.meetingSession.audioVideo.addObserver(e),this.meetingSession.audioVideo.start(),yield this.executeTimeoutTask(()=>Re(this,void 0,void 0,function*(){return t})),this.meetingSession.audioVideo.removeObserver(e),t})}stopMeeting(){return Re(this,void 0,void 0,function*(){let t=!1,e={audioVideoDidStop:r=>{t=!0}};return this.meetingSession.audioVideo.addObserver(e),this.meetingSession.audioVideo.stop(),yield this.executeTimeoutTask(()=>Re(this,void 0,void 0,function*(){return t})),this.meetingSession.audioVideo.removeObserver(e),t})}executeTimeoutTask(t){return Re(this,void 0,void 0,function*(){let e=!1;class r extends OK.default{constructor(s,a){super(s),this.waitDurationMs=a,this.isCancelled=!1}cancel(){this.isCancelled=!0}run(){return Re(this,void 0,void 0,function*(){for(;!this.isCancelled;){if(yield t()){e=!0;break}yield i.delay(this.waitDurationMs)}})}}return yield new PK.default(this.logger,new r(this.logger,this.configuration.waitDurationMs),this.configuration.timeoutMs).run(),e})}isAudioConnectionSuccessful(t,e){return t&&e.packetsReceived>0}};ro.default=aC});var Cc=y(wc=>{"use strict";var DK=wc&&wc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(wc,"__esModule",{value:!0});var NK=DK(Ro()),dC=class i{constructor(t,e){this.reconnectTimeoutMs=t,this.backoffPolicy=e,this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this._isFirstConnection=!0,this.backoffTimer=null,this.backoffCancel=null,this.reset()}timeSpentReconnectingMs(){return this.firstConnectionAttempted?Date.now()-this.firstConnectionAttemptTimestampMs:0}hasPastReconnectDeadline(){return Date.now()-this.lastActiveTimestampMs>=this.reconnectTimeoutMs?!0:this.timeSpentReconnectingMs()>=this.reconnectTimeoutMs}reset(){this.cancel(),this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this.backoffPolicy.reset()}startedConnectionAttempt(t){this._isFirstConnection=t,this.firstConnectionAttempted||(this.firstConnectionAttempted=!0,this.firstConnectionAttemptTimestampMs=Date.now())}hasStartedConnectionAttempt(){return this.firstConnectionAttempted}isFirstConnection(){return this._isFirstConnection}disableReconnect(){this.shouldReconnect=!1}enableRestartPeerConnection(){this.onlyRestartPeerConnection=!0}cancel(){this.disableReconnect(),this.backoffTimer&&(this.backoffTimer.stop(),this.backoffCancel&&(this.backoffCancel(),this.backoffCancel=null))}retryWithBackoff(t,e){let r=this.shouldReconnect&&!this.hasPastReconnectDeadline();return r&&(this.backoffCancel=e,this.backoffTimer=new NK.default(this.backoffPolicy.nextBackoffAmountMs()),this.backoffTimer.start(()=>{this.backoffCancel=null,t()})),r}shouldOnlyRestartPeerConnection(){return this.onlyRestartPeerConnection}clone(){return new i(this.reconnectTimeoutMs,this.backoffPolicy)}setLastActiveTimestampMs(t){this.lastActiveTimestampMs=t}};wc.default=dC});var Tc=y(_c=>{"use strict";var JO=_c&&_c.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(_c,"__esModule",{value:!0});var LK=JO(Vt()),Bs=JO(sd()),cC=class{constructor(t){this.logger=t}create(t,e,r){this.connection=new WebSocket(r?t:LK.default.urlWithVersion(t),e),this.connection.binaryType="arraybuffer"}send(t){if(!this.connection)return this.logger.error("WebSocket not yet created or already destroyed."),!1;try{return t instanceof Uint8Array?this.connection.send(t.buffer):this.connection.send(t),!0}catch(e){return this.logger.debug(()=>`send error: ${e.message}, websocket state=${Bs.default[this.readyState()]}`),!1}}close(t,e){var r;(r=this.connection)===null||r===void 0||r.close(t,e)}destroy(){this.connection=void 0}addEventListener(t,e){if(!this.connection){this.logger.warn("Cannot add event listener with no WebSocket connection.");return}this.connection.addEventListener(t,e)}removeEventListener(t,e){var r;(r=this.connection)===null||r===void 0||r.removeEventListener(t,e)}readyState(){if(!this.connection)return Bs.default.None;switch(this.connection.readyState){case WebSocket.CONNECTING:return Bs.default.Connecting;case WebSocket.OPEN:return Bs.default.Open;case WebSocket.CLOSING:return Bs.default.Closing;case WebSocket.CLOSED:return Bs.default.Closed}}};_c.default=cC});var tP=y(no=>{"use strict";var FK=no&&no.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},vi=no&&no.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(no,"__esModule",{value:!0});var QO=vi(Uf()),BK=vi(ww()),XO=vi(Ar()),VK=vi(We()),UK=vi(SS()),YO=vi(Lw()),lC=vi(Ou()),uC=mc(),qK=vi(Gf()),ZO=vi(Cc()),eP=vi(Tc()),fC=class{constructor(t,e,r,n){this._eventController=n,this._configuration=t,this._logger=e,this.checkBrowserSupportAndFeatureConfiguration(),lC.default.addLogger(this._logger),lC.default.register(),this._eventController||(this._eventController=new qK.default(t,e)),r.eventController||(r.eventController=this.eventController),this.audioVideoController=new QO.default(this._configuration,this._logger,new eP.default(this._logger),r,new ZO.default(this._configuration.reconnectTimeoutMs,new XO.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs)),this.eventController),this._deviceController=r,this.logger.info(`MeetingFeatures: ${JSON.stringify(t.meetingFeatures)}`);let o=new UK.default(this._logger);this.contentShareController=new YO.default(o,new QO.default(YO.default.createContentShareMeetingSessionConfigure(this._configuration),this._logger,new eP.default(this._logger),o,new ZO.default(this._configuration.reconnectTimeoutMs,new XO.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs))),this.audioVideoController),this.audioVideoFacade=new BK.default(this.audioVideoController,this.audioVideoController.videoTileController,this.audioVideoController.realtimeController,this.audioVideoController.audioMixController,this._deviceController,this.contentShareController)}get configuration(){return this._configuration}get logger(){return this._logger}get audioVideo(){return this.audioVideoFacade}get contentShare(){return this.contentShareController}get deviceController(){return this._deviceController}get eventController(){return this._eventController}destroy(){return FK(this,void 0,void 0,function*(){uC.isDestroyable(this.contentShareController)&&(yield this.contentShareController.destroy()),uC.isDestroyable(this.audioVideoController)&&(yield this.audioVideoController.destroy()),uC.isDestroyable(this.eventController)&&(yield this.eventController.destroy()),lC.default.removeLogger(this._logger),this._logger=void 0,this._configuration=void 0,this._deviceController=void 0,this.audioVideoFacade=void 0,this.audioVideoController=void 0,this.contentShareController=void 0,this._eventController=void 0})}checkBrowserSupportAndFeatureConfiguration(){let t=new VK.default,e=`${t.name()} ${t.majorVersion()} (${t.version()})`;if(this.logger.info(`browser is ${e}`),t.isSupported()||this.logger.warn(`this browser is not currently supported. Stability may suffer. Supported browsers are: ${t.supportString()}.`),this._configuration.videoUplinkBandwidthPolicy)if(this.isSimulcastUplinkPolicy(this._configuration.videoUplinkBandwidthPolicy)){if(!t.hasChromiumWebRTC())throw new Error("Simulcast is only supported on Chromium-based browsers");this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0}else this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1;this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&(t.hasChromiumWebRTC()?this.logger.info(`Simulcast is enabled for ${t.name()}`):(this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.logger.info("Simulcast is only supported on Chromium-based browsers")),this._configuration.enableSVC&&(this._configuration.enableSVC=!1,this.logger.info("SVC is not successfully enabled since simulcast is enabled"))),this._configuration.enableSVC&&!t.supportsScalableVideoCoding()&&(this._configuration.enableSVC=!1,this.logger.info("SVC is only supported on Chromium-based browsers with version 111 or above"))}isSimulcastUplinkPolicy(t){return!!(t&&t.addObserver)}};no.default=fC});var iP,rP,nP=h(()=>{iP=i=>({setHttpHandler(t){i.httpHandler=t},httpHandler(){return i.httpHandler},updateHttpClientConfig(t,e){i.httpHandler?.updateHttpClientConfig(t,e)},httpHandlerConfigs(){return i.httpHandler.httpHandlerConfigs()}}),rP=i=>({httpHandler:i.httpHandler()})});var oP=h(()=>{nP()});var sP=h(()=>{});var aP,dP=h(()=>{(function(i){i.HEADER="header",i.QUERY="query"})(aP||(aP={}))});var cP,lP=h(()=>{(function(i){i.HEADER="header",i.QUERY="query"})(cP||(cP={}))});var uP=h(()=>{});var fP=h(()=>{});var hP=h(()=>{});var pP=h(()=>{});var mP=h(()=>{dP();lP();uP();fP();hP();pP()});var gP=h(()=>{});var SP=h(()=>{});var yP=h(()=>{});var vP=h(()=>{});var bP=h(()=>{});var wP=h(()=>{});var CP=h(()=>{});var _P=h(()=>{bP();wP();CP()});var TP=h(()=>{});var EP=h(()=>{});var Vs,IP=h(()=>{(function(i){i.HTTP="http",i.HTTPS="https"})(Vs||(Vs={}))});var AP=h(()=>{});var kP=h(()=>{});var MP=h(()=>{});var xP=h(()=>{});var OP=h(()=>{});var PP=h(()=>{AP();kP();MP();xP();OP()});var RP=h(()=>{});var Us,DP=h(()=>{(function(i){i.MD5="md5",i.CRC32="crc32",i.CRC32C="crc32c",i.SHA1="sha1",i.SHA256="sha256"})(Us||(Us={}))});var NP=h(()=>{});var LP=h(()=>{});var FP=h(()=>{NP();LP();DP()});var BP=h(()=>{});var VP,UP=h(()=>{(function(i){i[i.HEADER=0]="HEADER",i[i.TRAILER=1]="TRAILER"})(VP||(VP={}))});var qP=h(()=>{});var HP=h(()=>{});var zP=h(()=>{});var $P=h(()=>{});var jP=h(()=>{});var WP=h(()=>{HP();zP();$P();jP()});var GP=h(()=>{});var Ec,KP=h(()=>{Ec="__smithy_context"});var JP=h(()=>{});var QP,XP=h(()=>{(function(i){i.PROFILE="profile",i.SSO_SESSION="sso-session",i.SERVICES="services"})(QP||(QP={}))});var YP=h(()=>{});var ZP=h(()=>{});var eR=h(()=>{});var tR=h(()=>{});var iR=h(()=>{});var rR=h(()=>{});var nR=h(()=>{});var oR=h(()=>{});var sR=h(()=>{});var aR=h(()=>{});var dR=h(()=>{});var cR,lR=h(()=>{(function(i){i.HTTP_0_9="http/0.9",i.HTTP_1_0="http/1.0",i.TDS_8_0="tds/8.0"})(cR||(cR={}))});var uR=h(()=>{});var fR=h(()=>{});var hR=h(()=>{});var pR=h(()=>{});var mR=h(()=>{});var gR=h(()=>{});var SR=h(()=>{});var Ic=h(()=>{sP();mP();gP();SP();yP();vP();_P();TP();EP();IP();PP();RP();FP();BP();UP();qP();WP();GP();KP();JP();XP();YP();ZP();eR();tR();iR();rR();nR();oR();sR();aR();dR();lR();uR();fR();hR();pR();mR();gR();SR()});var yR=h(()=>{});var vR=h(()=>{});var bR=h(()=>{});function HK(i){return Object.keys(i).reduce((t,e)=>{let r=i[e];return{...t,[e]:Array.isArray(r)?[...r]:r}},{})}var De,wR=h(()=>{De=class i{constructor(t){this.method=t.method||"GET",this.hostname=t.hostname||"localhost",this.port=t.port,this.query=t.query||{},this.headers=t.headers||{},this.body=t.body,this.protocol=t.protocol?t.protocol.slice(-1)!==":"?`${t.protocol}:`:t.protocol:"https:",this.path=t.path?t.path.charAt(0)!=="/"?`/${t.path}`:t.path:"/",this.username=t.username,this.password=t.password,this.fragment=t.fragment}static clone(t){let e=new i({...t,headers:{...t.headers}});return e.query&&(e.query=HK(e.query)),e}static isInstance(t){if(!t)return!1;let e=t;return"method"in e&&"protocol"in e&&"hostname"in e&&"path"in e&&typeof e.query=="object"&&typeof e.headers=="object"}clone(){return i.clone(this)}}});var Xt,CR=h(()=>{Xt=class{constructor(t){this.statusCode=t.statusCode,this.reason=t.reason,this.headers=t.headers||{},this.body=t.body}static isInstance(t){if(!t)return!1;let e=t;return typeof e.statusCode=="number"&&typeof e.headers=="object"}}});var _R=h(()=>{});var TR=h(()=>{});var nt=h(()=>{oP();yR();vR();bR();wR();CR();_R();TR()});var zK,$K,ER,IR=h(()=>{nt();zK=i=>t=>async e=>{if(!De.isInstance(e.request))return t(e);let{request:r}=e,{handlerProtocol:n=""}=i.requestHandler.metadata||{};if(n.indexOf("h2")>=0&&!r.headers[":authority"])delete r.headers.host,r.headers[":authority"]=r.hostname+(r.port?":"+r.port:"");else if(!r.headers.host){let o=r.hostname;r.port!=null&&(o+=`:${r.port}`),r.headers.host=o}return t(e)},$K={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},ER=i=>({applyToStack:t=>{t.add(zK(i),$K)}})});var jK,WK,AR,kR=h(()=>{jK=()=>(i,t)=>async e=>{try{let r=await i(e),{clientName:n,commandName:o,logger:s,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:l,overrideOutputFilterSensitiveLog:c}=a,d=l??t.inputFilterSensitiveLog,u=c??t.outputFilterSensitiveLog,{$metadata:f,...m}=r.output;return s?.info?.({clientName:n,commandName:o,input:d(e.input),output:u(m),metadata:f}),r}catch(r){let{clientName:n,commandName:o,logger:s,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:l}=a,c=l??t.inputFilterSensitiveLog;throw s?.error?.({clientName:n,commandName:o,input:c(e.input),error:r,metadata:r.$metadata}),r}},WK={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},AR=i=>({applyToStack:t=>{t.add(jK(),WK)}})});var MR=h(()=>{kR()});var hC,GK,KK,JK,QK,xR,OR=h(()=>{nt();hC="X-Amzn-Trace-Id",GK="AWS_LAMBDA_FUNCTION_NAME",KK="_X_AMZN_TRACE_ID",JK=i=>t=>async e=>{let{request:r}=e;if(!De.isInstance(r)||i.runtime!=="node")return t(e);let n=Object.keys(r.headers??{}).find(l=>l.toLowerCase()===hC.toLowerCase())??hC;if(r.headers.hasOwnProperty(n))return t(e);let o=process.env[GK],s=process.env[KK],a=l=>typeof l=="string"&&l.length>0;return a(o)&&a(s)&&(r.headers[hC]=s),t({...e,request:r})},QK={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},xR=i=>({applyToStack:t=>{t.add(JK(i),QK)}})});var PR=h(()=>{});var kr,RR=h(()=>{Ic();kr=i=>i[Ec]||(i[Ec]={})});var bt,DR=h(()=>{bt=i=>{if(typeof i=="function")return i;let t=Promise.resolve(i);return()=>t}});var Mr=h(()=>{RR();DR()});var NR,LR=h(()=>{NR=(i,t)=>{if(!t||t.length===0)return i;let e=[];for(let r of t)for(let n of i)n.schemeId.split("#")[1]===r&&e.push(n);for(let r of i)e.find(({schemeId:n})=>n===r.schemeId)||e.push(r);return e}});function XK(i){let t=new Map;for(let e of i)t.set(e.schemeId,e);return t}var FR,pC=h(()=>{Mr();LR();FR=(i,t)=>(e,r)=>async n=>{let o=i.httpAuthSchemeProvider(await t.httpAuthSchemeParametersProvider(i,r,n.input)),s=i.authSchemePreference?await i.authSchemePreference():[],a=NR(o,s),l=XK(i.httpAuthSchemes),c=kr(r),d=[];for(let u of a){let f=l.get(u.schemeId);if(!f){d.push(`HttpAuthScheme \`${u.schemeId}\` was not enabled for this service.`);continue}let m=f.identityProvider(await t.identityProviderConfigProvider(i));if(!m){d.push(`HttpAuthScheme \`${u.schemeId}\` did not have an IdentityProvider configured.`);continue}let{identityProperties:S={},signingProperties:T={}}=u.propertiesExtractor?.(i,r)||{};u.identityProperties=Object.assign(u.identityProperties||{},S),u.signingProperties=Object.assign(u.signingProperties||{},T),c.selectedHttpAuthScheme={httpAuthOption:u,identity:await m(u.identityProperties),signer:f.signer};break}if(!c.selectedHttpAuthScheme)throw new Error(d.join(`
`));return e(n)}});var YK,BR,VR=h(()=>{pC();YK={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},BR=(i,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:e})=>({applyToStack:r=>{r.addRelativeTo(FR(i,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:e}),YK)}})});var UR,mC,gC=h(()=>{nt();UR=(i,t)=>(e,r)=>async n=>{let{response:o}=await e(n);try{let s=await t(o,i);return{response:o,output:s}}catch(s){if(Object.defineProperty(s,"$response",{value:o}),!("$metadata"in s)){let a="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{s.message+=`
  `+a}catch{!r.logger||r.logger?.constructor?.name==="NoOpLogger"?console.warn(a):r.logger?.warn?.(a)}typeof s.$responseBodyText<"u"&&s.$response&&(s.$response.body=s.$responseBodyText);try{if(Xt.isInstance(o)){let{headers:l={}}=o,c=Object.entries(l);s.$metadata={httpStatusCode:o.statusCode,requestId:mC(/^x-[\w-]+-request-?id$/,c),extendedRequestId:mC(/^x-[\w-]+-id-2$/,c),cfId:mC(/^x-[\w-]+-cf-id$/,c)}}}catch{}}throw s}},mC=(i,t)=>(t.find(([e])=>e.match(i))||[void 0,void 0])[1]});var qR,SC=h(()=>{qR=(i,t)=>(e,r)=>async n=>{let o=i,s=r.endpointV2?.url&&o.urlParser?async()=>o.urlParser(r.endpointV2.url):o.endpoint;if(!s)throw new Error("No valid endpoint provider available.");let a=await t(n.input,{...i,endpoint:s});return e({...n,request:a})}});function x(i,t,e){return{applyToStack:r=>{r.add(UR(i,e),ZK),r.add(qR(i,t),Ac)}}}var ZK,Ac,HR=h(()=>{gC();SC();ZK={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},Ac={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0}});var Q=h(()=>{gC();HR();SC()});var sde,zR=h(()=>{Q();sde={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:Ac.name}});var $R=h(()=>{pC();VR();zR()});var e9,t9,jR,yC=h(()=>{nt();Mr();e9=i=>t=>{throw t},t9=(i,t)=>{},jR=i=>(t,e)=>async r=>{if(!De.isInstance(r.request))return t(r);let o=kr(e).selectedHttpAuthScheme;if(!o)throw new Error("No HttpAuthScheme was selected: unable to sign request");let{httpAuthOption:{signingProperties:s={}},identity:a,signer:l}=o,c=await t({...r,request:await l.sign(r.request,a,s)}).catch((l.errorHandler||e9)(s));return(l.successHandler||t9)(c.response,s),c}});var i9,WR,GR=h(()=>{yC();i9={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},WR=i=>({applyToStack:t=>{t.addRelativeTo(jR(i),i9)}})});var KR=h(()=>{yC();GR()});var oo,JR=h(()=>{oo=i=>{if(typeof i=="function")return i;let t=Promise.resolve(i);return()=>t}});function Pe(i,t,e,r,n){return async function*(s,a,...l){let c=a,d=s.startingToken??c[e],u=!0,f;for(;u;){if(c[e]=d,n&&(c[n]=c[n]??s.pageSize),s.client instanceof i)f=await r9(t,s.client,a,s.withCommand,...l);else throw new Error(`Invalid client, expected instance of ${i.name}`);yield f;let m=d;d=n9(f,r),u=!!(d&&(!s.stopOnSameToken||d!==m))}return void 0}}var r9,n9,QR=h(()=>{r9=async(i,t,e,r=o=>o,...n)=>{let o=new i(e);return o=r(o)??o,await t.send(o,...n)};n9=(i,t)=>{let e=i,r=t.split(".");for(let n of r){if(!e||typeof e!="object")return;e=e[n]}return e}});var Hi,so,xr,ao,XR,vC=h(()=>{Hi={},so=new Array(64);for(let i=0,t=65,e=90;i+t<=e;i++){let r=String.fromCharCode(i+t);Hi[r]=i,so[i]=r}for(let i=0,t=97,e=122;i+t<=e;i++){let r=String.fromCharCode(i+t),n=i+26;Hi[r]=n,so[n]=r}for(let i=0;i<10;i++){Hi[i.toString(10)]=i+52;let t=i.toString(10),e=i+52;Hi[t]=e,so[e]=t}Hi["+"]=62;so[62]="+";Hi["/"]=63;so[63]="/";xr=6,ao=8,XR=63});var qs,YR=h(()=>{vC();qs=i=>{let t=i.length/4*3;i.slice(-2)==="=="?t-=2:i.slice(-1)==="="&&t--;let e=new ArrayBuffer(t),r=new DataView(e);for(let n=0;n<i.length;n+=4){let o=0,s=0;for(let c=n,d=n+3;c<=d;c++)if(i[c]!=="="){if(!(i[c]in Hi))throw new TypeError(`Invalid character ${i[c]} in base64 string.`);o|=Hi[i[c]]<<(d-c)*xr,s+=xr}else o>>=xr;let a=n/4*3;o>>=s%ao;let l=Math.floor(s/ao);for(let c=0;c<l;c++){let d=(l-c-1)*ao;r.setUint8(a+c,(o&255<<d)>>d)}}return new Uint8Array(e)}});var Yt,bC=h(()=>{Yt=i=>new TextEncoder().encode(i)});var zi,ZR=h(()=>{bC();zi=i=>typeof i=="string"?Yt(i):ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(i)});var Hs,eD=h(()=>{Hs=i=>{if(typeof i=="string")return i;if(typeof i!="object"||typeof i.byteOffset!="number"||typeof i.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(i)}});var bi=h(()=>{bC();ZR();eD()});function Yf(i){let t;typeof i=="string"?t=Yt(i):t=i;let e=typeof t=="object"&&typeof t.length=="number",r=typeof t=="object"&&typeof t.byteOffset=="number"&&typeof t.byteLength=="number";if(!e&&!r)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let n="";for(let o=0;o<t.length;o+=3){let s=0,a=0;for(let c=o,d=Math.min(o+3,t.length);c<d;c++)s|=t[c]<<(d-c-1)*ao,a+=ao;let l=Math.ceil(a/xr);s<<=l*xr-a;for(let c=1;c<=l;c++){let d=(l-c)*xr;n+=so[(s&XR<<d)>>d]}n+="==".slice(0,4-l)}return n}var tD=h(()=>{bi();vC()});var Zf=h(()=>{YR();tD()});function iD(i,t="utf-8"){return t==="base64"?Yf(i):Hs(i)}function rD(i,t){return t==="base64"?$i.mutate(qs(i)):$i.mutate(Yt(i))}var nD=h(()=>{Zf();bi();wC()});var $i,wC=h(()=>{nD();$i=class i extends Uint8Array{static fromString(t,e="utf-8"){switch(typeof t){case"string":return rD(t,e);default:throw new Error(`Unsupported conversion from ${typeof t} to Uint8ArrayBlobAdapter.`)}}static mutate(t){return Object.setPrototypeOf(t,i.prototype),t}transformToString(t="utf-8"){return iD(this,t)}}});var oD=h(()=>{});var sD=h(()=>{});var aD=h(()=>{});var dD=h(()=>{});var cD=h(()=>{});var lD=h(()=>{});var wi,o9,uD=h(()=>{wi=i=>encodeURIComponent(i).replace(/[!'()*]/g,o9),o9=i=>`%${i.charCodeAt(0).toString(16).toUpperCase()}`});var fD=h(()=>{});var eh=h(()=>{uD();fD()});function hD(i){let t=[];for(let e of Object.keys(i).sort()){let r=i[e];if(e=wi(e),Array.isArray(r))for(let n=0,o=r.length;n<o;n++)t.push(`${e}=${wi(r[n])}`);else{let n=e;(r||typeof r=="string")&&(n+=`=${wi(r)}`),t.push(n)}}return t.join("&")}var pD=h(()=>{eh()});function CC(i,t){return new Request(i,t)}var mD=h(()=>{});function gD(i=0){return new Promise((t,e)=>{i&&setTimeout(()=>{let r=new Error(`Request did not complete within ${i} ms`);r.name="TimeoutError",e(r)},i)})}var SD=h(()=>{});var _C,th,yD=h(()=>{nt();pD();mD();SD();_C={supported:void 0},th=class i{static create(t){return typeof t?.handle=="function"?t:new i(t)}constructor(t){typeof t=="function"?this.configProvider=t().then(e=>e||{}):(this.config=t??{},this.configProvider=Promise.resolve(this.config)),_C.supported===void 0&&(_C.supported=typeof Request<"u"&&"keepalive"in CC("https://[::1]"))}destroy(){}async handle(t,{abortSignal:e,requestTimeout:r}={}){this.config||(this.config=await this.configProvider);let n=r??this.config.requestTimeout,o=this.config.keepAlive===!0,s=this.config.credentials;if(e?.aborted){let I=new Error("Request aborted");return I.name="AbortError",Promise.reject(I)}let a=t.path,l=hD(t.query||{});l&&(a+=`?${l}`),t.fragment&&(a+=`#${t.fragment}`);let c="";if(t.username!=null||t.password!=null){let I=t.username??"",A=t.password??"";c=`${I}:${A}@`}let{port:d,method:u}=t,f=`${t.protocol}//${c}${t.hostname}${d?`:${d}`:""}${a}`,m=u==="GET"||u==="HEAD"?void 0:t.body,S={body:m,headers:new Headers(t.headers),method:u,credentials:s};this.config?.cache&&(S.cache=this.config.cache),m&&(S.duplex="half"),typeof AbortController<"u"&&(S.signal=e),_C.supported&&(S.keepalive=o),typeof this.config.requestInit=="function"&&Object.assign(S,this.config.requestInit(t));let T=()=>{},_=CC(f,S),C=[fetch(_).then(I=>{let A=I.headers,E={};for(let W of A.entries())E[W[0]]=W[1];return I.body!=null?{response:new Xt({headers:E,reason:I.statusText,statusCode:I.status,body:I.body})}:I.blob().then(W=>({response:new Xt({headers:E,reason:I.statusText,statusCode:I.status,body:W})}))}),gD(n)];return e&&C.push(new Promise((I,A)=>{let E=()=>{let V=new Error("Request aborted");V.name="AbortError",A(V)};if(typeof e.addEventListener=="function"){let V=e;V.addEventListener("abort",E,{once:!0}),T=()=>V.removeEventListener("abort",E)}else e.onabort=E})),Promise.race(C).finally(T)}updateHttpClientConfig(t,e){this.config=void 0,this.configProvider=this.configProvider.then(r=>(r[t]=e,r))}httpHandlerConfigs(){return this.config??{}}}});async function s9(i){let t=await d9(i),e=qs(t);return new Uint8Array(e)}async function a9(i){let t=[],e=i.getReader(),r=!1,n=0;for(;!r;){let{done:a,value:l}=await e.read();l&&(t.push(l),n+=l.length),r=a}let o=new Uint8Array(n),s=0;for(let a of t)o.set(a,s),s+=a.length;return o}function d9(i){return new Promise((t,e)=>{let r=new FileReader;r.onloadend=()=>{if(r.readyState!==2)return e(new Error("Reader aborted too early"));let n=r.result??"",o=n.indexOf(","),s=o>-1?o+1:n.length;t(n.substring(s))},r.onabort=()=>e(new Error("Read aborted")),r.onerror=()=>e(r.error),r.readAsDataURL(i)})}var vD,bD=h(()=>{Zf();vD=async i=>typeof Blob=="function"&&i instanceof Blob||i.constructor?.name==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await i.arrayBuffer()):s9(i):a9(i)});var wD=h(()=>{yD();bD()});function _D(i){if(i.length%2!==0)throw new Error("Hex encoded strings must have an even number length");let t=new Uint8Array(i.length/2);for(let e=0;e<i.length;e+=2){let r=i.slice(e,e+2).toLowerCase();if(r in TC)t[e/2]=TC[r];else throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`)}return t}function Ot(i){let t="";for(let e=0;e<i.byteLength;e++)t+=CD[i[e]];return t}var CD,TC,zs=h(()=>{CD={},TC={};for(let i=0;i<256;i++){let t=i.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),CD[i]=t,TC[t]=i}});var TD=h(()=>{});var ED=h(()=>{});var ID=h(()=>{wC();oD();aD();dD();cD();lD();TD();ED();sD()});var ot,AD=h(()=>{ID();ot=async(i=new Uint8Array,t)=>{if(i instanceof Uint8Array)return $i.mutate(i);if(!i)return $i.mutate(new Uint8Array);let e=t.streamCollector(i);return $i.mutate(await e)}});function EC(i){return encodeURIComponent(i).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}var IC=h(()=>{});var kc,AC=h(()=>{kc=i=>typeof i=="function"?i():i});var kD=h(()=>{});var kC,MD=h(()=>{kC=class i{constructor(t,e=new Map){this.namespace=t,this.schemas=e}static for(t){return i.registries.has(t)||i.registries.set(t,new i(t)),i.registries.get(t)}register(t,e){let r=this.normalizeShapeId(t);i.for(this.getNamespace(t)).schemas.set(r,e)}getSchema(t){let e=this.normalizeShapeId(t);if(!this.schemas.has(e))throw new Error(`@smithy/core/schema - schema not found for ${e}`);return this.schemas.get(e)}getBaseException(){for(let[t,e]of this.schemas.entries())if(t.startsWith("smithy.ts.sdk.synthetic.")&&t.endsWith("ServiceException"))return e}find(t){return[...this.schemas.values()].find(t)}destroy(){i.registries.delete(this.namespace),this.schemas.clear()}normalizeShapeId(t){return t.includes("#")?t:this.namespace+"#"+t}getNamespace(t){return this.normalizeShapeId(t).split("#")[0]}};kC.registries=new Map});var Ci,$s=h(()=>{Ci=class{constructor(t,e){this.name=t,this.traits=e}}});var Mc,MC=h(()=>{$s();Mc=class i extends Ci{constructor(t,e,r){super(t,e),this.name=t,this.traits=e,this.valueSchema=r,this.symbol=i.symbol}static[Symbol.hasInstance](t){let e=i.prototype.isPrototypeOf(t);return!e&&typeof t=="object"&&t!==null?t.symbol===i.symbol:e}};Mc.symbol=Symbol.for("@smithy/core/schema::ListSchema")});var xc,xC=h(()=>{$s();xc=class i extends Ci{constructor(t,e,r,n){super(t,e),this.name=t,this.traits=e,this.keySchema=r,this.valueSchema=n,this.symbol=i.symbol}static[Symbol.hasInstance](t){let e=i.prototype.isPrototypeOf(t);return!e&&typeof t=="object"&&t!==null?t.symbol===i.symbol:e}};xc.symbol=Symbol.for("@smithy/core/schema::MapSchema")});var xD=h(()=>{});var co,ih=h(()=>{$s();co=class i extends Ci{constructor(t,e,r,n){super(t,e),this.name=t,this.traits=e,this.memberNames=r,this.memberList=n,this.symbol=i.symbol,this.members={};for(let o=0;o<r.length;++o)this.members[r[o]]=Array.isArray(n[o])?n[o]:[n[o],0]}static[Symbol.hasInstance](t){let e=i.prototype.isPrototypeOf(t);return!e&&typeof t=="object"&&t!==null?t.symbol===i.symbol:e}};co.symbol=Symbol.for("@smithy/core/schema::StructureSchema")});var OC,OD=h(()=>{ih();OC=class i extends co{constructor(t,e,r,n,o){super(t,e,r,n),this.name=t,this.traits=e,this.memberNames=r,this.memberList=n,this.ctor=o,this.symbol=i.symbol}static[Symbol.hasInstance](t){let e=i.prototype.isPrototypeOf(t);return!e&&typeof t=="object"&&t!==null?t.symbol===i.symbol:e}};OC.symbol=Symbol.for("@smithy/core/schema::ErrorSchema")});var Fe,PC=h(()=>{Fe={BLOB:21,STREAMING_BLOB:42,BOOLEAN:2,STRING:0,NUMERIC:1,BIG_INTEGER:17,BIG_DECIMAL:19,DOCUMENT:15,TIMESTAMP_DEFAULT:4,TIMESTAMP_DATE_TIME:5,TIMESTAMP_HTTP_DATE:6,TIMESTAMP_EPOCH_SECONDS:7,LIST_MODIFIER:64,MAP_MODIFIER:128}});var Oc,RC=h(()=>{$s();Oc=class i extends Ci{constructor(t,e,r){super(t,r),this.name=t,this.schemaRef=e,this.traits=r,this.symbol=i.symbol}static[Symbol.hasInstance](t){let e=i.prototype.isPrototypeOf(t);return!e&&typeof t=="object"&&t!==null?t.symbol===i.symbol:e}};Oc.symbol=Symbol.for("@smithy/core/schema::SimpleSchema")});var Pc,PD=h(()=>{AC();MC();xC();PC();RC();ih();Pc=class i{constructor(t,e){this.ref=t,this.memberName=e,this.symbol=i.symbol;let r=[],n=t,o=t;for(this._isMemberSchema=!1;Array.isArray(n);)r.push(n[1]),n=n[0],o=kc(n),this._isMemberSchema=!0;if(r.length>0){this.memberTraits={};for(let s=r.length-1;s>=0;--s){let a=r[s];Object.assign(this.memberTraits,i.translateTraits(a))}}else this.memberTraits=0;if(o instanceof i){this.name=o.name,this.traits=o.traits,this._isMemberSchema=o._isMemberSchema,this.schema=o.schema,this.memberTraits=Object.assign({},o.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,this.ref=o.ref,this.memberName=e??o.memberName;return}if(this.schema=kc(o),this.schema&&typeof this.schema=="object"?this.traits=this.schema?.traits??{}:this.traits=0,this.name=(typeof this.schema=="object"?this.schema?.name:void 0)??this.memberName??this.getSchemaName(),this._isMemberSchema&&!e)throw new Error(`@smithy/core/schema - NormalizedSchema member schema ${this.getName(!0)} must initialize with memberName argument.`)}static[Symbol.hasInstance](t){let e=i.prototype.isPrototypeOf(t);return!e&&typeof t=="object"&&t!==null?t.symbol===i.symbol:e}static of(t,e){return t instanceof i?t:new i(t,e)}static translateTraits(t){if(typeof t=="object")return t;t=t|0;let e={};return(t&1)===1&&(e.httpLabel=1),(t>>1&1)===1&&(e.idempotent=1),(t>>2&1)===1&&(e.idempotencyToken=1),(t>>3&1)===1&&(e.sensitive=1),(t>>4&1)===1&&(e.httpPayload=1),(t>>5&1)===1&&(e.httpResponseCode=1),(t>>6&1)===1&&(e.httpQueryParams=1),e}static memberFrom(t,e){return t instanceof i?(t.memberName=e,t._isMemberSchema=!0,t):new i(t,e)}getSchema(){return this.schema instanceof i?this.schema=this.schema.getSchema():this.schema instanceof Oc?kc(this.schema.schemaRef):kc(this.schema)}getName(t=!1){return!t&&this.name&&this.name.includes("#")?this.name.split("#")[1]:this.name||void 0}getMemberName(){if(!this.isMemberSchema())throw new Error(`@smithy/core/schema - cannot get member name on non-member schema: ${this.getName(!0)}`);return this.memberName}isMemberSchema(){return this._isMemberSchema}isUnitSchema(){return this.getSchema()==="unit"}isListSchema(){let t=this.getSchema();return typeof t=="number"?t>=Fe.LIST_MODIFIER&&t<Fe.MAP_MODIFIER:t instanceof Mc}isMapSchema(){let t=this.getSchema();return typeof t=="number"?t>=Fe.MAP_MODIFIER&&t<=255:t instanceof xc}isDocumentSchema(){return this.getSchema()===Fe.DOCUMENT}isStructSchema(){let t=this.getSchema();return t!==null&&typeof t=="object"&&"members"in t||t instanceof co}isBlobSchema(){return this.getSchema()===Fe.BLOB||this.getSchema()===Fe.STREAMING_BLOB}isTimestampSchema(){let t=this.getSchema();return typeof t=="number"&&t>=Fe.TIMESTAMP_DEFAULT&&t<=Fe.TIMESTAMP_EPOCH_SECONDS}isStringSchema(){return this.getSchema()===Fe.STRING}isBooleanSchema(){return this.getSchema()===Fe.BOOLEAN}isNumericSchema(){return this.getSchema()===Fe.NUMERIC}isBigIntegerSchema(){return this.getSchema()===Fe.BIG_INTEGER}isBigDecimalSchema(){return this.getSchema()===Fe.BIG_DECIMAL}isStreaming(){return this.getMergedTraits().streaming?!0:this.getSchema()===Fe.STREAMING_BLOB}isIdempotencyToken(){return typeof this.traits=="number"?(this.traits&4)===4:typeof this.traits=="object"?!!this.traits.idempotencyToken:!1}getMergedTraits(){return this.normalizedTraits?this.normalizedTraits:(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()},this.normalizedTraits)}getMemberTraits(){return i.translateTraits(this.memberTraits)}getOwnTraits(){return i.translateTraits(this.traits)}getKeySchema(){if(this.isDocumentSchema())return i.memberFrom([Fe.DOCUMENT,0],"key");if(!this.isMapSchema())throw new Error(`@smithy/core/schema - cannot get key schema for non-map schema: ${this.getName(!0)}`);let t=this.getSchema();return typeof t=="number"?i.memberFrom([63&t,0],"key"):i.memberFrom([t.keySchema,0],"key")}getValueSchema(){let t=this.getSchema();if(typeof t=="number"){if(this.isMapSchema())return i.memberFrom([63&t,0],"value");if(this.isListSchema())return i.memberFrom([63&t,0],"member")}if(t&&typeof t=="object"){if(this.isStructSchema())throw new Error(`cannot call getValueSchema() with StructureSchema ${this.getName(!0)}`);let e=t;if("valueSchema"in e){if(this.isMapSchema())return i.memberFrom([e.valueSchema,0],"value");if(this.isListSchema())return i.memberFrom([e.valueSchema,0],"member")}}if(this.isDocumentSchema())return i.memberFrom([Fe.DOCUMENT,0],"value");throw new Error(`@smithy/core/schema - the schema ${this.getName(!0)} does not have a value member.`)}hasMemberSchema(t){if(this.isStructSchema()){let e=this.getSchema();return t in e.members}return!1}getMemberSchema(t){if(this.isStructSchema()){let e=this.getSchema();if(!(t in e.members))throw new Error(`@smithy/core/schema - the schema ${this.getName(!0)} does not have a member with name=${t}.`);return i.memberFrom(e.members[t],t)}if(this.isDocumentSchema())return i.memberFrom([Fe.DOCUMENT,0],t);throw new Error(`@smithy/core/schema - the schema ${this.getName(!0)} does not have members.`)}getMemberSchemas(){let{schema:t}=this,e=t;if(!e||typeof e!="object")return{};if("members"in e){let r={};for(let n of e.memberNames)r[n]=this.getMemberSchema(n);return r}return{}}getEventStreamMember(){if(this.isStructSchema()){for(let[t,e]of this.structIterator())if(e.isStreaming()&&e.isStructSchema())return t}return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot acquire structIterator on non-struct schema.");let t=this.getSchema();for(let e=0;e<t.memberNames.length;++e)yield[t.memberNames[e],i.memberFrom([t.memberList[e],0],t.memberNames[e])]}getSchemaName(){let t=this.getSchema();if(typeof t=="number"){let e=63&t,r=192&t,n=Object.entries(Fe).find(([,o])=>o===e)?.[0]??"Unknown";switch(r){case Fe.MAP_MODIFIER:return`${n}Map`;case Fe.LIST_MODIFIER:return`${n}List`;case 0:return n}}return"Unknown"}};Pc.symbol=Symbol.for("@smithy/core/schema::NormalizedSchema")});var RD=h(()=>{AC();kD();MC();xC();xD();OD();PD();$s();RC();ih();PC();MD()});var DD=h(()=>{});var DC,qe,mle,H,ce,R,ND,c9,l9,rh,nh,NC=h(()=>{DC=i=>{if(i!=null){if(typeof i=="number"){if((i===0||i===1)&&nh.warn(rh(`Expected boolean, got ${typeof i}: ${i}`)),i===0)return!1;if(i===1)return!0}if(typeof i=="string"){let t=i.toLowerCase();if((t==="false"||t==="true")&&nh.warn(rh(`Expected boolean, got ${typeof i}: ${i}`)),t==="false")return!1;if(t==="true")return!0}if(typeof i=="boolean")return i;throw new TypeError(`Expected boolean, got ${typeof i}: ${i}`)}},qe=i=>{if(i!=null){if(typeof i=="string"){let t=parseFloat(i);if(!Number.isNaN(t))return String(t)!==String(i)&&nh.warn(rh(`Expected number but observed string: ${i}`)),t}if(typeof i=="number")return i;throw new TypeError(`Expected number, got ${typeof i}: ${i}`)}},mle=Math.ceil(34028234663852886e22),H=(i,t)=>{if(i==null)throw t?new TypeError(`Expected a non-null value for ${t}`):new TypeError("Expected a non-null value");return i},ce=i=>{if(i==null)return;if(typeof i=="object"&&!Array.isArray(i))return i;let t=Array.isArray(i)?"array":typeof i;throw new TypeError(`Expected object, got ${t}: ${i}`)},R=i=>{if(i!=null){if(typeof i=="string")return i;if(["boolean","number","bigint"].includes(typeof i))return nh.warn(rh(`Expected string, got ${typeof i}: ${i}`)),String(i);throw new TypeError(`Expected string, got ${typeof i}: ${i}`)}},ND=i=>qe(typeof i=="string"?l9(i):i),c9=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,l9=i=>{let t=i.match(c9);if(t===null||t[0].length!==i.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(i)},rh=i=>String(new TypeError(i).stack||i).split(`
`).slice(0,5).filter(t=>!t.includes("stackTraceWarning")).join(`
`),nh={warn:console.warn}});var wle,Cle,_le,Tle,Ele,je,Ile,LD=h(()=>{NC();wle=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?[zZ]$/),Cle=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),_le=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),Tle=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),Ele=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),je=i=>{if(i==null)return;let t;if(typeof i=="number")t=i;else if(typeof i=="string")t=ND(i);else if(typeof i=="object"&&i.tag===1)t=i.value;else throw new TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");if(Number.isNaN(t)||t===1/0||t===-1/0)throw new TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");return new Date(Math.round(t*1e3))},Ile=50*365*24*60*60*1e3});function LC(){if(!oh&&(oh=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!oh))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oh(u9)}var oh,u9,FD=h(()=>{u9=new Uint8Array(16)});function BD(i,t=0){return Qe[i[t+0]]+Qe[i[t+1]]+Qe[i[t+2]]+Qe[i[t+3]]+"-"+Qe[i[t+4]]+Qe[i[t+5]]+"-"+Qe[i[t+6]]+Qe[i[t+7]]+"-"+Qe[i[t+8]]+Qe[i[t+9]]+"-"+Qe[i[t+10]]+Qe[i[t+11]]+Qe[i[t+12]]+Qe[i[t+13]]+Qe[i[t+14]]+Qe[i[t+15]]}var Qe,VD=h(()=>{Qe=[];for(let i=0;i<256;++i)Qe.push((i+256).toString(16).slice(1))});var f9,FC,UD=h(()=>{f9=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),FC={randomUUID:f9}});function h9(i,t,e){if(FC.randomUUID&&!t&&!i)return FC.randomUUID();i=i||{};let r=i.random||(i.rng||LC)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let n=0;n<16;++n)t[e+n]=r[n];return t}return BD(r)}var Or,qD=h(()=>{UD();FD();VD();Or=h9});var BC=h(()=>{qD()});var HD=h(()=>{});var js,zD=h(()=>{js=function(t){return Object.assign(new String(t),{deserializeJSON(){return JSON.parse(String(t))},toString(){return String(t)},toJSON(){return String(t)}})};js.from=i=>i&&typeof i=="object"&&(i instanceof js||"deserializeJSON"in i)?i:typeof i=="string"||Object.getPrototypeOf(i)===String.prototype?js(String(i)):js(JSON.stringify(i));js.fromObject=js.from});var $D=h(()=>{});var jD=h(()=>{});var WD=h(()=>{});var GD=h(()=>{});var KD=h(()=>{DD();LD();HD();zD();NC();$D();jD();WD();GD()});var JD=h(()=>{});var QD=h(()=>{});var XD=h(()=>{});var YD,VC=h(()=>{IC();YD=(i,t,e,r,n,o)=>{if(t!=null&&t[e]!==void 0){let s=r();if(s.length<=0)throw new Error("Empty value provided for input HTTP label: "+e+".");i=i.replace(n,o?s.split("/").map(a=>EC(a)).join("/"):EC(s))}else throw new Error("No value provided for input HTTP label: "+e+".");return i}});function Y(i,t){return new UC(i,t)}var UC,ZD=h(()=>{nt();VC();UC=class{constructor(t,e){this.input=t,this.context=e,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){let{hostname:t,protocol:e="https",port:r,path:n}=await this.context.endpoint();this.path=n;for(let o of this.resolvePathStack)o(this.path);return new De({protocol:e,hostname:this.hostname||t,port:r,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(t){return this.hostname=t,this}bp(t){return this.resolvePathStack.push(e=>{this.path=`${e?.endsWith("/")?e.slice(0,-1):e||""}`+t}),this}p(t,e,r,n){return this.resolvePathStack.push(o=>{this.path=YD(o,this.input,t,e,r,n)}),this}h(t){return this.headers=t,this}q(t){return this.query=t,this}b(t){return this.body=t,this}m(t){return this.method=t,this}}});var e1=h(()=>{});var t1=h(()=>{});var i1=h(()=>{});var r1=h(()=>{});var n1=h(()=>{});var qC=h(()=>{AD();IC();QD();JD();XD();ZD();VC();t1();i1();n1();r1();e1()});var o1=h(()=>{qC()});function s1(i,t,e){i.__smithy_context?i.__smithy_context.features||(i.__smithy_context.features={}):i.__smithy_context={features:{}},i.__smithy_context.features[t]=e}var a1=h(()=>{});var sh,d1=h(()=>{sh=class{constructor(t){this.authSchemes=new Map;for(let[e,r]of Object.entries(t))r!==void 0&&this.authSchemes.set(e,r)}getIdentityProvider(t){return this.authSchemes.get(t)}}});var c1=h(()=>{});var l1=h(()=>{});var u1=h(()=>{});var f1=h(()=>{c1();l1();u1()});var p9,h1,HC,p1,m1=h(()=>{p9=i=>t=>HC(t)&&t.expiration.getTime()-Date.now()<i,h1=p9(3e5),HC=i=>i.expiration!==void 0,p1=(i,t,e)=>{if(i===void 0)return;let r=typeof i!="function"?async()=>Promise.resolve(i):i,n,o,s,a=!1,l=async c=>{o||(o=r(c));try{n=await o,s=!0,a=!1}finally{o=void 0}return n};return t===void 0?async c=>((!s||c?.forceRefresh)&&(n=await l(c)),n):async c=>((!s||c?.forceRefresh)&&(n=await l(c)),a?n:e(n)?(t(n)&&await l(c),n):(a=!0,n))}});var g1=h(()=>{d1();f1();m1()});var Xe=h(()=>{PR();$R();KR();JR();QR();o1();a1();g1()});function g9(i){return i===void 0?!0:typeof i=="string"&&i.length<=50}function S1(i){let t=oo(i.userAgentAppId??m9),{customUserAgent:e}=i;return Object.assign(i,{customUserAgent:typeof e=="string"?[[e]]:e,userAgentAppId:async()=>{let r=await t();if(!g9(r)){let n=i.logger?.constructor?.name==="NoOpLogger"||!i.logger?console:i.logger;typeof r!="string"?n?.warn("userAgentAppId must be a string or undefined."):r.length>50&&n?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return r}})}var m9,y1=h(()=>{Xe();m9=void 0});var ah,v1=h(()=>{ah=class{constructor({size:t,params:e}){this.data=new Map,this.parameters=[],this.capacity=t??50,e&&(this.parameters=e)}get(t,e){let r=this.hash(t);if(r===!1)return e();if(!this.data.has(r)){if(this.data.size>this.capacity+10){let n=this.data.keys(),o=0;for(;;){let{value:s,done:a}=n.next();if(this.data.delete(s),a||++o>10)break}}this.data.set(r,e())}return this.data.get(r)}size(){return this.data.size}hash(t){let e="",{parameters:r}=this;if(r.length===0)return!1;for(let n of r){let o=String(t[n]??"");if(o.includes("|;"))return!1;e+=o+"|;"}return e}}});var S9,Rc,zC=h(()=>{S9=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),Rc=i=>S9.test(i)||i.startsWith("[")&&i.endsWith("]")});var y9,Dc,$C=h(()=>{y9=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),Dc=(i,t=!1)=>{if(!t)return y9.test(i);let e=i.split(".");for(let r of e)if(!Dc(r))return!1;return!0}});var lo,dh=h(()=>{lo={}});var ji,b1=h(()=>{ji="endpoints"});function Pt(i){return typeof i!="object"||i==null?i:"ref"in i?`$${Pt(i.ref)}`:"fn"in i?`${i.fn}(${(i.argv||[]).map(Pt).join(", ")})`:JSON.stringify(i,null,2)}var w1=h(()=>{});var Nc=h(()=>{b1();w1()});var ke,C1=h(()=>{ke=class extends Error{constructor(t){super(t),this.name="EndpointError"}}});var _1=h(()=>{});var T1=h(()=>{});var E1=h(()=>{});var I1=h(()=>{});var A1=h(()=>{});var k1=h(()=>{});var Rt=h(()=>{C1();_1();T1();E1();I1();A1();k1()});var M1,x1=h(()=>{M1=(i,t)=>i===t});var O1,P1=h(()=>{Rt();O1=i=>{let t=i.split("."),e=[];for(let r of t){let n=r.indexOf("[");if(n!==-1){if(r.indexOf("]")!==r.length-1)throw new ke(`Path: '${i}' does not end with ']'`);let o=r.slice(n+1,-1);if(Number.isNaN(parseInt(o)))throw new ke(`Invalid array index: '${o}' in path: '${i}'`);n!==0&&e.push(r.slice(0,n)),e.push(o)}else e.push(r)}return e}});var ch,R1=h(()=>{Rt();P1();ch=(i,t)=>O1(t).reduce((e,r)=>{if(typeof e!="object")throw new ke(`Index '${r}' in '${t}' not found in '${JSON.stringify(i)}'`);return Array.isArray(e)?e[parseInt(r)]:e[r]},i)});var D1,N1=h(()=>{D1=i=>i!=null});var L1,F1=h(()=>{L1=i=>!i});var jC,B1,V1=h(()=>{Ic();zC();jC={[Vs.HTTP]:80,[Vs.HTTPS]:443},B1=i=>{let t=(()=>{try{if(i instanceof URL)return i;if(typeof i=="object"&&"hostname"in i){let{hostname:f,port:m,protocol:S="",path:T="",query:_={}}=i,C=new URL(`${S}//${f}${m?`:${m}`:""}${T}`);return C.search=Object.entries(_).map(([I,A])=>`${I}=${A}`).join("&"),C}return new URL(i)}catch{return null}})();if(!t)return console.error(`Unable to parse ${JSON.stringify(i)} as a whatwg URL.`),null;let e=t.href,{host:r,hostname:n,pathname:o,protocol:s,search:a}=t;if(a)return null;let l=s.slice(0,-1);if(!Object.values(Vs).includes(l))return null;let c=Rc(n),d=e.includes(`${r}:${jC[l]}`)||typeof i=="string"&&i.includes(`${r}:${jC[l]}`),u=`${r}${d?`:${jC[l]}`:""}`;return{scheme:l,authority:u,path:o,normalizedPath:o.endsWith("/")?o:`${o}/`,isIp:c}}});var U1,q1=h(()=>{U1=(i,t)=>i===t});var H1,z1=h(()=>{H1=(i,t,e,r)=>t>=e||i.length<e?null:r?i.substring(i.length-e,i.length-t):i.substring(t,e)});var $1,j1=h(()=>{$1=i=>encodeURIComponent(i).replace(/[!*'()]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)});var WC=h(()=>{x1();R1();N1();$C();F1();V1();q1();z1();j1()});var W1,G1=h(()=>{WC();W1={booleanEquals:M1,getAttr:ch,isSet:D1,isValidHostLabel:Dc,not:L1,parseURL:B1,stringEquals:U1,substring:H1,uriEncode:$1}});var lh,GC=h(()=>{WC();lh=(i,t)=>{let e=[],r={...t.endpointParams,...t.referenceRecord},n=0;for(;n<i.length;){let o=i.indexOf("{",n);if(o===-1){e.push(i.slice(n));break}e.push(i.slice(n,o));let s=i.indexOf("}",o);if(s===-1){e.push(i.slice(o));break}i[o+1]==="{"&&i[s+1]==="}"&&(e.push(i.slice(o+1,s)),n=s+2);let a=i.substring(o+1,s);if(a.includes("#")){let[l,c]=a.split("#");e.push(ch(r[l],c))}else e.push(r[a]);n=s+1}return e.join("")}});var K1,J1=h(()=>{K1=({ref:i},t)=>({...t.endpointParams,...t.referenceRecord})[i]});var Pr,Lc=h(()=>{Rt();KC();GC();J1();Pr=(i,t,e)=>{if(typeof i=="string")return lh(i,e);if(i.fn)return uh(i,e);if(i.ref)return K1(i,e);throw new ke(`'${t}': ${String(i)} is not a string, function or reference.`)}});var uh,KC=h(()=>{dh();G1();Lc();uh=({fn:i,argv:t},e)=>{let r=t.map(o=>["boolean","number"].includes(typeof o)?o:Pr(o,"arg",e)),n=i.split(".");return n[0]in lo&&n[1]!=null?lo[n[0]][n[1]](...r):W1[i](...r)}});var Q1,X1=h(()=>{Nc();Rt();KC();Q1=({assign:i,...t},e)=>{if(i&&i in e.referenceRecord)throw new ke(`'${i}' is already defined in Reference Record.`);let r=uh(t,e);return e.logger?.debug?.(`${ji} evaluateCondition: ${Pt(t)} = ${Pt(r)}`),{result:r===""?!0:!!r,...i!=null&&{toAssign:{name:i,value:r}}}}});var Ws,fh=h(()=>{Nc();X1();Ws=(i=[],t)=>{let e={};for(let r of i){let{result:n,toAssign:o}=Q1(r,{...t,referenceRecord:{...t.referenceRecord,...e}});if(!n)return{result:n};o&&(e[o.name]=o.value,t.logger?.debug?.(`${ji} assign: ${o.name} := ${Pt(o.value)}`))}return{result:!0,referenceRecord:e}}});var Y1,Z1=h(()=>{Rt();Lc();Y1=(i,t)=>Object.entries(i).reduce((e,[r,n])=>({...e,[r]:n.map(o=>{let s=Pr(o,"Header value entry",t);if(typeof s!="string")throw new ke(`Header '${r}' value '${s}' is not a string`);return s})}),{})});var JC,eN=h(()=>{Rt();GC();QC();JC=(i,t)=>{if(Array.isArray(i))return i.map(e=>JC(e,t));switch(typeof i){case"string":return lh(i,t);case"object":if(i===null)throw new ke(`Unexpected endpoint property: ${i}`);return hh(i,t);case"boolean":return i;default:throw new ke(`Unexpected endpoint property type: ${typeof i}`)}}});var hh,QC=h(()=>{eN();hh=(i,t)=>Object.entries(i).reduce((e,[r,n])=>({...e,[r]:JC(n,t)}),{})});var tN,iN=h(()=>{Rt();Lc();tN=(i,t)=>{let e=Pr(i,"Endpoint URL",t);if(typeof e=="string")try{return new URL(e)}catch(r){throw console.error(`Failed to construct URL with ${e}`,r),r}throw new ke(`Endpoint URL must be a string, got ${typeof e}`)}});var rN,nN=h(()=>{Nc();fh();Z1();QC();iN();rN=(i,t)=>{let{conditions:e,endpoint:r}=i,{result:n,referenceRecord:o}=Ws(e,t);if(!n)return;let s={...t,referenceRecord:{...t.referenceRecord,...o}},{url:a,properties:l,headers:c}=r;return t.logger?.debug?.(`${ji} Resolving endpoint from template: ${Pt(r)}`),{...c!=null&&{headers:Y1(c,s)},...l!=null&&{properties:hh(l,s)},url:tN(a,s)}}});var oN,sN=h(()=>{Rt();fh();Lc();oN=(i,t)=>{let{conditions:e,error:r}=i,{result:n,referenceRecord:o}=Ws(e,t);if(n)throw new ke(Pr(r,"Error",{...t,referenceRecord:{...t.referenceRecord,...o}}))}});var aN,dN=h(()=>{fh();XC();aN=(i,t)=>{let{conditions:e,rules:r}=i,{result:n,referenceRecord:o}=Ws(e,t);if(n)return ph(r,{...t,referenceRecord:{...t.referenceRecord,...o}})}});var ph,XC=h(()=>{Rt();nN();sN();dN();ph=(i,t)=>{for(let e of i)if(e.type==="endpoint"){let r=rN(e,t);if(r)return r}else if(e.type==="error")oN(e,t);else if(e.type==="tree"){let r=aN(e,t);if(r)return r}else throw new ke(`Unknown endpoint rule: ${e}`);throw new ke("Rules evaluation failed")}});var cN=h(()=>{dh();XC()});var lN,uN=h(()=>{Nc();Rt();cN();lN=(i,t)=>{let{endpointParams:e,logger:r}=t,{parameters:n,rules:o}=i;t.logger?.debug?.(`${ji} Initial EndpointParams: ${Pt(e)}`);let s=Object.entries(n).filter(([,c])=>c.default!=null).map(([c,d])=>[c,d.default]);if(s.length>0)for(let[c,d]of s)e[c]=e[c]??d;let a=Object.entries(n).filter(([,c])=>c.required).map(([c])=>c);for(let c of a)if(e[c]==null)throw new ke(`Missing required parameter: '${c}'`);let l=ph(o,{endpointParams:e,logger:r,referenceRecord:{}});return t.logger?.debug?.(`${ji} Resolved endpoint: ${Pt(l)}`),l}});var Fc=h(()=>{v1();zC();$C();dh();uN();Rt()});var YC=h(()=>{Fc()});var ZC,fN=h(()=>{Fc();YC();ZC=(i,t=!1)=>{if(t){for(let e of i.split("."))if(!ZC(e))return!1;return!0}return!(!Dc(i)||i.length<3||i.length>63||i!==i.toLowerCase()||Rc(i))}});var hN,pN=h(()=>{hN=i=>{let t=i.split(":");if(t.length<6)return null;let[e,r,n,o,s,...a]=t;if(e!=="arn"||r===""||n===""||a.join(":")==="")return null;let l=a.map(c=>c.split("/")).flat();return{partition:r,service:n,region:o,accountId:s,resourceId:l}}});var gN,mN=h(()=>{gN={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-6":{description:"Asia Pacific (New Zealand)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"aws global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"aws-cn global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"api.amazonwebservices.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"api.aws.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"aws-iso global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"api.aws.scloud",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"aws-iso-b global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"api.cloud-aws.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"aws-iso-e global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"api.aws.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"aws-iso-f global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"aws-us-gov global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}}],version:"1.1"}});var b9,w9,SN,yN,e_=h(()=>{mN();b9=gN,w9="",SN=i=>{let{partitions:t}=b9;for(let r of t){let{regions:n,outputs:o}=r;for(let[s,a]of Object.entries(n))if(s===i)return{...o,...a}}for(let r of t){let{regionRegex:n,outputs:o}=r;if(new RegExp(n).test(i))return{...o}}let e=t.find(r=>r.id==="aws");if(!e)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...e.outputs}},yN=()=>w9});var t_,vN=h(()=>{Fc();fN();pN();e_();t_={isVirtualHostableS3Bucket:ZC,parseArn:hN,partition:SN};lo.aws=t_});function bN(i){let t={};if(i=i.replace(/^\?/,""),i)for(let e of i.split("&")){let[r,n=null]=e.split("=");r=decodeURIComponent(r),n&&(n=decodeURIComponent(n)),r in t?Array.isArray(t[r])?t[r].push(n):t[r]=[t[r],n]:t[r]=n}return t}var wN=h(()=>{});var Gs,i_=h(()=>{wN();Gs=i=>{if(typeof i=="string")return Gs(new URL(i));let{hostname:t,pathname:e,port:r,protocol:n,search:o}=i,s;return o&&(s=bN(o)),{hostname:t,port:r?parseInt(r):void 0,protocol:n,path:e,query:s}}});var CN=h(()=>{});var _N=h(()=>{});var TN=h(()=>{});var EN=h(()=>{});var IN=h(()=>{});var AN=h(()=>{});var kN=h(()=>{});var MN=h(()=>{});var xN=h(()=>{TN();EN();IN();AN();kN();MN()});var r_=h(()=>{vN();e_();YC();CN();_N();xN()});var ON=h(()=>{});function PN(i,t,e){return i.$source||(i.$source={}),i.$source[t]=e,i}var RN=h(()=>{});function Zt(i,t,e){i.__aws_sdk_context?i.__aws_sdk_context.features||(i.__aws_sdk_context.features={}):i.__aws_sdk_context={features:{}},i.__aws_sdk_context.features[t]=e}var DN=h(()=>{});var NN=h(()=>{});var n_=h(()=>{ON();RN();DN();NN()});var o_,LN=h(()=>{nt();o_=i=>Xt.isInstance(i)?i.headers?.date??i.headers?.Date:void 0});var mh,s_=h(()=>{mh=i=>new Date(Date.now()+i)});var FN,BN=h(()=>{s_();FN=(i,t)=>Math.abs(mh(t).getTime()-i)>=3e5});var a_,VN=h(()=>{BN();a_=(i,t)=>{let e=Date.parse(i);return FN(e,t)?e-Date.now():t}});var UN=h(()=>{LN();s_();VN()});var Bc,qN,Vc,HN=h(()=>{nt();UN();Bc=(i,t)=>{if(!t)throw new Error(`Property \`${i}\` is not resolved for AWS SDK SigV4Auth`);return t},qN=async i=>{let t=Bc("context",i.context),e=Bc("config",i.config),r=t.endpointV2?.properties?.authSchemes?.[0],o=await Bc("signer",e.signer)(r),s=i?.signingRegion,a=i?.signingRegionSet,l=i?.signingName;return{config:e,signer:o,signingRegion:s,signingRegionSet:a,signingName:l}},Vc=class{async sign(t,e,r){if(!De.isInstance(t))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");let n=await qN(r),{config:o,signer:s}=n,{signingRegion:a,signingName:l}=n,c=r.context;if(c?.authSchemes?.length??!1){let[u,f]=c.authSchemes;u?.name==="sigv4a"&&f?.name==="sigv4"&&(a=f?.signingRegion??a,l=f?.signingName??l)}return await s.sign(t,{signingDate:mh(o.systemClockOffset),signingRegion:a,signingService:l})}errorHandler(t){return e=>{let r=e.ServerTime??o_(e.$response);if(r){let n=Bc("config",t.config),o=n.systemClockOffset;n.systemClockOffset=a_(r,n.systemClockOffset),n.systemClockOffset!==o&&e.$metadata&&(e.$metadata.clockSkewCorrected=!0)}throw e}}successHandler(t,e){let r=o_(t);if(r){let n=Bc("config",e.config);n.systemClockOffset=a_(r,n.systemClockOffset)}}}});var zN=h(()=>{});var $N=h(()=>{});var jN=h(()=>{});var WN=h(()=>{});var GN=h(()=>{});var KN=h(()=>{});var JN=h(()=>{});var QN,XN=h(()=>{QN=(i,t,e)=>{let r,n,o,s=!1,a=async()=>{n||(n=i());try{r=await n,o=!0,s=!1}finally{n=void 0}return r};return t===void 0?async l=>((!o||l?.forceRefresh)&&(r=await a()),r):async l=>((!o||l?.forceRefresh)&&(r=await a()),s?r:e&&!e(r)?(s=!0,r):(t(r)&&await a(),r))}});var YN=h(()=>{WN();jN();GN();KN();JN();XN()});var ZN=h(()=>{});var eL,tL,d_,iL,rL,c_,l_,u_,f_,C9,nL,oL,Uc,sL,aL,dL,cL,gh,lL,uL,fL,h_,hL,Rr=h(()=>{eL="X-Amz-Algorithm",tL="X-Amz-Credential",d_="X-Amz-Date",iL="X-Amz-SignedHeaders",rL="X-Amz-Expires",c_="X-Amz-Signature",l_="X-Amz-Security-Token",u_="authorization",f_=d_.toLowerCase(),C9="date",nL=[u_,f_,C9],oL=c_.toLowerCase(),Uc="x-amz-content-sha256",sL=l_.toLowerCase(),aL={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},dL=/^proxy-/,cL=/^sec-/,gh="AWS4-HMAC-SHA256",lL="AWS4-HMAC-SHA256-PAYLOAD",uL="UNSIGNED-PAYLOAD",fL=50,h_="aws4_request",hL=3600*24*7});var Sh,p_,yh,mL,pL,m_=h(()=>{zs();bi();Rr();Sh={},p_=[],yh=(i,t,e)=>`${i}/${t}/${e}/${h_}`,mL=async(i,t,e,r,n)=>{let o=await pL(i,t.secretAccessKey,t.accessKeyId),s=`${e}:${r}:${n}:${Ot(o)}:${t.sessionToken}`;if(s in Sh)return Sh[s];for(p_.push(s);p_.length>fL;)delete Sh[p_.shift()];let a=`AWS4${t.secretAccessKey}`;for(let l of[e,r,n,h_])a=await pL(i,a,l);return Sh[s]=a},pL=(i,t,e)=>{let r=new i(t);return r.update(zi(e)),r.digest()}});var g_,gL=h(()=>{Rr();g_=({headers:i},t,e)=>{let r={};for(let n of Object.keys(i).sort()){if(i[n]==null)continue;let o=n.toLowerCase();(o in aL||t?.has(o)||dL.test(o)||cL.test(o))&&(!e||e&&!e.has(o))||(r[o]=i[n].trim().replace(/\s+/g," "))}return r}});var SL,yL=h(()=>{SL=i=>typeof ArrayBuffer=="function"&&i instanceof ArrayBuffer||Object.prototype.toString.call(i)==="[object ArrayBuffer]"});var vh,vL=h(()=>{yL();zs();bi();Rr();vh=async({headers:i,body:t},e)=>{for(let r of Object.keys(i))if(r.toLowerCase()===Uc)return i[r];if(t==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof t=="string"||ArrayBuffer.isView(t)||SL(t)){let r=new e;return r.update(zi(t)),Ot(await r.digest())}return uL}});function wL(i){for(let t=0;t<8;t++)i[t]^=255;for(let t=7;t>-1&&(i[t]++,i[t]===0);t--);}var bh,bL,_9,S_,CL=h(()=>{zs();bi();bh=class{format(t){let e=[];for(let o of Object.keys(t)){let s=Yt(o);e.push(Uint8Array.from([s.byteLength]),s,this.formatHeaderValue(t[o]))}let r=new Uint8Array(e.reduce((o,s)=>o+s.byteLength,0)),n=0;for(let o of e)r.set(o,n),n+=o.byteLength;return r}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":let e=new DataView(new ArrayBuffer(3));return e.setUint8(0,3),e.setInt16(1,t.value,!1),new Uint8Array(e.buffer);case"integer":let r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,t.value,!1),new Uint8Array(r.buffer);case"long":let n=new Uint8Array(9);return n[0]=5,n.set(t.value.bytes,1),n;case"binary":let o=new DataView(new ArrayBuffer(3+t.value.byteLength));o.setUint8(0,6),o.setUint16(1,t.value.byteLength,!1);let s=new Uint8Array(o.buffer);return s.set(t.value,3),s;case"string":let a=Yt(t.value),l=new DataView(new ArrayBuffer(3+a.byteLength));l.setUint8(0,7),l.setUint16(1,a.byteLength,!1);let c=new Uint8Array(l.buffer);return c.set(a,3),c;case"timestamp":let d=new Uint8Array(9);return d[0]=8,d.set(S_.fromNumber(t.value.valueOf()).bytes,1),d;case"uuid":if(!_9.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);let u=new Uint8Array(17);return u[0]=9,u.set(_D(t.value.replace(/\-/g,"")),1),u}}};(function(i){i[i.boolTrue=0]="boolTrue",i[i.boolFalse=1]="boolFalse",i[i.byte=2]="byte",i[i.short=3]="short",i[i.integer=4]="integer",i[i.long=5]="long",i[i.byteArray=6]="byteArray",i[i.string=7]="string",i[i.timestamp=8]="timestamp",i[i.uuid=9]="uuid"})(bL||(bL={}));_9=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,S_=class i{constructor(t){if(this.bytes=t,t.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>9223372036854776e3||t<-9223372036854776e3)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);let e=new Uint8Array(8);for(let r=7,n=Math.abs(Math.round(t));r>-1&&n>0;r--,n/=256)e[r]=n;return t<0&&wL(e),new i(e)}valueOf(){let t=this.bytes.slice(0),e=t[0]&128;return e&&wL(t),parseInt(Ot(t),16)*(e?-1:1)}toString(){return String(this.valueOf())}}});var _L,TL=h(()=>{_L=(i,t)=>{i=i.toLowerCase();for(let e of Object.keys(t))if(i===e.toLowerCase())return!0;return!1}});var EL,IL=h(()=>{nt();EL=(i,t={})=>{let{headers:e,query:r={}}=De.clone(i);for(let n of Object.keys(e)){let o=n.toLowerCase();(o.slice(0,6)==="x-amz-"&&!t.unhoistableHeaders?.has(o)||t.hoistableHeaders?.has(o))&&(r[n]=e[n],delete e[n])}return{...i,headers:e,query:r}}});var y_,AL=h(()=>{nt();Rr();y_=i=>{i=De.clone(i);for(let t of Object.keys(i.headers))nL.indexOf(t.toLowerCase())>-1&&delete i.headers[t];return i}});var kL,ML=h(()=>{eh();Rr();kL=({query:i={}})=>{let t=[],e={};for(let r of Object.keys(i)){if(r.toLowerCase()===oL)continue;let n=wi(r);t.push(n);let o=i[r];typeof o=="string"?e[n]=`${n}=${wi(o)}`:Array.isArray(o)&&(e[n]=o.slice(0).reduce((s,a)=>s.concat([`${n}=${wi(a)}`]),[]).sort().join("&"))}return t.sort().map(r=>e[r]).filter(r=>r).join("&")}});var xL,T9,OL=h(()=>{xL=i=>T9(i).toISOString().replace(/\.\d{3}Z$/,"Z"),T9=i=>typeof i=="number"?new Date(i*1e3):typeof i=="string"?Number(i)?new Date(Number(i)*1e3):new Date(i):i});var wh,PL=h(()=>{zs();Mr();eh();bi();ML();OL();wh=class{constructor({applyChecksum:t,credentials:e,region:r,service:n,sha256:o,uriEscapePath:s=!0}){this.service=n,this.sha256=o,this.uriEscapePath=s,this.applyChecksum=typeof t=="boolean"?t:!0,this.regionProvider=bt(r),this.credentialProvider=bt(e)}createCanonicalRequest(t,e,r){let n=Object.keys(e).sort();return`${t.method}
${this.getCanonicalPath(t)}
${kL(t)}
${n.map(o=>`${o}:${e[o]}`).join(`
`)}

${n.join(";")}
${r}`}async createStringToSign(t,e,r,n){let o=new this.sha256;o.update(zi(r));let s=await o.digest();return`${n}
${t}
${e}
${Ot(s)}`}getCanonicalPath({path:t}){if(this.uriEscapePath){let e=[];for(let o of t.split("/"))o?.length!==0&&o!=="."&&(o===".."?e.pop():e.push(o));let r=`${t?.startsWith("/")?"/":""}${e.join("/")}${e.length>0&&t?.endsWith("/")?"/":""}`;return wi(r).replace(/%2F/g,"/")}return t}validateResolvedCredentials(t){if(typeof t!="object"||typeof t.accessKeyId!="string"||typeof t.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate(t){let e=xL(t).replace(/[\-:]/g,"");return{longDate:e,shortDate:e.slice(0,8)}}getCanonicalHeaderList(t){return Object.keys(t).sort().join(";")}}});var qc,RL=h(()=>{zs();bi();Rr();m_();gL();vL();CL();TL();IL();AL();PL();qc=class extends wh{constructor({applyChecksum:t,credentials:e,region:r,service:n,sha256:o,uriEscapePath:s=!0}){super({applyChecksum:t,credentials:e,region:r,service:n,sha256:o,uriEscapePath:s}),this.headerFormatter=new bh}async presign(t,e={}){let{signingDate:r=new Date,expiresIn:n=3600,unsignableHeaders:o,unhoistableHeaders:s,signableHeaders:a,hoistableHeaders:l,signingRegion:c,signingService:d}=e,u=await this.credentialProvider();this.validateResolvedCredentials(u);let f=c??await this.regionProvider(),{longDate:m,shortDate:S}=this.formatDate(r);if(n>hL)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");let T=yh(S,f,d??this.service),_=EL(y_(t),{unhoistableHeaders:s,hoistableHeaders:l});u.sessionToken&&(_.query[l_]=u.sessionToken),_.query[eL]=gh,_.query[tL]=`${u.accessKeyId}/${T}`,_.query[d_]=m,_.query[rL]=n.toString(10);let C=g_(_,o,a);return _.query[iL]=this.getCanonicalHeaderList(C),_.query[c_]=await this.getSignature(m,T,this.getSigningKey(u,f,S,d),this.createCanonicalRequest(_,C,await vh(t,this.sha256))),_}async sign(t,e){return typeof t=="string"?this.signString(t,e):t.headers&&t.payload?this.signEvent(t,e):t.message?this.signMessage(t,e):this.signRequest(t,e)}async signEvent({headers:t,payload:e},{signingDate:r=new Date,priorSignature:n,signingRegion:o,signingService:s}){let a=o??await this.regionProvider(),{shortDate:l,longDate:c}=this.formatDate(r),d=yh(l,a,s??this.service),u=await vh({headers:{},body:e},this.sha256),f=new this.sha256;f.update(t);let m=Ot(await f.digest()),S=[lL,c,d,n,m,u].join(`
`);return this.signString(S,{signingDate:r,signingRegion:a,signingService:s})}async signMessage(t,{signingDate:e=new Date,signingRegion:r,signingService:n}){return this.signEvent({headers:this.headerFormatter.format(t.message.headers),payload:t.message.body},{signingDate:e,signingRegion:r,signingService:n,priorSignature:t.priorSignature}).then(s=>({message:t.message,signature:s}))}async signString(t,{signingDate:e=new Date,signingRegion:r,signingService:n}={}){let o=await this.credentialProvider();this.validateResolvedCredentials(o);let s=r??await this.regionProvider(),{shortDate:a}=this.formatDate(e),l=new this.sha256(await this.getSigningKey(o,s,a,n));return l.update(zi(t)),Ot(await l.digest())}async signRequest(t,{signingDate:e=new Date,signableHeaders:r,unsignableHeaders:n,signingRegion:o,signingService:s}={}){let a=await this.credentialProvider();this.validateResolvedCredentials(a);let l=o??await this.regionProvider(),c=y_(t),{longDate:d,shortDate:u}=this.formatDate(e),f=yh(u,l,s??this.service);c.headers[f_]=d,a.sessionToken&&(c.headers[sL]=a.sessionToken);let m=await vh(c,this.sha256);!_L(Uc,c.headers)&&this.applyChecksum&&(c.headers[Uc]=m);let S=g_(c,n,r),T=await this.getSignature(d,f,this.getSigningKey(a,l,u,s),this.createCanonicalRequest(c,S,m));return c.headers[u_]=`${gh} Credential=${a.accessKeyId}/${f}, SignedHeaders=${this.getCanonicalHeaderList(S)}, Signature=${T}`,c}async getSignature(t,e,r,n){let o=await this.createStringToSign(t,e,n,gh),s=new this.sha256(await r);return s.update(zi(o)),Ot(await s.digest())}getSigningKey(t,e,r,n){return mL(this.sha256,t,r,e,n||this.service)}}});var DL=h(()=>{});var NL=h(()=>{RL();Rr();m_();DL()});function E9(i,{credentials:t,credentialDefaultProvider:e}){let r;return t?t?.memoized?r=t:r=p1(t,h1,HC):e?r=oo(e(Object.assign({},i,{parentClientConfig:i}))):r=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},r.memoized=!0,r}function I9(i,t){if(t.configBound)return t;let e=async r=>t({...r,callerClientConfig:i});return e.memoized=t.memoized,e.configBound=!0,e}var LL,FL=h(()=>{n_();Xe();NL();LL=i=>{let t=i.credentials,e=!!i.credentials,r;Object.defineProperty(i,"credentials",{set(c){c&&c!==t&&c!==r&&(e=!0),t=c;let d=E9(i,{credentials:t,credentialDefaultProvider:i.credentialDefaultProvider}),u=I9(i,d);e&&!u.attributed?(r=async f=>u(f).then(m=>PN(m,"CREDENTIALS_CODE","e")),r.memoized=u.memoized,r.configBound=u.configBound,r.attributed=!0):r=u},get(){return r},enumerable:!0,configurable:!0}),i.credentials=t;let{signingEscapePath:n=!0,systemClockOffset:o=i.systemClockOffset||0,sha256:s}=i,a;return i.signer?a=oo(i.signer):i.regionInfoProvider?a=()=>oo(i.region)().then(async c=>[await i.regionInfoProvider(c,{useFipsEndpoint:await i.useFipsEndpoint(),useDualstackEndpoint:await i.useDualstackEndpoint()})||{},c]).then(([c,d])=>{let{signingRegion:u,signingService:f}=c;i.signingRegion=i.signingRegion||u||d,i.signingName=i.signingName||f||i.serviceId;let m={...i,credentials:i.credentials,region:i.signingRegion,service:i.signingName,sha256:s,uriEscapePath:n},S=i.signerConstructor||qc;return new S(m)}):a=async c=>{c=Object.assign({},{name:"sigv4",signingName:i.signingName||i.defaultSigningName,signingRegion:await oo(i.region)(),properties:{}},c);let d=c.signingRegion,u=c.signingName;i.signingRegion=i.signingRegion||d,i.signingName=i.signingName||u||i.serviceId;let f={...i,credentials:i.credentials,region:i.signingRegion,service:i.signingName,sha256:s,uriEscapePath:n},m=i.signerConstructor||qc;return new m(f)},Object.assign(i,{systemClockOffset:o,signingEscapePath:n,signer:a})}});var BL=h(()=>{HN();$N();ZN();FL()});var VL=h(()=>{BL();zN()});var UL,qL,HL=h(()=>{UL=typeof TextEncoder=="function"?new TextEncoder:null,qL=i=>{if(typeof i=="string"){if(UL)return UL.encode(i).byteLength;let t=i.length;for(let e=t-1;e>=0;e--){let r=i.charCodeAt(e);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&e--}return t}else{if(typeof i.byteLength=="number")return i.byteLength;if(typeof i.size=="number")return i.size}throw new Error(`Body Length computation failed for ${i}`)}});var zL=h(()=>{HL()});var $L=h(()=>{});var jL=h(()=>{});var uo,Dr,Ks,WL,GL,KL=h(()=>{uo=(i,t)=>{let e=[];if(i&&e.push(i),t)for(let r of t)e.push(r);return e},Dr=(i,t)=>`${i||"anonymous"}${t&&t.length>0?` (a.k.a. ${t.join(",")})`:""}`,Ks=()=>{let i=[],t=[],e=!1,r=new Set,n=u=>u.sort((f,m)=>WL[m.step]-WL[f.step]||GL[m.priority||"normal"]-GL[f.priority||"normal"]),o=u=>{let f=!1,m=S=>{let T=uo(S.name,S.aliases);if(T.includes(u)){f=!0;for(let _ of T)r.delete(_);return!1}return!0};return i=i.filter(m),t=t.filter(m),f},s=u=>{let f=!1,m=S=>{if(S.middleware===u){f=!0;for(let T of uo(S.name,S.aliases))r.delete(T);return!1}return!0};return i=i.filter(m),t=t.filter(m),f},a=u=>(i.forEach(f=>{u.add(f.middleware,{...f})}),t.forEach(f=>{u.addRelativeTo(f.middleware,{...f})}),u.identifyOnResolve?.(d.identifyOnResolve()),u),l=u=>{let f=[];return u.before.forEach(m=>{m.before.length===0&&m.after.length===0?f.push(m):f.push(...l(m))}),f.push(u),u.after.reverse().forEach(m=>{m.before.length===0&&m.after.length===0?f.push(m):f.push(...l(m))}),f},c=(u=!1)=>{let f=[],m=[],S={};return i.forEach(_=>{let C={..._,before:[],after:[]};for(let I of uo(C.name,C.aliases))S[I]=C;f.push(C)}),t.forEach(_=>{let C={..._,before:[],after:[]};for(let I of uo(C.name,C.aliases))S[I]=C;m.push(C)}),m.forEach(_=>{if(_.toMiddleware){let C=S[_.toMiddleware];if(C===void 0){if(u)return;throw new Error(`${_.toMiddleware} is not found when adding ${Dr(_.name,_.aliases)} middleware ${_.relation} ${_.toMiddleware}`)}_.relation==="after"&&C.after.push(_),_.relation==="before"&&C.before.push(_)}}),n(f).map(l).reduce((_,C)=>(_.push(...C),_),[])},d={add:(u,f={})=>{let{name:m,override:S,aliases:T}=f,_={step:"initialize",priority:"normal",middleware:u,...f},C=uo(m,T);if(C.length>0){if(C.some(I=>r.has(I))){if(!S)throw new Error(`Duplicate middleware name '${Dr(m,T)}'`);for(let I of C){let A=i.findIndex(V=>V.name===I||V.aliases?.some(W=>W===I));if(A===-1)continue;let E=i[A];if(E.step!==_.step||_.priority!==E.priority)throw new Error(`"${Dr(E.name,E.aliases)}" middleware with ${E.priority} priority in ${E.step} step cannot be overridden by "${Dr(m,T)}" middleware with ${_.priority} priority in ${_.step} step.`);i.splice(A,1)}}for(let I of C)r.add(I)}i.push(_)},addRelativeTo:(u,f)=>{let{name:m,override:S,aliases:T}=f,_={middleware:u,...f},C=uo(m,T);if(C.length>0){if(C.some(I=>r.has(I))){if(!S)throw new Error(`Duplicate middleware name '${Dr(m,T)}'`);for(let I of C){let A=t.findIndex(V=>V.name===I||V.aliases?.some(W=>W===I));if(A===-1)continue;let E=t[A];if(E.toMiddleware!==_.toMiddleware||E.relation!==_.relation)throw new Error(`"${Dr(E.name,E.aliases)}" middleware ${E.relation} "${E.toMiddleware}" middleware cannot be overridden by "${Dr(m,T)}" middleware ${_.relation} "${_.toMiddleware}" middleware.`);t.splice(A,1)}}for(let I of C)r.add(I)}t.push(_)},clone:()=>a(Ks()),use:u=>{u.applyToStack(d)},remove:u=>typeof u=="string"?o(u):s(u),removeByTag:u=>{let f=!1,m=S=>{let{tags:T,name:_,aliases:C}=S;if(T&&T.includes(u)){let I=uo(_,C);for(let A of I)r.delete(A);return f=!0,!1}return!0};return i=i.filter(m),t=t.filter(m),f},concat:u=>{let f=a(Ks());return f.use(u),f.identifyOnResolve(e||f.identifyOnResolve()||(u.identifyOnResolve?.()??!1)),f},applyToStack:a,identify:()=>c(!0).map(u=>{let f=u.step??u.relation+" "+u.toMiddleware;return Dr(u.name,u.aliases)+" - "+f}),identifyOnResolve(u){return typeof u=="boolean"&&(e=u),e},resolve:(u,f)=>{for(let m of c().map(S=>S.middleware).reverse())u=m(u,f);return e&&console.log(d.identify()),u}};return d},WL={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},GL={high:3,normal:2,low:1}});var v_=h(()=>{KL()});var Hc,JL=h(()=>{v_();Hc=class{constructor(t){this.config=t,this.middlewareStack=Ks()}send(t,e,r){let n=typeof e!="function"?e:void 0,o=typeof e=="function"?e:r,s=n===void 0&&this.config.cacheMiddleware===!0,a;if(s){this.handlers||(this.handlers=new WeakMap);let l=this.handlers;l.has(t.constructor)?a=l.get(t.constructor):(a=t.resolveMiddleware(this.middlewareStack,this.config,n),l.set(t.constructor,a))}else delete this.handlers,a=t.resolveMiddleware(this.middlewareStack,this.config,n);if(o)a(t).then(l=>o(null,l.output),l=>o(l)).catch(()=>{});else return a(t).then(l=>l.output)}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}});var QL=h(()=>{qC()});function Ch(i,t){if(t==null)return t;let e=Pc.of(i);if(e.getMergedTraits().sensitive)return b_;if(e.isListSchema()){if(!!e.getValueSchema().getMergedTraits().sensitive)return b_}else if(e.isMapSchema()){if(!!e.getKeySchema().getMergedTraits().sensitive||!!e.getValueSchema().getMergedTraits().sensitive)return b_}else if(e.isStructSchema()&&typeof t=="object"){let r=t,n={};for(let[o,s]of e.structIterator())r[o]!=null&&(n[o]=Ch(s,r[o]));return n}return t}var b_,XL=h(()=>{RD();b_="***SensitiveInformation***"});var M,w_,YL=h(()=>{v_();Ic();XL();M=class{constructor(){this.middlewareStack=Ks()}static classBuilder(){return new w_}resolveMiddlewareWithContext(t,e,r,{middlewareFn:n,clientName:o,commandName:s,inputFilterSensitiveLog:a,outputFilterSensitiveLog:l,smithyContext:c,additionalContext:d,CommandCtor:u}){for(let _ of n.bind(this)(u,t,e,r))this.middlewareStack.use(_);let f=t.concat(this.middlewareStack),{logger:m}=e,S={logger:m,clientName:o,commandName:s,inputFilterSensitiveLog:a,outputFilterSensitiveLog:l,[Ec]:{commandInstance:this,...c},...d},{requestHandler:T}=e;return f.resolve(_=>T.handle(_.request,r||{}),S)}},w_=class{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=void 0,this._outputFilterSensitiveLog=void 0,this._serializer=null,this._deserializer=null}init(t){this._init=t}ep(t){return this._ep=t,this}m(t){return this._middlewareFn=t,this}s(t,e,r={}){return this._smithyContext={service:t,operation:e,...r},this}c(t={}){return this._additionalContext=t,this}n(t,e){return this._clientName=t,this._commandName=e,this}f(t=r=>r,e=r=>r){return this._inputFilterSensitiveLog=t,this._outputFilterSensitiveLog=e,this}ser(t){return this._serializer=t,this}de(t){return this._deserializer=t,this}sc(t){return this._operationSchema=t,this._smithyContext.operationSchema=t,this}build(){let t=this,e;return e=class extends M{static getEndpointParameterInstructions(){return t._ep}constructor(...[r]){super(),this.serialize=t._serializer,this.deserialize=t._deserializer,this.input=r??{},t._init(this),this.schema=t._operationSchema}resolveMiddleware(r,n,o){return this.resolveMiddlewareWithContext(r,n,o,{CommandCtor:e,middlewareFn:t._middlewareFn,clientName:t._clientName,commandName:t._commandName,inputFilterSensitiveLog:t._inputFilterSensitiveLog??(t._operationSchema?Ch.bind(null,t._operationSchema.input):s=>s),outputFilterSensitiveLog:t._outputFilterSensitiveLog??(t._operationSchema?Ch.bind(null,t._operationSchema.output):s=>s),smithyContext:t._smithyContext,additionalContext:t._additionalContext})}}}}});var q,ZL=h(()=>{q="***SensitiveInformation***"});var eF,tF=h(()=>{eF=(i,t)=>{for(let e of Object.keys(i)){let r=i[e],n=async function(s,a,l){let c=new r(s);if(typeof a=="function")this.send(c,a);else if(typeof l=="function"){if(typeof a!="object")throw new Error(`Expected http options but got ${typeof a}`);this.send(c,a||{},l)}else return this.send(c,a)},o=(e[0].toLowerCase()+e.slice(1)).replace(/Command$/,"");t.prototype[o]=n}}});var _h,Dt,C_=h(()=>{_h=class i extends Error{constructor(t){super(t.message),Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=t.name,this.$fault=t.$fault,this.$metadata=t.$metadata}static isInstance(t){if(!t)return!1;let e=t;return i.prototype.isPrototypeOf(e)||!!e.$fault&&!!e.$metadata&&(e.$fault==="client"||e.$fault==="server")}static[Symbol.hasInstance](t){if(!t)return!1;let e=t;return this===i?i.isInstance(t):i.isInstance(t)?e.name&&this.name?this.prototype.isPrototypeOf(t)||e.name===this.name:this.prototype.isPrototypeOf(t):!1}},Dt=(i,t={})=>{Object.entries(t).filter(([,r])=>r!==void 0).forEach(([r,n])=>{(i[r]==null||i[r]==="")&&(i[r]=n)});let e=i.message||i.Message||"UnknownError";return i.message=e,delete i.Message,i}});var A9,iF,k9,rF=h(()=>{C_();A9=({output:i,parsedBody:t,exceptionCtor:e,errorCode:r})=>{let n=k9(i),o=n.httpStatusCode?n.httpStatusCode+"":void 0,s=new e({name:t?.code||t?.Code||r||o||"UnknownError",$fault:"client",$metadata:n});throw Dt(s,t)},iF=i=>({output:t,parsedBody:e,errorCode:r})=>{A9({output:t,parsedBody:e,exceptionCtor:i,errorCode:r})},k9=i=>({httpStatusCode:i.statusCode,requestId:i.headers["x-amzn-requestid"]??i.headers["x-amzn-request-id"]??i.headers["x-amz-request-id"],extendedRequestId:i.headers["x-amz-id-2"],cfId:i.headers["x-amz-cf-id"]})});var nF,oF=h(()=>{nF=i=>{switch(i){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}}});var sF=h(()=>{});var aF=h(()=>{});var dF,cF,lF=h(()=>{Ic();dF=i=>{let t=[];for(let e in Us){let r=Us[e];i[r]!==void 0&&t.push({algorithmId:()=>r,checksumConstructor:()=>i[r]})}return{addChecksumAlgorithm(e){t.push(e)},checksumAlgorithms(){return t}}},cF=i=>{let t={};return i.checksumAlgorithms().forEach(e=>{t[e.algorithmId()]=e.checksumConstructor()}),t}});var uF,fF,hF=h(()=>{uF=i=>({setRetryStrategy(t){i.retryStrategy=t},retryStrategy(){return i.retryStrategy}}),fF=i=>{let t={};return t.retryStrategy=i.retryStrategy(),t}});var pF,mF,gF=h(()=>{lF();hF();pF=i=>Object.assign(dF(i),uF(i)),mF=i=>Object.assign(cF(i),fF(i))});var SF=h(()=>{gF()});var yF=h(()=>{});var vF=h(()=>{});var ue,bF=h(()=>{ue=i=>i!=null});var Js,wF=h(()=>{Js=class{trace(){}debug(){}info(){}warn(){}error(){}}});function k(i,t,e){let r,n,o;if(typeof t>"u"&&typeof e>"u")r={},o=i;else{if(r=i,typeof t=="function")return n=t,o=e,M9(r,n,o);o=t}for(let s of Object.keys(o)){if(!Array.isArray(o[s])){r[s]=o[s];continue}CF(r,null,o,s)}return r}var B,M9,CF,x9,O9,_F=h(()=>{B=(i,t)=>{let e={};for(let r in t)CF(e,i,t,r);return e},M9=(i,t,e)=>k(i,Object.entries(e).reduce((r,[n,o])=>(Array.isArray(o)?r[n]=o:typeof o=="function"?r[n]=[t,o()]:r[n]=[t,o],r),{})),CF=(i,t,e,r)=>{if(t!==null){let s=e[r];typeof s=="function"&&(s=[,s]);let[a=x9,l=O9,c=r]=s;(typeof a=="function"&&a(t[c])||typeof a!="function"&&a)&&(i[r]=l(t[c]));return}let[n,o]=e[r];if(typeof o=="function"){let s,a=n===void 0&&(s=o())!=null,l=typeof n=="function"&&!!n(void 0)||typeof n!="function"&&!!n;a?i[r]=s:l&&(i[r]=o())}else{let s=n===void 0&&o!=null,a=typeof n=="function"&&!!n(o)||typeof n!="function"&&!!n;(s||a)&&(i[r]=o)}},x9=i=>i!=null,O9=i=>i});var TF=h(()=>{});var __,EF=h(()=>{__=i=>i.toISOString().replace(".000Z","Z")});var $,IF=h(()=>{$=i=>{if(i==null)return{};if(Array.isArray(i))return i.filter(t=>t!=null).map($);if(typeof i=="object"){let t={};for(let e of Object.keys(i))i[e]!=null&&(t[e]=$(i[e]));return t}return i}});var j=h(()=>{JL();QL();YL();ZL();tF();rF();oF();sF();C_();aF();SF();yF();vF();bF();wF();_F();TF();EF();IF();KD()});var AF,kF=h(()=>{j();bi();AF=(i,t)=>ot(i,t).then(e=>(t?.utf8Encoder??Hs)(e))});var de,MF,xF,OF=h(()=>{kF();de=(i,t)=>AF(i,t).then(e=>{if(e.length)try{return JSON.parse(e)}catch(r){throw r?.name==="SyntaxError"&&Object.defineProperty(r,"$responseBodyText",{value:e}),r}return{}}),MF=async(i,t)=>{let e=await de(i,t);return e.message=e.message??e.Message,e},xF=(i,t)=>{let e=(o,s)=>Object.keys(o).find(a=>a.toLowerCase()===s.toLowerCase()),r=o=>{let s=o;return typeof s=="number"&&(s=s.toString()),s.indexOf(",")>=0&&(s=s.split(",")[0]),s.indexOf(":")>=0&&(s=s.split(":")[0]),s.indexOf("#")>=0&&(s=s.split("#")[1]),s},n=e(i.headers,"x-amzn-errortype");if(n!==void 0)return r(i.headers[n]);if(t&&typeof t=="object"){let o=e(t,"code");if(o&&t[o]!==void 0)return r(t[o]);if(t.__type!==void 0)return r(t.__type)}}});var PF=h(()=>{});var RF=h(()=>{});var DF=h(()=>{});var NF=h(()=>{});var LF=h(()=>{});var FF=h(()=>{});var BF=h(()=>{});var VF=h(()=>{});var UF=h(()=>{});var qF=h(()=>{});var HF=h(()=>{});var zF=h(()=>{});var $F=h(()=>{});var jF=h(()=>{});var T_=h(()=>{jF()});var WF=h(()=>{$F();T_()});var GF=h(()=>{WF();T_()});var KF=h(()=>{GF()});var JF=h(()=>{});var QF=h(()=>{});var XF=h(()=>{$L();jL();LF();FF();NF();BF();DF();PF();RF();VF();OF();HF();qF();QF();JF();UF();KF();zF()});var zc=h(()=>{n_();VL();XF()});async function YF(i,t,e){if(e.request?.headers?.["smithy-protocol"]==="rpc-v2-cbor"&&Zt(i,"PROTOCOL_RPC_V2_CBOR","M"),typeof t.retryStrategy=="function"){let o=await t.retryStrategy();typeof o.acquireInitialRetryToken=="function"?o.constructor?.name?.includes("Adaptive")?Zt(i,"RETRY_MODE_ADAPTIVE","F"):Zt(i,"RETRY_MODE_STANDARD","E"):Zt(i,"RETRY_MODE_LEGACY","D")}if(typeof t.accountIdEndpointMode=="function"){let o=i.endpointV2;switch(String(o?.url?.hostname).match(R9)&&Zt(i,"ACCOUNT_ID_ENDPOINT","O"),await t.accountIdEndpointMode?.()){case"disabled":Zt(i,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":Zt(i,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":Zt(i,"ACCOUNT_ID_MODE_REQUIRED","R");break}}let n=i.__smithy_context?.selectedHttpAuthScheme?.identity;if(n?.$source){let o=n;o.accountId&&Zt(i,"RESOLVED_ACCOUNT_ID","T");for(let[s,a]of Object.entries(o.$source??{}))Zt(i,s,a)}}var R9,ZF=h(()=>{zc();R9=/\d{12}\.ddb/});var E_,Th,eB,tB,iB=h(()=>{E_="user-agent",Th="x-amz-user-agent",eB=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,tB=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g});function rB(i){let t="";for(let e in i){let r=i[e];if(t.length+r.length+1<=1024){t.length?t+=","+r:t+=r;continue}break}return t}var nB=h(()=>{});var D9,Eh,N9,aB,dB=h(()=>{r_();nt();ZF();iB();nB();D9=i=>(t,e)=>async r=>{let{request:n}=r;if(!De.isInstance(n))return t(r);let{headers:o}=n,s=e?.userAgent?.map(Eh)||[],a=(await i.defaultUserAgentProvider()).map(Eh);await YF(e,i,r);let l=e;a.push(`m/${rB(Object.assign({},e.__smithy_context?.features,l.__aws_sdk_context?.features))}`);let c=i?.customUserAgent?.map(Eh)||[],d=await i.userAgentAppId();d&&a.push(Eh([`app/${d}`]));let u=yN(),f=(u?[u]:[]).concat([...a,...s,...c]).join(" "),m=[...a.filter(S=>S.startsWith("aws-sdk-")),...c].join(" ");return i.runtime!=="browser"?(m&&(o[Th]=o[Th]?`${o[E_]} ${m}`:m),o[E_]=f):o[Th]=f,t({...r,request:n})},Eh=i=>{let t=i[0].split("/").map(s=>s.replace(eB,"-")).join("/"),e=i[1]?.replace(tB,"-"),r=t.indexOf("/"),n=t.substring(0,r),o=t.substring(r+1);return n==="api"&&(o=o.toLowerCase()),[n,o,e].filter(s=>s&&s.length>0).reduce((s,a,l)=>{switch(l){case 0:return a;case 1:return`${s}/${a}`;default:return`${s}#${a}`}},"")},N9={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},aB=i=>({applyToStack:t=>{t.add(D9(i),N9)}})});var cB=h(()=>{y1();dB()});var lB,uB=h(()=>{lB=!1});var fB,hB=h(()=>{fB=!1});var pB=h(()=>{});var mB=h(()=>{});var gB=h(()=>{uB();hB();pB();mB()});var SB=h(()=>{});var Ih,A_=h(()=>{Ih=i=>typeof i=="string"&&(i.startsWith("fips-")||i.endsWith("-fips"))});var k_,yB=h(()=>{A_();k_=i=>Ih(i)?["fips-aws-global","aws-fips"].includes(i)?"us-east-1":i.replace(/fips-(dkr-|prod-)?|-fips/,""):i});var vB,bB=h(()=>{yB();A_();vB=i=>{let{region:t,useFipsEndpoint:e}=i;if(!t)throw new Error("Region is missing");return Object.assign(i,{region:async()=>{if(typeof t=="string")return k_(t);let r=await t();return k_(r)},useFipsEndpoint:async()=>{let r=typeof t=="string"?t:await t();return Ih(r)?!0:typeof e!="function"?Promise.resolve(!!e):e()}})}});var wB=h(()=>{SB();bB()});var CB=h(()=>{});var _B=h(()=>{});var TB=h(()=>{});var EB=h(()=>{CB();_B();TB()});var M_=h(()=>{gB();wB();EB()});function L9(i){return t=>async e=>{let r=e.request;if(De.isInstance(r)){let{body:n,headers:o}=r;if(n&&Object.keys(o).map(s=>s.toLowerCase()).indexOf(IB)===-1)try{let s=i(n);r.headers={...r.headers,[IB]:String(s)}}catch{}}return t({...e,request:r})}}var IB,F9,AB,kB=h(()=>{nt();IB="content-length";F9={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},AB=i=>({applyToStack:t=>{t.add(L9(i.bodyLengthChecker),F9)}})});var MB,B9,V9,U9,q9,H9,xB=h(()=>{MB=async i=>{let t=i?.Bucket||"";if(typeof i.Bucket=="string"&&(i.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),H9(t)){if(i.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!q9(t)||t.indexOf(".")!==-1&&!String(i.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(i.ForcePathStyle=!0);return i.DisableMultiRegionAccessPoints&&(i.disableMultiRegionAccessPoints=!0,i.DisableMRAP=!0),i},B9=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,V9=/(\d+\.){3}\d+/,U9=/\.\./,q9=i=>B9.test(i)&&!V9.test(i)&&!U9.test(i),H9=i=>{let[t,e,r,,,n]=i.split(":"),o=t==="arn"&&i.split(":").length>=6,s=!!(o&&e&&r&&n);if(o&&!s)throw new Error(`Invalid ARN: ${i} was an invalid ARN.`);return s}});var OB=h(()=>{xB()});var PB,RB=h(()=>{PB=(i,t,e)=>{let r=async()=>{let n=e[i]??e[t];return typeof n=="function"?n():n};return i==="credentialScope"||t==="CredentialScope"?async()=>{let n=typeof e.credentials=="function"?await e.credentials():e.credentials;return n?.credentialScope??n?.CredentialScope}:i==="accountId"||t==="AccountId"?async()=>{let n=typeof e.credentials=="function"?await e.credentials():e.credentials;return n?.accountId??n?.AccountId}:i==="endpoint"||t==="endpoint"?async()=>{if(e.isCustomEndpoint===!1)return;let n=await r();if(n&&typeof n=="object"){if("url"in n)return n.url.href;if("hostname"in n){let{protocol:o,hostname:s,port:a,path:l}=n;return`${o}//${s}${a?":"+a:""}${l}`}}return n}:r}});var Ah,x_=h(()=>{Ah=async i=>{}});var kh,Mh=h(()=>{i_();kh=i=>typeof i=="object"?"url"in i?Gs(i.url):i:Gs(i)});var DB,z9,O_=h(()=>{OB();RB();x_();Mh();DB=async(i,t,e,r)=>{if(!e.isCustomEndpoint){let s;e.serviceConfiguredEndpoint?s=await e.serviceConfiguredEndpoint():s=await Ah(e.serviceId),s&&(e.endpoint=()=>Promise.resolve(kh(s)),e.isCustomEndpoint=!0)}let n=await z9(i,t,e);if(typeof e.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return e.endpointProvider(n,r)},z9=async(i,t,e)=>{let r={},n=t?.getEndpointParameterInstructions?.()||{};for(let[o,s]of Object.entries(n))switch(s.type){case"staticContextParams":r[o]=s.value;break;case"contextParams":r[o]=i[s.name];break;case"clientContextParams":case"builtInParams":r[o]=await PB(s.name,o,e)();break;case"operationContextParams":r[o]=s.get(i);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(s))}return Object.keys(n).length===0&&Object.assign(r,e),String(e.serviceId).toLowerCase()==="s3"&&await MB(r),r}});var NB=h(()=>{O_();Mh()});var LB,P_=h(()=>{Xe();Mr();O_();LB=({config:i,instructions:t})=>(e,r)=>async n=>{i.isCustomEndpoint&&s1(r,"ENDPOINT_OVERRIDE","N");let o=await DB(n.input,{getEndpointParameterInstructions(){return t}},{...i},r);r.endpointV2=o,r.authSchemes=o.properties?.authSchemes;let s=r.authSchemes?.[0];if(s){r.signing_region=s.signingRegion,r.signing_service=s.signingName;let l=kr(r)?.selectedHttpAuthScheme?.httpAuthOption;l&&(l.signingProperties=Object.assign(l.signingProperties||{},{signing_region:s.signingRegion,signingRegion:s.signingRegion,signing_service:s.signingName,signingName:s.signingName,signingRegionSet:s.signingRegionSet},s.properties))}return e({...n})}});var $9,O,FB=h(()=>{Q();P_();$9={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:Ac.name},O=(i,t)=>({applyToStack:e=>{e.addRelativeTo(LB({config:i,instructions:t}),$9)}})});var BB,VB=h(()=>{Mr();x_();Mh();BB=i=>{let t=i.tls??!0,{endpoint:e,useDualstackEndpoint:r,useFipsEndpoint:n}=i,o=e!=null?async()=>kh(await bt(e)()):void 0,a=Object.assign(i,{endpoint:o,tls:t,isCustomEndpoint:!!e,useDualstackEndpoint:bt(r??!1),useFipsEndpoint:bt(n??!1)}),l;return a.serviceConfiguredEndpoint=async()=>(i.serviceId&&!l&&(l=Ah(i.serviceId)),l),a}});var UB=h(()=>{});var qB=h(()=>{});var Z=h(()=>{NB();P_();FB();VB();UB();qB()});var Wi,fo,R_,xh=h(()=>{(function(i){i.STANDARD="standard",i.ADAPTIVE="adaptive"})(Wi||(Wi={}));fo=3,R_=Wi.STANDARD});var HB,zB,$B,jB,WB,GB=h(()=>{HB=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],zB=["TimeoutError","RequestTimeout","RequestTimeoutException"],$B=[500,502,503,504],jB=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],WB=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"]});var j9,W9,Oh,Ph,KB,D_=h(()=>{GB();j9=i=>i.$metadata?.clockSkewCorrected,W9=i=>{let t=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return i&&i instanceof TypeError?t.has(i.message):!1},Oh=i=>i.$metadata?.httpStatusCode===429||HB.includes(i.name)||i.$retryable?.throttling==!0,Ph=(i,t=0)=>j9(i)||zB.includes(i.name)||jB.includes(i?.code||"")||WB.includes(i?.code||"")||$B.includes(i.$metadata?.httpStatusCode||0)||W9(i)||i.cause!==void 0&&t<=10&&Ph(i.cause,t+1),KB=i=>{if(i.$metadata?.httpStatusCode!==void 0){let t=i.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Ph(i)}return!1}});var $c,N_=h(()=>{D_();$c=class i{constructor(t){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=t?.beta??.7,this.minCapacity=t?.minCapacity??1,this.minFillRate=t?.minFillRate??.5,this.scaleConstant=t?.scaleConstant??.4,this.smooth=t?.smooth??.8;let e=this.getCurrentTimeInSeconds();this.lastThrottleTime=e,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(t){if(this.enabled){if(this.refillTokenBucket(),t>this.currentCapacity){let e=(t-this.currentCapacity)/this.fillRate*1e3;await new Promise(r=>i.setTimeoutFn(r,e))}this.currentCapacity=this.currentCapacity-t}}refillTokenBucket(){let t=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=t;return}let e=(t-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+e),this.lastTimestamp=t}updateClientSendingRate(t){let e;if(this.updateMeasuredRate(),Oh(t)){let n=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=n,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),e=this.cubicThrottle(n),this.enableTokenBucket()}else this.calculateTimeWindow(),e=this.cubicSuccess(this.getCurrentTimeInSeconds());let r=Math.min(e,2*this.measuredTxRate);this.updateTokenBucketRate(r)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(t){return this.getPrecise(t*this.beta)}cubicSuccess(t){return this.getPrecise(this.scaleConstant*Math.pow(t-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(t){this.refillTokenBucket(),this.fillRate=Math.max(t,this.minFillRate),this.maxCapacity=Math.max(t,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){let t=this.getCurrentTimeInSeconds(),e=Math.floor(t*2)/2;if(this.requestCount++,e>this.lastTxRateBucket){let r=this.requestCount/(e-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(r*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=e}}getPrecise(t){return parseFloat(t.toFixed(8))}};$c.setTimeoutFn=setTimeout});var JB,QB,XB=h(()=>{JB="amz-sdk-invocation-id",QB="amz-sdk-request"});var ZB,eV=h(()=>{ZB=()=>{let i=100;return{computeNextBackoffDelay:r=>Math.floor(Math.min(2e4,Math.random()*2**r*i)),setDelayBase:r=>{i=r}}}});var L_,tV=h(()=>{L_=({retryDelay:i,retryCount:t,retryCost:e})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(2e4,i),getRetryCost:()=>e})});var Qs,F_=h(()=>{xh();eV();tV();Qs=class{constructor(t){this.maxAttempts=t,this.mode=Wi.STANDARD,this.capacity=500,this.retryBackoffStrategy=ZB(),this.maxAttemptsProvider=typeof t=="function"?t:async()=>t}async acquireInitialRetryToken(t){return L_({retryDelay:100,retryCount:0})}async refreshRetryTokenForRetry(t,e){let r=await this.getMaxAttempts();if(this.shouldRetry(t,e,r)){let n=e.errorType;this.retryBackoffStrategy.setDelayBase(n==="THROTTLING"?500:100);let o=this.retryBackoffStrategy.computeNextBackoffDelay(t.getRetryCount()),s=e.retryAfterHint?Math.max(e.retryAfterHint.getTime()-Date.now()||0,o):o,a=this.getCapacityCost(n);return this.capacity-=a,L_({retryDelay:s,retryCount:t.getRetryCount()+1,retryCost:a})}throw new Error("No retry token available")}recordSuccess(t){this.capacity=Math.max(500,this.capacity+(t.getRetryCost()??1))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${fo}`),fo}}shouldRetry(t,e,r){return t.getRetryCount()+1<r&&this.capacity>=this.getCapacityCost(e.errorType)&&this.isRetryableError(e.errorType)}getCapacityCost(t){return t==="TRANSIENT"?10:5}isRetryableError(t){return t==="THROTTLING"||t==="TRANSIENT"}}});var Rh,iV=h(()=>{xh();N_();F_();Rh=class{constructor(t,e){this.maxAttemptsProvider=t,this.mode=Wi.ADAPTIVE;let{rateLimiter:r}=e??{};this.rateLimiter=r??new $c,this.standardRetryStrategy=new Qs(t)}async acquireInitialRetryToken(t){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(t)}async refreshRetryTokenForRetry(t,e){return this.rateLimiter.updateClientSendingRate(e),this.standardRetryStrategy.refreshRetryTokenForRetry(t,e)}recordSuccess(t){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(t)}}});var rV=h(()=>{});var nV=h(()=>{});var Dh=h(()=>{iV();rV();N_();F_();xh();XB();nV()});var oV=h(()=>{});var sV=h(()=>{});var aV,dV=h(()=>{aV=i=>i instanceof Error?i:i instanceof Object?Object.assign(new Error,i):typeof i=="string"?new Error(i):new Error(`AWS SDK error wrapper for ${i}`)});var cV=h(()=>{});var lV=h(()=>{});var uV,fV=h(()=>{Mr();Dh();uV=i=>{let{retryStrategy:t,retryMode:e,maxAttempts:r}=i,n=bt(r??fo);return Object.assign(i,{maxAttempts:n,retryStrategy:async()=>t||(await bt(e)()===Wi.ADAPTIVE?new Rh(n):new Qs(n))})}});var hV=h(()=>{});var pV,mV=h(()=>{pV=i=>i?.body instanceof ReadableStream});var J9,Q9,X9,Y9,Z9,gV,e7,SV=h(()=>{nt();D_();j();Dh();BC();mV();dV();J9=i=>(t,e)=>async r=>{let n=await i.retryStrategy(),o=await i.maxAttempts();if(Q9(n)){n=n;let s=await n.acquireInitialRetryToken(e.partition_id),a=new Error,l=0,c=0,{request:d}=r,u=De.isInstance(d);for(u&&(d.headers[JB]=Or());;)try{u&&(d.headers[QB]=`attempt=${l+1}; max=${o}`);let{response:f,output:m}=await t(r);return n.recordSuccess(s),m.$metadata.attempts=l+1,m.$metadata.totalRetryDelay=c,{response:f,output:m}}catch(f){let m=X9(f);if(a=aV(f),u&&pV(d))throw(e.logger instanceof Js?console:e.logger)?.warn("An error was encountered in a non-retryable streaming request."),a;try{s=await n.refreshRetryTokenForRetry(s,m)}catch{throw a.$metadata||(a.$metadata={}),a.$metadata.attempts=l+1,a.$metadata.totalRetryDelay=c,a}l=s.getRetryCount();let S=s.getRetryDelay();c+=S,await new Promise(T=>setTimeout(T,S))}}else return n=n,n?.mode&&(e.userAgent=[...e.userAgent||[],["cfg/retry-mode",n.mode]]),n.retry(t,r)},Q9=i=>typeof i.acquireInitialRetryToken<"u"&&typeof i.refreshRetryTokenForRetry<"u"&&typeof i.recordSuccess<"u",X9=i=>{let t={error:i,errorType:Y9(i)},e=e7(i.$response);return e&&(t.retryAfterHint=e),t},Y9=i=>Oh(i)?"THROTTLING":Ph(i)?"TRANSIENT":KB(i)?"SERVER_ERROR":"CLIENT_ERROR",Z9={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},gV=i=>({applyToStack:t=>{t.add(J9(i),Z9)}}),e7=i=>{if(!Xt.isInstance(i))return;let t=Object.keys(i.headers).find(o=>o.toLowerCase()==="retry-after");if(!t)return;let e=i.headers[t],r=Number(e);return Number.isNaN(r)?new Date(e):new Date(r*1e3)}});var yV=h(()=>{lV();cV();fV();oV();hV();sV();SV()});function t7(i){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"chime",region:i.region},propertiesExtractor:(t,e)=>({signingProperties:{config:t,context:e}})}}var vV,bV,wV,B_=h(()=>{zc();Mr();vV=async(i,t,e)=>({operation:kr(t).operation,region:await bt(i.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});bV=i=>{let t=[];switch(i.operation){default:t.push(t7(i))}return t},wV=i=>{let t=LL(i);return Object.assign(t,{authSchemePreference:bt(i.authSchemePreference??[])})}});var CV,P,ee=h(()=>{CV=i=>Object.assign(i,{useDualstackEndpoint:i.useDualstackEndpoint??!1,useFipsEndpoint:i.useFipsEndpoint??!1,defaultSigningName:"chime"}),P={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}});var TV,_V=h(()=>{TV={name:"@aws-sdk/client-chime-sdk-messaging",description:"AWS SDK for JavaScript Chime Sdk Messaging Client for Node.js, Browser and React Native",version:"3.883.0",scripts:{build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-chime-sdk-messaging","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo chime-sdk-messaging"},main:"./dist-cjs/index.js",types:"./dist-types/index.d.ts",module:"./dist-es/index.js",sideEffects:!1,dependencies:{"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"3.883.0","@aws-sdk/credential-provider-node":"3.883.0","@aws-sdk/middleware-host-header":"3.873.0","@aws-sdk/middleware-logger":"3.876.0","@aws-sdk/middleware-recursion-detection":"3.873.0","@aws-sdk/middleware-user-agent":"3.883.0","@aws-sdk/region-config-resolver":"3.873.0","@aws-sdk/types":"3.862.0","@aws-sdk/util-endpoints":"3.879.0","@aws-sdk/util-user-agent-browser":"3.873.0","@aws-sdk/util-user-agent-node":"3.883.0","@smithy/config-resolver":"^4.1.5","@smithy/core":"^3.9.2","@smithy/fetch-http-handler":"^5.1.1","@smithy/hash-node":"^4.0.5","@smithy/invalid-dependency":"^4.0.5","@smithy/middleware-content-length":"^4.0.5","@smithy/middleware-endpoint":"^4.1.21","@smithy/middleware-retry":"^4.1.22","@smithy/middleware-serde":"^4.0.9","@smithy/middleware-stack":"^4.0.5","@smithy/node-config-provider":"^4.1.4","@smithy/node-http-handler":"^4.1.1","@smithy/protocol-http":"^5.1.3","@smithy/smithy-client":"^4.5.2","@smithy/types":"^4.3.2","@smithy/url-parser":"^4.0.5","@smithy/util-base64":"^4.0.0","@smithy/util-body-length-browser":"^4.0.0","@smithy/util-body-length-node":"^4.0.0","@smithy/util-defaults-mode-browser":"^4.0.29","@smithy/util-defaults-mode-node":"^4.0.29","@smithy/util-endpoints":"^3.0.7","@smithy/util-middleware":"^4.0.5","@smithy/util-retry":"^4.0.7","@smithy/util-utf8":"^4.0.0","@types/uuid":"^9.0.1",tslib:"^2.6.2",uuid:"^9.0.1"},devDependencies:{"@tsconfig/node18":"18.2.4","@types/node":"^18.19.69",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~5.8.3"},engines:{node:">=18.0.0"},typesVersions:{"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files:["dist-*/**"],author:{name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license:"Apache-2.0",browser:{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:"https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-chime-sdk-messaging",repository:{type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-chime-sdk-messaging"}}});var V_,U_=h(()=>{V_=i=>new TextEncoder().encode(i)});var EV=h(()=>{U_()});var IV=h(()=>{});var AV=h(()=>{U_();EV();IV()});function Gi(i){return i instanceof Uint8Array?i:typeof i=="string"?r7(i):ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(i)}var r7,kV=h(()=>{AV();r7=typeof Buffer<"u"&&Buffer.from?function(i){return Buffer.from(i,"utf8")}:V_});function Xs(i){return typeof i=="string"?i.length===0:i.byteLength===0}var MV=h(()=>{});var xV=h(()=>{});var OV=h(()=>{});var Nh=h(()=>{kV();MV();xV();OV()});var q_,H_,PV,RV=h(()=>{q_={name:"SHA-256"},H_={name:"HMAC",hash:q_},PV=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85])});function Ys(){return typeof window<"u"?window:typeof self<"u"?self:n7}var n7,z_=h(()=>{n7={}});var $_,j_=h(()=>{Nh();RV();z_();$_=(function(){function i(t){this.toHash=new Uint8Array(0),this.secret=t,this.reset()}return i.prototype.update=function(t){if(!Xs(t)){var e=Gi(t),r=new Uint8Array(this.toHash.byteLength+e.byteLength);r.set(this.toHash,0),r.set(e,this.toHash.byteLength),this.toHash=r}},i.prototype.digest=function(){var t=this;return this.key?this.key.then(function(e){return Ys().crypto.subtle.sign(H_,e,t.toHash).then(function(r){return new Uint8Array(r)})}):Xs(this.toHash)?Promise.resolve(PV):Promise.resolve().then(function(){return Ys().crypto.subtle.digest(q_,t.toHash)}).then(function(e){return Promise.resolve(new Uint8Array(e))})},i.prototype.reset=function(){var t=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(e,r){Ys().crypto.subtle.importKey("raw",Gi(t.secret),H_,!1,["sign"]).then(e,r)}),this.key.catch(function(){}))},i})()});function DV(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})}function NV(i,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(d){return l([c,d])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(e=0)),e;)try{if(r=1,n&&(o=c[0]&2?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,n=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){e.label=c[1];break}if(c[0]===6&&e.label<o[1]){e.label=o[1],o=c;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(c);break}o[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(i,e)}catch(d){c=[6,d],n=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var LV=h(()=>{});var ut,FV,BV,VV,UV,W_=h(()=>{ut=64,FV=32,BV=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),VV=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],UV=Math.pow(2,53)-1});var jc,qV=h(()=>{W_();jc=(function(){function i(){this.state=Int32Array.from(VV),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return i.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var e=0,r=t.byteLength;if(this.bytesHashed+=r,this.bytesHashed*8>UV)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;r>0;)this.buffer[this.bufferLength++]=t[e++],r--,this.bufferLength===ut&&(this.hashBuffer(),this.bufferLength=0)},i.prototype.digest=function(){if(!this.finished){var t=this.bytesHashed*8,e=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),r=this.bufferLength;if(e.setUint8(this.bufferLength++,128),r%ut>=ut-8){for(var n=this.bufferLength;n<ut;n++)e.setUint8(n,0);this.hashBuffer(),this.bufferLength=0}for(var n=this.bufferLength;n<ut-8;n++)e.setUint8(n,0);e.setUint32(ut-8,Math.floor(t/4294967296),!0),e.setUint32(ut-4,t),this.hashBuffer(),this.finished=!0}for(var o=new Uint8Array(FV),n=0;n<8;n++)o[n*4]=this.state[n]>>>24&255,o[n*4+1]=this.state[n]>>>16&255,o[n*4+2]=this.state[n]>>>8&255,o[n*4+3]=this.state[n]>>>0&255;return o},i.prototype.hashBuffer=function(){for(var t=this,e=t.buffer,r=t.state,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=r[5],d=r[6],u=r[7],f=0;f<ut;f++){if(f<16)this.temp[f]=(e[f*4]&255)<<24|(e[f*4+1]&255)<<16|(e[f*4+2]&255)<<8|e[f*4+3]&255;else{var m=this.temp[f-2],S=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10;m=this.temp[f-15];var T=(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3;this.temp[f]=(S+this.temp[f-7]|0)+(T+this.temp[f-16]|0)}var _=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&c^~l&d)|0)+(u+(BV[f]+this.temp[f]|0)|0)|0,C=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&o^n&s^o&s)|0;u=d,d=c,c=l,l=a+_|0,a=s,s=o,o=n,n=_+C|0}r[0]+=n,r[1]+=o,r[2]+=s,r[3]+=a,r[4]+=l,r[5]+=c,r[6]+=d,r[7]+=u},i})()});function o7(i){var t=Gi(i);if(t.byteLength>ut){var e=new jc;e.update(t),t=e.digest()}var r=new Uint8Array(ut);return r.set(t),r}var HV,zV=h(()=>{LV();W_();qV();Nh();HV=(function(){function i(t){this.secret=t,this.hash=new jc,this.reset()}return i.prototype.update=function(t){if(!(Xs(t)||this.error))try{this.hash.update(Gi(t))}catch(e){this.error=e}},i.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},i.prototype.digest=function(){return DV(this,void 0,void 0,function(){return NV(this,function(t){return[2,this.digestSync()]})})},i.prototype.reset=function(){if(this.hash=new jc,this.secret){this.outer=new jc;var t=o7(this.secret),e=new Uint8Array(ut);e.set(t);for(var r=0;r<ut;r++)t[r]^=54,e[r]^=92;this.hash.update(t),this.outer.update(e);for(var r=0;r<t.byteLength;r++)t[r]=0}},i})()});var $V=h(()=>{zV()});function jV(i){if(a7(i)&&typeof i.crypto.subtle=="object"){var t=i.crypto.subtle;return d7(t)}return!1}function a7(i){if(typeof i=="object"&&typeof i.crypto=="object"){var t=i.crypto.getRandomValues;return typeof t=="function"}return!1}function d7(i){return i&&s7.every(function(t){return typeof i[t]=="function"})}var s7,WV=h(()=>{s7=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"]});var GV=h(()=>{WV()});var KV,JV=h(()=>{j_();$V();GV();z_();Nh();KV=(function(){function i(t){jV(Ys())?this.hash=new $_(t):this.hash=new HV(t)}return i.prototype.update=function(t,e){this.hash.update(Gi(t))},i.prototype.digest=function(){return this.hash.digest()},i.prototype.reset=function(){this.hash.reset()},i})()});var QV=h(()=>{JV();j_()});var K_=y((Wc,G_)=>{(function(i,t){typeof Wc=="object"&&typeof G_=="object"?G_.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Wc=="object"?Wc.bowser=t():i.bowser=t()})(Wc,(function(){return(function(i){var t={};function e(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return i[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=i,e.c=t,e.d=function(r,n,o){e.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:o})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,n){if(1&n&&(r=e(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var s in r)e.d(o,s,function(a){return r[a]}.bind(null,s));return o},e.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(n,"a",n),n},e.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},e.p="",e(e.s=90)})({17:function(i,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r=e(18),n=(function(){function o(){}return o.getFirstMatch=function(s,a){var l=a.match(s);return l&&l.length>0&&l[1]||""},o.getSecondMatch=function(s,a){var l=a.match(s);return l&&l.length>1&&l[2]||""},o.matchAndReturnConst=function(s,a,l){if(s.test(a))return l},o.getWindowsVersionName=function(s){switch(s){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},o.getMacOSVersionName=function(s){var a=s.split(".").splice(0,2).map((function(l){return parseInt(l,10)||0}));if(a.push(0),a[0]===10)switch(a[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},o.getAndroidVersionName=function(s){var a=s.split(".").splice(0,2).map((function(l){return parseInt(l,10)||0}));if(a.push(0),!(a[0]===1&&a[1]<5))return a[0]===1&&a[1]<6?"Cupcake":a[0]===1&&a[1]>=6?"Donut":a[0]===2&&a[1]<2?"Eclair":a[0]===2&&a[1]===2?"Froyo":a[0]===2&&a[1]>2?"Gingerbread":a[0]===3?"Honeycomb":a[0]===4&&a[1]<1?"Ice Cream Sandwich":a[0]===4&&a[1]<4?"Jelly Bean":a[0]===4&&a[1]>=4?"KitKat":a[0]===5?"Lollipop":a[0]===6?"Marshmallow":a[0]===7?"Nougat":a[0]===8?"Oreo":a[0]===9?"Pie":void 0},o.getVersionPrecision=function(s){return s.split(".").length},o.compareVersions=function(s,a,l){l===void 0&&(l=!1);var c=o.getVersionPrecision(s),d=o.getVersionPrecision(a),u=Math.max(c,d),f=0,m=o.map([s,a],(function(S){var T=u-o.getVersionPrecision(S),_=S+new Array(T+1).join(".0");return o.map(_.split("."),(function(C){return new Array(20-C.length).join("0")+C})).reverse()}));for(l&&(f=u-Math.min(c,d)),u-=1;u>=f;){if(m[0][u]>m[1][u])return 1;if(m[0][u]===m[1][u]){if(u===f)return 0;u-=1}else if(m[0][u]<m[1][u])return-1}},o.map=function(s,a){var l,c=[];if(Array.prototype.map)return Array.prototype.map.call(s,a);for(l=0;l<s.length;l+=1)c.push(a(s[l]));return c},o.find=function(s,a){var l,c;if(Array.prototype.find)return Array.prototype.find.call(s,a);for(l=0,c=s.length;l<c;l+=1){var d=s[l];if(a(d,l))return d}},o.assign=function(s){for(var a,l,c=s,d=arguments.length,u=new Array(d>1?d-1:0),f=1;f<d;f++)u[f-1]=arguments[f];if(Object.assign)return Object.assign.apply(Object,[s].concat(u));var m=function(){var S=u[a];typeof S=="object"&&S!==null&&Object.keys(S).forEach((function(T){c[T]=S[T]}))};for(a=0,l=u.length;a<l;a+=1)m();return s},o.getBrowserAlias=function(s){return r.BROWSER_ALIASES_MAP[s]},o.getBrowserTypeByAlias=function(s){return r.BROWSER_MAP[s]||""},o})();t.default=n,i.exports=t.default},18:function(i,t,e){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast","Pale Moon":"pale_moon",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",pale_moon:"Pale Moon",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv",bot:"bot"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(i,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=e(91))&&r.__esModule?r:{default:r},o=e(18);function s(l,c){for(var d=0;d<c.length;d++){var u=c[d];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,u.key,u)}}var a=(function(){function l(){}var c,d,u;return l.getParser=function(f,m){if(m===void 0&&(m=!1),typeof f!="string")throw new Error("UserAgent should be a string");return new n.default(f,m)},l.parse=function(f){return new n.default(f).getResult()},c=l,u=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(d=null)&&s(c.prototype,d),u&&s(c,u),l})();t.default=a,i.exports=t.default},91:function(i,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r=l(e(92)),n=l(e(93)),o=l(e(94)),s=l(e(95)),a=l(e(17));function l(d){return d&&d.__esModule?d:{default:d}}var c=(function(){function d(f,m){if(m===void 0&&(m=!1),f==null||f==="")throw new Error("UserAgent parameter can't be empty");this._ua=f,this.parsedResult={},m!==!0&&this.parse()}var u=d.prototype;return u.getUA=function(){return this._ua},u.test=function(f){return f.test(this._ua)},u.parseBrowser=function(){var f=this;this.parsedResult.browser={};var m=a.default.find(r.default,(function(S){if(typeof S.test=="function")return S.test(f);if(Array.isArray(S.test))return S.test.some((function(T){return f.test(T)}));throw new Error("Browser's test function is not valid")}));return m&&(this.parsedResult.browser=m.describe(this.getUA())),this.parsedResult.browser},u.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},u.getBrowserName=function(f){return f?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},u.getBrowserVersion=function(){return this.getBrowser().version},u.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},u.parseOS=function(){var f=this;this.parsedResult.os={};var m=a.default.find(n.default,(function(S){if(typeof S.test=="function")return S.test(f);if(Array.isArray(S.test))return S.test.some((function(T){return f.test(T)}));throw new Error("Browser's test function is not valid")}));return m&&(this.parsedResult.os=m.describe(this.getUA())),this.parsedResult.os},u.getOSName=function(f){var m=this.getOS().name;return f?String(m).toLowerCase()||"":m||""},u.getOSVersion=function(){return this.getOS().version},u.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},u.getPlatformType=function(f){f===void 0&&(f=!1);var m=this.getPlatform().type;return f?String(m).toLowerCase()||"":m||""},u.parsePlatform=function(){var f=this;this.parsedResult.platform={};var m=a.default.find(o.default,(function(S){if(typeof S.test=="function")return S.test(f);if(Array.isArray(S.test))return S.test.some((function(T){return f.test(T)}));throw new Error("Browser's test function is not valid")}));return m&&(this.parsedResult.platform=m.describe(this.getUA())),this.parsedResult.platform},u.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},u.getEngineName=function(f){return f?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},u.parseEngine=function(){var f=this;this.parsedResult.engine={};var m=a.default.find(s.default,(function(S){if(typeof S.test=="function")return S.test(f);if(Array.isArray(S.test))return S.test.some((function(T){return f.test(T)}));throw new Error("Browser's test function is not valid")}));return m&&(this.parsedResult.engine=m.describe(this.getUA())),this.parsedResult.engine},u.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},u.getResult=function(){return a.default.assign({},this.parsedResult)},u.satisfies=function(f){var m=this,S={},T=0,_={},C=0;if(Object.keys(f).forEach((function(F){var G=f[F];typeof G=="string"?(_[F]=G,C+=1):typeof G=="object"&&(S[F]=G,T+=1)})),T>0){var I=Object.keys(S),A=a.default.find(I,(function(F){return m.isOS(F)}));if(A){var E=this.satisfies(S[A]);if(E!==void 0)return E}var V=a.default.find(I,(function(F){return m.isPlatform(F)}));if(V){var W=this.satisfies(S[V]);if(W!==void 0)return W}}if(C>0){var D=Object.keys(_),N=a.default.find(D,(function(F){return m.isBrowser(F,!0)}));if(N!==void 0)return this.compareVersion(_[N])}},u.isBrowser=function(f,m){m===void 0&&(m=!1);var S=this.getBrowserName().toLowerCase(),T=f.toLowerCase(),_=a.default.getBrowserTypeByAlias(T);return m&&_&&(T=_.toLowerCase()),T===S},u.compareVersion=function(f){var m=[0],S=f,T=!1,_=this.getBrowserVersion();if(typeof _=="string")return f[0]===">"||f[0]==="<"?(S=f.substr(1),f[1]==="="?(T=!0,S=f.substr(2)):m=[],f[0]===">"?m.push(1):m.push(-1)):f[0]==="="?S=f.substr(1):f[0]==="~"&&(T=!0,S=f.substr(1)),m.indexOf(a.default.compareVersions(_,S,T))>-1},u.isOS=function(f){return this.getOSName(!0)===String(f).toLowerCase()},u.isPlatform=function(f){return this.getPlatformType(!0)===String(f).toLowerCase()},u.isEngine=function(f){return this.getEngineName(!0)===String(f).toLowerCase()},u.is=function(f,m){return m===void 0&&(m=!1),this.isBrowser(f,m)||this.isOS(f)||this.isPlatform(f)},u.some=function(f){var m=this;return f===void 0&&(f=[]),f.some((function(S){return m.is(S)}))},d})();t.default=c,i.exports=t.default},92:function(i,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=e(17))&&r.__esModule?r:{default:r},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(a){var l={name:"Googlebot"},c=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/opera/i],describe:function(a){var l={name:"Opera"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/opr\/|opios/i],describe:function(a){var l={name:"Opera"},c=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/SamsungBrowser/i],describe:function(a){var l={name:"Samsung Internet for Android"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/Whale/i],describe:function(a){var l={name:"NAVER Whale Browser"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/PaleMoon/i],describe:function(a){var l={name:"Pale Moon"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:PaleMoon)[\s/](\d+(?:\.\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/MZBrowser/i],describe:function(a){var l={name:"MZ Browser"},c=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/focus/i],describe:function(a){var l={name:"Focus"},c=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/swing/i],describe:function(a){var l={name:"Swing"},c=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/coast/i],describe:function(a){var l={name:"Opera Coast"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(a){var l={name:"Opera Touch"},c=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/yabrowser/i],describe:function(a){var l={name:"Yandex Browser"},c=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/ucbrowser/i],describe:function(a){var l={name:"UC Browser"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/Maxthon|mxios/i],describe:function(a){var l={name:"Maxthon"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/epiphany/i],describe:function(a){var l={name:"Epiphany"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/puffin/i],describe:function(a){var l={name:"Puffin"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/sleipnir/i],describe:function(a){var l={name:"Sleipnir"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/k-meleon/i],describe:function(a){var l={name:"K-Meleon"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/micromessenger/i],describe:function(a){var l={name:"WeChat"},c=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/qqbrowser/i],describe:function(a){var l={name:/qqbrowserlite/i.test(a)?"QQ Browser Lite":"QQ Browser"},c=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/msie|trident/i],describe:function(a){var l={name:"Internet Explorer"},c=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/\sedg\//i],describe:function(a){var l={name:"Microsoft Edge"},c=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/edg([ea]|ios)/i],describe:function(a){var l={name:"Microsoft Edge"},c=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/vivaldi/i],describe:function(a){var l={name:"Vivaldi"},c=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/seamonkey/i],describe:function(a){var l={name:"SeaMonkey"},c=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/sailfish/i],describe:function(a){var l={name:"Sailfish"},c=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,a);return c&&(l.version=c),l}},{test:[/silk/i],describe:function(a){var l={name:"Amazon Silk"},c=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/phantom/i],describe:function(a){var l={name:"PhantomJS"},c=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/slimerjs/i],describe:function(a){var l={name:"SlimerJS"},c=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var l={name:"BlackBerry"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var l={name:"WebOS Browser"},c=n.default.getFirstMatch(o,a)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/bada/i],describe:function(a){var l={name:"Bada"},c=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/tizen/i],describe:function(a){var l={name:"Tizen"},c=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/qupzilla/i],describe:function(a){var l={name:"QupZilla"},c=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/firefox|iceweasel|fxios/i],describe:function(a){var l={name:"Firefox"},c=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/electron/i],describe:function(a){var l={name:"Electron"},c=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/MiuiBrowser/i],describe:function(a){var l={name:"Miui"},c=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/chromium/i],describe:function(a){var l={name:"Chromium"},c=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,a)||n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/chrome|crios|crmo/i],describe:function(a){var l={name:"Chrome"},c=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/GSA/i],describe:function(a){var l={name:"Google Search"},c=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:function(a){var l=!a.test(/like android/i),c=a.test(/android/i);return l&&c},describe:function(a){var l={name:"Android Browser"},c=n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/playstation 4/i],describe:function(a){var l={name:"PlayStation 4"},c=n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/safari|applewebkit/i],describe:function(a){var l={name:"Safari"},c=n.default.getFirstMatch(o,a);return c&&(l.version=c),l}},{test:[/.*/i],describe:function(a){var l=a.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(l,a),version:n.default.getSecondMatch(l,a)}}}];t.default=s,i.exports=t.default},93:function(i,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=e(17))&&r.__esModule?r:{default:r},o=e(18),s=[{test:[/Roku\/DVP/],describe:function(a){var l=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,a);return{name:o.OS_MAP.Roku,version:l}}},{test:[/windows phone/i],describe:function(a){var l=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,a);return{name:o.OS_MAP.WindowsPhone,version:l}}},{test:[/windows /i],describe:function(a){var l=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,a),c=n.default.getWindowsVersionName(l);return{name:o.OS_MAP.Windows,version:l,versionName:c}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(a){var l={name:o.OS_MAP.iOS},c=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,a);return c&&(l.version=c),l}},{test:[/macintosh/i],describe:function(a){var l=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,a).replace(/[_\s]/g,"."),c=n.default.getMacOSVersionName(l),d={name:o.OS_MAP.MacOS,version:l};return c&&(d.versionName=c),d}},{test:[/(ipod|iphone|ipad)/i],describe:function(a){var l=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,a).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:l}}},{test:function(a){var l=!a.test(/like android/i),c=a.test(/android/i);return l&&c},describe:function(a){var l=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,a),c=n.default.getAndroidVersionName(l),d={name:o.OS_MAP.Android,version:l};return c&&(d.versionName=c),d}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var l=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,a),c={name:o.OS_MAP.WebOS};return l&&l.length&&(c.version=l),c}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var l=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,a)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,a)||n.default.getFirstMatch(/\bbb(\d+)/i,a);return{name:o.OS_MAP.BlackBerry,version:l}}},{test:[/bada/i],describe:function(a){var l=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,a);return{name:o.OS_MAP.Bada,version:l}}},{test:[/tizen/i],describe:function(a){var l=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,a);return{name:o.OS_MAP.Tizen,version:l}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(a){var l=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,a);return{name:o.OS_MAP.PlayStation4,version:l}}}];t.default=s,i.exports=t.default},94:function(i,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=e(17))&&r.__esModule?r:{default:r},o=e(18),s=[{test:[/googlebot/i],describe:function(){return{type:o.PLATFORMS_MAP.bot,vendor:"Google"}}},{test:[/huawei/i],describe:function(a){var l=n.default.getFirstMatch(/(can-l01)/i,a)&&"Nova",c={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return l&&(c.model=l),c}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(a){var l=a.test(/ipod|iphone/i),c=a.test(/like (ipod|iphone)/i);return l&&!c},describe:function(a){var l=n.default.getFirstMatch(/(ipod|iphone)/i,a);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:l}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/Nokia/i],describe:function(a){var l=n.default.getFirstMatch(/Nokia\s+([0-9]+(\.[0-9]+)?)/i,a),c={type:o.PLATFORMS_MAP.mobile,vendor:"Nokia"};return l&&(c.model=l),c}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getBrowserName(!0)==="blackberry"},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(a){return a.getBrowserName(!0)==="bada"},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getBrowserName()==="windows phone"},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(a){var l=Number(String(a.getOSVersion()).split(".")[0]);return a.getOSName(!0)==="android"&&l>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(a){return a.getOSName(!0)==="android"},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getOSName(!0)==="macos"},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(a){return a.getOSName(!0)==="windows"},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(a){return a.getOSName(!0)==="linux"},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(a){return a.getOSName(!0)==="playstation 4"},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(a){return a.getOSName(!0)==="roku"},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];t.default=s,i.exports=t.default},95:function(i,t,e){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=e(17))&&r.__esModule?r:{default:r},o=e(18),s=[{test:function(a){return a.getBrowserName(!0)==="microsoft edge"},describe:function(a){if(/\sedg\//i.test(a))return{name:o.ENGINE_MAP.Blink};var l=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,a);return{name:o.ENGINE_MAP.EdgeHTML,version:l}}},{test:[/trident/i],describe:function(a){var l={name:o.ENGINE_MAP.Trident},c=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:function(a){return a.test(/presto/i)},describe:function(a){var l={name:o.ENGINE_MAP.Presto},c=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:function(a){var l=a.test(/gecko/i),c=a.test(/like gecko/i);return l&&!c},describe:function(a){var l={name:o.ENGINE_MAP.Gecko},c=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(a){var l={name:o.ENGINE_MAP.WebKit},c=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,a);return c&&(l.version=c),l}}];t.default=s,i.exports=t.default}})}))});var XV,YV,ZV=h(()=>{XV=yI(K_()),YV=({serviceId:i,clientVersion:t})=>async e=>{let r=typeof window<"u"&&window?.navigator?.userAgent?XV.default.parse(window.navigator.userAgent):void 0,n=[["aws-sdk-js",t],["ua","2.1"],[`os/${r?.os?.name||"other"}`,r?.os?.version],["lang/js"],["md/browser",`${r?.browser?.name??"unknown"}_${r?.browser?.version??"unknown"}`]];i&&n.push([`api/${i}`,t]);let o=await e?.userAgentAppId?.();return o&&n.push([`app/${o}`]),n}});var e2=h(()=>{});var t2,i2=h(()=>{t2=i=>()=>Promise.reject(i)});var r2=h(()=>{e2();i2()});var h2,Ti,n2,Kc,Zs,Gc,Ki,J_,o2,s2,a2,p2,m2,_i,d2,c2,l2,u2,f2,c7,g2,S2=h(()=>{h2="required",Ti="argv",n2="isSet",Kc="booleanEquals",Zs="error",Gc="endpoint",Ki="tree",J_="PartitionResult",o2={[h2]:!1,type:"String"},s2={[h2]:!0,default:!1,type:"Boolean"},a2={ref:"Endpoint"},p2={fn:Kc,[Ti]:[{ref:"UseFIPS"},!0]},m2={fn:Kc,[Ti]:[{ref:"UseDualStack"},!0]},_i={},d2={fn:"getAttr",[Ti]:[{ref:J_},"supportsFIPS"]},c2={fn:Kc,[Ti]:[!0,{fn:"getAttr",[Ti]:[{ref:J_},"supportsDualStack"]}]},l2=[p2],u2=[m2],f2=[{ref:"Region"}],c7={version:"1.0",parameters:{Region:o2,UseDualStack:s2,UseFIPS:s2,Endpoint:o2},rules:[{conditions:[{fn:n2,[Ti]:[a2]}],rules:[{conditions:l2,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:Zs},{conditions:u2,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:Zs},{endpoint:{url:a2,properties:_i,headers:_i},type:Gc}],type:Ki},{conditions:[{fn:n2,[Ti]:f2}],rules:[{conditions:[{fn:"aws.partition",[Ti]:f2,assign:J_}],rules:[{conditions:[p2,m2],rules:[{conditions:[{fn:Kc,[Ti]:[!0,d2]},c2],rules:[{endpoint:{url:"https://messaging-chime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:_i,headers:_i},type:Gc}],type:Ki},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:Zs}],type:Ki},{conditions:l2,rules:[{conditions:[{fn:Kc,[Ti]:[d2,!0]}],rules:[{endpoint:{url:"https://messaging-chime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:_i,headers:_i},type:Gc}],type:Ki},{error:"FIPS is enabled but this partition does not support FIPS",type:Zs}],type:Ki},{conditions:u2,rules:[{conditions:[c2],rules:[{endpoint:{url:"https://messaging-chime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:_i,headers:_i},type:Gc}],type:Ki},{error:"DualStack is enabled but this partition does not support DualStack",type:Zs}],type:Ki},{endpoint:{url:"https://messaging-chime.{Region}.{PartitionResult#dnsSuffix}",properties:_i,headers:_i},type:Gc}],type:Ki}],type:Ki},{error:"Invalid Configuration: Missing Region",type:Zs}]},g2=c7});var l7,y2,v2=h(()=>{r_();Fc();S2();l7=new ah({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),y2=(i,t={})=>l7.get(i,()=>lN(g2,{endpointParams:i,logger:t.logger}));lo.aws=t_});var b2,w2=h(()=>{zc();j();i_();Zf();bi();B_();v2();b2=i=>({apiVersion:"2021-05-15",base64Decoder:i?.base64Decoder??qs,base64Encoder:i?.base64Encoder??Yf,disableHostPrefix:i?.disableHostPrefix??!1,endpointProvider:i?.endpointProvider??y2,extensions:i?.extensions??[],httpAuthSchemeProvider:i?.httpAuthSchemeProvider??bV,httpAuthSchemes:i?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:t=>t.getIdentityProvider("aws.auth#sigv4"),signer:new Vc}],logger:i?.logger??new Js,serviceId:i?.serviceId??"Chime SDK Messaging",urlParser:i?.urlParser??Gs,utf8Decoder:i?.utf8Decoder??Yt,utf8Encoder:i?.utf8Encoder??Hs})});var C2,_2=h(()=>{C2=["in-region","cross-region","mobile","standard","legacy"]});var T2,E2,u7,I2=h(()=>{YN();T2=yI(K_());_2();E2=({defaultsMode:i}={})=>QN(async()=>{let t=typeof i=="function"?await i():i;switch(t?.toLowerCase()){case"auto":return Promise.resolve(u7()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(t?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${C2.join(", ")}, got ${t}`)}}),u7=()=>{let t=(typeof window<"u"&&window?.navigator?.userAgent?T2.default.parse(window.navigator.userAgent):void 0)?.platform?.type;return t==="tablet"||t==="mobile"}});var A2=h(()=>{I2()});var k2,M2=h(()=>{_V();QV();ZV();M_();wD();r2();zL();Dh();w2();j();A2();k2=i=>{let t=E2(i),e=()=>t().then(nF),r=b2(i);return{...r,...i,runtime:"browser",defaultsMode:t,bodyLengthChecker:i?.bodyLengthChecker??qL,credentialDefaultProvider:i?.credentialDefaultProvider??(n=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:i?.defaultUserAgentProvider??YV({serviceId:r.serviceId,clientVersion:TV.version}),maxAttempts:i?.maxAttempts??fo,region:i?.region??t2("Region is missing"),requestHandler:th.create(i?.requestHandler??e),retryMode:i?.retryMode??(async()=>(await e()).retryMode||R_),sha256:i?.sha256??KV,streamCollector:i?.streamCollector??vD,useDualstackEndpoint:i?.useDualstackEndpoint??(()=>Promise.resolve(lB)),useFipsEndpoint:i?.useFipsEndpoint??(()=>Promise.resolve(fB))}}});var x2,O2,P2=h(()=>{x2=i=>({setRegion(t){i.region=t},region(){return i.region}}),O2=i=>({region:i.region()})});var R2=h(()=>{});var Q_=h(()=>{});var D2=h(()=>{Q_()});var N2=h(()=>{D2();Q_()});var L2=h(()=>{R2();N2()});var F2=h(()=>{P2();L2()});var B2,V2,U2=h(()=>{B2=i=>{let t=i.httpAuthSchemes,e=i.httpAuthSchemeProvider,r=i.credentials;return{setHttpAuthScheme(n){let o=t.findIndex(s=>s.schemeId===n.schemeId);o===-1?t.push(n):t.splice(o,1,n)},httpAuthSchemes(){return t},setHttpAuthSchemeProvider(n){e=n},httpAuthSchemeProvider(){return e},setCredentials(n){r=n},credentials(){return r}}},V2=i=>({httpAuthSchemes:i.httpAuthSchemes(),httpAuthSchemeProvider:i.httpAuthSchemeProvider(),credentials:i.credentials()})});var q2,H2=h(()=>{F2();nt();j();U2();q2=(i,t)=>{let e=Object.assign(x2(i),pF(i),iP(i),B2(i));return t.forEach(r=>r.configure(e)),Object.assign(i,O2(e),mF(e),rP(e),V2(e))}});var Te,ft=h(()=>{IR();MR();OR();cB();M_();Xe();kB();Z();yV();j();B_();ee();M2();H2();Te=class extends Hc{config;constructor(...[t]){let e=k2(t||{});super(e),this.initConfig=e;let r=CV(e),n=S1(r),o=uV(n),s=vB(o),a=s,l=BB(a),c=wV(l),d=q2(c,t?.extensions||[]);this.config=d,this.middlewareStack.use(aB(this.config)),this.middlewareStack.use(gV(this.config)),this.middlewareStack.use(AB(this.config)),this.middlewareStack.use(ER(this.config)),this.middlewareStack.use(AR(this.config)),this.middlewareStack.use(xR(this.config)),this.middlewareStack.use(BR(this.config,{httpAuthSchemeParametersProvider:vV,identityProviderConfigProvider:async u=>new sh({"aws.auth#sigv4":u.credentials})})),this.middlewareStack.use(WR(this.config))}destroy(){super.destroy()}}});var it,Lh=h(()=>{j();it=class i extends _h{constructor(t){super(t),Object.setPrototypeOf(this,i.prototype)}}});var h7,p7,m7,Jc,Qc,Xc,Yc,Zc,el,tl,il,rl,g7,S7,y7,v7,b7,w7,C7,_7,T7,E7,I7,A7,k7,He,z2,X_,$2,j2,W2,G2,nl,K2,ol,Y_,J2,Z_,Q2,X2,sl,e0,Y2,Fh,Z2,eU,tU,t0,iU,rU,al,i0,r0,n0,o0,s0,a0,d0,c0,l0,u0,f0,h0,p0,m0,g0,S0,y0,v0,b0,w0,C0,_0,T0,E0,I0,A0,k0,M0,x0,O0,P0,R0,D0,N0,L0,F0,B0,V0,U0,q0,H0,z0,$0,j0,W0,fe=h(()=>{j();Lh();h7={ALL:"ALL",FILTERED:"FILTERED",NONE:"NONE"},p7={DEFAULT:"DEFAULT",HIDDEN:"HIDDEN"},m7={AccessDenied:"AccessDenied",BadRequest:"BadRequest",Conflict:"Conflict",Forbidden:"Forbidden",NotFound:"NotFound",PhoneNumberAssociationsExist:"PhoneNumberAssociationsExist",PreconditionFailed:"PreconditionFailed",ResourceLimitExceeded:"ResourceLimitExceeded",ServiceFailure:"ServiceFailure",ServiceUnavailable:"ServiceUnavailable",Throttled:"Throttled",Throttling:"Throttling",Unauthorized:"Unauthorized",Unprocessable:"Unprocessable",VoiceConnectorGroupAssociationsExist:"VoiceConnectorGroupAssociationsExist"},Jc=class i extends it{name="BadRequestException";$fault="client";Code;Message;constructor(t){super({name:"BadRequestException",$fault:"client",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},Qc=class i extends it{name="ConflictException";$fault="client";Code;Message;constructor(t){super({name:"ConflictException",$fault:"client",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},Xc=class i extends it{name="ForbiddenException";$fault="client";Code;Message;constructor(t){super({name:"ForbiddenException",$fault:"client",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},Yc=class i extends it{name="NotFoundException";$fault="client";Code;Message;constructor(t){super({name:"NotFoundException",$fault:"client",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},Zc=class i extends it{name="ServiceFailureException";$fault="server";Code;Message;constructor(t){super({name:"ServiceFailureException",$fault:"server",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},el=class i extends it{name="ServiceUnavailableException";$fault="server";Code;Message;constructor(t){super({name:"ServiceUnavailableException",$fault:"server",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},tl=class i extends it{name="ThrottledClientException";$fault="client";Code;Message;constructor(t){super({name:"ThrottledClientException",$fault:"client",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},il=class i extends it{name="UnauthorizedClientException";$fault="client";Code;Message;constructor(t){super({name:"UnauthorizedClientException",$fault:"client",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},rl=class i extends it{name="ResourceLimitExceededException";$fault="client";Code;Message;constructor(t){super({name:"ResourceLimitExceededException",$fault:"client",...t}),Object.setPrototypeOf(this,i.prototype),this.Code=t.Code,this.Message=t.Message}},g7={CREATED_TIMESTAMP:"CREATED_TIMESTAMP",LAST_MESSAGE_TIMESTAMP:"LAST_MESSAGE_TIMESTAMP"},S7={RESTRICTED:"RESTRICTED",UNRESTRICTED:"UNRESTRICTED"},y7={PRIVATE:"PRIVATE",PUBLIC:"PUBLIC"},v7={ASYNC:"ASYNC"},b7={ABORT:"ABORT",CONTINUE:"CONTINUE"},w7={DEFAULT:"DEFAULT",VOIP:"VOIP"},C7={NON_PERSISTENT:"NON_PERSISTENT",PERSISTENT:"PERSISTENT"},_7={DENIED:"DENIED",FAILED:"FAILED",PENDING:"PENDING",SENT:"SENT"},T7={CONTROL:"CONTROL",STANDARD:"STANDARD"},E7={Channel:"Channel",ChannelMessage:"ChannelMessage"},I7={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},A7={MEMBERS:"MEMBERS"},k7={EQUALS:"EQUALS",INCLUDES:"INCLUDES"},He=i=>({...i,...i.Name&&{Name:q}}),z2=i=>({...i,...i.InvitedBy&&{InvitedBy:He(i.InvitedBy)},...i.Members&&{Members:i.Members.map(t=>He(t))}}),X_=i=>({...i,...i.BatchChannelMemberships&&{BatchChannelMemberships:z2(i.BatchChannelMemberships)}}),$2=i=>({...i,...i.Name&&{Name:q},...i.Metadata&&{Metadata:q},...i.CreatedBy&&{CreatedBy:He(i.CreatedBy)}}),j2=i=>({...i,...i.Name&&{Name:q},...i.Metadata&&{Metadata:q}}),W2=i=>({...i,...i.Member&&{Member:He(i.Member)},...i.CreatedBy&&{CreatedBy:He(i.CreatedBy)}}),G2=i=>({...i,...i.Member&&{Member:He(i.Member)}}),nl=i=>({...i,...i.Name&&{Name:q}}),K2=i=>({...i,...i.Processors&&{Processors:i.Processors.map(t=>nl(t))},...i.Name&&{Name:q}}),ol=i=>({...i,...i.StringValues&&{StringValues:q}}),Y_=i=>({...i,...i.Title&&{Title:q},...i.Body&&{Body:q}}),J2=i=>({...i,...i.Content&&{Content:q},...i.Metadata&&{Metadata:q},...i.PushNotification&&{PushNotification:Y_(i.PushNotification)},...i.MessageAttributes&&{MessageAttributes:Object.entries(i.MessageAttributes).reduce((t,[e,r])=>(t[e]=ol(r),t),{})},...i.ContentType&&{ContentType:q}}),Z_=i=>({...i,...i.ChannelMessage&&{ChannelMessage:J2(i.ChannelMessage)}}),Q2=i=>({...i,...i.Name&&{Name:q},...i.Processors&&{Processors:i.Processors.map(t=>nl(t))}}),X2=i=>({...i,...i.InvitedBy&&{InvitedBy:He(i.InvitedBy)},...i.Member&&{Member:He(i.Member)}}),sl=i=>({...i,...i.Name&&{Name:q},...i.Metadata&&{Metadata:q}}),e0=i=>({...i,...i.ChannelSummary&&{ChannelSummary:sl(i.ChannelSummary)}}),Y2=i=>({...i,...i.FilterRule&&{FilterRule:q}}),Fh=i=>({...i,...i.PushNotifications&&{PushNotifications:Y2(i.PushNotifications)}}),Z2=i=>({...i,...i.Member&&{Member:He(i.Member)}}),eU=i=>({...i,...i.Content&&{Content:q},...i.Metadata&&{Metadata:q},...i.Sender&&{Sender:He(i.Sender)},...i.MessageAttributes&&{MessageAttributes:Object.entries(i.MessageAttributes).reduce((t,[e,r])=>(t[e]=ol(r),t),{})},...i.ContentType&&{ContentType:q}}),tU=i=>({...i,...i.Content&&{Content:q},...i.Metadata&&{Metadata:q},...i.Sender&&{Sender:He(i.Sender)},...i.MessageAttributes&&{MessageAttributes:Object.entries(i.MessageAttributes).reduce((t,[e,r])=>(t[e]=ol(r),t),{})},...i.ContentType&&{ContentType:q}}),t0=i=>({...i,...i.ChannelSummary&&{ChannelSummary:sl(i.ChannelSummary)}}),iU=i=>({...i,...i.Moderator&&{Moderator:He(i.Moderator)},...i.CreatedBy&&{CreatedBy:He(i.CreatedBy)}}),rU=i=>({...i,...i.Moderator&&{Moderator:He(i.Moderator)}}),al=i=>({...i,...i.Key&&{Key:q},...i.Value&&{Value:q}}),i0=i=>({...i,...i.Name&&{Name:q},...i.Metadata&&{Metadata:q},...i.ClientRequestToken&&{ClientRequestToken:q},...i.Tags&&{Tags:i.Tags.map(t=>al(t))},...i.ChannelId&&{ChannelId:q}}),r0=i=>({...i,...i.Member&&{Member:He(i.Member)}}),n0=i=>({...i,...i.Processors&&{Processors:i.Processors.map(t=>nl(t))},...i.Name&&{Name:q},...i.Tags&&{Tags:i.Tags.map(t=>al(t))},...i.ClientRequestToken&&{ClientRequestToken:q}}),o0=i=>({...i,...i.Member&&{Member:He(i.Member)}}),s0=i=>({...i,...i.ChannelModerator&&{ChannelModerator:He(i.ChannelModerator)}}),a0=i=>({...i,...i.Channel&&{Channel:$2(i.Channel)}}),d0=i=>({...i,...i.ChannelBan&&{ChannelBan:W2(i.ChannelBan)}}),c0=i=>({...i,...i.ChannelFlow&&{ChannelFlow:K2(i.ChannelFlow)}}),l0=i=>({...i,...i.ChannelMembership&&{ChannelMembership:X2(i.ChannelMembership)}}),u0=i=>({...i,...i.ChannelMembership&&{ChannelMembership:e0(i.ChannelMembership)}}),f0=i=>({...i,...i.Channel&&{Channel:t0(i.Channel)}}),h0=i=>({...i,...i.ChannelModerator&&{ChannelModerator:iU(i.ChannelModerator)}}),p0=i=>({...i,...i.Member&&{Member:He(i.Member)},...i.Preferences&&{Preferences:Fh(i.Preferences)}}),m0=i=>({...i,...i.ChannelMessage&&{ChannelMessage:eU(i.ChannelMessage)}}),g0=i=>({...i,...i.NextToken&&{NextToken:q}}),S0=i=>({...i,...i.NextToken&&{NextToken:q},...i.ChannelBans&&{ChannelBans:i.ChannelBans.map(t=>G2(t))}}),y0=i=>({...i,...i.NextToken&&{NextToken:q}}),v0=i=>({...i,...i.ChannelFlows&&{ChannelFlows:i.ChannelFlows.map(t=>Q2(t))},...i.NextToken&&{NextToken:q}}),b0=i=>({...i,...i.NextToken&&{NextToken:q}}),w0=i=>({...i,...i.ChannelMemberships&&{ChannelMemberships:i.ChannelMemberships.map(t=>Z2(t))},...i.NextToken&&{NextToken:q}}),C0=i=>({...i,...i.NextToken&&{NextToken:q}}),_0=i=>({...i,...i.ChannelMemberships&&{ChannelMemberships:i.ChannelMemberships.map(t=>e0(t))},...i.NextToken&&{NextToken:q}}),T0=i=>({...i,...i.NextToken&&{NextToken:q}}),E0=i=>({...i,...i.NextToken&&{NextToken:q},...i.ChannelMessages&&{ChannelMessages:i.ChannelMessages.map(t=>tU(t))}}),I0=i=>({...i,...i.NextToken&&{NextToken:q}}),A0=i=>({...i,...i.NextToken&&{NextToken:q},...i.ChannelModerators&&{ChannelModerators:i.ChannelModerators.map(t=>rU(t))}}),k0=i=>({...i,...i.NextToken&&{NextToken:q}}),M0=i=>({...i,...i.Channels&&{Channels:i.Channels.map(t=>sl(t))},...i.NextToken&&{NextToken:q}}),x0=i=>({...i,...i.NextToken&&{NextToken:q}}),O0=i=>({...i,...i.Channels&&{Channels:i.Channels.map(t=>j2(t))},...i.NextToken&&{NextToken:q}}),P0=i=>({...i,...i.NextToken&&{NextToken:q}}),R0=i=>({...i,...i.Channels&&{Channels:i.Channels.map(t=>t0(t))},...i.NextToken&&{NextToken:q}}),D0=i=>({...i,...i.NextToken&&{NextToken:q}}),N0=i=>({...i,...i.NextToken&&{NextToken:q}}),L0=i=>({...i,...i.Tags&&{Tags:i.Tags.map(t=>al(t))}}),F0=i=>({...i,...i.Preferences&&{Preferences:Fh(i.Preferences)}}),B0=i=>({...i,...i.Member&&{Member:He(i.Member)},...i.Preferences&&{Preferences:Fh(i.Preferences)}}),V0=i=>({...i,...i.NextToken&&{NextToken:q}}),U0=i=>({...i,...i.Channels&&{Channels:i.Channels.map(t=>sl(t))},...i.NextToken&&{NextToken:q}}),q0=i=>({...i,...i.Content&&{Content:q},...i.Metadata&&{Metadata:q},...i.ClientRequestToken&&{ClientRequestToken:q},...i.PushNotification&&{PushNotification:Y_(i.PushNotification)},...i.MessageAttributes&&{MessageAttributes:Object.entries(i.MessageAttributes).reduce((t,[e,r])=>(t[e]=ol(r),t),{})},...i.ContentType&&{ContentType:q}}),H0=i=>({...i,...i.Tags&&{Tags:i.Tags.map(t=>al(t))}}),z0=i=>({...i,...i.TagKeys&&{TagKeys:q}}),$0=i=>({...i,...i.Name&&{Name:q},...i.Metadata&&{Metadata:q}}),j0=i=>({...i,...i.Processors&&{Processors:i.Processors.map(t=>nl(t))},...i.Name&&{Name:q}}),W0=i=>({...i,...i.Content&&{Content:q},...i.Metadata&&{Metadata:q},...i.ContentType&&{ContentType:q}})});var nU,oU,sU,aU,dU,cU,lU,uU,fU,hU,pU,mU,gU,SU,yU,vU,bU,wU,CU,_U,TU,EU,IU,AU,kU,MU,xU,OU,PU,RU,DU,NU,LU,FU,BU,VU,UU,qU,HU,zU,$U,jU,WU,GU,KU,JU,QU,XU,YU,ZU,e3,t3,i3,r3,n3,o3,s3,a3,d3,c3,l3,u3,f3,h3,p3,m3,g3,S3,y3,v3,b3,w3,C3,_3,T3,E3,I3,A3,k3,M3,x3,O3,P3,R3,D3,N3,L3,F3,B3,V3,U3,q3,H3,z3,$3,j3,W3,G3,K3,J3,Q3,X3,ie,M7,x7,O7,P7,R7,D7,N7,L7,F7,B7,V7,U7,q7,H7,z7,Y3,$7,j7,W7,G7,Z3,K7,J7,G0,eq,K,tq,Bh,pe,Q7,ei,X7,Y7,ti,Z7,eJ,ho,tJ,iJ,rJ,iq,Vh,nJ,ii,oJ,sJ,ri,ea,aJ,ta,po,dJ,cJ,me,te=h(()=>{zc();Xe();j();BC();Lh();fe();nU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/channel-flow"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n;return n=JSON.stringify(B(i,{ChannelFlowArn:[]})),e.m("PUT").h(r).b(n),e.build()},oU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/memberships"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[ea]:[,"batch-create"]}),o;return o=JSON.stringify(B(i,{MemberArns:s=>$(s),SubChannelId:[],Type:[]})),e.m("POST").h(r).q(n).b(o),e.build()},sU=async(i,t)=>{let e=Y(i,t),r={"content-type":"application/json"};e.bp("/channels/{ChannelArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[ea]:[,"channel-flow-callback"]}),o;return o=JSON.stringify(B(i,{CallbackId:[!0,s=>s??Or()],ChannelMessage:s=>$(s),DeleteResource:[]})),e.m("POST").h(r).q(n).b(o),e.build()},aU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels");let n;return n=JSON.stringify(B(i,{AppInstanceArn:[],ChannelId:[],ClientRequestToken:[!0,o=>o??Or()],ElasticChannelConfiguration:o=>$(o),ExpirationSettings:o=>$(o),MemberArns:o=>$(o),Metadata:[],Mode:[],ModeratorArns:o=>$(o),Name:[],Privacy:[],Tags:o=>$(o)})),e.m("POST").h(r).b(n),e.build()},dU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/bans"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n;return n=JSON.stringify(B(i,{MemberArn:[]})),e.m("POST").h(r).b(n),e.build()},cU=async(i,t)=>{let e=Y(i,t),r={"content-type":"application/json"};e.bp("/channel-flows");let n;return n=JSON.stringify(B(i,{AppInstanceArn:[],ClientRequestToken:[!0,o=>o??Or()],Name:[],Processors:o=>$(o),Tags:o=>$(o)})),e.m("POST").h(r).b(n),e.build()},lU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/memberships"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n;return n=JSON.stringify(B(i,{MemberArn:[],SubChannelId:[],Type:[]})),e.m("POST").h(r).b(n),e.build()},uU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/moderators"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n;return n=JSON.stringify(B(i,{ChannelModeratorArn:[]})),e.m("POST").h(r).b(n),e.build()},fU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.m("DELETE").h(r).b(void 0),e.build()},hU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}/bans/{MemberArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MemberArn",()=>i.MemberArn,"{MemberArn}",!1),e.m("DELETE").h(r).b(void 0),e.build()},pU=async(i,t)=>{let e=Y(i,t),r={};return e.bp("/channel-flows/{ChannelFlowArn}"),e.p("ChannelFlowArn",()=>i.ChannelFlowArn,"{ChannelFlowArn}",!1),e.m("DELETE").h(r).b(void 0),e.build()},mU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/memberships/{MemberArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MemberArn",()=>i.MemberArn,"{MemberArn}",!1);let n=k({[po]:[,i[ho]]});return e.m("DELETE").h(r).q(n).b(void 0),e.build()},gU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/messages/{MessageId}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MessageId",()=>i.MessageId,"{MessageId}",!1);let n=k({[po]:[,i[ho]]});return e.m("DELETE").h(r).q(n).b(void 0),e.build()},SU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}/moderators/{ChannelModeratorArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("ChannelModeratorArn",()=>i.ChannelModeratorArn,"{ChannelModeratorArn}",!1),e.m("DELETE").h(r).b(void 0),e.build()},yU=async(i,t)=>{let e=Y(i,t),r={};return e.bp("/app-instances/{AppInstanceArn}/streaming-configurations"),e.p("AppInstanceArn",()=>i.AppInstanceArn,"{AppInstanceArn}",!1),e.m("DELETE").h(r).b(void 0),e.build()},vU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.m("GET").h(r).b(void 0),e.build()},bU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}/bans/{MemberArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MemberArn",()=>i.MemberArn,"{MemberArn}",!1),e.m("GET").h(r).b(void 0),e.build()},wU=async(i,t)=>{let e=Y(i,t),r={};return e.bp("/channel-flows/{ChannelFlowArn}"),e.p("ChannelFlowArn",()=>i.ChannelFlowArn,"{ChannelFlowArn}",!1),e.m("GET").h(r).b(void 0),e.build()},CU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/memberships/{MemberArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MemberArn",()=>i.MemberArn,"{MemberArn}",!1);let n=k({[po]:[,i[ho]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},_U=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[ta]:[,"app-instance-user-membership"],[Vh]:[,H(i[Bh],"AppInstanceUserArn")]});return e.m("GET").h(r).q(n).b(void 0),e.build()},TU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[ta]:[,"app-instance-user-moderated-channel"],[Vh]:[,H(i[Bh],"AppInstanceUserArn")]});return e.m("GET").h(r).q(n).b(void 0),e.build()},EU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}/moderators/{ChannelModeratorArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("ChannelModeratorArn",()=>i.ChannelModeratorArn,"{ChannelModeratorArn}",!1),e.m("GET").h(r).b(void 0),e.build()},IU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}/channel-flow/{ChannelFlowArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("ChannelFlowArn",()=>i.ChannelFlowArn,"{ChannelFlowArn}",!1),e.m("DELETE").h(r).b(void 0),e.build()},AU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}/memberships/{MemberArn}/preferences"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MemberArn",()=>i.MemberArn,"{MemberArn}",!1),e.m("GET").h(r).b(void 0),e.build()},kU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/messages/{MessageId}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MessageId",()=>i.MessageId,"{MessageId}",!1);let n=k({[po]:[,i[ho]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},MU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/messages/{MessageId}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MessageId",()=>i.MessageId,"{MessageId}",!1);let n=k({[ta]:[,"message-status"],[po]:[,i[ho]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},xU=async(i,t)=>{let e=Y(i,t),r={};return e.bp("/endpoints/messaging-session"),e.m("GET").h(r).b(void 0),e.build()},OU=async(i,t)=>{let e=Y(i,t),r={};return e.bp("/app-instances/{AppInstanceArn}/streaming-configurations"),e.p("AppInstanceArn",()=>i.AppInstanceArn,"{AppInstanceArn}",!1),e.m("GET").h(r).b(void 0),e.build()},PU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/bans"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},RU=async(i,t)=>{let e=Y(i,t),r={};e.bp("/channel-flows");let n=k({[iq]:[,H(i[tq],"AppInstanceArn")],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},DU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/memberships"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[cJ]:[,i[iJ]],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]],[po]:[,i[ho]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},NU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels");let n=k({[ta]:[,"app-instance-user-memberships"],[Vh]:[,i[Bh]],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},LU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/messages"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[dJ]:[,i[tJ]],[sJ]:[()=>i.NotBefore!==void 0,()=>__(i[Y7]).toString()],[oJ]:[()=>i.NotAfter!==void 0,()=>__(i[X7]).toString()],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]],[po]:[,i[ho]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},FU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/moderators"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},BU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels");let n=k({[iq]:[,H(i[tq],"AppInstanceArn")],[aJ]:[,i[Z7]],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},VU=async(i,t)=>{let e=Y(i,t),r={};e.bp("/channels");let n=k({[ta]:[,"channel-flow-associations"],[nJ]:[,H(i[Q7],"ChannelFlowArn")],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},UU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels");let n=k({[ta]:[,"app-instance-user-moderated-channels"],[Vh]:[,i[Bh]],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},qU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});e.bp("/channels/{ChannelArn}/subchannels"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n=k({[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]});return e.m("GET").h(r).q(n).b(void 0),e.build()},HU=async(i,t)=>{let e=Y(i,t),r={};e.bp("/tags");let n=k({[rJ]:[,H(i[eJ],"ResourceARN")]});return e.m("GET").h(r).q(n).b(void 0),e.build()},zU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/expiration-settings"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n;return n=JSON.stringify(B(i,{ExpirationSettings:o=>$(o)})),e.m("PUT").h(r).b(n),e.build()},$U=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/memberships/{MemberArn}/preferences"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MemberArn",()=>i.MemberArn,"{MemberArn}",!1);let n;return n=JSON.stringify(B(i,{Preferences:o=>$(o)})),e.m("PUT").h(r).b(n),e.build()},jU=async(i,t)=>{let e=Y(i,t),r={"content-type":"application/json"};e.bp("/app-instances/{AppInstanceArn}/streaming-configurations"),e.p("AppInstanceArn",()=>i.AppInstanceArn,"{AppInstanceArn}",!1);let n;return n=JSON.stringify(B(i,{StreamingConfigurations:o=>$(o)})),e.m("PUT").h(r).b(n),e.build()},WU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/messages/{MessageId}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MessageId",()=>i.MessageId,"{MessageId}",!1);let n=k({[ea]:[,"redact"]}),o;return o=JSON.stringify(B(i,{SubChannelId:[]})),e.m("POST").h(r).q(n).b(o),e.build()},GU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels");let n=k({[ea]:[,"search"],[ii]:[()=>i.MaxResults!==void 0,()=>i[ei].toString()],[ri]:[,i[ti]]}),o;return o=JSON.stringify(B(i,{Fields:s=>$(s)})),e.m("POST").h(r).q(n).b(o),e.build()},KU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/messages"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n;return n=JSON.stringify(B(i,{ClientRequestToken:[!0,o=>o??Or()],Content:[],ContentType:[],MessageAttributes:o=>$(o),Metadata:[],Persistence:[],PushNotification:o=>$(o),SubChannelId:[],Target:o=>$(o),Type:[]})),e.m("POST").h(r).b(n),e.build()},JU=async(i,t)=>{let e=Y(i,t),r={"content-type":"application/json"};e.bp("/tags");let n=k({[ea]:[,"tag-resource"]}),o;return o=JSON.stringify(B(i,{ResourceARN:[],Tags:s=>$(s)})),e.m("POST").h(r).q(n).b(o),e.build()},QU=async(i,t)=>{let e=Y(i,t),r={"content-type":"application/json"};e.bp("/tags");let n=k({[ea]:[,"untag-resource"]}),o;return o=JSON.stringify(B(i,{ResourceARN:[],TagKeys:s=>$(s)})),e.m("POST").h(r).q(n).b(o),e.build()},XU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1);let n;return n=JSON.stringify(B(i,{Metadata:[],Mode:[],Name:[]})),e.m("PUT").h(r).b(n),e.build()},YU=async(i,t)=>{let e=Y(i,t),r={"content-type":"application/json"};e.bp("/channel-flows/{ChannelFlowArn}"),e.p("ChannelFlowArn",()=>i.ChannelFlowArn,"{ChannelFlowArn}",!1);let n;return n=JSON.stringify(B(i,{Name:[],Processors:o=>$(o)})),e.m("PUT").h(r).b(n),e.build()},ZU=async(i,t)=>{let e=Y(i,t),r=k({},ue,{"content-type":"application/json",[me]:i[pe]});e.bp("/channels/{ChannelArn}/messages/{MessageId}"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.p("MessageId",()=>i.MessageId,"{MessageId}",!1);let n;return n=JSON.stringify(B(i,{Content:[],ContentType:[],Metadata:[],SubChannelId:[]})),e.m("PUT").h(r).b(n),e.build()},e3=async(i,t)=>{let e=Y(i,t),r=k({},ue,{[me]:i[pe]});return e.bp("/channels/{ChannelArn}/readMarker"),e.p("ChannelArn",()=>i.ChannelArn,"{ChannelArn}",!1),e.m("PUT").h(r).b(void 0),e.build()},t3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},i3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{BatchChannelMemberships:$,Errors:$});return Object.assign(e,n),e},r3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{CallbackId:R,ChannelArn:R});return Object.assign(e,n),e},n3=async(i,t)=>{if(i.statusCode!==201&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R});return Object.assign(e,n),e},o3=async(i,t)=>{if(i.statusCode!==201&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,Member:$});return Object.assign(e,n),e},s3=async(i,t)=>{if(i.statusCode!==201&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelFlowArn:R});return Object.assign(e,n),e},a3=async(i,t)=>{if(i.statusCode!==201&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,Member:$,SubChannelId:R});return Object.assign(e,n),e},d3=async(i,t)=>{if(i.statusCode!==201&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,ChannelModerator:$});return Object.assign(e,n),e},c3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},l3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},u3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},f3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},h3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},p3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},m3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},g3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Channel:o=>U7(o,t)});return Object.assign(e,n),e},S3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelBan:o=>q7(o,t)});return Object.assign(e,n),e},y3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelFlow:o=>H7(o,t)});return Object.assign(e,n),e},v3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelMembership:o=>z7(o,t)});return Object.assign(e,n),e},b3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelMembership:o=>Y3(o,t)});return Object.assign(e,n),e},w3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Channel:o=>Z3(o,t)});return Object.assign(e,n),e},C3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelModerator:o=>J7(o,t)});return Object.assign(e,n),e},_3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},T3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,Member:$,Preferences:$});return Object.assign(e,n),e},E3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelMessage:o=>j7(o,t)});return Object.assign(e,n),e},I3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Status:$});return Object.assign(e,n),e},A3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Endpoint:$});return Object.assign(e,n),e},k3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{StreamingConfigurations:$});return Object.assign(e,n),e},M3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,ChannelBans:$,NextToken:R});return Object.assign(e,n),e},x3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelFlows:$,NextToken:R});return Object.assign(e,n),e},O3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,ChannelMemberships:$,NextToken:R});return Object.assign(e,n),e},P3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelMemberships:o=>$7(o,t),NextToken:R});return Object.assign(e,n),e},R3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,ChannelMessages:o=>G7(o,t),NextToken:R,SubChannelId:R});return Object.assign(e,n),e},D3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,ChannelModerators:$,NextToken:R});return Object.assign(e,n),e},N3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Channels:o=>eq(o,t),NextToken:R});return Object.assign(e,n),e},L3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Channels:$,NextToken:R});return Object.assign(e,n),e},F3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Channels:o=>K7(o,t),NextToken:R});return Object.assign(e,n),e},B3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,NextToken:R,SubChannels:$});return Object.assign(e,n),e},V3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Tags:$});return Object.assign(e,n),e},U3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,ExpirationSettings:$});return Object.assign(e,n),e},q3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,Member:$,Preferences:$});return Object.assign(e,n),e},H3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{StreamingConfigurations:$});return Object.assign(e,n),e},z3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,MessageId:R,SubChannelId:R});return Object.assign(e,n),e},$3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{Channels:o=>eq(o,t),NextToken:R});return Object.assign(e,n),e},j3=async(i,t)=>{if(i.statusCode!==201&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,MessageId:R,Status:$,SubChannelId:R});return Object.assign(e,n),e},W3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},G3=async(i,t)=>{if(i.statusCode!==204&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)});return await ot(i.body,t),e},K3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R});return Object.assign(e,n),e},J3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelFlowArn:R});return Object.assign(e,n),e},Q3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R,MessageId:R,Status:$,SubChannelId:R});return Object.assign(e,n),e},X3=async(i,t)=>{if(i.statusCode!==200&&i.statusCode>=300)return ie(i,t);let e=k({$metadata:K(i)}),r=H(ce(await de(i.body,t)),"body"),n=B(r,{ChannelArn:R});return Object.assign(e,n),e},ie=async(i,t)=>{let e={...i,body:await MF(i.body,t)},r=xF(i,e.body);switch(r){case"BadRequestException":case"com.amazonaws.chimesdkmessaging#BadRequestException":throw await x7(e,t);case"ConflictException":case"com.amazonaws.chimesdkmessaging#ConflictException":throw await O7(e,t);case"ForbiddenException":case"com.amazonaws.chimesdkmessaging#ForbiddenException":throw await P7(e,t);case"NotFoundException":case"com.amazonaws.chimesdkmessaging#NotFoundException":throw await R7(e,t);case"ServiceFailureException":case"com.amazonaws.chimesdkmessaging#ServiceFailureException":throw await N7(e,t);case"ServiceUnavailableException":case"com.amazonaws.chimesdkmessaging#ServiceUnavailableException":throw await L7(e,t);case"ThrottledClientException":case"com.amazonaws.chimesdkmessaging#ThrottledClientException":throw await F7(e,t);case"UnauthorizedClientException":case"com.amazonaws.chimesdkmessaging#UnauthorizedClientException":throw await B7(e,t);case"ResourceLimitExceededException":case"com.amazonaws.chimesdkmessaging#ResourceLimitExceededException":throw await D7(e,t);default:let n=e.body;return M7({output:i,parsedBody:n,errorCode:r})}},M7=iF(it),x7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new Jc({$metadata:K(i),...e});return Dt(o,i.body)},O7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new Qc({$metadata:K(i),...e});return Dt(o,i.body)},P7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new Xc({$metadata:K(i),...e});return Dt(o,i.body)},R7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new Yc({$metadata:K(i),...e});return Dt(o,i.body)},D7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new rl({$metadata:K(i),...e});return Dt(o,i.body)},N7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new Zc({$metadata:K(i),...e});return Dt(o,i.body)},L7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new el({$metadata:K(i),...e});return Dt(o,i.body)},F7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new tl({$metadata:K(i),...e});return Dt(o,i.body)},B7=async(i,t)=>{let e=k({}),r=i.body,n=B(r,{Code:R,Message:R});Object.assign(e,n);let o=new il({$metadata:K(i),...e});return Dt(o,i.body)},V7=(i,t)=>B(i,{ReadMarkerTimestamp:e=>H(je(qe(e))),SubChannelId:R,Type:R}),U7=(i,t)=>B(i,{ChannelArn:R,ChannelFlowArn:R,CreatedBy:$,CreatedTimestamp:e=>H(je(qe(e))),ElasticChannelConfiguration:$,ExpirationSettings:$,LastMessageTimestamp:e=>H(je(qe(e))),LastUpdatedTimestamp:e=>H(je(qe(e))),Metadata:R,Mode:R,Name:R,Privacy:R}),q7=(i,t)=>B(i,{ChannelArn:R,CreatedBy:$,CreatedTimestamp:e=>H(je(qe(e))),Member:$}),H7=(i,t)=>B(i,{ChannelFlowArn:R,CreatedTimestamp:e=>H(je(qe(e))),LastUpdatedTimestamp:e=>H(je(qe(e))),Name:R,Processors:$}),z7=(i,t)=>B(i,{ChannelArn:R,CreatedTimestamp:e=>H(je(qe(e))),InvitedBy:$,LastUpdatedTimestamp:e=>H(je(qe(e))),Member:$,SubChannelId:R,Type:R}),Y3=(i,t)=>B(i,{AppInstanceUserMembershipSummary:e=>V7(e,t),ChannelSummary:e=>G0(e,t)}),$7=(i,t)=>(i||[]).filter(r=>r!=null).map(r=>Y3(r,t)),j7=(i,t)=>B(i,{ChannelArn:R,Content:R,ContentType:R,CreatedTimestamp:e=>H(je(qe(e))),LastEditedTimestamp:e=>H(je(qe(e))),LastUpdatedTimestamp:e=>H(je(qe(e))),MessageAttributes:$,MessageId:R,Metadata:R,Persistence:R,Redacted:DC,Sender:$,Status:$,SubChannelId:R,Target:$,Type:R}),W7=(i,t)=>B(i,{Content:R,ContentType:R,CreatedTimestamp:e=>H(je(qe(e))),LastEditedTimestamp:e=>H(je(qe(e))),LastUpdatedTimestamp:e=>H(je(qe(e))),MessageAttributes:$,MessageId:R,Metadata:R,Redacted:DC,Sender:$,Status:$,Target:$,Type:R}),G7=(i,t)=>(i||[]).filter(r=>r!=null).map(r=>W7(r,t)),Z3=(i,t)=>B(i,{ChannelSummary:e=>G0(e,t)}),K7=(i,t)=>(i||[]).filter(r=>r!=null).map(r=>Z3(r,t)),J7=(i,t)=>B(i,{ChannelArn:R,CreatedBy:$,CreatedTimestamp:e=>H(je(qe(e))),Moderator:$}),G0=(i,t)=>B(i,{ChannelArn:R,LastMessageTimestamp:e=>H(je(qe(e))),Metadata:R,Mode:R,Name:R,Privacy:R}),eq=(i,t)=>(i||[]).filter(r=>r!=null).map(r=>G0(r,t)),K=i=>({httpStatusCode:i.statusCode,requestId:i.headers["x-amzn-requestid"]??i.headers["x-amzn-request-id"]??i.headers["x-amz-request-id"],extendedRequestId:i.headers["x-amz-id-2"],cfId:i.headers["x-amz-cf-id"]}),tq="AppInstanceArn",Bh="AppInstanceUserArn",pe="ChimeBearer",Q7="ChannelFlowArn",ei="MaxResults",X7="NotAfter",Y7="NotBefore",ti="NextToken",Z7="Privacy",eJ="ResourceARN",ho="SubChannelId",tJ="SortOrder",iJ="Type",rJ="arn",iq="app-instance-arn",Vh="app-instance-user-arn",nJ="channel-flow-arn",ii="max-results",oJ="not-after",sJ="not-before",ri="next-token",ea="operation",aJ="privacy",ta="scope",po="sub-channel-id",dJ="sort-order",cJ="type",me="x-amz-chime-bearer"});var dl,K0=h(()=>{Z();Q();j();ee();te();dl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","AssociateChannelFlow",{}).n("ChimeSDKMessagingClient","AssociateChannelFlowCommand").f(void 0,void 0).ser(nU).de(t3).build(){}});var cl,J0=h(()=>{Z();Q();j();ee();fe();te();cl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","BatchCreateChannelMembership",{}).n("ChimeSDKMessagingClient","BatchCreateChannelMembershipCommand").f(void 0,X_).ser(oU).de(i3).build(){}});var ll,Q0=h(()=>{Z();Q();j();ee();fe();te();ll=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ChannelFlowCallback",{}).n("ChimeSDKMessagingClient","ChannelFlowCallbackCommand").f(Z_,void 0).ser(sU).de(r3).build(){}});var ul,X0=h(()=>{Z();Q();j();ee();fe();te();ul=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelBan",{}).n("ChimeSDKMessagingClient","CreateChannelBanCommand").f(void 0,r0).ser(dU).de(o3).build(){}});var fl,Y0=h(()=>{Z();Q();j();ee();fe();te();fl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannel",{}).n("ChimeSDKMessagingClient","CreateChannelCommand").f(i0,void 0).ser(aU).de(n3).build(){}});var hl,Z0=h(()=>{Z();Q();j();ee();fe();te();hl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelFlow",{}).n("ChimeSDKMessagingClient","CreateChannelFlowCommand").f(n0,void 0).ser(cU).de(s3).build(){}});var pl,eT=h(()=>{Z();Q();j();ee();fe();te();pl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelMembership",{}).n("ChimeSDKMessagingClient","CreateChannelMembershipCommand").f(void 0,o0).ser(lU).de(a3).build(){}});var ml,tT=h(()=>{Z();Q();j();ee();fe();te();ml=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","CreateChannelModerator",{}).n("ChimeSDKMessagingClient","CreateChannelModeratorCommand").f(void 0,s0).ser(uU).de(d3).build(){}});var gl,iT=h(()=>{Z();Q();j();ee();te();gl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelBan",{}).n("ChimeSDKMessagingClient","DeleteChannelBanCommand").f(void 0,void 0).ser(hU).de(l3).build(){}});var Sl,rT=h(()=>{Z();Q();j();ee();te();Sl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannel",{}).n("ChimeSDKMessagingClient","DeleteChannelCommand").f(void 0,void 0).ser(fU).de(c3).build(){}});var yl,nT=h(()=>{Z();Q();j();ee();te();yl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelFlow",{}).n("ChimeSDKMessagingClient","DeleteChannelFlowCommand").f(void 0,void 0).ser(pU).de(u3).build(){}});var vl,oT=h(()=>{Z();Q();j();ee();te();vl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelMembership",{}).n("ChimeSDKMessagingClient","DeleteChannelMembershipCommand").f(void 0,void 0).ser(mU).de(f3).build(){}});var bl,sT=h(()=>{Z();Q();j();ee();te();bl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelMessage",{}).n("ChimeSDKMessagingClient","DeleteChannelMessageCommand").f(void 0,void 0).ser(gU).de(h3).build(){}});var wl,aT=h(()=>{Z();Q();j();ee();te();wl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteChannelModerator",{}).n("ChimeSDKMessagingClient","DeleteChannelModeratorCommand").f(void 0,void 0).ser(SU).de(p3).build(){}});var Cl,dT=h(()=>{Z();Q();j();ee();te();Cl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DeleteMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","DeleteMessagingStreamingConfigurationsCommand").f(void 0,void 0).ser(yU).de(m3).build(){}});var _l,cT=h(()=>{Z();Q();j();ee();fe();te();_l=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelBan",{}).n("ChimeSDKMessagingClient","DescribeChannelBanCommand").f(void 0,d0).ser(bU).de(S3).build(){}});var Tl,lT=h(()=>{Z();Q();j();ee();fe();te();Tl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannel",{}).n("ChimeSDKMessagingClient","DescribeChannelCommand").f(void 0,a0).ser(vU).de(g3).build(){}});var El,uT=h(()=>{Z();Q();j();ee();fe();te();El=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelFlow",{}).n("ChimeSDKMessagingClient","DescribeChannelFlowCommand").f(void 0,c0).ser(wU).de(y3).build(){}});var Il,fT=h(()=>{Z();Q();j();ee();fe();te();Il=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelMembership",{}).n("ChimeSDKMessagingClient","DescribeChannelMembershipCommand").f(void 0,l0).ser(CU).de(v3).build(){}});var Al,hT=h(()=>{Z();Q();j();ee();fe();te();Al=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelMembershipForAppInstanceUser",{}).n("ChimeSDKMessagingClient","DescribeChannelMembershipForAppInstanceUserCommand").f(void 0,u0).ser(_U).de(b3).build(){}});var kl,pT=h(()=>{Z();Q();j();ee();fe();te();kl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelModeratedByAppInstanceUser",{}).n("ChimeSDKMessagingClient","DescribeChannelModeratedByAppInstanceUserCommand").f(void 0,f0).ser(TU).de(w3).build(){}});var Ml,mT=h(()=>{Z();Q();j();ee();fe();te();Ml=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DescribeChannelModerator",{}).n("ChimeSDKMessagingClient","DescribeChannelModeratorCommand").f(void 0,h0).ser(EU).de(C3).build(){}});var xl,gT=h(()=>{Z();Q();j();ee();te();xl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","DisassociateChannelFlow",{}).n("ChimeSDKMessagingClient","DisassociateChannelFlowCommand").f(void 0,void 0).ser(IU).de(_3).build(){}});var Ol,ST=h(()=>{Z();Q();j();ee();fe();te();Ol=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetChannelMembershipPreferences",{}).n("ChimeSDKMessagingClient","GetChannelMembershipPreferencesCommand").f(void 0,p0).ser(AU).de(T3).build(){}});var Pl,yT=h(()=>{Z();Q();j();ee();fe();te();Pl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetChannelMessage",{}).n("ChimeSDKMessagingClient","GetChannelMessageCommand").f(void 0,m0).ser(kU).de(E3).build(){}});var Rl,vT=h(()=>{Z();Q();j();ee();te();Rl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetChannelMessageStatus",{}).n("ChimeSDKMessagingClient","GetChannelMessageStatusCommand").f(void 0,void 0).ser(MU).de(I3).build(){}});var Dl,bT=h(()=>{Z();Q();j();ee();te();Dl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetMessagingSessionEndpoint",{}).n("ChimeSDKMessagingClient","GetMessagingSessionEndpointCommand").f(void 0,void 0).ser(xU).de(A3).build(){}});var Nl,wT=h(()=>{Z();Q();j();ee();te();Nl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","GetMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","GetMessagingStreamingConfigurationsCommand").f(void 0,void 0).ser(OU).de(k3).build(){}});var mo,Uh=h(()=>{Z();Q();j();ee();fe();te();mo=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelBans",{}).n("ChimeSDKMessagingClient","ListChannelBansCommand").f(g0,S0).ser(PU).de(M3).build(){}});var go,qh=h(()=>{Z();Q();j();ee();fe();te();go=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelFlows",{}).n("ChimeSDKMessagingClient","ListChannelFlowsCommand").f(y0,v0).ser(RU).de(x3).build(){}});var So,Hh=h(()=>{Z();Q();j();ee();fe();te();So=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelMemberships",{}).n("ChimeSDKMessagingClient","ListChannelMembershipsCommand").f(b0,w0).ser(DU).de(O3).build(){}});var yo,zh=h(()=>{Z();Q();j();ee();fe();te();yo=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelMembershipsForAppInstanceUser",{}).n("ChimeSDKMessagingClient","ListChannelMembershipsForAppInstanceUserCommand").f(C0,_0).ser(NU).de(P3).build(){}});var vo,$h=h(()=>{Z();Q();j();ee();fe();te();vo=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelMessages",{}).n("ChimeSDKMessagingClient","ListChannelMessagesCommand").f(T0,E0).ser(LU).de(R3).build(){}});var bo,jh=h(()=>{Z();Q();j();ee();fe();te();bo=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelModerators",{}).n("ChimeSDKMessagingClient","ListChannelModeratorsCommand").f(I0,A0).ser(FU).de(D3).build(){}});var wo,Wh=h(()=>{Z();Q();j();ee();fe();te();wo=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelsAssociatedWithChannelFlow",{}).n("ChimeSDKMessagingClient","ListChannelsAssociatedWithChannelFlowCommand").f(x0,O0).ser(VU).de(L3).build(){}});var Co,Gh=h(()=>{Z();Q();j();ee();fe();te();Co=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannels",{}).n("ChimeSDKMessagingClient","ListChannelsCommand").f(k0,M0).ser(BU).de(N3).build(){}});var _o,Kh=h(()=>{Z();Q();j();ee();fe();te();_o=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListChannelsModeratedByAppInstanceUser",{}).n("ChimeSDKMessagingClient","ListChannelsModeratedByAppInstanceUserCommand").f(P0,R0).ser(UU).de(F3).build(){}});var To,Jh=h(()=>{Z();Q();j();ee();fe();te();To=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListSubChannels",{}).n("ChimeSDKMessagingClient","ListSubChannelsCommand").f(D0,N0).ser(qU).de(B3).build(){}});var Ll,CT=h(()=>{Z();Q();j();ee();fe();te();Ll=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","ListTagsForResource",{}).n("ChimeSDKMessagingClient","ListTagsForResourceCommand").f(void 0,L0).ser(HU).de(V3).build(){}});var Fl,_T=h(()=>{Z();Q();j();ee();te();Fl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","PutChannelExpirationSettings",{}).n("ChimeSDKMessagingClient","PutChannelExpirationSettingsCommand").f(void 0,void 0).ser(zU).de(U3).build(){}});var Bl,TT=h(()=>{Z();Q();j();ee();fe();te();Bl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","PutChannelMembershipPreferences",{}).n("ChimeSDKMessagingClient","PutChannelMembershipPreferencesCommand").f(F0,B0).ser($U).de(q3).build(){}});var Vl,ET=h(()=>{Z();Q();j();ee();te();Vl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","PutMessagingStreamingConfigurations",{}).n("ChimeSDKMessagingClient","PutMessagingStreamingConfigurationsCommand").f(void 0,void 0).ser(jU).de(H3).build(){}});var Ul,IT=h(()=>{Z();Q();j();ee();te();Ul=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","RedactChannelMessage",{}).n("ChimeSDKMessagingClient","RedactChannelMessageCommand").f(void 0,void 0).ser(WU).de(z3).build(){}});var Eo,Qh=h(()=>{Z();Q();j();ee();fe();te();Eo=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","SearchChannels",{}).n("ChimeSDKMessagingClient","SearchChannelsCommand").f(V0,U0).ser(GU).de($3).build(){}});var ql,AT=h(()=>{Z();Q();j();ee();fe();te();ql=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","SendChannelMessage",{}).n("ChimeSDKMessagingClient","SendChannelMessageCommand").f(q0,void 0).ser(KU).de(j3).build(){}});var Hl,kT=h(()=>{Z();Q();j();ee();fe();te();Hl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","TagResource",{}).n("ChimeSDKMessagingClient","TagResourceCommand").f(H0,void 0).ser(JU).de(W3).build(){}});var zl,MT=h(()=>{Z();Q();j();ee();fe();te();zl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UntagResource",{}).n("ChimeSDKMessagingClient","UntagResourceCommand").f(z0,void 0).ser(QU).de(G3).build(){}});var $l,xT=h(()=>{Z();Q();j();ee();fe();te();$l=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannel",{}).n("ChimeSDKMessagingClient","UpdateChannelCommand").f($0,void 0).ser(XU).de(K3).build(){}});var jl,OT=h(()=>{Z();Q();j();ee();fe();te();jl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannelFlow",{}).n("ChimeSDKMessagingClient","UpdateChannelFlowCommand").f(j0,void 0).ser(YU).de(J3).build(){}});var Wl,PT=h(()=>{Z();Q();j();ee();fe();te();Wl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannelMessage",{}).n("ChimeSDKMessagingClient","UpdateChannelMessageCommand").f(W0,void 0).ser(ZU).de(Q3).build(){}});var Gl,RT=h(()=>{Z();Q();j();ee();te();Gl=class extends M.classBuilder().ep(P).m(function(t,e,r,n){return[x(r,this.serialize,this.deserialize),O(r,t.getEndpointParameterInstructions())]}).s("ChimeMessagingService","UpdateChannelReadMarker",{}).n("ChimeSDKMessagingClient","UpdateChannelReadMarkerCommand").f(void 0,void 0).ser(e3).de(X3).build(){}});var lJ,Xh,rq=h(()=>{j();ft();K0();J0();Q0();X0();Y0();Z0();eT();tT();iT();rT();nT();oT();sT();aT();dT();cT();lT();uT();fT();hT();pT();mT();gT();ST();yT();vT();bT();wT();Uh();qh();Hh();zh();$h();jh();Wh();Gh();Kh();Jh();CT();_T();TT();ET();IT();Qh();AT();kT();MT();xT();OT();PT();RT();lJ={AssociateChannelFlowCommand:dl,BatchCreateChannelMembershipCommand:cl,ChannelFlowCallbackCommand:ll,CreateChannelCommand:fl,CreateChannelBanCommand:ul,CreateChannelFlowCommand:hl,CreateChannelMembershipCommand:pl,CreateChannelModeratorCommand:ml,DeleteChannelCommand:Sl,DeleteChannelBanCommand:gl,DeleteChannelFlowCommand:yl,DeleteChannelMembershipCommand:vl,DeleteChannelMessageCommand:bl,DeleteChannelModeratorCommand:wl,DeleteMessagingStreamingConfigurationsCommand:Cl,DescribeChannelCommand:Tl,DescribeChannelBanCommand:_l,DescribeChannelFlowCommand:El,DescribeChannelMembershipCommand:Il,DescribeChannelMembershipForAppInstanceUserCommand:Al,DescribeChannelModeratedByAppInstanceUserCommand:kl,DescribeChannelModeratorCommand:Ml,DisassociateChannelFlowCommand:xl,GetChannelMembershipPreferencesCommand:Ol,GetChannelMessageCommand:Pl,GetChannelMessageStatusCommand:Rl,GetMessagingSessionEndpointCommand:Dl,GetMessagingStreamingConfigurationsCommand:Nl,ListChannelBansCommand:mo,ListChannelFlowsCommand:go,ListChannelMembershipsCommand:So,ListChannelMembershipsForAppInstanceUserCommand:yo,ListChannelMessagesCommand:vo,ListChannelModeratorsCommand:bo,ListChannelsCommand:Co,ListChannelsAssociatedWithChannelFlowCommand:wo,ListChannelsModeratedByAppInstanceUserCommand:_o,ListSubChannelsCommand:To,ListTagsForResourceCommand:Ll,PutChannelExpirationSettingsCommand:Fl,PutChannelMembershipPreferencesCommand:Bl,PutMessagingStreamingConfigurationsCommand:Vl,RedactChannelMessageCommand:Ul,SearchChannelsCommand:Eo,SendChannelMessageCommand:ql,TagResourceCommand:Hl,UntagResourceCommand:zl,UpdateChannelCommand:$l,UpdateChannelFlowCommand:jl,UpdateChannelMessageCommand:Wl,UpdateChannelReadMarkerCommand:Gl},Xh=class extends Te{};eF(lJ,Xh)});var nq=h(()=>{K0();J0();Q0();X0();Y0();Z0();eT();tT();iT();rT();nT();oT();sT();aT();dT();cT();lT();uT();fT();hT();pT();mT();gT();ST();yT();vT();bT();wT();Uh();qh();Hh();zh();$h();jh();Wh();Gh();Kh();Jh();CT();_T();TT();ET();IT();Qh();AT();kT();MT();xT();OT();PT();RT()});var oq=h(()=>{});var uJ,sq=h(()=>{Xe();ft();Uh();uJ=Pe(Te,mo,"NextToken","NextToken","MaxResults")});var fJ,aq=h(()=>{Xe();ft();qh();fJ=Pe(Te,go,"NextToken","NextToken","MaxResults")});var hJ,dq=h(()=>{Xe();ft();zh();hJ=Pe(Te,yo,"NextToken","NextToken","MaxResults")});var pJ,cq=h(()=>{Xe();ft();Hh();pJ=Pe(Te,So,"NextToken","NextToken","MaxResults")});var mJ,lq=h(()=>{Xe();ft();$h();mJ=Pe(Te,vo,"NextToken","NextToken","MaxResults")});var gJ,uq=h(()=>{Xe();ft();jh();gJ=Pe(Te,bo,"NextToken","NextToken","MaxResults")});var SJ,fq=h(()=>{Xe();ft();Wh();SJ=Pe(Te,wo,"NextToken","NextToken","MaxResults")});var yJ,hq=h(()=>{Xe();ft();Kh();yJ=Pe(Te,_o,"NextToken","NextToken","MaxResults")});var vJ,pq=h(()=>{Xe();ft();Gh();vJ=Pe(Te,Co,"NextToken","NextToken","MaxResults")});var bJ,mq=h(()=>{Xe();ft();Jh();bJ=Pe(Te,To,"NextToken","NextToken","MaxResults")});var wJ,gq=h(()=>{Xe();ft();Qh();wJ=Pe(Te,Eo,"NextToken","NextToken","MaxResults")});var Sq=h(()=>{oq();sq();aq();dq();cq();lq();uq();fq();hq();pq();mq();gq()});var yq=h(()=>{fe()});var vq={};hu(vq,{$Command:()=>M,AllowNotifications:()=>h7,AssociateChannelFlowCommand:()=>dl,BadRequestException:()=>Jc,BatchChannelMembershipsFilterSensitiveLog:()=>z2,BatchCreateChannelMembershipCommand:()=>cl,BatchCreateChannelMembershipResponseFilterSensitiveLog:()=>X_,ChannelAssociatedWithFlowSummaryFilterSensitiveLog:()=>j2,ChannelBanFilterSensitiveLog:()=>W2,ChannelBanSummaryFilterSensitiveLog:()=>G2,ChannelFilterSensitiveLog:()=>$2,ChannelFlowCallbackCommand:()=>ll,ChannelFlowCallbackRequestFilterSensitiveLog:()=>Z_,ChannelFlowFilterSensitiveLog:()=>K2,ChannelFlowSummaryFilterSensitiveLog:()=>Q2,ChannelMembershipFilterSensitiveLog:()=>X2,ChannelMembershipForAppInstanceUserSummaryFilterSensitiveLog:()=>e0,ChannelMembershipPreferencesFilterSensitiveLog:()=>Fh,ChannelMembershipSummaryFilterSensitiveLog:()=>Z2,ChannelMembershipType:()=>p7,ChannelMessageCallbackFilterSensitiveLog:()=>J2,ChannelMessageFilterSensitiveLog:()=>eU,ChannelMessagePersistenceType:()=>C7,ChannelMessageStatus:()=>_7,ChannelMessageSummaryFilterSensitiveLog:()=>tU,ChannelMessageType:()=>T7,ChannelMode:()=>S7,ChannelModeratedByAppInstanceUserSummaryFilterSensitiveLog:()=>t0,ChannelModeratorFilterSensitiveLog:()=>iU,ChannelModeratorSummaryFilterSensitiveLog:()=>rU,ChannelPrivacy:()=>y7,ChannelSummaryFilterSensitiveLog:()=>sl,ChimeSDKMessaging:()=>Xh,ChimeSDKMessagingClient:()=>Te,ChimeSDKMessagingServiceException:()=>it,ConflictException:()=>Qc,CreateChannelBanCommand:()=>ul,CreateChannelBanResponseFilterSensitiveLog:()=>r0,CreateChannelCommand:()=>fl,CreateChannelFlowCommand:()=>hl,CreateChannelFlowRequestFilterSensitiveLog:()=>n0,CreateChannelMembershipCommand:()=>pl,CreateChannelMembershipResponseFilterSensitiveLog:()=>o0,CreateChannelModeratorCommand:()=>ml,CreateChannelModeratorResponseFilterSensitiveLog:()=>s0,CreateChannelRequestFilterSensitiveLog:()=>i0,DeleteChannelBanCommand:()=>gl,DeleteChannelCommand:()=>Sl,DeleteChannelFlowCommand:()=>yl,DeleteChannelMembershipCommand:()=>vl,DeleteChannelMessageCommand:()=>bl,DeleteChannelModeratorCommand:()=>wl,DeleteMessagingStreamingConfigurationsCommand:()=>Cl,DescribeChannelBanCommand:()=>_l,DescribeChannelBanResponseFilterSensitiveLog:()=>d0,DescribeChannelCommand:()=>Tl,DescribeChannelFlowCommand:()=>El,DescribeChannelFlowResponseFilterSensitiveLog:()=>c0,DescribeChannelMembershipCommand:()=>Il,DescribeChannelMembershipForAppInstanceUserCommand:()=>Al,DescribeChannelMembershipForAppInstanceUserResponseFilterSensitiveLog:()=>u0,DescribeChannelMembershipResponseFilterSensitiveLog:()=>l0,DescribeChannelModeratedByAppInstanceUserCommand:()=>kl,DescribeChannelModeratedByAppInstanceUserResponseFilterSensitiveLog:()=>f0,DescribeChannelModeratorCommand:()=>Ml,DescribeChannelModeratorResponseFilterSensitiveLog:()=>h0,DescribeChannelResponseFilterSensitiveLog:()=>a0,DisassociateChannelFlowCommand:()=>xl,ErrorCode:()=>m7,ExpirationCriterion:()=>g7,FallbackAction:()=>b7,ForbiddenException:()=>Xc,GetChannelMembershipPreferencesCommand:()=>Ol,GetChannelMembershipPreferencesResponseFilterSensitiveLog:()=>p0,GetChannelMessageCommand:()=>Pl,GetChannelMessageResponseFilterSensitiveLog:()=>m0,GetChannelMessageStatusCommand:()=>Rl,GetMessagingSessionEndpointCommand:()=>Dl,GetMessagingStreamingConfigurationsCommand:()=>Nl,IdentityFilterSensitiveLog:()=>He,InvocationType:()=>v7,ListChannelBansCommand:()=>mo,ListChannelBansRequestFilterSensitiveLog:()=>g0,ListChannelBansResponseFilterSensitiveLog:()=>S0,ListChannelFlowsCommand:()=>go,ListChannelFlowsRequestFilterSensitiveLog:()=>y0,ListChannelFlowsResponseFilterSensitiveLog:()=>v0,ListChannelMembershipsCommand:()=>So,ListChannelMembershipsForAppInstanceUserCommand:()=>yo,ListChannelMembershipsForAppInstanceUserRequestFilterSensitiveLog:()=>C0,ListChannelMembershipsForAppInstanceUserResponseFilterSensitiveLog:()=>_0,ListChannelMembershipsRequestFilterSensitiveLog:()=>b0,ListChannelMembershipsResponseFilterSensitiveLog:()=>w0,ListChannelMessagesCommand:()=>vo,ListChannelMessagesRequestFilterSensitiveLog:()=>T0,ListChannelMessagesResponseFilterSensitiveLog:()=>E0,ListChannelModeratorsCommand:()=>bo,ListChannelModeratorsRequestFilterSensitiveLog:()=>I0,ListChannelModeratorsResponseFilterSensitiveLog:()=>A0,ListChannelsAssociatedWithChannelFlowCommand:()=>wo,ListChannelsAssociatedWithChannelFlowRequestFilterSensitiveLog:()=>x0,ListChannelsAssociatedWithChannelFlowResponseFilterSensitiveLog:()=>O0,ListChannelsCommand:()=>Co,ListChannelsModeratedByAppInstanceUserCommand:()=>_o,ListChannelsModeratedByAppInstanceUserRequestFilterSensitiveLog:()=>P0,ListChannelsModeratedByAppInstanceUserResponseFilterSensitiveLog:()=>R0,ListChannelsRequestFilterSensitiveLog:()=>k0,ListChannelsResponseFilterSensitiveLog:()=>M0,ListSubChannelsCommand:()=>To,ListSubChannelsRequestFilterSensitiveLog:()=>D0,ListSubChannelsResponseFilterSensitiveLog:()=>N0,ListTagsForResourceCommand:()=>Ll,ListTagsForResourceResponseFilterSensitiveLog:()=>L0,MessageAttributeValueFilterSensitiveLog:()=>ol,MessagingDataType:()=>E7,NotFoundException:()=>Yc,ProcessorFilterSensitiveLog:()=>nl,PushNotificationConfigurationFilterSensitiveLog:()=>Y_,PushNotificationPreferencesFilterSensitiveLog:()=>Y2,PushNotificationType:()=>w7,PutChannelExpirationSettingsCommand:()=>Fl,PutChannelMembershipPreferencesCommand:()=>Bl,PutChannelMembershipPreferencesRequestFilterSensitiveLog:()=>F0,PutChannelMembershipPreferencesResponseFilterSensitiveLog:()=>B0,PutMessagingStreamingConfigurationsCommand:()=>Vl,RedactChannelMessageCommand:()=>Ul,ResourceLimitExceededException:()=>rl,SearchChannelsCommand:()=>Eo,SearchChannelsRequestFilterSensitiveLog:()=>V0,SearchChannelsResponseFilterSensitiveLog:()=>U0,SearchFieldKey:()=>A7,SearchFieldOperator:()=>k7,SendChannelMessageCommand:()=>ql,SendChannelMessageRequestFilterSensitiveLog:()=>q0,ServiceFailureException:()=>Zc,ServiceUnavailableException:()=>el,SortOrder:()=>I7,TagFilterSensitiveLog:()=>al,TagResourceCommand:()=>Hl,TagResourceRequestFilterSensitiveLog:()=>H0,ThrottledClientException:()=>tl,UnauthorizedClientException:()=>il,UntagResourceCommand:()=>zl,UntagResourceRequestFilterSensitiveLog:()=>z0,UpdateChannelCommand:()=>$l,UpdateChannelFlowCommand:()=>jl,UpdateChannelFlowRequestFilterSensitiveLog:()=>j0,UpdateChannelMessageCommand:()=>Wl,UpdateChannelMessageRequestFilterSensitiveLog:()=>W0,UpdateChannelReadMarkerCommand:()=>Gl,UpdateChannelRequestFilterSensitiveLog:()=>$0,__Client:()=>Hc,paginateListChannelBans:()=>uJ,paginateListChannelFlows:()=>fJ,paginateListChannelMemberships:()=>pJ,paginateListChannelMembershipsForAppInstanceUser:()=>hJ,paginateListChannelMessages:()=>mJ,paginateListChannelModerators:()=>gJ,paginateListChannels:()=>vJ,paginateListChannelsAssociatedWithChannelFlow:()=>SJ,paginateListChannelsModeratedByAppInstanceUser:()=>yJ,paginateListSubChannels:()=>bJ,paginateSearchChannels:()=>wJ});var bq=h(()=>{ft();rq();nq();Sq();yq();Lh()});var LT=y(NT=>{"use strict";Object.defineProperty(NT,"__esModule",{value:!0});var DT=class{constructor(t,e,r){this.type=t,this.headers=e,this.payload=r}};NT.default=DT});var BT=y((gPe,Zh)=>{var wq,Cq,_q,Tq,Eq,Iq,Aq,kq,Mq,Yh,FT,xq,Oq,ia,Pq,Rq,Dq,Nq,Lq,Fq,Bq,Vq,Uq;(function(i){var t=typeof window=="object"?window:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(r){i(e(t,e(r)))}):typeof Zh=="object"&&typeof Zh.exports=="object"?i(e(t,e(Zh.exports))):i(e(t));function e(r,n){return r!==t&&(typeof Object.create=="function"?Object.defineProperty(r,"__esModule",{value:!0}):r.__esModule=!0),function(o,s){return r[o]=n?n(o,s):s}}})(function(i){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};wq=function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)},Cq=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_q=function(e,r){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&r.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)r.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]]);return n},Tq=function(e,r,n,o){var s=arguments.length,a=s<3?r:o===null?o=Object.getOwnPropertyDescriptor(r,n):o,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,r,n,o);else for(var c=e.length-1;c>=0;c--)(l=e[c])&&(a=(s<3?l(a):s>3?l(r,n,a):l(r,n))||a);return s>3&&a&&Object.defineProperty(r,n,a),a},Eq=function(e,r){return function(n,o){r(n,o,e)}},Iq=function(e,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,r)},Aq=function(e,r,n,o){function s(a){return a instanceof n?a:new n(function(l){l(a)})}return new(n||(n=Promise))(function(a,l){function c(f){try{u(o.next(f))}catch(m){l(m)}}function d(f){try{u(o.throw(f))}catch(m){l(m)}}function u(f){f.done?a(f.value):s(f.value).then(c,d)}u((o=o.apply(e,r||[])).next())})},kq=function(e,r){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},o,s,a,l;return l={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function c(u){return function(f){return d([u,f])}}function d(u){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,s&&(a=u[0]&2?s.return:u[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,u[1])).done)return a;switch(s=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,s=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){n.label=u[1];break}if(u[0]===6&&n.label<a[1]){n.label=a[1],a=u;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(u);break}a[2]&&n.ops.pop(),n.trys.pop();continue}u=r.call(e,n)}catch(f){u=[6,f],s=0}finally{o=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Uq=function(e,r,n,o){o===void 0&&(o=n),e[o]=r[n]},Mq=function(e,r){for(var n in e)n!=="default"&&!r.hasOwnProperty(n)&&(r[n]=e[n])},Yh=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,n=r&&e[r],o=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},FT=function(e,r){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o=n.call(e),s,a=[],l;try{for(;(r===void 0||r-- >0)&&!(s=o.next()).done;)a.push(s.value)}catch(c){l={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(l)throw l.error}}return a},xq=function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(FT(arguments[r]));return e},Oq=function(){for(var e=0,r=0,n=arguments.length;r<n;r++)e+=arguments[r].length;for(var o=Array(e),s=0,r=0;r<n;r++)for(var a=arguments[r],l=0,c=a.length;l<c;l++,s++)o[s]=a[l];return o},ia=function(e){return this instanceof ia?(this.v=e,this):new ia(e)},Pq=function(e,r,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(e,r||[]),s,a=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(S){o[S]&&(s[S]=function(T){return new Promise(function(_,C){a.push([S,T,_,C])>1||c(S,T)})})}function c(S,T){try{d(o[S](T))}catch(_){m(a[0][3],_)}}function d(S){S.value instanceof ia?Promise.resolve(S.value.v).then(u,f):m(a[0][2],S)}function u(S){c("next",S)}function f(S){c("throw",S)}function m(S,T){S(T),a.shift(),a.length&&c(a[0][0],a[0][1])}},Rq=function(e){var r,n;return r={},o("next"),o("throw",function(s){throw s}),o("return"),r[Symbol.iterator]=function(){return this},r;function o(s,a){r[s]=e[s]?function(l){return(n=!n)?{value:ia(e[s](l)),done:s==="return"}:a?a(l):l}:a}},Dq=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],n;return r?r.call(e):(e=typeof Yh=="function"?Yh(e):e[Symbol.iterator](),n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n);function o(a){n[a]=e[a]&&function(l){return new Promise(function(c,d){l=e[a](l),s(c,d,l.done,l.value)})}}function s(a,l,c,d){Promise.resolve(d).then(function(u){a({value:u,done:c})},l)}},Nq=function(e,r){return Object.defineProperty?Object.defineProperty(e,"raw",{value:r}):e.raw=r,e},Lq=function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r.default=e,r},Fq=function(e){return e&&e.__esModule?e:{default:e}},Bq=function(e,r){if(!r.has(e))throw new TypeError("attempted to get private field on non-instance");return r.get(e)},Vq=function(e,r,n){if(!r.has(e))throw new TypeError("attempted to set private field on non-instance");return r.set(e,n),n},i("__extends",wq),i("__assign",Cq),i("__rest",_q),i("__decorate",Tq),i("__param",Eq),i("__metadata",Iq),i("__awaiter",Aq),i("__generator",kq),i("__exportStar",Mq),i("__createBinding",Uq),i("__values",Yh),i("__read",FT),i("__spread",xq),i("__spreadArrays",Oq),i("__await",ia),i("__asyncGenerator",Pq),i("__asyncDelegator",Rq),i("__asyncValues",Dq),i("__makeTemplateObject",Nq),i("__importStar",Lq),i("__importDefault",Fq),i("__classPrivateFieldGet",Bq),i("__classPrivateFieldSet",Vq)})});var VT=y(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.MAX_HASHABLE_LENGTH=Nt.INIT=Nt.KEY=Nt.DIGEST_LENGTH=Nt.BLOCK_SIZE=void 0;Nt.BLOCK_SIZE=64;Nt.DIGEST_LENGTH=32;Nt.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);Nt.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];Nt.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1});var qq=y(ep=>{"use strict";Object.defineProperty(ep,"__esModule",{value:!0});ep.RawSha256=void 0;var Lt=VT(),CJ=(function(){function i(){this.state=Int32Array.from(Lt.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return i.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var e=0,r=t.byteLength;if(this.bytesHashed+=r,this.bytesHashed*8>Lt.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;r>0;)this.buffer[this.bufferLength++]=t[e++],r--,this.bufferLength===Lt.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},i.prototype.digest=function(){if(!this.finished){var t=this.bytesHashed*8,e=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),r=this.bufferLength;if(e.setUint8(this.bufferLength++,128),r%Lt.BLOCK_SIZE>=Lt.BLOCK_SIZE-8){for(var n=this.bufferLength;n<Lt.BLOCK_SIZE;n++)e.setUint8(n,0);this.hashBuffer(),this.bufferLength=0}for(var n=this.bufferLength;n<Lt.BLOCK_SIZE-8;n++)e.setUint8(n,0);e.setUint32(Lt.BLOCK_SIZE-8,Math.floor(t/4294967296),!0),e.setUint32(Lt.BLOCK_SIZE-4,t),this.hashBuffer(),this.finished=!0}for(var o=new Uint8Array(Lt.DIGEST_LENGTH),n=0;n<8;n++)o[n*4]=this.state[n]>>>24&255,o[n*4+1]=this.state[n]>>>16&255,o[n*4+2]=this.state[n]>>>8&255,o[n*4+3]=this.state[n]>>>0&255;return o},i.prototype.hashBuffer=function(){for(var t=this,e=t.buffer,r=t.state,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=r[5],d=r[6],u=r[7],f=0;f<Lt.BLOCK_SIZE;f++){if(f<16)this.temp[f]=(e[f*4]&255)<<24|(e[f*4+1]&255)<<16|(e[f*4+2]&255)<<8|e[f*4+3]&255;else{var m=this.temp[f-2],S=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10;m=this.temp[f-15];var T=(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3;this.temp[f]=(S+this.temp[f-7]|0)+(T+this.temp[f-16]|0)}var _=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&c^~l&d)|0)+(u+(Lt.KEY[f]+this.temp[f]|0)|0)|0,C=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&o^n&s^o&s)|0;u=d,d=c,c=l,l=a+_|0,a=s,s=o,o=n,n=_+C|0}r[0]+=n,r[1]+=o,r[2]+=s,r[3]+=a,r[4]+=l,r[5]+=c,r[6]+=d,r[7]+=u},i})();ep.RawSha256=CJ});var Hq,zq,$q=h(()=>{Hq=i=>{let t=[];for(let e=0,r=i.length;e<r;e++){let n=i.charCodeAt(e);if(n<128)t.push(n);else if(n<2048)t.push(n>>6|192,n&63|128);else if(e+1<i.length&&(n&64512)===55296&&(i.charCodeAt(e+1)&64512)===56320){let o=65536+((n&1023)<<10)+(i.charCodeAt(++e)&1023);t.push(o>>18|240,o>>12&63|128,o>>6&63|128,o&63|128)}else t.push(n>>12|224,n>>6&63|128,n&63|128)}return Uint8Array.from(t)},zq=i=>{let t="";for(let e=0,r=i.length;e<r;e++){let n=i[e];if(n<128)t+=String.fromCharCode(n);else if(192<=n&&n<224){let o=i[++e];t+=String.fromCharCode((n&31)<<6|o&63)}else if(240<=n&&n<365){let s="%"+[n,i[++e],i[++e],i[++e]].map(a=>a.toString(16)).join("%");t+=decodeURIComponent(s)}else t+=String.fromCharCode((n&15)<<12|(i[++e]&63)<<6|i[++e]&63)}return t}});function jq(i){return new TextEncoder().encode(i)}function Wq(i){return new TextDecoder("utf-8").decode(i)}var Gq=h(()=>{});var Kq={};hu(Kq,{fromUtf8:()=>_J,toUtf8:()=>TJ});var _J,TJ,Jq=h(()=>{$q();Gq();_J=i=>typeof TextEncoder=="function"?jq(i):Hq(i),TJ=i=>typeof TextDecoder=="function"?Wq(i):zq(i)});var Qq=y(tp=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});tp.convertToBuffer=void 0;var EJ=(Jq(),pu(Kq)),IJ=typeof Buffer<"u"&&Buffer.from?function(i){return Buffer.from(i,"utf8")}:EJ.fromUtf8;function AJ(i){return i instanceof Uint8Array?i:typeof i=="string"?IJ(i):ArrayBuffer.isView(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(i)}tp.convertToBuffer=AJ});var Xq=y(ip=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});ip.isEmptyData=void 0;function kJ(i){return typeof i=="string"?i.length===0:i.byteLength===0}ip.isEmptyData=kJ});var Yq=y(rp=>{"use strict";Object.defineProperty(rp,"__esModule",{value:!0});rp.numToUint8=void 0;function MJ(i){return new Uint8Array([(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255])}rp.numToUint8=MJ});var Zq=y(np=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});np.uint32ArrayFrom=void 0;function xJ(i){if(!Uint32Array.from){for(var t=new Uint32Array(i.length),e=0;e<i.length;)t[e]=i[e],e+=1;return t}return Uint32Array.from(i)}np.uint32ArrayFrom=xJ});var eH=y(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.uint32ArrayFrom=Ei.numToUint8=Ei.isEmptyData=Ei.convertToBuffer=void 0;var OJ=Qq();Object.defineProperty(Ei,"convertToBuffer",{enumerable:!0,get:function(){return OJ.convertToBuffer}});var PJ=Xq();Object.defineProperty(Ei,"isEmptyData",{enumerable:!0,get:function(){return PJ.isEmptyData}});var RJ=Yq();Object.defineProperty(Ei,"numToUint8",{enumerable:!0,get:function(){return RJ.numToUint8}});var DJ=Zq();Object.defineProperty(Ei,"uint32ArrayFrom",{enumerable:!0,get:function(){return DJ.uint32ArrayFrom}})});var iH=y(sp=>{"use strict";Object.defineProperty(sp,"__esModule",{value:!0});sp.Sha256=void 0;var tH=BT(),op=VT(),UT=qq(),qT=eH(),NJ=(function(){function i(t){if(this.hash=new UT.RawSha256,t){this.outer=new UT.RawSha256;var e=LJ(t),r=new Uint8Array(op.BLOCK_SIZE);r.set(e);for(var n=0;n<op.BLOCK_SIZE;n++)e[n]^=54,r[n]^=92;this.hash.update(e),this.outer.update(r);for(var n=0;n<e.byteLength;n++)e[n]=0}}return i.prototype.update=function(t){if(!((0,qT.isEmptyData)(t)||this.error))try{this.hash.update((0,qT.convertToBuffer)(t))}catch(e){this.error=e}},i.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},i.prototype.digest=function(){return tH.__awaiter(this,void 0,void 0,function(){return tH.__generator(this,function(t){return[2,this.digestSync()]})})},i})();sp.Sha256=NJ;function LJ(i){var t=(0,qT.convertToBuffer)(i);if(t.byteLength>op.BLOCK_SIZE){var e=new UT.RawSha256;e.update(t),t=e.digest()}var r=new Uint8Array(op.BLOCK_SIZE);return r.set(t),r}});var rH=y(HT=>{"use strict";Object.defineProperty(HT,"__esModule",{value:!0});var FJ=BT();FJ.__exportStar(iH(),HT)});var oH={};hu(oH,{fromHex:()=>BJ,toHex:()=>VJ});function BJ(i){if(i.length%2!==0)throw new Error("Hex encoded strings must have an even number length");let t=new Uint8Array(i.length/2);for(let e=0;e<i.length;e+=2){let r=i.slice(e,e+2).toLowerCase();if(r in zT)t[e/2]=zT[r];else throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`)}return t}function VJ(i){let t="";for(let e=0;e<i.byteLength;e++)t+=nH[i[e]];return t}var nH,zT,sH=h(()=>{nH={},zT={};for(let i=0;i<256;i++){let t=i.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),nH[i]=t,zT[t]=i}});var WT=y(Io=>{"use strict";var aH=Io&&Io.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},UJ=Io&&Io.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Io,"__esModule",{value:!0});var qJ=rH(),$T=(sH(),pu(oH)),ap=UJ(Vt()),jT=class{constructor(t){this.chimeClient=t}makeTwoDigits(t){return t>9?t.toString():"0"+t.toString()}hmac(t,e){let r=new qJ.Sha256(e);return r.update(t),r.digest()}getDateTimeString(){let t=new Date;return t.getUTCFullYear()+this.makeTwoDigits(t.getUTCMonth()+1)+this.makeTwoDigits(t.getUTCDate())+"T"+this.makeTwoDigits(t.getUTCHours())+this.makeTwoDigits(t.getUTCMinutes())+this.makeTwoDigits(t.getUTCSeconds())+"Z"}getDateString(t){return t.substring(0,t.indexOf("T"))}getSignatureKey(t,e,r,n){return aH(this,void 0,void 0,function*(){let o=yield this.hmac(e,"AWS4"+t),s=yield this.hmac(r,o),a=yield this.hmac(n,s);return yield this.hmac("aws4_request",a)})}signURL(t,e,r,n,o,s,a){return aH(this,void 0,void 0,function*(){let l=this.getDateTimeString(),c=this.getDateString(l),d="AWS4-HMAC-SHA256",u="";this.chimeClient.config.region instanceof Function?u=yield this.chimeClient.config.region():u=this.chimeClient.config.region;let f="host",m="host:"+n.toLowerCase()+`
`,S=c+"/"+u+"/"+r+"/aws4_request",T;this.chimeClient.config.credentials instanceof Function?T=yield this.chimeClient.config.credentials():T=this.chimeClient.config.credentials;let _=new Map;_.set("X-Amz-Algorithm",[d]),_.set("X-Amz-Credential",[encodeURIComponent(T.accessKeyId+"/"+S)]),_.set("X-Amz-Date",[l]),_.set("X-Amz-Expires",["10"]),_.set("X-Amz-SignedHeaders",["host"]),T.sessionToken&&_.set("X-Amz-Security-Token",[encodeURIComponent(T.sessionToken)]),_.set(ap.default.X_AMZN_VERSION,[encodeURIComponent(ap.default.sdkVersion)]),_.set(ap.default.X_AMZN_USER_AGENT,[encodeURIComponent(ap.default.sdkUserAgentLowResolution)]),a?.forEach((N,F)=>{let G=encodeURIComponent(F);N.sort().forEach(oe=>{_.has(G)||_.set(G,[]),_.get(G).push(encodeURIComponent(oe))})});let C="";_=new Map([..._.entries()].sort()),_.forEach((N,F)=>{N.forEach(G=>{C.length&&(C+="&"),C+=F+"="+G})});let I=t+`
`+o+`
`+C+`
`+m+`
`+f+`
`+$T.toHex(yield this.hmac(s)),A=$T.toHex(yield this.hmac(I)),E=`AWS4-HMAC-SHA256
`+l+`
`+c+"/"+u+"/"+r+`/aws4_request
`+A,V=yield this.getSignatureKey(T.secretAccessKey,c,u,r),W=$T.toHex(yield this.hmac(E,V)),D=C+"&X-Amz-Signature="+W;return e+"://"+n+o+"?"+D})}};Io.default=jT});var JT=y(KT=>{"use strict";Object.defineProperty(KT,"__esModule",{value:!0});var GT;(function(i){i.Connect="connect"})(GT||(GT={}));KT.default=GT});var lH=y(Ao=>{"use strict";var Kl=Ao&&Ao.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Ji=Ao&&Ao.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ao,"__esModule",{value:!0});var HJ=(bq(),pu(vq)),zJ=Ji(Ar()),QT=Ji(Ou()),$J=Ji(LT()),jJ=Ji(Cc()),WJ=Ji(wt()),GJ=Ji(WT()),KJ=Ji(Tc()),dH=Ji(sd()),cH=Ji(JT()),XT=class{constructor(t,e,r,n,o){this.configuration=t,this.logger=e,this.webSocket=r,this.reconnectController=n,this.sigV4=o,this.observerQueue=new Set,this.webSocket||(this.webSocket=new KJ.default(this.logger)),this.reconnectController||(this.reconnectController=new jJ.default(t.reconnectTimeoutMs,new zJ.default(t.reconnectFixedWaitMs,t.reconnectShortBackoffMs,t.reconnectLongBackoffMs))),this.sigV4||(this.sigV4=new GJ.default(this.configuration.chimeClient)),QT.default.addLogger(this.logger),QT.default.register(),this.preBootstrapMessages=[]}addObserver(t){this.logger.info("adding messaging observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing messaging observer"),this.observerQueue.delete(t)}start(){return Kl(this,void 0,void 0,function*(){this.isClosed()?yield this.startConnecting(!1):this.logger.info("messaging session already started")})}stop(){this.isClosed()?this.logger.info("no existing messaging session needs closing"):(this.isClosing=!0,this.webSocket.close(),QT.default.removeLogger(this.logger))}forEachObserver(t){for(let e of this.observerQueue)WJ.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.openEventHandler()}),this.webSocket.addEventListener("message",t=>{this.receiveMessageHandler(t.data)}),this.webSocket.addEventListener("close",t=>{this.closeEventHandler(t)}),this.webSocket.addEventListener("error",()=>{this.logger.error("WebSocket error")})}startConnecting(t){return Kl(this,void 0,void 0,function*(){return yield this.startConnectingInternal(t),yield new Promise((e,r)=>{this.bootstrapResolved=e,this.bootstrapRejected=r})})}startConnectingInternal(t){var e;return Kl(this,void 0,void 0,function*(){let r=this.configuration.endpointUrl;if(t||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),t||r===void 0)try{if(this.configuration.chimeClient.getMessagingSessionEndpoint instanceof Function){let o=yield this.configuration.chimeClient.getMessagingSessionEndpoint();!((e=o.Endpoint)===null||e===void 0)&&e.Url?r=o.Endpoint.Url:r=(yield this.configuration.chimeClient.getMessagingSessionEndpoint().promise()).Endpoint.Url}else r=(yield this.configuration.chimeClient.send(new HJ.GetMessagingSessionEndpointCommand({}))).Endpoint.Url;this.logger.debug(`Messaging endpoint resolved to: ${r}`)}catch(o){this.logger.error(`Messaging Session failed to resolve endpoint: ${o}`);let s=new CloseEvent("close",{wasClean:!1,code:4999,reason:"Failed to get messaging session endpoint URL",bubbles:!1});this.closeEventHandler(s);return}let n=yield this.prepareWebSocketUrl(r);this.logger.info(`opening connection to ${n}`),t||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),this.webSocket.create(n,[],!0),this.forEachObserver(o=>{o.messagingSessionDidStartConnecting&&o.messagingSessionDidStartConnecting(t)}),this.setUpEventListeners()})}prepareWebSocketUrl(t){return Kl(this,void 0,void 0,function*(){let e=new Map;return e.set("userArn",[this.configuration.userArn]),e.set("sessionId",[this.configuration.messagingSessionId]),this.configuration.prefetchOn===cH.default.Connect&&e.set("prefetch-on",[cH.default.Connect]),this.configuration.prefetchSortBy&&e.set("prefetch-sort-by",[this.configuration.prefetchSortBy]),yield this.sigV4.signURL("GET","wss","chime",t,"/connect","",e)})}isClosed(){return this.webSocket.readyState()===dH.default.None||this.webSocket.readyState()===dH.default.Closed}openEventHandler(){this.reconnectController.reset(),this.isSessionEstablished=!1}receiveMessageHandler(t){try{let e=JSON.parse(t),r=e.Headers["x-amz-chime-event-type"],n=new $J.default(r,e.Headers,e.Payload||null);if(!this.isSessionEstablished&&r==="SESSION_ESTABLISHED"){this.forEachObserver(s=>{s.messagingSessionDidStart&&s.messagingSessionDidStart()}),this.bootstrapResolved(),this.isSessionEstablished=!0;let o=this.preBootstrapMessages.length;for(let s=0;s<o;s++){let a=this.preBootstrapMessages.shift();this.forEachObserver(l=>{this.sendMessageToObserver(l,a)})}}else if(!this.isSessionEstablished){this.preBootstrapMessages.push(n);return}this.forEachObserver(o=>{this.sendMessageToObserver(o,n)})}catch(e){this.logger.error(`Messaging parsing failed: ${e}`)}}sendMessageToObserver(t,e){t.messagingSessionDidReceiveMessage&&t.messagingSessionDidReceiveMessage(e)}retryConnection(){return this.reconnectController.retryWithBackoff(()=>Kl(this,void 0,void 0,function*(){yield this.startConnecting(!0)}),null)}closeEventHandler(t){this.logger.info(`WebSocket close: ${t.code} ${t.reason}`),t.code!==4999&&this.webSocket.destroy(),!(!this.isClosing&&this.canReconnect(t.code)&&this.retryConnection())&&(this.isClosing=!1,this.isSessionEstablished?this.forEachObserver(e=>{e.messagingSessionDidStop&&e.messagingSessionDidStop(t)}):this.bootstrapRejected(t))}canReconnect(t){return t===1001||t===1006||t>=1011&&t<=1014||t>4e3&&t!==4002&&t!==4003&&t!==4401}};Ao.default=XT});var ZT=y(Jl=>{"use strict";var JJ=Jl&&Jl.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Jl,"__esModule",{value:!0});var QJ=JJ(Ar()),YT=class extends QJ.default{constructor(t,e,r,n){super(t,e,r),this.limit=n,this.attempts=0}nextBackoffAmountMs(){if(this.attempts++,this.attempts>this.limit)throw new Error("retry limit exceeded");return super.nextBackoffAmountMs()}};Jl.default=YT});var fH=y(Ql=>{"use strict";var uH=Ql&&Ql.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ql,"__esModule",{value:!0});var XJ=uH(Ar()),YJ=uH(ZT()),eE=class{constructor(t,e,r){this.fixedWaitMs=t,this.shortBackoffMs=e,this.longBackoffMs=r}create(){return new XJ.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs)}createWithLimit(t){return new YJ.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs,t)}};Ql.default=eE});var rE=y(iE=>{"use strict";Object.defineProperty(iE,"__esModule",{value:!0});var tE=class{constructor(t,e,r,n){this.sequenceNumber=t,this.message=e,this.timestampMs=r,this.logLevel=n}};iE.default=tE});var hH=y(oE=>{"use strict";Object.defineProperty(oE,"__esModule",{value:!0});var ZJ=hr(),nE=class{constructor(t,e,r,n){this.userArn=t,this.messagingSessionId=e,this.endpointUrl=r,this.chimeClient=n,this.reconnectTimeoutMs=10*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackoffMs=1*1e3,this.reconnectLongBackoffMs=5*1e3,this.prefetchOn=void 0,this.prefetchSortBy=void 0,this.messagingSessionId||(this.messagingSessionId=this.generateSessionId())}generateSessionId(){let t=new Uint32Array(1);return ZJ.getRandomValues(t),t[0].toString()}};oE.default=nE});var pH=y(Xl=>{"use strict";var eQ=Xl&&Xl.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Xl,"__esModule",{value:!0});var tQ=eQ(Bt()),sE=class{constructor(...t){this._loggers=t}info(t){for(let e of this._loggers)e.info(t)}warn(t){for(let e of this._loggers)e.warn(t)}error(t){for(let e of this._loggers)e.error(t)}debug(t){let e,r;typeof t=="string"?r=t:t?r=()=>(e||(e=t()),e):r=""+t;for(let n of this._loggers)n.debug(r)}setLogLevel(t){for(let e of this._loggers)e.setLogLevel(t)}getLogLevel(){for(let t of this._loggers)return t.getLogLevel();return tQ.default.OFF}};Xl.default=sE});var dp=y(Yl=>{"use strict";var iQ=Yl&&Yl.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Yl,"__esModule",{value:!0});var mH=iQ(Bt()),aE=class{constructor(t=mH.default.OFF){this.level=t}info(t){}warn(t){}error(t){}debug(t){mH.default.DEBUG<this.level||typeof t!="string"&&t()}setLogLevel(t){this.level=t}getLogLevel(){return this.level}};Yl.default=aE});var cE=y(Zl=>{"use strict";var gH=Zl&&Zl.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Zl,"__esModule",{value:!0});var rQ=gH(Bt()),nQ=gH(dp()),dE=class extends nQ.default{constructor(){super(rQ.default.DEBUG)}};Zl.default=dE});var cp=y(uE=>{"use strict";Object.defineProperty(uE,"__esModule",{value:!0});var lE=class{acquireAudioInputStream(){return Promise.reject()}acquireVideoInputStream(){return Promise.reject()}acquireDisplayInputStream(t){return Promise.reject()}muteLocalAudioInputStream(){}unmuteLocalAudioInputStream(){}addMediaStreamBrokerObserver(t){}removeMediaStreamBrokerObserver(t){}};uE.default=lE});var yH=y(eu=>{"use strict";var Ft=eu&&eu.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(eu,"__esModule",{value:!0});var oQ=Ft(Ar()),sQ=Ft(Gf()),SH=Ft(cE()),aQ=Ft(cp()),dQ=Ft(Hf()),cQ=Ft(lc()),lQ=Ft(un()),uQ=Ft(jt()),fQ=Ft(qf()),hQ=Ft(Cc()),pQ=Ft(Tc()),mQ=Ft(Uf()),fE=class extends mQ.default{constructor(t){let e=new dQ.default;e.meetingId="",e.externalMeetingId="",e.credentials=new cQ.default,e.credentials.attendeeId="",e.credentials.joinToken="",e.urls=new fQ.default,e.urls.turnControlURL="",e.urls.audioHostURL="",e.urls.signalingURL="wss://localhost/";let r=new SH.default;super(t||e,r,new pQ.default(new SH.default),new aQ.default,new hQ.default(0,new oQ.default(0,0,0)),new sQ.default(t||e,r))}setAudioProfile(t){}start(){}stop(){}promoteToPrimaryMeeting(t){return Promise.resolve(new lQ.default(uQ.default.OK))}demoteFromPrimaryMeeting(){}};eu.default=fE});var bH=y(Qi=>{"use strict";var gQ=Qi&&Qi.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},vH=Qi&&Qi.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Qi,"__esModule",{value:!0});Qi.NoOpDeviceControllerWithEventController=void 0;var SQ=vH(cp()),yQ=vH(Pi()),lp=class extends SQ.default{constructor(t){super(),this.destroyed=!1}destroy(){return gQ(this,void 0,void 0,function*(){this.destroyed=!0})}listAudioInputDevices(){return Promise.resolve([])}listVideoInputDevices(){return Promise.resolve([])}listAudioOutputDevices(){return Promise.resolve([])}startAudioInput(t){return Promise.reject()}stopAudioInput(){return Promise.resolve()}startVideoInput(t){return Promise.reject()}stopVideoInput(){return Promise.resolve()}chooseAudioOutput(t){return Promise.reject()}addDeviceChangeObserver(t){}removeDeviceChangeObserver(t){}createAnalyserNodeForAudioInput(){return null}startVideoPreviewForVideoInput(t){}stopVideoPreviewForVideoInput(t){}setDeviceLabelTrigger(t){}mixIntoAudioInput(t){return null}chooseVideoInputQuality(t,e,r){}getVideoInputQualitySettings(){return yQ.default.VideoDisabled}};Qi.default=lp;var hE=class extends lp{constructor(t){super(),this.eventController=t}};Qi.NoOpDeviceControllerWithEventController=hE});var wH=y(mE=>{"use strict";Object.defineProperty(mE,"__esModule",{value:!0});var pE=class{constructor(){}reportEvent(t,e,r){}start(){}stop(){}};mE.default=pE});var CH=y(SE=>{"use strict";Object.defineProperty(SE,"__esModule",{value:!0});var gE=class{cancel(){}name(){return"NoOpTask"}run(){return Promise.resolve()}setParent(t){}};SE.default=gE});var _H=y(vE=>{"use strict";Object.defineProperty(vE,"__esModule",{value:!0});var yE=class{create(){let t={clientWidth:400,clientHeight:300,width:400,height:300,videoWidth:400,videoHeight:300,style:{transform:""},hasAttribute:()=>!1,removeAttribute:()=>{},setAttribute:()=>{},srcObject:!1,paused:!0,pause:()=>{t.paused=!0},play:()=>(t.paused=!1,Promise.resolve())};return t}};vE.default=yE});var TH=y(tu=>{"use strict";var vQ=tu&&tu.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(tu,"__esModule",{value:!0});var bQ=vQ(Ms()),bE=class{constructor(){}updateConnectionMetric(t){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(t){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){return new bQ.default(0,0,0,0,!1)}maxBandwidthKbps(){return 0}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}setHighResolutionFeatureEnabled(t){}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!1}};tu.default=bE});var IH=y(ko=>{"use strict";var EH=ko&&ko.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},wE=ko&&ko.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ko,"__esModule",{value:!0});var wQ=wE(nr()),CQ=wE(rE()),Xi=wE(Bt()),iu=class i{constructor(t){this.logCapture=[],this.lock=!1,this.sequenceNumber=0;let{url:e,batchSize:r=i.BATCH_SIZE,intervalMs:n=i.INTERVAL_MS,logLevel:o=Xi.default.WARN,metadata:s,headers:a}=t;this.url=e,this.batchSize=r,this.intervalMs=n,this.logLevel=o,this.metadata=s,this.headers=a,this.start(),this.eventListener=()=>{this.stop()},this.addEventListener()}addEventListener(){!this.eventListener||!("window"in window)||!window.addEventListener||window.addEventListener("unload",this.eventListener)}removeEventListener(){!this.eventListener||!("window"in window)||!window.removeEventListener||window.removeEventListener("unload",this.eventListener)}debug(t){Xi.default.DEBUG<this.logLevel||(typeof t=="string"?this.log(Xi.default.DEBUG,t):t?this.log(Xi.default.DEBUG,t()):this.log(Xi.default.DEBUG,""+t))}info(t){this.log(Xi.default.INFO,t)}warn(t){this.log(Xi.default.WARN,t)}error(t){this.log(Xi.default.ERROR,t)}setLogLevel(t){this.logLevel=t}getLogLevel(){return this.logLevel}getLogCaptureSize(){return this.logCapture.length}start(){this.addEventListener(),this.intervalScheduler=new wQ.default(this.intervalMs),this.intervalScheduler.start(()=>EH(this,void 0,void 0,function*(){if(this.lock===!0||this.getLogCaptureSize()===0)return;this.lock=!0;let t=this.logCapture.slice(0,this.batchSize),e=this.makeRequestBody(t);try{(yield fetch(this.url,Object.assign({method:"POST",body:e},this.headers?{headers:this.headers}:{}))).status===200&&(this.logCapture=this.logCapture.slice(t.length))}catch(r){console.warn("[POSTLogger] "+r.message)}finally{this.lock=!1}}))}stop(){var t;(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=void 0,this.removeEventListener();let e=this.makeRequestBody(this.logCapture);navigator.sendBeacon(this.url,e)}destroy(){return EH(this,void 0,void 0,function*(){this.stop(),this.metadata=void 0,this.headers=void 0,this.logCapture=[],this.sequenceNumber=0,this.lock=!1,this.batchSize=0,this.intervalMs=0,this.url=void 0})}makeRequestBody(t){return JSON.stringify(Object.assign(Object.assign({},this.metadata),{logs:t}))}log(t,e){if(t<this.logLevel)return;let r=Date.now();this.logCapture.push(new CQ.default(this.sequenceNumber,e,r,Xi.default[t])),this.sequenceNumber+=1}};ko.default=iu;iu.BATCH_SIZE=85;iu.INTERVAL_MS=2e3});var AH=y(_E=>{"use strict";Object.defineProperty(_E,"__esModule",{value:!0});var CE;(function(i){i.Unread="unread",i.LastMessageTimestamp="last-message-timestamp"})(CE||(CE={}));_E.default=CE});var kH=y(EE=>{"use strict";Object.defineProperty(EE,"__esModule",{value:!0});var TE=class{constructor(){this.attendeeIndex=null,this.attendeesInFrame=null}};EE.default=TE});var MH=y(ru=>{"use strict";var _Q=ru&&ru.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ru,"__esModule",{value:!0});var TQ=_Q(_e()),IE=class extends TQ.default{constructor(t,e,r="RunnableTask"){super(t),this.fn=e,this.taskName=r}run(){return this.fn().then(()=>{})}};ru.default=IE});var xH=y(nu=>{"use strict";var up=nu&&nu.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(nu,"__esModule",{value:!0});var AE=class{constructor(t){this.inner=t}mute(t){return up(this,void 0,void 0,function*(){})}stop(){var t;return up(this,void 0,void 0,function*(){(t=this.node)===null||t===void 0||t.disconnect()})}intrinsicDevice(){return up(this,void 0,void 0,function*(){return this.inner})}createAudioNode(t){var e;return up(this,void 0,void 0,function*(){return(e=this.node)===null||e===void 0||e.disconnect(),this.node=yield this.createSingleAudioNode(t),{start:this.node,end:this.node}})}};nu.default=AE});var OH=y(ME=>{"use strict";Object.defineProperty(ME,"__esModule",{value:!0});var kE=class{};ME.default=kE});var PH=y(OE=>{"use strict";Object.defineProperty(OE,"__esModule",{value:!0});var xE=class{};OE.default=xE});var RH=y(RE=>{"use strict";Object.defineProperty(RE,"__esModule",{value:!0});var PE=class{};RE.default=PE});var DH=y(NE=>{"use strict";Object.defineProperty(NE,"__esModule",{value:!0});var DE=class{};NE.default=DE});var NH=y(FE=>{"use strict";Object.defineProperty(FE,"__esModule",{value:!0});var LE=class{};FE.default=LE});var LH=y(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.DeferredPromise=void 0;var BE=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}getPromise(){return this.promise}resolvePromise(t){this.resolve(t)}resolveAndReplacePromise(t){this.resolve(t),this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}rejectPromise(t){this.reject(t)}rejectAndReplacePromise(t){this.reject(t),this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}};fp.DeferredPromise=BE});var hp=y(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.DEFAULT_VIDEO_FX_SPEC=Be.FXLIB_PATH=Be.WORKER_PATH=Be.CDN_BASE_PATH=Be.RESOURCE_CONSTRAINTS=Be.SEGMENTATION_MODEL=Be.DEFAULT_STREAM_PARAMETERS=Be.WORKER_MSG=void 0;Be.WORKER_MSG={BUILD_ENGINE_REQUEST:"BuildEngineRequest",BUILD_ENGINE_RESPONSE:"BuildEngineResponse",PERFORM_SEGMENTATION_REQUEST:"PerformSegmentationRequest",PERFORM_SEGMENTATION_RESPONSE:"PerformSegmentationResponse",PERFORM_SEGMENTATION_SAB_REQUEST:"PerformSegmentationSABRequest",PERFORM_SEGMENTATION_SAB_RESPONSE:"PerformSegmentationSABResponse",DESTROY_ASSETS_REQUEST:"DestroyAssetsRequest",DESTROY_ASSETS_RESPONSE:"DestroyAssetsResponse",CLOSE_WORKER_REQUEST:"CloseWorkerRequest"};Be.DEFAULT_STREAM_PARAMETERS={FRAMES_PER_SECOND:15,WIDTH_IN_PIXEL:960,HEIGHT_IN_PIXEL:540,CHANNEL_COUNT:4};Be.SEGMENTATION_MODEL={LOAD_SUCCESS:2,WIDTH_IN_PIXELS:176,HEIGHT_IN_PIXELS:160};Be.RESOURCE_CONSTRAINTS={DEFAULT_PROCESSING_BUDGET_PER_FRAME:50,SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION:1,SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT:500,BLUR_DEFAULT_CYCLE_PERCENTAGE:10,BLUR_SAMPLING_PERIOD_FRAME_COUNT:1e3,MIN_PROCESSING_BUDGET:0,MAX_PROCESSING_BUDGET:100};Be.CDN_BASE_PATH="https://static.sdkassets.chime.aws";var FH="/ml_media_fx/otherassets";Be.WORKER_PATH=`${FH}/worker.js`;Be.FXLIB_PATH=`${FH}/fxlib.js`;Be.DEFAULT_VIDEO_FX_SPEC={paths:{cdnBasePath:Be.CDN_BASE_PATH,workerPath:Be.WORKER_PATH,fxLibPath:Be.FXLIB_PATH}}});var BH=y(na=>{"use strict";var VE=na&&na.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(na,"__esModule",{value:!0});na.VideoFxCanvasOpsManager=void 0;var ra=hp(),UE=class{constructor(t,e){this.streamParameters=t,this.outputCanvas=e,this.configureCanvasPipeline()}getInferenceInputData(t){return this.inferenceCtx.save(),this.inferenceCtx.scale(this.horizontalResizeScalar,this.verticalResizeScalar),this.inferenceCtx.drawImage(t,0,0),this.inferenceCtx.restore(),this.inferenceCtx.getImageData(0,0,ra.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,ra.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS)}configureForStreamParameters(t){return VE(this,void 0,void 0,function*(){if(this.streamParameters=t,this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.backgroundReplacementCanvas){let e=document.createElement("canvas");e.width=this.streamParameters.width,e.height=this.streamParameters.height,e.getContext("2d").drawImage(this.backgroundReplacementCanvas,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=e}this.configureCanvasPipeline()})}configureCanvasPipeline(){this.inferenceCanvas=document.createElement("canvas"),this.inferenceCtx=this.inferenceCanvas.getContext("2d",{willReadFrequently:!0}),this.inferenceCanvas.width=ra.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,this.inferenceCanvas.height=ra.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.horizontalResizeScalar=ra.SEGMENTATION_MODEL.WIDTH_IN_PIXELS/this.streamParameters.width,this.verticalResizeScalar=ra.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS/this.streamParameters.height}getBackgroundReplacementCanvas(){return this.backgroundReplacementCanvas}loadReplacementBackground(t){return VE(this,void 0,void 0,function*(){let e=t.backgroundReplacement.backgroundImageURL,r=t.backgroundReplacement.defaultColor;if(e)try{let n=yield this.loadImage(e);this.backgroundReplacementImage=n,this.resizeAndSetReplacementImage(this.backgroundReplacementImage)}catch(n){throw this.logger.error(n),new Error("Failed to set the replacement image.")}else this.resizeAndSetReplacementColor(r)})}resizeAndSetReplacementImage(t){let e=document.createElement("canvas"),r=e.getContext("2d");e.width=this.streamParameters.width,e.height=this.streamParameters.height,r.drawImage(t,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=e}resizeAndSetReplacementColor(t){let e=document.createElement("canvas"),r=e.getContext("2d");e.width=this.streamParameters.width,e.height=this.streamParameters.height,r.fillStyle=t,r.fillRect(0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=e}loadImage(t){return VE(this,void 0,void 0,function*(){let r=yield(yield fetch(t).catch(o=>{throw this.logger.error(o.toString()),new Error("Failed to fetch image.")})).blob(),n=new Image;return n.src=URL.createObjectURL(r),new Promise((o,s)=>{n.onload=()=>{o(n)},n.onerror=a=>{s(a)}})})}};na.VideoFxCanvasOpsManager=UE});var UH=y(pp=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});pp.VideoFxSegmentationRateManager=void 0;var VH=hp(),qE=class{constructor(t,e){this.logger=t,this.targetSegmentationCyclePercentage=e/100,this.frameCountOverSamplingPeriod=0,this.totalSegmentationDurationOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now(),this.framesPerSegmentation=VH.RESOURCE_CONSTRAINTS.SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION}submitFrame(){this.frameCountOverSamplingPeriod++}shouldApplySegmentation(){return this.frameCountOverSamplingPeriod%this.framesPerSegmentation===0}startSegmentation(){this.frameSegmentationStartTime=performance.now()}completeSegmentation(){this.totalSegmentationDurationOverSamplingPeriod+=performance.now()-this.frameSegmentationStartTime,this.frameCountOverSamplingPeriod>=VH.RESOURCE_CONSTRAINTS.SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT&&this.adjustFramesPerSegmentation(this.totalSegmentationDurationOverSamplingPeriod/(performance.now()-this.samplingPeriodStartTime))}adjustFramesPerSegmentation(t){t>this.targetSegmentationCyclePercentage?(this.framesPerSegmentation++,this.logger.info(`Segmentation cycle percentage above the configured maximal value. Decreasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)):this.framesPerSegmentation>1&&t<this.targetSegmentationCyclePercentage&&(this.framesPerSegmentation--,this.logger.info(`Segmentation cycle percentage below the configured maximal value. Increasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)),this.totalSegmentationDurationOverSamplingPeriod=0,this.frameCountOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now()}};pp.VideoFxSegmentationRateManager=qE});var zH=y(Mo=>{"use strict";var Ye=Mo&&Mo.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},gp=Mo&&Mo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Mo,"__esModule",{value:!0});var EQ=Tu(),IQ=qr(),qH=Zi(),AQ=gp(We()),kQ=gp(dp()),MQ=hr(),HH=gp(Vt()),xQ=gp(ka()),HE=LH(),OQ=BH(),Ee=hp(),PQ=UH(),mp=class i{constructor(t,e=Ee.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME,r){this.logger=t,this.outputCanvas=document.createElement("canvas"),this.canvasVideoFrameBuffer=new xQ.default(this.outputCanvas),this.videoFxSpec=Ee.DEFAULT_VIDEO_FX_SPEC;try{this.validateProcessingBudgetPerFrame(e)}catch(n){throw this.logger.error(n),new Error(`Cannot instantiate VideoFxProcessor due to invalid processingBudgetPerFrame of ${e}`)}r&&(this.eventController=r),this.effectConfig={backgroundBlur:{isEnabled:!1,strength:"low"},backgroundReplacement:{isEnabled:!1,backgroundImageURL:null,defaultColor:"black"}},this.segmentationRequestPromise=new HE.DeferredPromise,this.segmentationRateManager=new PQ.VideoFxSegmentationRateManager(this.logger,e),this.streamParameters={framerate:Ee.DEFAULT_STREAM_PARAMETERS.FRAMES_PER_SECOND,width:Ee.DEFAULT_STREAM_PARAMETERS.WIDTH_IN_PIXEL,height:Ee.DEFAULT_STREAM_PARAMETERS.HEIGHT_IN_PIXEL,channels:Ee.DEFAULT_STREAM_PARAMETERS.CHANNEL_COUNT},i.isSharedArrayBufferSupported&&(this.sharedImageBuffer=new SharedArrayBuffer(Ee.SEGMENTATION_MODEL.WIDTH_IN_PIXELS*Ee.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS*this.streamParameters.channels),this.sharedImageData=new Uint8ClampedArray(this.sharedImageBuffer)),this.logger.info(`VideoFx supports Shared Array Buffer: ${i.isSharedArrayBufferSupported}`),this.canvasOpsManager=new OQ.VideoFxCanvasOpsManager(this.streamParameters,this.outputCanvas),this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.segmentationMask=new ImageData(this.streamParameters.width,this.streamParameters.height),this.logger.info(`VideoFxProcessor instantiated with a processingBudgetPerFrame of ${e}`)}process(t){return Ye(this,void 0,void 0,function*(){return t})}fxProcess(t){return Ye(this,void 0,void 0,function*(){let e=t[0].asCanvasElement();this.didStreamParametersChange(e)&&(yield this.adjustProcessorForNewStreamParameters(e));try{yield this.manageSegmentationMask(e)}catch(r){throw this.logger.error(r),new Error("Video stream could not be processed")}return yield this.renderer.render(e,this.segmentationMask),t[0]=this.canvasVideoFrameBuffer,t})}noOpProcess(t){return Ye(this,void 0,void 0,function*(){return t})}didStreamParametersChange(t){return t.width!==this.streamParameters.width||t.height!==this.streamParameters.height}adjustProcessorForNewStreamParameters(t){return Ye(this,void 0,void 0,function*(){this.streamParameters.width=t.width,this.streamParameters.height=t.height,yield this.canvasOpsManager.configureForStreamParameters(this.streamParameters),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,this.effectConfig)})}destroy(){return Ye(this,void 0,void 0,function*(){this.canvasVideoFrameBuffer.destroy(),this.fxLibScript&&this.fxLibScript.parentNode&&this.fxLibScript.parentNode.removeChild(this.fxLibScript),this.engineWorker&&(this.destroyedAssetsPromise=new HE.DeferredPromise,this.engineWorker.postMessage({msg:Ee.WORKER_MSG.DESTROY_ASSETS_REQUEST}),yield this.destroyedAssetsPromise.getPromise(),this.engineWorker.postMessage({msg:Ee.WORKER_MSG.CLOSE_WORKER_REQUEST})),this.logger.info("VideoFxProcessor destroyed.")})}manageSegmentationMask(t){return Ye(this,void 0,void 0,function*(){try{if(this.segmentationRateManager.submitFrame(),this.segmentationRateManager.shouldApplySegmentation()){this.segmentationRateManager.startSegmentation();let e=this.canvasOpsManager.getInferenceInputData(t);this.segmentationMask=yield this.generateSegmentationMask(e),this.segmentationRateManager.completeSegmentation()}}catch(e){throw this.logger.error(e.toString()),new Error("Can not properly manage the returned segmentation mask")}})}generateSegmentationMask(t){return Ye(this,void 0,void 0,function*(){i.isSharedArrayBufferSupported?(this.sharedImageData.set(t.data),this.engineWorker.postMessage({msg:Ee.WORKER_MSG.PERFORM_SEGMENTATION_SAB_REQUEST,payload:this.sharedImageBuffer})):this.engineWorker.postMessage({msg:Ee.WORKER_MSG.PERFORM_SEGMENTATION_REQUEST,payload:t},[t.data.buffer]);try{return yield this.segmentationRequestPromise.getPromise()}catch(e){throw this.logger.error(e.toString()),new Error("Segmentation mask could not be generated")}})}cloneConfigFrom(t){return{backgroundBlur:{isEnabled:t.backgroundBlur.isEnabled,strength:t.backgroundBlur.strength},backgroundReplacement:{isEnabled:t.backgroundReplacement.isEnabled,backgroundImageURL:t.backgroundReplacement.backgroundImageURL,defaultColor:t.backgroundReplacement.defaultColor}}}setVideoFxSpec(t){t.paths&&(this.videoFxSpec.paths=t.paths)}setEffectConfig(t){return Ye(this,void 0,void 0,function*(){if(this.sameVideoFxConfig(t,this.effectConfig))return;let e=this.cloneConfigFrom(t);try{yield this.validateEffectConfig(e)}catch(r){throw this.logger.error(r.toString()),new Error("Provided effect config is invalid, not updating VideoFxProcessor")}e.backgroundReplacement.isEnabled&&(yield this.canvasOpsManager.loadReplacementBackground(e),yield this.renderer.setBackgroundReplacementCanvas(this.canvasOpsManager.getBackgroundReplacementCanvas())),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,e),this.effectConfig=e,!this.effectConfig.backgroundBlur.isEnabled&&!this.effectConfig.backgroundReplacement.isEnabled?this.process=this.noOpProcess:this.process=this.fxProcess,this.logger.info(`VideoFxProcessor effect configuration updated to: ${JSON.stringify(this.effectConfig)}`),this.eventController&&this.publishVideoFxConfigEvent()})}validateEffectConfig(t){return Ye(this,void 0,void 0,function*(){if(t.backgroundBlur.isEnabled&&t.backgroundReplacement.isEnabled)throw new Error("Invalid VideoFx configuration: Background Blur and Background Replacement can not both be enabled");t.backgroundReplacement.isEnabled&&(yield this.validateReplacementConfig(t))})}validateReplacementConfig(t){return Ye(this,void 0,void 0,function*(){if(t.backgroundReplacement.backgroundImageURL&&t.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement can not have both an image URL and default color");if(!t.backgroundReplacement.backgroundImageURL&&!t.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement image URL and default can not both be null/undefined");try{t.backgroundReplacement.backgroundImageURL&&(yield this.canvasOpsManager.loadImage(t.backgroundReplacement.backgroundImageURL))}catch(r){throw this.logger.error(r.toString()),new Error("Invalid VideoFx configuration: backgroundImageURL failed to load")}let e=t.backgroundReplacement.defaultColor;if(e&&e!=="black"&&e!=="#000000"&&e!=="#000"){if(e.includes("#")&&!new RegExp(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/).test(e))throw new Error(`Invalid hexadecimal color code for default replacement background: ${e}`);let n=document.createElement("canvas").getContext("2d"),o=n.fillStyle;if(n.fillStyle=e,n.fillStyle===o)throw new Error(`Invalid color for default replacement background: ${e}`)}})}validateProcessingBudgetPerFrame(t){if(t<Ee.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET||t>Ee.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET)throw new Error(`Invalid resource constraint: cycle percentage must be within range of ${Ee.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET} and ${Ee.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET}`)}loadAssets(){return Ye(this,void 0,void 0,function*(){this.logger.info("Loading required assets for the VideoFxProcessor");try{let t=this.getVideoFxAssetParams();yield this.loadEngineWorker(t),yield this.buildEngine(t),yield this.loadFxLib(t),this.renderer=constructRenderer(Ee.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,Ee.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.effectConfig,this.outputCanvas)}catch(t){throw this.logger.error(t.toString()),new Error("Failed to load necessary assets for the VideoFxProcessor")}this.logger.info("Finished loading of essential VideoFxProcessor assets.")})}getVideoFxAssetParams(){let t=MQ.getDefaultAssetSpec();return{assetGroup:t.assetGroup,revisionID:t.revisionID,sdk:encodeURIComponent(HH.default.sdkVersion),ua:encodeURIComponent(HH.default.sdkUserAgentLowResolution)}}getPathFromVideoFxAssetParams(t,e){let r=new URL(t);for(let[n,o]of Object.entries(e))if(o!==void 0){let s=encodeURIComponent(n),a=encodeURIComponent(o);r.searchParams.set(s,a)}return r.toString()}loadEngineWorker(t){return Ye(this,void 0,void 0,function*(){try{let e=this.getPathFromVideoFxAssetParams(this.videoFxSpec.paths.cdnBasePath+this.videoFxSpec.paths.workerPath,t);this.engineWorker=yield IQ.loadWorker(e,"VideoFxEngineWorker",{},null),this.logger.info("Successfully loaded the VideoFxProcessor's engine worker"),this.engineWorker.addEventListener("message",r=>this.engineWorkerReceiver(r))}catch(e){throw this.logger.error(e.toString()),new Error("Failed to load the VideoFxProcessor's engine worker")}})}buildEngine(t){return Ye(this,void 0,void 0,function*(){this.buildEnginePromise=new HE.DeferredPromise,this.engineWorker.postMessage({msg:Ee.WORKER_MSG.BUILD_ENGINE_REQUEST,payload:{cdnBasePath:this.videoFxSpec.paths.cdnBasePath,sdkVersioningParams:t}});try{yield this.buildEnginePromise.getPromise()}catch(e){throw this.logger.error(e.toString()),new Error("Failed to instantiate the VideoFxEngine")}})}loadFxLib(t){return Ye(this,void 0,void 0,function*(){let e=this.getPathFromVideoFxAssetParams(this.videoFxSpec.paths.cdnBasePath+this.videoFxSpec.paths.fxLibPath,t),r={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"};try{let n=yield EQ.fetchWithBehavior(e,r,{});if(!n.ok)throw new Error("Fetch failed.");let o=window.URL.createObjectURL(yield n.blob());yield new Promise((s,a)=>{this.fxLibScript=document.createElement("script"),this.fxLibScript.setAttribute("src",o),this.fxLibScript.setAttribute("type","module"),this.fxLibScript.setAttribute("async","false"),this.fxLibScript.addEventListener("load",s),this.fxLibScript.addEventListener("error",a),document.body.appendChild(this.fxLibScript)})}catch(n){throw this.logger.error(n.toString()),new Error("Failed to load the fxlib")}})}getEffectConfig(){return this.cloneConfigFrom(this.effectConfig)}engineWorkerReceiver(t){let e=t.data;switch(e.msg){case Ee.WORKER_MSG.BUILD_ENGINE_RESPONSE:this.settleEngineBuildPromise(e.payload);break;case Ee.WORKER_MSG.PERFORM_SEGMENTATION_RESPONSE:this.settleSegmentationPromise(e.payload.output);break;case Ee.WORKER_MSG.PERFORM_SEGMENTATION_SAB_RESPONSE:this.settleSegmentationPromiseSAB();break;case Ee.WORKER_MSG.DESTROY_ASSETS_RESPONSE:this.destroyedAssetsPromise.resolvePromise();break;default:this.logger.info(`VideoFx worker received unknown event msg: ${JSON.stringify(e)}`);break}}settleEngineBuildPromise(t){t!==Ee.SEGMENTATION_MODEL.LOAD_SUCCESS?this.buildEnginePromise.rejectPromise(new Error("Failed to build VideoFxProcessor's engine")):(this.logger.info("Successfully built the VideoFxEngine"),this.buildEnginePromise.resolvePromise())}settleSegmentationPromise(t){t?this.segmentationRequestPromise.resolveAndReplacePromise(t):this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation on the input image"))}settleSegmentationPromiseSAB(){try{let t=new ImageData(new Uint8ClampedArray(this.sharedImageData),Ee.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,Ee.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS);this.segmentationRequestPromise.resolveAndReplacePromise(t)}catch{this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation with a shared array buffer on the input image"))}}setToNoOpProcess(){this.process=this.noOpProcess}static isSupported(t=new kQ.default,e=!0){return Ye(this,void 0,void 0,function*(){let r=!0,n=(a,l)=>{a&&(t.info(l),r=!1)};n(typeof globalThis>"u","Browser does not have globalThis."),n(!qH.supportsWorker(globalThis,t),"Browser does not support web workers."),n(!qH.supportsWASM(globalThis,t),"Browser does not support wasm."),n(!document.createElement("canvas").getContext("webgl2"),"Browser does not support webgl.");let o=new AQ.default;n(!o.isVideoFxSupportedBrowser(),"Browser is unsupported for VideoFxProcessor");let s=()=>Ye(this,void 0,void 0,function*(){if(e)try{let a=new i(t);yield a.loadAssets(),yield a.destroy()}catch{return t.info("Browser environment is unable to access the required external assets."),Promise.resolve(!1)}return Promise.resolve(!0)});return Promise.resolve(r?yield s():!1)})}static create(t,e,r=Ee.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME,n){return Ye(this,void 0,void 0,function*(){let o=new i(t,r);n&&o.setVideoFxSpec(n);try{return yield o.loadAssets(),yield o.setEffectConfig(e),o}catch(s){throw t.error(s.toString()),o.setToNoOpProcess(),new Error("VideoFxProcessor built with support for only NoOp processing")}})}setEventController(t){this.eventController?this.eventController=t:(this.eventController=t,this.publishVideoFxConfigEvent())}publishVideoFxConfigEvent(){let t={backgroundBlurEnabled:this.effectConfig.backgroundBlur.isEnabled.toString(),backgroundBlurStrength:this.effectConfig.backgroundBlur.strength,backgroundReplacementEnabled:this.effectConfig.backgroundReplacement.isEnabled.toString(),backgroundFilterVersion:2};this.eventController.publishEvent("backgroundFilterConfigSelected",t)}sameVideoFxConfig(t,e){return t.backgroundBlur.isEnabled===e.backgroundBlur.isEnabled&&t.backgroundBlur.strength===e.backgroundBlur.strength&&t.backgroundReplacement.backgroundImageURL===e.backgroundReplacement.backgroundImageURL&&t.backgroundReplacement.defaultColor===e.backgroundReplacement.defaultColor&&t.backgroundReplacement.isEnabled===e.backgroundReplacement.isEnabled}};Mo.default=mp;mp.isSharedArrayBufferSupported=typeof SharedArrayBuffer<"u"});var WH=y(Nr=>{"use strict";var $E=Nr&&Nr.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.decideModel=Nr.measureAndDecideExecutionApproach=void 0;var RQ=qr(),zE=Zi(),DQ=3,NQ=2.5,LQ=2.63,FQ=.6,BQ=.65,VQ=.5,UQ=.7,$H={wasm:{noSupport:.07,inline:{c100:1,c50:.36,c20:.16,c10:.07},worker:{c100:.5,c50:.18,c20:.08,c10:.06}},simd:{noSupport:.1,inline:{c100:1,c50:.43,c20:.3,c10:.2},worker:{c100:.5,c50:.21,c20:.15,c10:.1}}},Sp=class{constructor(t,e){this.fetchConfig=t,this.logger=e;let r=`${t.paths.workers}estimator-v1.js`;this.fetchBehavior={headers:t.headers,escapedQueryString:t.escapedQueryString},this.worker=(0,RQ.loadWorker)(r,"VoiceFocusEstimator",this.fetchBehavior,e)}roundtrip(t,e,r){return new Promise((n,o)=>{this.worker.then(s=>{let a;a=l=>{let{message:c,key:d}=l.data;c===e&&d===r&&(s.removeEventListener("message",a),n(l.data))},s.addEventListener("message",a),s.postMessage(t)}).catch(s=>{var a;(a=this.logger)===null||a===void 0||a.error("Failed to load worker.",s),o(s)})})}supportsSIMD(t){let e="simd",r=t||`${this.fetchConfig.paths.wasm}simd-v1.wasm`,n={message:"supports-simd",fetchBehavior:this.fetchBehavior,path:r,key:e};return this.roundtrip(n,"simd-support",e).then(o=>o.supports)}measure(t,e){let r=`${this.fetchConfig.paths.wasm}bench-v1.wasm`,n=`${this.fetchConfig.paths.wasm}bench-v1_simd.wasm`,o=t?n:r,s=`bench:${t}`,a={message:"measure",fetchBehavior:this.fetchBehavior,budget:e,path:o,key:s};return this.roundtrip(a,"measurement",s).then(l=>{if(l.measurement)return l.measurement;throw new Error("Failed to measure.")})}stop(){this.worker.then(t=>{var e;(e=this.logger)===null||e===void 0||e.debug("Stopping estimator worker."),t.terminate()}).catch(t=>{})}},qQ=(i,t)=>i===1?FQ:t==="quality"?BQ*i:VQ*i,HQ=({supportsSIMD:i,supportsSAB:t,duration:e,executionPreference:r="auto",simdPreference:n,variantPreference:o="auto",namePreference:s="default",usagePreference:a,executionQuantaPreference:l=DQ},c=$H,d)=>{let f=n==="force"||n!=="disable"&&i,m=e!==-1,S=m?(f?NQ:LQ)/e:0,T=f?c.simd:c.wasm,_=m?qQ(l,a)*S:0,C=m?UQ*S:0,I=s,A=D=>({supported:!1,reason:D});if(m){if(S<T.noSupport)return A(`Performance score ${S} worse than threshold ${T.noSupport}.`)}else if(r==="auto"||o==="auto")return A(`Missing explicit execution (${r}) or variant (${o}) preference, but no scoring performed.`);d?.debug(`Bench duration ${e} yields inline score ${_} and worker score ${C}.`);let E=(D,N,F)=>({supported:!0,useSIMD:f,processor:D,executionApproach:N,variant:F,executionQuanta:N==="inline"?l:void 0,name:I}),V=(D,N,F)=>N!=="auto"?!m||D>F[N]?N:"failed":D>F.c100?"c100":D>F.c50?"c50":D>F.c20?"c20":D>F.c10?"c10":"failed",W=D=>{switch(D||"auto"){case"auto":{let N=W("inline"),F=W("worker");return d?.debug(`Reducing auto preference: ${JSON.stringify(N)} vs ${JSON.stringify(F)}`),N.supported===!1||F.supported===!1?F:N.variant===F.variant||N.variant==="c50"?N:F}case"worker":return(0,zE.supportsSharedArrayBuffer)(globalThis,window,d)?W("worker-sab"):W("worker-postMessage");case"inline":{let N=V(_,o,T.inline);return N==="failed"?A(`Performance score ${_} not sufficient for inline use with variant preference ${o}.`):E("voicefocus-inline-processor","inline",N)}case"worker-sab":{if(!t){let F="Requested worker-sab but no SharedArrayBuffer support.";return d?.warn(F),{supported:!1,reason:F}}let N=V(C,o,T.worker);return N==="failed"?A(`Performance score ${C} not sufficient for worker use with variant preference ${o}.`):E("voicefocus-worker-sab-processor","worker-sab",N)}case"worker-postMessage":{let N=V(C,o,T.worker);if(N==="failed")return A(`Performance score ${C} not sufficient for worker use.`);if(I==="ns_es"){let F="Requested echo suppression but postMessage executor does not support it.";return d?.warn(F),{supported:!1,reason:F}}return E("voicefocus-worker-postMessage-processor","worker-postMessage",N)}}};return W(r)},jH=(i,t,e,r)=>$E(void 0,void 0,void 0,function*(){let n={supportsSIMD:i,supportsSAB:(0,zE.supportsSharedArrayBuffer)(globalThis,window,e),duration:-1};if(i)return e?.info("Supports SIMD: true (force)"),n;let o=!r,s=r||new Sp(t,e);try{let a=!(0,zE.isOldChrome)(window,e)&&(yield s.supportsSIMD());return e?.info(`Supports SIMD: ${a} (force: ${i})`),n.supportsSIMD=a,n}finally{o&&s.stop()}}),zQ=(i,t,e,r)=>$E(void 0,void 0,void 0,function*(){let n=new Sp(t,r);try{let o=yield jH(i,t,r,n);if(o.supportsSIMD)try{return o.duration=yield n.measure(!0,e),r?.info("SIMD timing:",o.duration),o}catch{r?.warn("Failed SIMD estimation; falling back to non-SIMD."),o.supportsSIMD=!1}return o.duration=yield n.measure(!1,e),r?.info("No-SIMD timing:",o.duration),o}catch(o){throw r?.error("Could not feature check.",o),o}finally{n.stop()}}),$Q=(i,t,e,r=$H)=>$E(void 0,void 0,void 0,function*(){let n=i.executionPreference,{usagePreference:o,variantPreference:s,namePreference:a,simdPreference:l,estimatorBudget:c,executionQuantaPreference:d}=i;o==="interactivity"&&n!=="inline"&&(e?.debug(`Overriding execution preference ${n} to reflect interactivity preference.`),n="inline");let u=l==="force",f=s!=="auto",m=n!=="auto",S;try{f&&m?S=yield jH(u,t,e):S=yield zQ(u,t,c,e)}catch(T){throw e?.error("Could not load estimator.",T),new Error("Could not load Voice Focus estimator.")}return HQ(Object.assign(Object.assign({},S),{simdPreference:l,executionPreference:n,variantPreference:s,namePreference:a,usagePreference:o,executionQuantaPreference:d}),r,e)});Nr.measureAndDecideExecutionApproach=$Q;var jQ=({category:i,name:t,variant:e,simd:r,url:n})=>`${i}-${t}-${e}-v1${r?"_simd":""}`;Nr.decideModel=jQ});var vp=y(yp=>{"use strict";Object.defineProperty(yp,"__esModule",{value:!0});yp.VoiceFocusAudioWorkletNode=void 0;var jE=class extends(typeof globalThis<"u"&&globalThis.AudioWorkletNode||class{}){};yp.VoiceFocusAudioWorkletNode=jE});var GH=y(ou=>{"use strict";var bp=ou&&ou.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(ou,"__esModule",{value:!0});var WQ=Zi(),GQ=vp(),KQ=5*1e3,JQ=5*1e3,WE=class extends GQ.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.cpuWarningCount=0,this.metrics={latencyMillisAverage:0,snr:{average:0,averageActive:0,variance:0,varianceActive:0},drr:{average:0,variance:0,averageActive:0,varianceActive:0},vad:{average:0},cpu:{lateInvoke:0,longInvoke:0}},this.channelCountMode="explicit",this.channelCount=1;let{modelURL:r,worker:n,fetchBehavior:o,logger:s,delegate:a}=e;this.logger=s,this.port.onmessage=this.onProcessorMessage.bind(this),this.delegate=a,s&&s.debug("VoiceFocusInlineNode:",r),this.worker=n,this.worker.onmessage=this.onWorkerMessage.bind(this);let l=(0,WQ.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:l,key:"model",fetchBehavior:o,path:r})}onModuleBufferLoaded(t,e){this.port.postMessage({message:"module-buffer",buffer:t,key:e})}onModuleLoaded(t,e){this.port.postMessage({message:"module",module:t,key:e})}enable(){return bp(this,void 0,void 0,function*(){this.port.postMessage({message:"enable"})})}disable(){return bp(this,void 0,void 0,function*(){this.port.postMessage({message:"disable"})})}setMode(t){return bp(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:t})})}stop(){var t;return bp(this,void 0,void 0,function*(){this.port.postMessage({message:"stop"});try{(t=this.worker)===null||t===void 0||t.terminate()}catch(e){console.error("failed to terminate worker:",e)}this.disconnect()})}onProcessorMessage(t){var e,r,n,o,s,a;let{data:l}=t,{message:c}=l;switch(c){case"cpu":let{reason:d,count:u}=l;d&&u&&(this.metrics.cpu=Object.assign(Object.assign({},this.metrics.cpu),{[d]:u+this.metrics.cpu[d]})),this.cpuWarningCount++;let f=Date.now(),m=this.cpuWarningLastTriggered||f,S=Math.abs(f-m);(!this.cpuWarningLastTriggered||S>KQ)&&((e=this.logger)===null||e===void 0||e.warn(`CPU warning (count: ${this.cpuWarningCount}):`,c),this.cpuWarningCount=0,this.cpuWarningLastTriggered=f),(r=this.delegate)===null||r===void 0||r.onCPUWarning();break;case"metrics":let{metrics:T}=l;if(!T){(n=this.logger)===null||n===void 0||n.warn("Got metrics message but no metrics payload");break}if(this.metrics=Object.assign(Object.assign({},this.metrics),T),this.logger){let _=Date.now();_-((o=this.metricsLastRecorded)!==null&&o!==void 0?o:0)>JQ&&((s=this.logger)===null||s===void 0||s.debug("Contact metrics:",this.metrics),this.metricsLastRecorded=_)}break;default:(a=this.logger)===null||a===void 0||a.debug("Ignoring processor message.")}}getModelMetrics(){return this.metrics}onWorkerMessage(t){let e=t.data;switch(e.message){case"module-buffer":if(!e.buffer||!e.key)return;this.onModuleBufferLoaded(e.buffer,e.key);break;case"module":if(!e.module||!e.key)return;this.onModuleLoaded(e.module,e.key);break;case"stopped":this.worker&&this.worker.terminate();break;default:return}}};ou.default=WE});var KH=y(su=>{"use strict";var wp=su&&su.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(su,"__esModule",{value:!0});var QQ=Zi(),XQ=vp(),oa={ready:0,enabled:1},GE={disabled:0,enabled:1,stopped:2},KE=class extends XQ.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.channelCountMode="explicit",this.channelCount=1;let{modelURL:r,resamplerURL:n,worker:o,fetchBehavior:s,delegate:a}=e;this.delegate=a,this.worker=o,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);let{enabled:l,supportFarendStream:c}=e.processorOptions;this.worker.postMessage({message:"init",approach:"sab",frames:t.sampleRate===16e3?160:480,enabled:l,model:r,supportFarendStream:c});let d=(0,QQ.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:d,key:"resampler",fetchBehavior:s,path:n})}enable(){return wp(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,oa.enabled,GE.enabled),Atomics.notify(this.state,oa.ready,1)):this.worker.postMessage({message:"enable"})})}disable(){return wp(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,oa.enabled,GE.disabled),Atomics.notify(this.state,oa.ready,1)):this.worker.postMessage({message:"disable"})})}setMode(t){return wp(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:t})})}stop(){return wp(this,void 0,void 0,function*(){if(this.state)Atomics.store(this.state,oa.enabled,GE.stopped),Atomics.notify(this.state,oa.ready,1);else try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}getModelMetrics(){}onWorkerMessage(t){var e;let r=t.data;switch(r.message){case"ready":if(!r.shared)throw new Error("No shared state.");this.state=new Int32Array(r.shared.state),this.port.postMessage(r);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(r);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"processing":this.port.postMessage(r);break;default:return}}onProcessorMessage(t){var e;let r=t.data;switch(r.message){case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(r);break;default:}}};su.default=KE});var JH=y(au=>{"use strict";var Cp=au&&au.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(au,"__esModule",{value:!0});var YQ=Zi(),ZQ=vp(),JE=class extends ZQ.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.channelCountMode="explicit",this.channelCount=1;let{modelURL:r,audioBufferURL:n,worker:o,fetchBehavior:s,delegate:a}=e;this.delegate=a,this.worker=o,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);let{enabled:l,agc:c,supportFarendStream:d}=e.processorOptions;this.worker.postMessage({message:"init",approach:"postMessage",frames:t.sampleRate===16e3?160:480,enabled:l,agc:c,fetchBehavior:s,model:r,supportFarendStream:d});let u=(0,YQ.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:u,key:"buffer",fetchBehavior:s,path:n})}enable(){return Cp(this,void 0,void 0,function*(){this.worker.postMessage({message:"enable"})})}disable(){return Cp(this,void 0,void 0,function*(){this.worker.postMessage({message:"disable"})})}setMode(t){return Cp(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:t})})}stop(){return Cp(this,void 0,void 0,function*(){try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}getModelMetrics(){}onWorkerMessage(t){var e;let r=t.data;switch(r.message){case"ready":this.port.postMessage({message:"ready",shared:r.shared},r.shared?Object.values(r.shared):[]);break;case"data":if(!r.buffer)return;this.port.postMessage({message:"data",buffer:r.buffer},[r.buffer]);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(r);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"processing":this.port.postMessage(r);break;default:return}}onProcessorMessage(t){var e;let r=t.data;switch(r.message){case"data":if(!r.buffer)return;this.worker.postMessage({message:"data",buffer:r.buffer},[r.buffer]);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(r);break;default:return}}};au.default=JE});var rz=y(Ii=>{"use strict";var sa=Ii&&Ii.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.getAudioInput=Ii.createAudioContext=Ii.VoiceFocus=void 0;var ez=WH(),aa=Tu(),eX=qr(),xo=Zi(),tX=GH(),iX=KH(),rX=JH(),nX={useVoiceFocusAGC:!1,useBuiltInAGC:!0},tz=nX,QH="stable-v1",_p="https://static.sdkassets.chime.aws",XH={processors:`${_p}/processors/`,workers:`${_p}/workers/`,wasm:`${_p}/wasm/`,models:`${_p}/wasm/`},oX={latencyHint:0},iz={channelCount:1,echoCancellation:!0,googEchoCancellation:!0,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1},sX=Object.assign(Object.assign({},iz),{autoGainControl:!0,googAutoGainControl:!0,googAutoGainControl2:!0}),aX=Object.assign(Object.assign({},iz),{autoGainControl:!1,googAutoGainControl:!1,googAutoGainControl2:!1}),dX={"voicefocus-worker-sab-processor":{file:"worklet-worker-sab-processor-v1.js",node:iX.default},"voicefocus-worker-postMessage-processor":{file:"worklet-worker-postMessage-processor-v1.js",node:rX.default},"voicefocus-inline-processor":{file:"worklet-inline-processor-v1.js",node:tX.default}},YH=(i,t)=>{if(i!==void 0&&!(0,aa.isValidAssetGroup)(i))throw new Error(`Invalid asset group ${i}`);if(t!==void 0&&!(0,aa.isValidRevisionID)(t))throw new Error(`Invalid revision ID ${t}`)},cX=(i,t)=>{let e;if(t.useBuiltInAGC?e=sX:e=aX,!i)return{audio:e};if(!i.audio)return i;if(i.video)throw new Error("Not adding Voice Focus to multi-device getUserMedia call.");return Object.assign(Object.assign({},i),{audio:i.audio===!0?e:Object.assign(Object.assign({},i.audio),e)})},ZH=(i,t)=>`${t.models}${(0,ez.decideModel)(i)}.wasm`,du=class i{constructor(t,e,r,n,o,s){this.processorURL=e,this.nodeConstructor=r,this.nodeOptions=n,this.executionQuanta=o,this.logger=s,this.internal={worker:t,isDestroyed:!1}}getModelMetrics(){var t;return(t=this.internal.voiceFocusNode)===null||t===void 0?void 0:t.getModelMetrics()}enable(){var t;(t=this.internal.voiceFocusNode)===null||t===void 0||t.enable()}disable(){var t;(t=this.internal.voiceFocusNode)===null||t===void 0||t.disable()}setMode(t){var e;(e=this.internal.voiceFocusNode)===null||e===void 0||e.setMode(t)}destroy(){var t,e,r,n,o;return sa(this,void 0,void 0,function*(){let{worker:s,isDestroyed:a,voiceFocusNode:l,destinationNode:c,sourceNode:d,audioContext:u}=this.internal;if(a){(t=this.logger)===null||t===void 0||t.debug("Voice Focus is already destroyed");return}try{s?.terminate(),d?.disconnect(),c?.disconnect(),yield Promise.all([(e=u?.close().catch(f=>f))!==null&&e!==void 0?e:yield Promise.resolve(),(r=l?.stop().catch(f=>f))!==null&&r!==void 0?r:yield Promise.resolve()]),this.internal.audioContext=void 0,this.internal.voiceFocusNode=void 0,this.internal.sourceNode=void 0,this.internal.destinationNode=void 0,(n=this.logger)===null||n===void 0||n.debug("Voice Focus destroyed successfully")}catch(f){throw(o=this.logger)===null||o===void 0||o.error("Error while destroying the Voice Focus instance: ",f),f}finally{this.internal.isDestroyed=!0}})}static isSupported(t,e){let{fetchBehavior:r,logger:n}=e||{};if(typeof globalThis>"u")return n?.debug("Browser does not have globalThis."),Promise.resolve(!1);if(!(0,xo.supportsAudioWorklet)(globalThis,n))return n?.debug("Browser does not support Audio Worklet."),Promise.resolve(!1);if(!(0,xo.supportsWASM)(globalThis,n))return n?.debug("Browser does not support WASM."),Promise.resolve(!1);(0,xo.supportsWASMStreaming)(globalThis,n)||n?.debug("Browser does not support streaming WASM compilation.");let{assetGroup:o=QH,revisionID:s,paths:a=XH}=t||{};YH(o,s);let l=s?{revisionID:s}:{assetGroup:o},c=(0,aa.addQueryParams)(r,l),d=Object.assign(Object.assign({},c),{paths:a});return(0,xo.supportsVoiceFocusWorker)(globalThis,d,n)}static mungeExecutionPreference(t,e){let r=t===void 0||t==="auto";if((0,xo.isSafari)(globalThis)){if(r||t==="inline")return"inline";if(!r)throw new Error(`Unsupported execution preference ${t}`)}if(t==="worker-sab"&&!(0,xo.supportsSharedArrayBuffer)(globalThis,globalThis,e))throw new Error(`Unsupported execution preference ${t}`);return t||"auto"}static configure(t,e){return sa(this,void 0,void 0,function*(){let{fetchBehavior:r,preResolve:n,logger:o}=e||{},{category:s="voicefocus",name:a="default",variant:l="auto",assetGroup:c=QH,revisionID:d,simd:u="detect",mode:f="ns",executionPreference:m="auto",executionQuantaPreference:S,usagePreference:T="interactivity",estimatorBudget:_=100,paths:C=XH,thresholds:I}=t||{};if(o?.debug("Configuring Voice Focus with spec",t),s!==void 0&&s!=="voicefocus")throw new Error(`Unrecognized category ${s}`);if(a!==void 0&&a!=="default"&&a!=="ns_es")throw new Error(`Unrecognized feature name ${a}`);if(l!==void 0&&!["auto","c100","c50","c20","c10"].includes(l))throw new Error(`Unrecognized feature variant ${l}`);if(S!==void 0&&![1,2,3].includes(S))throw new Error(`Unrecognized execution quanta preference ${S}`);if(YH(c,d),u!==void 0&&!["detect","force","disable"].includes(u))throw new Error(`Unrecognized SIMD option ${u}`);if(m!==void 0&&!["auto","inline","worker","worker-sab","worker-postMessage"].includes(m))throw new Error(`Unrecognized execution preference ${m}`);if(T!==void 0&&!["quality","interactivity"].includes(T))throw new Error(`Unrecognized usage preference ${T}`);let A={executionPreference:this.mungeExecutionPreference(m,o),usagePreference:T,executionQuantaPreference:S,variantPreference:l,namePreference:a,simdPreference:u,estimatorBudget:_},E=d?{revisionID:d}:{assetGroup:c},V=(0,aa.addQueryParams)(r,E),W=Object.assign({paths:C},V),D=yield(0,ez.measureAndDecideExecutionApproach)(A,W,o,I);if(D.supported===!1)return{supported:!1,reason:D.reason};o?.info("Decided execution approach",D);let{useSIMD:N,processor:F,variant:G,executionQuanta:oe}=D,ze={category:s||"voicefocus",name:a||"default",mode:f,variant:G,simd:N};if(n){let oi=ZH(ze,C);ze.url=yield(0,aa.resolveURL)(oi,V)}return{fetchConfig:W,model:ze,processor:F,executionQuanta:oe,supported:!0}})}static init(t,{delegate:e,preload:r=!0,logger:n}){return sa(this,void 0,void 0,function*(){if(t.supported===!1)throw new Error("Voice Focus not supported. Reason: "+t.reason);let{model:o,processor:s,fetchConfig:a,executionQuanta:l}=t,{simd:c,name:d,mode:u}=o,{paths:f}=a;if(s!=="voicefocus-inline-processor"&&s!=="voicefocus-worker-postMessage-processor"&&s!=="voicefocus-worker-sab-processor")throw new Error(`Unknown processor ${s}`);let m=o.url||ZH(o,f);n?.debug(`Using model URL ${m}.`);let S=`${f.wasm}audio_buffer-v1${c?"_simd":""}.wasm`,T=`${f.wasm}resampler-v1${c?"_simd":""}.wasm`,_=`${f.workers}worker-v1.js`,{file:C,node:I}=dX[s],A=`${f.processors}${C}`,E=yield(0,eX.loadWorker)(_,"VoiceFocusWorker",a,n);if(r){n?.debug("Preloading",m);let N=(0,xo.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";E.postMessage({message:N,preload:!0,key:"model",fetchBehavior:a,path:m})}let W={processor:s,worker:E,audioBufferURL:S,resamplerURL:T,fetchBehavior:a,modelURL:m,delegate:e,logger:n,numberOfInputs:d==="ns_es"?2:1,mode:u},D=new i(E,A,I,W,l,n);return Promise.resolve(D)})}createNode(t,e){var r;if(this.internal.isDestroyed)throw new Error("Unable to create node because VoiceFocus worker has been destroyed.");let{voiceFocusSampleRate:n=t.sampleRate===16e3?16e3:48e3,enabled:o=!0,agc:s=tz}=e||{},a=e?.es,l={voiceFocusSampleRate:n,enabled:o,sendBufferCount:10,prefill:6,agc:s,executionQuanta:this.executionQuanta,supportFarendStream:a,mode:this.nodeOptions.mode},c=(0,aa.withQueryString)(this.processorURL,(r=this.nodeOptions)===null||r===void 0?void 0:r.fetchBehavior);return t.audioWorklet.addModule(c).then(()=>new this.nodeConstructor(t,Object.assign(Object.assign({},this.nodeOptions),{processorOptions:l})))}applyToStream(t,e,r){return sa(this,void 0,void 0,function*(){if(this.internal.isDestroyed)throw new Error("Unable to apply stream because VoiceFocus worker has been destroyed");let n=e.createMediaStreamSource(t),o=yield this.applyToSourceNode(n,e,r),s=e.createMediaStreamDestination();return o.connect(s),this.internal=Object.assign(Object.assign({},this.internal),{voiceFocusNode:o,sourceNode:n,destinationNode:s,audioContext:e}),{node:o,source:n,destination:s,stream:s.stream}})}applyToSourceNode(t,e,r){return sa(this,void 0,void 0,function*(){let n=yield this.createNode(e,r);return t.connect(n),n})}};Ii.VoiceFocus=du;var lX=(i=oX)=>new(window.AudioContext||window.webkitAudioContext)(i);Ii.createAudioContext=lX;var uX=(i,t,e)=>sa(void 0,void 0,void 0,function*(){var r,n;let{constraints:o,spec:s,delegate:a,preload:l=!0,options:c}=t,{logger:d}=e,u=yield du.configure(s,e);if(!u.supported)return(r=e.logger)===null||r===void 0||r.warn("Voice Focus not supported; returning standard stream."),window.navigator.mediaDevices.getUserMedia(o);let f=yield du.init(u,{delegate:a,preload:l,logger:d}),m=((n=t.options)===null||n===void 0?void 0:n.agc)||tz,S=yield window.navigator.mediaDevices.getUserMedia(cX(o,m));return f.applyToStream(S,i,c).then(T=>T.stream)});Ii.getAudioInput=uX});var nz=y(XE=>{"use strict";Object.defineProperty(XE,"__esModule",{value:!0});function Tp(i){return i.map(t=>typeof t=="object"?JSON.stringify(t):`${t}`).join(" ")}var QE=class{constructor(t){this.base=t}debug(...t){this.base.debug(Tp(t))}info(...t){this.base.info(Tp(t))}warn(...t){this.base.warn(Tp(t))}error(...t){this.base.error(Tp(t))}};XE.default=QE});var ZE=y(Oo=>{"use strict";var ni=Oo&&Oo.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},fX=Oo&&Oo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Oo,"__esModule",{value:!0});var hX=fX(We()),YE=class i{constructor(t,e,r,n,o=!1,s=void 0,a=new hX.default,l=new Map,c=void 0,d=void 0){this.device=t,this.voiceFocus=e,this.delegate=r,this.nodeOptions=n,this.failed=o,this.node=s,this.browserBehavior=a,this.farEndStreamToAudioSourceNode=l,this.mixDestNode=c,this.mixSourceNode=d}getInnerDevice(){return this.device}mute(t){return ni(this,void 0,void 0,function*(){this.node&&(t?yield this.node.disable():yield this.node.enable())})}stop(){return ni(this,void 0,void 0,function*(){this.node&&(this.node.disconnect(),yield this.node.stop())})}chooseNewInnerDevice(t){return ni(this,void 0,void 0,function*(){return this.device===t&&!pX(t)?this:new i(t,this.voiceFocus,this.delegate,this.nodeOptions,this.failed,this.node,this.browserBehavior,this.farEndStreamToAudioSourceNode,this.mixDestNode,this.mixSourceNode)})}intrinsicDevice(){return ni(this,void 0,void 0,function*(){if(this.failed)return this.device;let t=this.nodeOptions.es,e={echoCancellation:!t,googEchoCancellation:!t,googEchoCancellation2:!t,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googNoiseSuppression2:!1},r;return this.nodeOptions&&this.nodeOptions.agc!==void 0?r=this.nodeOptions.agc.useBuiltInAGC:r=!0,e.autoGainControl=r,e.googAutoGainControl=r,e.googAutoGainControl2=r,this.device?typeof this.device=="string"?(this.browserBehavior.requiresNoExactMediaStreamConstraints()?e.deviceId=this.device:e.deviceId={exact:this.device},e):this.device.id?this.device:Object.assign(Object.assign({},this.device),e):e})}createAudioNode(t){var e,r;return ni(this,void 0,void 0,function*(){if(((e=this.node)===null||e===void 0?void 0:e.context)===t)return{start:this.node,end:this.node};let o=Object.assign({enabled:!0,agc:{useVoiceFocusAGC:!1}},this.nodeOptions);try{if((r=this.node)===null||r===void 0||r.disconnect(),this.node=yield this.voiceFocus.createNode(t,o),this.nodeOptions.es){this.mixDestNode=new MediaStreamAudioDestinationNode(t,{channelCount:1,channelCountMode:"explicit"});for(let l of this.farEndStreamToAudioSourceNode.keys())this.assignFarEndStreamToAudioSourceNode(l);this.createMixSourceNode()}let s=this.node,a=this.node;return{start:s,end:a}}catch(s){throw this.failed=!0,this.delegate.onFallback(this,s),s}})}observeMeetingAudio(t){return ni(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;t.addAudioMixObserver(this);let e=yield t.getCurrentMeetingAudioStream();e&&this.addFarEndStream(e)})}unObserveMeetingAudio(t){return ni(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;t.removeAudioMixObserver(this);let e=yield t.getCurrentMeetingAudioStream();e&&this.removeFarendStream(e)})}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}addFarEndStream(t){return ni(this,void 0,void 0,function*(){!this.nodeOptions.es||!t||this.farEndStreamToAudioSourceNode.has(t)||(this.node?this.assignFarEndStreamToAudioSourceNode(t):this.farEndStreamToAudioSourceNode.set(t,null))})}removeFarendStream(t){var e;return ni(this,void 0,void 0,function*(){(e=this.farEndStreamToAudioSourceNode.get(t))===null||e===void 0||e.disconnect(),this.farEndStreamToAudioSourceNode.delete(t)})}meetingAudioStreamBecameActive(t){return ni(this,void 0,void 0,function*(){this.addFarEndStream(t)})}meetingAudioStreamBecameInactive(t){return ni(this,void 0,void 0,function*(){this.removeFarendStream(t)})}assignFarEndStreamToAudioSourceNode(t){let e=this.node.context.createMediaStreamSource(t);e.channelCount=1,e.channelCountMode="explicit",this.farEndStreamToAudioSourceNode.set(t,e),e.connect(this.mixDestNode,0)}createMixSourceNode(){this.mixSourceNode=this.node.context.createMediaStreamSource(this.mixDestNode.stream),this.mixSourceNode.channelCount=1,this.mixSourceNode.channelCountMode="explicit",this.mixSourceNode.connect(this.node,0,1)}};function pX(i){return i==="default"?!0:!i||typeof i!="object"?!1:"deviceId"in i&&i.deviceId==="default"||"id"in i&&i.id==="default"}Oo.default=YE});var oz=y(tI=>{"use strict";Object.defineProperty(tI,"__esModule",{value:!0});var eI=class{constructor(){this.observers=new Set}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}onFallback(t,e){var r;for(let n of this.observers)(r=n.voiceFocusFellBackToInnerStream)===null||r===void 0||r.call(n,t,e)}onCPUWarning(){var t;for(let e of this.observers)(t=e.voiceFocusInsufficientResources)===null||t===void 0||t.call(e)}};tI.default=eI});var az=y(Yi=>{"use strict";var Lr=Yi&&Yi.__awaiter||function(i,t,e,r){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(d){try{c(r.next(d))}catch(u){s(u)}}function l(d){try{c(r.throw(d))}catch(u){s(u)}}function c(d){d.done?o(d.value):n(d.value).then(a,l)}c((r=r.apply(i,t||[])).next())})},Ip=Yi&&Yi.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Yi,"__esModule",{value:!0});Yi.VoiceFocusDeviceTransformer=void 0;var iI=rz(),mX=hr(),rI=Ip(Vt()),sz=Ip(nz()),gX=Ip(ZE()),SX=Ip(oz()),Ep=class i{constructor(t,{preload:e=!0,logger:r,fetchBehavior:n=i.defaultFetchBehavior()},o){this.spec=t,this.supported=!0,this.logger=r,this.vfLogger=r?new sz.default(r):void 0,this.preload=e,this.fetchBehavior=n,this.spec=i.augmentSpec(this.spec),o&&(this.configuration=Promise.resolve(o))}static isSupported(t,e){var r,n;let o=i.defaultFetchBehavior(),s=e?.logger?new sz.default(e.logger):void 0,a={fetchBehavior:o,logger:s};if(mX.isIFramed()){if(e?.allowIFrame===!1)return(r=e?.logger)===null||r===void 0||r.error("Amazon Voice Focus support check inside iframe: not supported."),Promise.resolve(!1);(n=e?.logger)===null||n===void 0||n.warn("Amazon Voice Focus support check inside iframe: not recommended.")}return iI.VoiceFocus.isSupported(i.augmentSpec(t),a)}static create(t={},e={},r,n,o){var s,a,l;return Lr(this,void 0,void 0,function*(){n&&n.Meeting.Meeting&&(n=n.Meeting);let c=((l=(a=(s=n?.Meeting)===null||s===void 0?void 0:s.MeetingFeatures)===null||a===void 0?void 0:a.Audio)===null||l===void 0?void 0:l.EchoReduction)==="AVAILABLE",d=r&&r.supported===!0&&r.model.name==="ns_es"&&!c,u=t.name==="ns_es"&&!c;if(d||u)throw new Error("Echo Reduction requested but not enabled.");let f=new i(t,e,r);return yield f.init(),f})}static configure(t={},e={}){return Lr(this,void 0,void 0,function*(){return new i(t,e,void 0).configure(!0)})}getConfiguration(){return this.configuration}isSupported(){return this.supported}createTransformDevice(t,e){return Lr(this,void 0,void 0,function*(){if(this.supported)try{let[n,o]=yield this.allocateVoiceFocus(!0),s=Object.assign(Object.assign({},e),{es:this.spec.name==="ns_es"});return new gX.default(t,n,o,s)}catch{return}})}static destroyVoiceFocus(t){var e;return Lr(this,void 0,void 0,function*(){(e=t?.vf)===null||e===void 0||e.destroy()})}static augmentSpec(t){return!t||!t.assetGroup&&!t.revisionID?Object.assign(Object.assign({},t),{assetGroup:i.currentSDKAssetGroup()}):t}configure(t=!1){return Lr(this,void 0,void 0,function*(){let e={fetchBehavior:this.fetchBehavior,preResolve:t,logger:this.vfLogger};return iI.VoiceFocus.configure(this.spec,e)})}init(){var t;return Lr(this,void 0,void 0,function*(){this.configuration||(this.configuration=this.configure());let e=yield this.configuration;if(!e.supported){this.supported=!1;return}this.pendingVoiceFocus=this.createVoiceFocus(e,this.preload);try{yield this.pendingVoiceFocus}catch(r){(t=this.logger)===null||t===void 0||t.error(`Unable to initialize Amazon Voice Focus: ${r}`),this.supported=!1}})}createVoiceFocus(t,e){return Lr(this,void 0,void 0,function*(){let r=new SX.default;return this.vf=yield iI.VoiceFocus.init(t,{delegate:r,preload:e,logger:this.vfLogger}),[this.vf,r]})}allocateVoiceFocus(t){return Lr(this,void 0,void 0,function*(){if(!this.supported)throw new Error("Not supported.");if(this.pendingVoiceFocus){let e=this.pendingVoiceFocus;return this.pendingVoiceFocus=void 0,e}return this.createVoiceFocus(yield this.configuration,t)})}static majorVersion(){return rI.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|[1-9][0-9]*)/)[0]}static majorMinorVersion(){return rI.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|(?:[1-9][0-9]*))\.(?:0|[1-9][0-9]*)/)[0]}static currentSDKAssetGroup(){let t=this.majorVersion();return t?`sdk-${t}`:"stable-v1"}static defaultFetchBehavior(){let t=i.majorMinorVersion()||"unknown",e=rI.default.sdkUserAgentLowResolution;return{escapedQueryString:`sdk=${encodeURIComponent(t)}&ua=${encodeURIComponent(e)}`}}};Yi.VoiceFocusDeviceTransformer=Ep;Yi.default=Ep});var CM=y(g=>{var b=g&&g.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(g,"__esModule",{value:!0});g.DefaultEventController=g.DefaultDevicePixelRatioMonitor=g.DefaultDeviceController=g.DefaultContentShareController=g.DefaultBrowserBehavior=g.DefaultAudioVideoFacade=g.DefaultAudioVideoController=g.DefaultAudioMixController=g.DefaultActiveSpeakerPolicy=g.DefaultActiveSpeakerDetector=g.DataMessage=g.CreateSDPTask=g.CreatePeerConnectionTask=g.ContentShareMediaStreamBroker=g.ContentShareConstants=g.ConsoleLogger=g.ConnectionHealthPolicyConfiguration=g.ConnectionHealthData=g.ClientVideoStreamReceivingReport=g.ClientMetricReportMediaType=g.ClientMetricReportDirection=g.ClientMetricReport=g.CleanStoppedSessionTask=g.CleanRestartedSessionTask=g.CheckVideoInputFeedback=g.CheckVideoConnectivityFeedback=g.CheckNetworkUDPConnectivityFeedback=g.CheckNetworkTCPConnectivityFeedback=g.CheckContentShareConnectivityFeedback=g.CheckCameraResolutionFeedback=g.CheckAudioOutputFeedback=g.CheckAudioInputFeedback=g.CheckAudioConnectivityFeedback=g.CanvasVideoFrameBuffer=g.CSPMonitor=g.BitrateParameters=g.BaseTask=g.BaseConnectionHealthPolicy=g.BackgroundReplacementVideoFrameProcessor=g.BackgroundFilterVideoFrameProcessor=g.BackgroundBlurVideoFrameProcessor=g.BackgroundBlurStrength=g.AudioVideoControllerState=g.AudioProfile=g.AudioLogEvent=g.Attendee=g.AttachMediaInputTask=g.AsyncScheduler=g.ApplicationMetadata=g.AllHighestVideoBandwidthPolicy=void 0;g.MeetingFeatures=g.MeetingEventsClientConfiguration=g.MediaDeviceProxyHandler=g.Maybe=g.LogLevel=g.Log=g.ListenForVolumeIndicatorsTask=g.LeaveAndReceiveLeaveAckTask=g.JoinAndReceiveIndexTask=g.IntervalScheduler=g.InMemoryJSONEventBuffer=g.GlobalMetricReport=g.GetUserMediaError=g.FullJitterLimitedBackoff=g.FullJitterBackoffFactory=g.FullJitterBackoff=g.FinishGatheringICECandidatesTask=g.EventIngestionConfiguration=g.EventBufferConfiguration=g.DeviceSelection=g.DevicePixelRatioWindowSource=g.DefaultWebSocketAdapter=g.DefaultVolumeIndicatorAdapter=g.DefaultVideoTransformDevice=g.DefaultVideoTileFactory=g.DefaultVideoTileController=g.DefaultVideoTile=g.DefaultVideoStreamIndex=g.DefaultVideoStreamIdSet=g.DefaultVideoFrameProcessorTimer=g.DefaultVideoFrameProcessorPipeline=g.DefaultVideoElementResolutionMonitor=g.DefaultVideoCaptureAndEncodeParameter=g.DefaultUserAgentParser=g.DefaultTranscriptionController=g.DefaultTransceiverController=g.DefaultSimulcastUplinkPolicyForContentShare=g.DefaultSimulcastUplinkPolicy=g.DefaultSignalingClient=g.DefaultSigV4=g.DefaultSessionStateController=g.DefaultReconnectController=g.DefaultRealtimeController=g.DefaultPingPong=g.DefaultModality=g.DefaultMessagingSession=g.DefaultMeetingSession=g.DefaultMeetingReadinessChecker=g.DefaultMeetingEventReporter=g.DefaultMediaDeviceFactory=void 0;g.RedundantAudioEncoder=g.ReconnectionHealthPolicy=g.ReceiveVideoStreamIndexTask=g.ReceiveVideoInputTask=g.ReceiveRemoteVideoPauseResumeTask=g.ReceiveAudioInputTask=g.RealtimeVolumeIndicator=g.RealtimeState=g.RealtimeAttendeePositionInFrame=g.PromoteToPrimaryMeetingTask=g.PromiseQueue=g.PrefetchSortBy=g.PrefetchOn=g.PermissionDeniedError=g.ParallelGroupTask=g.POSTLogger=g.OverconstrainedError=g.OpenSignalingConnectionTask=g.OnceTask=g.NotReadableError=g.NotFoundError=g.None=g.NoVideoUplinkBandwidthPolicy=g.NoVideoDownlinkBandwidthPolicy=g.NoOpVideoFrameProcessor=g.NoOpVideoElementFactory=g.NoOpTask=g.NoOpMediaStreamBroker=g.NoOpLogger=g.NoOpEventReporter=g.NoOpDeviceController=g.NoOpDebugLogger=g.NoOpAudioVideoController=g.NScaleVideoUplinkBandwidthPolicy=g.MutableVideoPreferences=g.MultiLogger=g.MonitorTask=g.ModelSpecBuilder=g.MessagingSessionConfiguration=g.Message=g.MeetingSessionVideoAvailability=g.MeetingSessionURLs=g.MeetingSessionTURNCredentials=g.MeetingSessionStatusCode=g.MeetingSessionStatus=g.MeetingSessionLifecycleEventCondition=g.MeetingSessionLifecycleEvent=g.MeetingSessionCredentials=g.MeetingSessionConfiguration=g.MeetingReadinessCheckerConfiguration=void 0;g.VideoEncodingConcurrentSendersHealthPolicy=g.VideoCodecCapability=g.VideoAdaptiveProbePolicy=g.Versioning=g.UnusableAudioWarningConnectionHealthPolicy=g.TypeError=g.TranscriptionStatusType=g.TranscriptionStatus=g.TranscriptResult=g.TranscriptLanguageWithScore=g.TranscriptItemType=g.TranscriptItem=g.TranscriptEntity=g.TranscriptAlternative=g.Transcript=g.TimeoutTask=g.TimeoutScheduler=g.TaskStatus=g.TargetDisplaySize=g.SubscribeAndReceiveSubscribeAckTask=g.StreamMetricReport=g.Some=g.SingleNodeAudioTransformDevice=g.SimulcastVideoStreamIndex=g.SimulcastTransceiverController=g.SimulcastLayers=g.SimulcastContentShareTransceiverController=g.SignalingClientVideoSubscriptionConfiguration=g.SignalingClientSubscribe=g.SignalingClientJoin=g.SignalingClientEventType=g.SignalingClientEvent=g.SignalingClientConnectionRequest=g.SignalingAndMetricsConnectionMonitor=g.SetRemoteDescriptionTask=g.SetLocalDescriptionTask=g.SessionStateControllerTransitionResult=g.SessionStateControllerState=g.SessionStateControllerDeferPriority=g.SessionStateControllerAction=g.ServerSideNetworkAdaption=g.SerialGroupTask=g.SendingAudioFailureConnectionHealthPolicy=g.SendAndReceiveDataMessagesTask=g.SDPMediaSection=g.SDPCandidateType=g.SDP=g.RunnableTask=g.RedundantAudioRecoveryMetricReport=g.RedundantAudioEncoderWorkerCode=void 0;g.isVideoTransformDevice=g.isDestroyable=g.isAudioTransformDevice=g.ZLIBTextCompressor=g.WebSocketReadyState=g.WaitForAttendeePresenceTask=g.VoiceFocusTransformDevice=g.VoiceFocusDeviceTransformer=g.VideoTileState=g.VideoStreamDescription=g.VideoSource=g.VideoQualitySettings=g.VideoQualityAdaptationPreference=g.VideoPriorityBasedPolicyConfig=g.VideoPriorityBasedPolicy=g.VideoPreferences=g.VideoPreference=g.VideoOnlyTransceiverController=g.VideoLogEvent=g.VideoFxProcessor=g.VideoEncodingFramerateConnectionHealthPolicy=g.VideoEncodingCpuConnectionHealthPolicy=g.VideoEncodingConnectionHealthPolicyName=void 0;var yX=b(gu());g.AllHighestVideoBandwidthPolicy=yX.default;var vX=b(vI());g.ApplicationMetadata=vX.default;var bX=b(wt());g.AsyncScheduler=bX.default;var wX=b(Jp());g.AttachMediaInputTask=wX.default;var CX=b(Yp());g.Attendee=CX.default;var _X=b(vu());g.AudioLogEvent=_X.default;var TX=b(Cu());g.AudioProfile=TX.default;var EX=b(im());g.AudioVideoControllerState=EX.default;var IX=b(Ca());g.BackgroundBlurStrength=IX.default;var AX=b(iA());g.BackgroundBlurVideoFrameProcessor=AX.default;var kX=b(Iu());g.BackgroundFilterVideoFrameProcessor=kX.default;var MX=b(aA());g.BackgroundReplacementVideoFrameProcessor=MX.default;var xX=b(er());g.BaseConnectionHealthPolicy=xX.default;var OX=b(_e());g.BaseTask=OX.default;var PX=b(Bm());g.BitrateParameters=PX.default;var RX=b(Ou());g.CSPMonitor=RX.default;var DX=b(ka());g.CanvasVideoFrameBuffer=DX.default;var NX=b(Um());g.CheckAudioConnectivityFeedback=NX.default;var LX=b(qm());g.CheckAudioInputFeedback=LX.default;var FX=b(Hm());g.CheckAudioOutputFeedback=FX.default;var BX=b(zm());g.CheckCameraResolutionFeedback=BX.default;var VX=b($m());g.CheckContentShareConnectivityFeedback=VX.default;var UX=b(jm());g.CheckNetworkTCPConnectivityFeedback=UX.default;var qX=b(Wm());g.CheckNetworkUDPConnectivityFeedback=qX.default;var HX=b(Gm());g.CheckVideoConnectivityFeedback=HX.default;var zX=b(Km());g.CheckVideoInputFeedback=zX.default;var $X=b(Qm());g.CleanRestartedSessionTask=$X.default;var jX=b(Ym());g.CleanStoppedSessionTask=jX.default;var WX=b(Sg());g.ClientMetricReport=WX.default;var GX=b(Jo());g.ClientMetricReportDirection=GX.default;var KX=b(Xo());g.ClientMetricReportMediaType=KX.default;var JX=b(vk());g.ClientVideoStreamReceivingReport=JX.default;var QX=b(Cg());g.ConnectionHealthData=QX.default;var XX=b(Og());g.ConnectionHealthPolicyConfiguration=XX.default;var YX=b(Au());g.ConsoleLogger=YX.default;var ZX=b(es());g.ContentShareConstants=ZX.default;var eY=b(SS());g.ContentShareMediaStreamBroker=eY.default;var tY=b(yS());g.CreatePeerConnectionTask=tY.default;var iY=b(kS());g.CreateSDPTask=iY.default;var rY=b(OS());g.DataMessage=rY.default;var nY=b(RS());g.DefaultActiveSpeakerDetector=nY.default;var oY=b(jk());g.DefaultActiveSpeakerPolicy=oY.default;var sY=b(Ku());g.DefaultAudioMixController=sY.default;var aY=b(Uf());g.DefaultAudioVideoController=aY.default;var dY=b(ww());g.DefaultAudioVideoFacade=dY.default;var cY=b(We());g.DefaultBrowserBehavior=cY.default;var lY=b(Lw());g.DefaultContentShareController=lY.default;var uY=b($u());g.DefaultDeviceController=uY.default;var fY=b(Jb());g.DefaultDevicePixelRatioMonitor=fY.default;var hY=b(Gf());g.DefaultEventController=hY.default;var pY=b(Bg());g.DefaultMediaDeviceFactory=pY.default;var mY=b(Kw());g.DefaultMeetingEventReporter=mY.default;var gY=b(KO());g.DefaultMeetingReadinessChecker=gY.default;var SY=b(tP());g.DefaultMeetingSession=SY.default;var yY=b(lH());g.DefaultMessagingSession=yY.default;var vY=b(sr());g.DefaultModality=vY.default;var bY=b(jS());g.DefaultPingPong=bY.default;var wY=b(gy());g.DefaultRealtimeController=wY.default;var CY=b(Cc());g.DefaultReconnectController=CY.default;var _Y=b(by());g.DefaultSessionStateController=_Y.default;var TY=b(WT());g.DefaultSigV4=TY.default;var EY=b(Ty());g.DefaultSignalingClient=EY.default;var IY=b(lw());g.DefaultSimulcastUplinkPolicy=IY.default;var AY=b(Pw());g.DefaultSimulcastUplinkPolicyForContentShare=AY.default;var kY=b(zd());g.DefaultTransceiverController=kY.default;var MY=b(sy());g.DefaultTranscriptionController=MY.default;var xY=b($w());g.DefaultUserAgentParser=xY.default;var OY=b(Ms());g.DefaultVideoCaptureAndEncodeParameter=OY.default;var PY=b(tw());g.DefaultVideoElementResolutionMonitor=PY.default;var RY=b(Wg());g.DefaultVideoFrameProcessorPipeline=RY.default;var DY=b(zg());g.DefaultVideoFrameProcessorTimer=DY.default;var NY=b(Fr());g.DefaultVideoStreamIdSet=NY.default;var LY=b(Df());g.DefaultVideoStreamIndex=LY.default;var FY=b(Wa());g.DefaultVideoTile=FY.default;var BY=b(rw());g.DefaultVideoTileController=BY.default;var VY=b(ow());g.DefaultVideoTileFactory=VY.default;var UY=b(Jg());g.DefaultVideoTransformDevice=UY.default;var qY=b(pw());g.DefaultVolumeIndicatorAdapter=qY.default;var HY=b(Tc());g.DefaultWebSocketAdapter=HY.default;var zY=b(Yb());g.DevicePixelRatioWindowSource=zY.default;var $Y=b(nS());g.DeviceSelection=$Y.default;var jY=b(Vw());g.EventBufferConfiguration=jY.default;var WY=b(qw());g.EventIngestionConfiguration=WY.default;var GY=b(Ny());g.FinishGatheringICECandidatesTask=GY.default;var KY=b(Ar());g.FullJitterBackoff=KY.default;var JY=b(fH());g.FullJitterBackoffFactory=JY.default;var QY=b(ZT());g.FullJitterLimitedBackoff=QY.default;var XY=b(ar());g.GetUserMediaError=XY.default;var YY=b(pg());g.GlobalMetricReport=YY.default;var ZY=b(Ww());g.InMemoryJSONEventBuffer=ZY.default;var eZ=b(nr());g.IntervalScheduler=eZ.default;var tZ=b(Hy());g.JoinAndReceiveIndexTask=tZ.default;var iZ=b($y());g.LeaveAndReceiveLeaveAckTask=iZ.default;var rZ=b(Wy());g.ListenForVolumeIndicatorsTask=rZ.default;var nZ=b(rE());g.Log=nZ.default;var oZ=b(Bt());g.LogLevel=oZ.default;var sZ=b(Lg());g.MediaDeviceProxyHandler=sZ.default;var aZ=b(Xw());g.MeetingEventsClientConfiguration=aZ.default;var dZ=b(_w());g.MeetingFeatures=dZ.default;var cZ=b(iC());g.MeetingReadinessCheckerConfiguration=cZ.default;var lZ=b(Hf());g.MeetingSessionConfiguration=lZ.default;var uZ=b(lc());g.MeetingSessionCredentials=uZ.default;var fZ=b(Py());g.MeetingSessionLifecycleEvent=fZ.default;var hZ=b(Ry());g.MeetingSessionLifecycleEventCondition=hZ.default;var pZ=b(un());g.MeetingSessionStatus=pZ.default;var mZ=b(jt());g.MeetingSessionStatusCode=mZ.default;var gZ=b(By());g.MeetingSessionTURNCredentials=gZ.default;var SZ=b(qf());g.MeetingSessionURLs=SZ.default;var yZ=b(Ju());g.MeetingSessionVideoAvailability=yZ.default;var vZ=b(LT());g.Message=vZ.default;var bZ=b(hH());g.MessagingSessionConfiguration=bZ.default;var wZ=b(om());g.ModelSpecBuilder=wZ.default;var CZ=b(tv());g.MonitorTask=CZ.default;var _Z=b(pH());g.MultiLogger=_Z.default;var TZ=b(fw());g.NScaleVideoUplinkBandwidthPolicy=TZ.default;var EZ=b(yH());g.NoOpAudioVideoController=EZ.default;var IZ=b(cE());g.NoOpDebugLogger=IZ.default;var AZ=b(bH());g.NoOpDeviceController=AZ.default;var kZ=b(wH());g.NoOpEventReporter=kZ.default;var MZ=b(dp());g.NoOpLogger=MZ.default;var xZ=b(cp());g.NoOpMediaStreamBroker=xZ.default;var OZ=b(CH());g.NoOpTask=OZ.default;var PZ=b(_H());g.NoOpVideoElementFactory=PZ.default;var RZ=b(ku());g.NoOpVideoFrameProcessor=RZ.default;var DZ=b(xw());g.NoVideoDownlinkBandwidthPolicy=DZ.default;var NZ=b(TH());g.NoVideoUplinkBandwidthPolicy=NZ.default;var LZ=b(dS());g.NotFoundError=LZ.default;var FZ=b(lS());g.NotReadableError=FZ.default;var BZ=b($p());g.OnceTask=BZ.default;var VZ=b(av());g.OpenSignalingConnectionTask=VZ.default;var UZ=b(fS());g.OverconstrainedError=UZ.default;var qZ=b(IH());g.POSTLogger=qZ.default;var HZ=b(cv());g.ParallelGroupTask=HZ.default;var zZ=b(Uu());g.PermissionDeniedError=zZ.default;var $Z=b(JT());g.PrefetchOn=$Z.default;var jZ=b(AH());g.PrefetchSortBy=jZ.default;var WZ=b(qg());g.PromiseQueue=WZ.default;var GZ=b(uv());g.PromoteToPrimaryMeetingTask=GZ.default;var KZ=b(kH());g.RealtimeAttendeePositionInFrame=KZ.default;var JZ=b(ly());g.RealtimeState=JZ.default;var QZ=b(hy());g.RealtimeVolumeIndicator=QZ.default;var XZ=b(hv());g.ReceiveAudioInputTask=XZ.default;var YZ=b(mv());g.ReceiveRemoteVideoPauseResumeTask=YZ.default;var ZZ=b(Sv());g.ReceiveVideoInputTask=ZZ.default;var eee=b(bv());g.ReceiveVideoStreamIndexTask=eee.default;var tee=b(Ky());g.ReconnectionHealthPolicy=tee.default;var iee=b(xb());g.RedundantAudioEncoder=iee.default;var ree=b(Pb());g.RedundantAudioEncoderWorkerCode=ree.default;var nee=b(nf());g.RedundantAudioRecoveryMetricReport=nee.default;var oee=b(MH());g.RunnableTask=oee.default;var see=b(an());g.SDP=see.default;var aee=b(vS());g.SDPCandidateType=aee.default;var dee=b(CS());g.SDPMediaSection=dee.default;var cee=b(_v());g.SendAndReceiveDataMessagesTask=cee.default;var lee=b(Qy());g.SendingAudioFailureConnectionHealthPolicy=lee.default;var uee=b(Ev());g.SerialGroupTask=uee.default;var fee=b(li());g.ServerSideNetworkAdaption=fee.default;var hee=b(Yu());g.SessionStateControllerAction=hee.default;var pee=b(Sy());g.SessionStateControllerDeferPriority=pee.default;var mee=b(Zu());g.SessionStateControllerState=mee.default;var gee=b(ef());g.SessionStateControllerTransitionResult=gee.default;var See=b(kv());g.SetLocalDescriptionTask=See.default;var yee=b(xv());g.SetRemoteDescriptionTask=yee.default;var vee=b(VS());g.SignalingAndMetricsConnectionMonitor=vee.default;var bee=b(nv());g.SignalingClientConnectionRequest=bee.default;var wee=b(Cy());g.SignalingClientEvent=wee.default;var Cee=b(Ge());g.SignalingClientEventType=Cee.default;var _ee=b(Uy());g.SignalingClientJoin=_ee.default;var Tee=b(Cb());g.SignalingClientSubscribe=Tee.default;var Eee=b(rf());g.SignalingClientVideoSubscriptionConfiguration=Eee.default;var Iee=b(Af());g.SimulcastContentShareTransceiverController=Iee.default;var Aee=b(sw());g.SimulcastLayers=Aee.default;var kee=b($d());g.SimulcastTransceiverController=kee.default;var Mee=b(Gb());g.SimulcastVideoStreamIndex=Mee.default;var xee=b(xH());g.SingleNodeAudioTransformDevice=xee.default;var Oee=b(Oy());g.StreamMetricReport=Oee.default;var Pee=b(Eb());g.SubscribeAndReceiveSubscribeAckTask=Pee.default;var Ree=b(kf());g.TargetDisplaySize=Ree.default;var Dee=b(yu());g.TaskStatus=Dee.default;var Nee=b(Ro());g.TimeoutScheduler=Nee.default;var Lee=b(If());g.TimeoutTask=Lee.default;var Fee=b(KS());g.Transcript=Fee.default;var Bee=b(OH());g.TranscriptAlternative=Bee.default;var Vee=b(PH());g.TranscriptEntity=Vee.default;var Uee=b(RH());g.TranscriptItem=Uee.default;var qee=b(ry());g.TranscriptItemType=qee.default;var Hee=b(DH());g.TranscriptLanguageWithScore=Hee.default;var zee=b(NH());g.TranscriptResult=zee.default;var $ee=b(XS());g.TranscriptionStatus=$ee.default;var jee=b(ey());g.TranscriptionStatusType=jee.default;var Wee=b(mS());g.TypeError=Wee.default;var Gee=b(Yy());g.UnusableAudioWarningConnectionHealthPolicy=Gee.default;var Kee=b(Vt());g.Versioning=Kee.default;var Jee=b(zb());g.VideoAdaptiveProbePolicy=Jee.default;var Qee=b(sn());g.VideoCodecCapability=Qee.default;var Xee=b(Tg());g.VideoEncodingConcurrentSendersHealthPolicy=Xee.default;var Yee=b(Zo());g.VideoEncodingConnectionHealthPolicyName=Yee.default;var Zee=b(Ig());g.VideoEncodingCpuConnectionHealthPolicy=Zee.default;var ete=b(kg());g.VideoEncodingFramerateConnectionHealthPolicy=ete.default;var tte=b(zH());g.VideoFxProcessor=tte.default;var ite=b(Su());g.VideoLogEvent=ite.default;var rte=b(Nb());g.VideoOnlyTransceiverController=rte.default;var nte=b(Mf());g.VideoPreference=nte.default;var ote=b(Vn());g.VideoPreferences=ote.default;var ste=b(qb());g.VideoPriorityBasedPolicy=ste.default;var ate=b(xf());g.VideoPriorityBasedPolicyConfig=ate.default;var dte=b(od());g.VideoQualityAdaptationPreference=dte.default;var cte=b(Pi());g.VideoQualitySettings=cte.default;var lte=b(Ub());g.VideoSource=lte.default;var ute=b(Of());g.VideoStreamDescription=ute.default;var fte=b(Yg());g.VideoTileState=fte.default;var hte=b(az());g.VoiceFocusDeviceTransformer=hte.default;var pte=b(ZE());g.VoiceFocusTransformDevice=pte.default;var mte=b(kb());g.WaitForAttendeePresenceTask=mte.default;var gte=b(sd());g.WebSocketReadyState=gte.default;var Ste=b(vb());g.ZLIBTextCompressor=Ste.default;var yte=Vn();Object.defineProperty(g,"MutableVideoPreferences",{enumerable:!0,get:function(){return yte.MutableVideoPreferences}});var nI=_t();Object.defineProperty(g,"Some",{enumerable:!0,get:function(){return nI.Some}});Object.defineProperty(g,"None",{enumerable:!0,get:function(){return nI.None}});Object.defineProperty(g,"Maybe",{enumerable:!0,get:function(){return nI.Maybe}});var vte=tS();Object.defineProperty(g,"isAudioTransformDevice",{enumerable:!0,get:function(){return vte.isAudioTransformDevice}});var bte=mc();Object.defineProperty(g,"isDestroyable",{enumerable:!0,get:function(){return bte.isDestroyable}});var wte=Hu();Object.defineProperty(g,"isVideoTransformDevice",{enumerable:!0,get:function(){return wte.isVideoTransformDevice}})});return CM();})();
/*! Bundled license information:

tslib/tslib.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
